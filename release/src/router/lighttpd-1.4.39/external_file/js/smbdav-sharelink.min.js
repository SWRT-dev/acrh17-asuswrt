var g_storage=new myStorage,m=new lang,g_modal_url,g_modal_window_width=200,g_modal_window_height=80,g_show_modal=0,g_folder_array,g_file_array,g_root_path="",g_sharelink_openurl_key="",g_image_player_setting=null,client=new davlib.DavClient;client.initialize();function closeJqmWindow(){var c=$("div#modalWindow");$("iframe",c).attr("src","");c&&c.jqmHide()}function resizeJqmWindow(c,d){var b=$(".jqmWindow");b&&(b.css("width",c+"px"),b.css("height",d+"px"))}
function onMouseDownPicDIVHandler(c){if(c.button==2)return!1;openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openAudioPlayer(c){for(var d=[],b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].furl)=="mp3"&&d.push(g_file_array[b]);if(d.length==0)alert("No audio files");else{for(var e="",a=0,b=0;b<d.length;b++){var k=d[b].furl;c==k&&(a=b);e+=k;b!=d.length-1&&(e+=",")}d=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+c+"&alist="+e+"&index="+a+"&s=0";g_modal_window_width=480;g_modal_window_height=160;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
d&&d.jqmShow()}}
function openImageViewer(c){for(var d=[],b=0;b<g_file_array.length;b++){var e=getFileExt(g_file_array[b].furl);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&d.push(g_file_array[b])}if(d.length==0)alert(m.getString("msg_no_image_list"));else{for(b=e=0;b<d.length;b++)c==d[b].furl&&(e=b);c="";b=getPageSize();c+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+b[0]/2+"px; top: "+b[1]/2+'px; z-index: 2999;">';c+=
'<div class="barousel_image">';for(b=0;b<d.length;b++){var a=d[b].furl;c+=b==e?'<img src="" path="'+a+'" alt="" class="default"/>':'<img src="" path="'+a+'" alt="" class=""/>'}c+="</div>";c+='<div class="barousel_nav">';c+='<div class="barousel_content transparent" style="display: block; ">';for(b=0;b<d.length;b++)c+='<div class="',b==e&&(c+="default"),c+='" style="display: none; ">',c+='<p class="header">'+d[b].name+"</p>",c+="</div>";c+="</div>";c+="</div>";c+='<div class="barousel_loading" style="position:absolute;display:none;z-index=99;"><img src="/smb/css/load.gif" width="18px" height="18px"/></div>';
c+="</div>";$(c).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({name:"image_slide_show",manualCarousel:1,contentResize:0,startIndex:e,storage:g_storage,stringTable:m,enableExifFunc:0,enableShareFunc:0,closeHandler:function(){g_image_player_setting=null},initCompleteHandler:function(a){g_image_player_setting=a}});d=null}}
function openSelItem(c){var d=c.attr("uhref");c.attr("qtype");var b=c.attr("isdir");c.attr("isusb");var e=c.attr("uhref");c.attr("title");c=getFileExt(d);if(c=="mp4")if(isBrowser("msie")&&getInternetExplorerVersion()<=8)window.open(d);else{d=$("div#modalWindow");c="/smb/css/vlc_video.html?v="+e;c+="&showbutton=1";e=[];for(b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].furl)=="srt"&&e.push(g_file_array[b].furl);if(e.length>0){c+="&s=";for(b=0;b<e.length;b++)c+=e[b],b!=e.length-1&&(c+=";")}g_modal_url=
c;g_modal_window_width=655;g_modal_window_height=580;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_videoplayer"));d&&d.jqmShow()}else if(c=="mp3")openAudioPlayer(d);else{if(c=="doc"||c=="docx"||c=="ppt"||c=="pptx"||c=="xls"||c=="xlsx"||c=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){window.open("https://docs.google.com/viewer?url="+d);return}c=="jpg"||c=="jpeg"||c=="png"||c=="gif"?openImageViewer(d):b==1?doPROPFIND(d,null,0):window.open(d)}}
function sortByName(c,d){var b=c.name.toLowerCase(),e=d.name.toLowerCase();return b<e?-1:b>e?1:0}
function createThumbView(c,d,b,e){var a="";$("div#fileview").empty();if(c!=2){var k=decodeURI(d),E=decodeURI(g_root_path);k.indexOf(E)!=-1&&(a+='<div class="albumDiv">',a+='<table class="thumb-table-parent">',a+="<tbody>",a+="<tr><td>",a+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',a+=d,a+='">',a+='<div class="parentDiv bicon"></div></div>',a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo">',a+='<a id="list_item" qtype="1" isdir="1" uhref="',a+=d,a+='" title="'+m.getString("btn_prevpage")+
'" online="0">'+m.getString("btn_prevpage"),a+="</a>",a+="</div>",a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>");for(d=0;d<b.length;d++)k=m.getString("table_filename")+": "+b[d].name,b[d].time!=""&&(k+="\n"+m.getString("table_time")+": "+b[d].time),a+='<div class="albumDiv" ',a+=' title="',a+=k,a+='">',a+='<table class="thumb-table-parent">',a+="<tbody>",a+="<tr><td>",a+='<div class="picDiv" popupmenu="',a+=c=="0"?"1":"0",a+='" uhref="',a+=b[d].furl,a+='">',a+=c=="2"?b[d].type=="usbdisk"?
'<div id="fileviewicon" class="usbDiv bicon">':b[d].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">',b[d].routersyncfolder=="1"&&(a+='<div id="routersyncicon" class="routersyncDiv sicon"></div>'),a+='<div class="selectDiv sicon"></div>',a+='<div class="selectHintDiv sicon"></div>',a+="</div></div>",a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo">',a+='<a id="list_item" qtype="',
a+=c,a+='" isdir="1" uhref="',a+=b[d].furl,a+='" title="',a+=b[d].name,a+='" online="',a+=b[d].online,a+='" ip="" mac="',a+=b[d].mac,a+='" uid="',a+=b[d].uid,a+='" freadonly="',a+=b[d].freadonly,a+='" fhidden="',a+=b[d].fhidden,a+=b[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"',a+='">',a+=b[d].shortname,b[d].online=="0"&&c=="2"&&(a+="("+m.getString("title_offline")+")"),a+="</a>",a+="</div>",a+="</td></tr>",a+="<tr><td>",a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>";for(d=0;d<e.length;d++)k=
m.getString("table_filename")+": "+e[d].name+"\n"+m.getString("table_time")+": "+e[d].time+"\n"+m.getString("table_size")+": "+e[d].size,a+='<div class="albumDiv"',a+=' title="',a+=k,a+='">',a+='<table class="thumb-table-parent">',a+="<tbody>",b=getFileExt(String(e[d].furl)),b.length>5&&(b=""),a+="<tr><td>",a+=c=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',a+=e[d].furl,a+='">',a+=b=="jpg"||b=="jpeg"||b=="png"||b=="gif"||b=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':
b=="mp3"||b=="m4a"||b=="m4r"||b=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':b=="mp4"||b=="rmvb"||b=="m4v"||b=="wmv"||b=="avi"||b=="mpg"||b=="mpeg"||b=="mkv"||b=="mov"||b=="flv"||b=="3gp"||b=="m2v"||b=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':b=="doc"||b=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':b=="ppt"||b=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':b=="xls"||b=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':b=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':
'<div id="fileviewicon" class="fileDiv bicon">',a+='<div class="selectDiv sicon"></div>',a+='<div class="selectHintDiv sicon"></div>',a+="</div></div>",a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo" style="font-size:80%">',a+='<a id="list_item" qtype="1" isdir="0" uhref="',a+=e[d].furl,a+='" title="',a+=e[d].name,a+='" uid="',a+=e[d].uid,a+='" ext="',a+=b,a+='" freadonly="',a+=e[d].freadonly,a+='" fhidden="',a+=e[d].fhidden,a+='">',a+=e[d].shortname,a+="</a>",a+="</div>",a+="</td></tr>",
a+="<tr><td>",a+='<input type="button" class="btnDownload" value="'+m.getString("func_download")+'">',a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>";$("div#fileview").append(a);$(".picDiv").mousedown(onMouseDownPicDIVHandler);$("input.btnDownload").click(function(){var a=$(this).parents(".thumb-table-parent").find("a#list_item"),b=a.attr("isdir"),a=a.attr("uhref");b==1?(b=$("div#modalWindow"),g_modal_url="/smb/css/download_folder.html?v="+a+"&p=slhp&a=agt&u="+g_storage.get(g_sharelink_openurl_key),
g_modal_window_width=600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_download_folder")),b&&b.jqmShow()):window.open(a)});$("input.btnDownloadAll").click(function(){var a=$("div#modalWindow"),b=g_root_path,b=b.substr(0,b.lastIndexOf("/"));g_modal_url="/smb/css/download_folder.html?v="+g_root_path+"&p=slhp&a=agt&u="+b;g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));
a&&a.jqmShow()})}}
function doPROPFIND(c,d,b){if(client!=null)try{client.PROPFIND(c,b,function(a,b,e){if(a)if(a==207){g_folder_array=[];g_file_array=[];if(window.DOMParser)a=new DOMParser,b=a.parseFromString(e,"text/xml");else if(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(e),!b.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var l,n,f,j,a=b.documentElement.childNodes,e=b.documentElement.getAttribute("qtype");b.documentElement.getAttribute("readonly");b.documentElement.getAttribute("ruser");
b.documentElement.getAttribute("computername");b.documentElement.getAttribute("isusb");for(b=0;b<a.length;b++){var i="",r="",s="",o="",t="",u="",v="",w="",x="",y="",z="",A="",B="",h;j="";var C="0",p=a[b].childNodes;for(l=0;l<p.length;l++)if(p[l].nodeType==1&&p[l].nodeName=="D:propstat"){var D=p[l].childNodes;for(n=0;n<D.length;n++)if(D[n].nodeName=="D:prop"){var g=D[n].childNodes;for(f=0;f<g.length;f++)if(!(g[f].childNodes.length<=0))if(g[f].nodeName=="D:getcontenttype")r=String(g[f].childNodes[0].nodeValue);
else if(g[f].nodeName=="D:getuniqueid")s=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getonline")u=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getlastmodified")v=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getcontentlength")w=String(size_format(parseInt(g[f].childNodes[0].nodeValue)));else if(g[f].nodeName=="D:getmac")y=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getip")x=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName==
"D:gettype")z=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getattr"){var q=g[f].childNodes;for(j=0;j<q.length;j++)if(q[j].nodeName=="D:readonly")A=q[j].childNodes[0].nodeValue;else if(q[j].nodeName=="D:hidden")B=q[j].childNodes[0].nodeValue}else g[f].nodeName=="D:getuseragent"?(j=String(g[f].childNodes[0].nodeValue),g_storage.set("user_agent",j)):g[f].nodeName=="D:getroutersync"&&(C=String(g[f].childNodes[0].nodeValue))}}else p[l].nodeType==1&&p[l].nodeName=="D:href"&&(i=String(p[l].childNodes[0].nodeValue),
n="",i.match(/^http/)&&(n=window.location.protocol+"//"+window.location.host),f=n+addPathSlash(c),i!=f?(i=i.replace(n,""),o=i.substring(i.lastIndexOf("/")+1,i.length),o!=""?(h=o,t=o=mydecodeURI(o)):i=""):i="");i!=""&&(r=="httpd/unix-directory"?g_folder_array.push({contenttype:r,furl:i,name:o,uname:h,shortname:t,online:u,time:v,size:w,ip:x,mac:y,uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}):g_file_array.push({contenttype:r,furl:i,name:o,uname:h,shortname:t,online:u,time:v,size:w,ip:x,mac:y,
uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}))}g_folder_array.sort(sortByName);g_file_array.sort(sortByName);h=addPathSlash(c);h!="/"&&(h=h.substring(0,h.length-1),h=h.substring(0,h.lastIndexOf("/")),h==""&&(h="/"));createThumbView(e,h,g_folder_array,g_file_array);g_storage.set(g_sharelink_openurl_key,c);$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));closeJqmWindow(0);d!=void 0&&d()}else a==501?doPROPFIND(c):
alert(m.getString(a))},null,1)}catch(e){alert("catch error: "+e)}}
$(document).ready(function(){document.oncontextmenu=function(){return!1};$(document).keydown(function(c){c.keyCode==27?$("#image_slide_show").close(g_image_player_setting):c.keyCode==37?$("#image_slide_show").prev(g_image_player_setting):c.keyCode==39&&$("#image_slide_show").next(g_image_player_setting)});var c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan");m.setLanguage(c);g_storage.set("slhp",$("div#fileview").attr("port"));
g_storage.set("agt","");g_sharelink_openurl_key=g_root_path=$("div#fileview").attr("rootpath");c=g_storage.get(g_sharelink_openurl_key);c==void 0&&(c=g_root_path);doPROPFIND(c,null,0);c="";c+="<div id='modalWindow' class='jqmWindow'>";c+="<div id='jqmTitle'>";c+="<span id='jqmTitleText'></span>";c+="</div>";c+="<div id='jqmMsg'>";c+="<span id='jqmMsgText'></span>";c+="</div>";c+="<div id='jqmContent' style='padding;0px;margin:0px'>";c+="</div>";c+="</div>";$(c).appendTo($("body"));$("input.btnDownloadAll").attr("value",
m.getString("func_downloadall"));$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(c){$(c.w).fadeOut("2000",function(){c.o.remove();g_show_modal=0})},onShow:function(c){var c=$(c.w),b=$("#jqmContent",c);$("#jqmTitle",c);var e=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase();var a=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));
return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",c).attr("src",g_modal_url));isBrowser("msie")&&a()<=8&&(g_modal_window_height+=25);c.css({width:g_modal_window_width,height:g_modal_window_height,left:e,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:e,marginLeft:0,opacity:1},200,function(){})}})});
