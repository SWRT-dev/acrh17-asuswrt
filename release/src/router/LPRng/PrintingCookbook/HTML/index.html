<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="generator" content="HTML Tidy, see www.w3.org">
    <title>The Printing Cookbook</title>
    <meta name="GENERATOR" content=
    "Modular DocBook HTML Stylesheet Version 1.71 ">
  </head>

  <body class="BOOK" bgcolor="#FFFFFF" text="#000000" link=
  "#0000FF" vlink="#840084" alink="#0000FF">
    <div class="BOOK">
      <a name="AEN1"></a>
<table><tr valign=top>
<td width=25%>
<a href="http://www.lprng.com">
<img align=left SRC="LPRng.jpg" ALT="LPRngLogo" height=60>
</a>
</td>
<td width=50%></td><td width=25% >
<a href="http://www.lprng.com">
<img align=right SRC="LPRngT-L.jpg" ALT="LPRngTool" height=75>
</a>
</td></tr></table>

      <div class="TITLEPAGE">
        <h1 class="TITLE"><a name="AEN2">The Printing
        Cookbook</a></h1>

        <h3 class="AUTHOR"><a name="AEN4">Patrick A Powell</a></h3>

        <div class="AFFILIATION">
          <div class="ADDRESS">
            <p class="ADDRESS">papowell@lprng.com<br>
            AStArt&nbsp;Technologies<br>
            9475&nbsp;Chesapeake&nbsp;Dr,&nbsp;Suite&nbsp;D,<br>
            San&nbsp;Diego,&nbsp;CA&nbsp;92123<br>
            Phone&nbsp;858-874-6543<br>
            Fax&nbsp;858-279-8424</p>
          </div>
        </div>

        <p class="COPYRIGHT">Copyright &copy; 2001 by Patrick
        Powell</p>

        <div>
          <div class="ABSTRACT">
            <a name="AEN17"></a>

            <p>This is a set of <i class="EMPHASIS">Recipes for
            Printing</i>, a set of procedures that can be used to
            set up and diagnose printing in a range of system
            environments. The main emphasis will be on using the <b
            class="APPLICATION">LPRng</b> print spooler, either by
            itself or with other print spooling systems.</p>
          </div>
        </div>
        <hr>
      </div>

      <div class="TOC">
        <dl>
          <dt><b>Table of Contents</b></dt>

          <dt><a href="#AEN21">Preface</a></dt>

          <dd>
            <dl>
              <dt>1. <a href="#AEN34">Acknowledgements</a></dt>

              <dt>2. <a href="#AEN40">Conventions</a></dt>

              <dt>3. <a href="#AEN67">Disclaimer</a></dt>
            </dl>
          </dd>

          <dt>1. <a href="#AEN70">Introduction - The Basics and
          Variations</a></dt>

          <dd>
            <dl>
              <dt>1.1. <a href="#AEN160">Checking the Printing
              System</a></dt>

              <dt>1.2. <a href="#AEN168">Fixing the
              Problems</a></dt>
            </dl>
          </dd>

          <dt>2. <a href="#AEN181">Simple Spooling</a></dt>

          <dd>
            <dl>
              <dt>2.1. <a href="#AEN187">Setting Up The Print
              Queues</a></dt>

              <dt>2.2. <a href="#AEN226">Diagnostics for Spooling
              Problems</a></dt>

              <dt>2.3. <a href="#AEN280">What Went Wrong With My
              Job?</a></dt>

              <dt>2.4. <a href="#AEN331">Diagnostics for <b class=
              "APPLICATION">lpd</b> Problems</a></dt>
            </dl>
          </dd>

          <dt>3. <a href="#AEN371">Printers</a></dt>

          <dd>
            <dl>
              <dt>3.1. <a href="#AEN381">Interface</a></dt>

              <dt>3.2. <a href="#AEN388">Parallel Port</a></dt>

              <dt>3.3. <a href="#AEN439">Network Ports</a></dt>

              <dt>3.4. <a href="#AEN647">Sending To SMB (Samba,
              Microsoft) Printer, Novell, Appletalk</a></dt>

              <dt>3.5. <a href="#AEN703">Serial Port</a></dt>
            </dl>
          </dd>

          <dt>4. <a href="#AEN728">Printer Job Formats</a></dt>

          <dd>
            <dl>
              <dt>4.1. <a href="#AEN745">PostScript</a></dt>

              <dt>4.2. <a href="#AEN788">PCL</a></dt>

              <dt>4.3. <a href="#AEN803">Printer Job Language (PJL)
              and PostScript, PCL</a></dt>

              <dt>4.4. <a href="#AEN811">Text Files</a></dt>

              <dt>4.5. <a href="#AEN826">Magical Mystery
              Proprietary Format</a></dt>

              <dt>4.6. <a href="#AEN859">Printing Test
              Pages</a></dt>
            </dl>
          </dd>

          <dt>5. <a href="#AEN872">Filters</a></dt>

          <dd>
            <dl>
              <dt>5.1. <a href="#AEN951">Writing Your Own
              Filter</a></dt>

              <dt>5.2. <a href="#AEN991">The <b class=
              "APPLICATION">LPRng</b> IFHP Filter</a></dt>

              <dt>5.3. <a href="#AEN1059">Taming the Wild Phaser
              Printer</a></dt>
            </dl>
          </dd>

          <dt>6. <a href="#AEN1071">Banner Pages and
          Accounting</a></dt>

          <dd>
            <dl>
              <dt>6.1. <a href="#AEN1074">Suppressing Banner
              Pages</a></dt>

              <dt>6.2. <a href="#AEN1100">Forcing Banner
              Pages</a></dt>

              <dt>6.3. <a href="#AEN1108">Generating Banner
              Pages</a></dt>

              <dt>6.4. <a href="#AEN1130">Accounting</a></dt>

              <dt>6.5. <a href="#AEN1162">Accounting
              Gotchas</a></dt>

              <dt>6.6. <a href="#AEN1170">Accounting Including
              Banner Pages</a></dt>
            </dl>
          </dd>

          <dt>7. <a href="#AEN1177">Printer Pools and Load
          Sharing</a></dt>

          <dd>
            <dl>
              <dt>7.1. <a href="#AEN1205">Implementing Smart Load
              Balancing</a></dt>

              <dt>7.2. <a href="#AEN1234">Using <tt class=
              "LITERAL">:chooser</tt> Exit Codes</a></dt>
            </dl>
          </dd>

          <dt>8. <a href="#AEN1244">Wildcards, Bounce Queues, and
          Forwarding</a></dt>

          <dd>
            <dl>
              <dt>8.1. <a href="#AEN1251">Bounce Queues</a></dt>

              <dt>8.2. <a href="#AEN1260">Adding -Z Options Using
              Bounce Queues</a></dt>

              <dt>8.3. <a href="#INCOMING">Adding Options By
              Modifying Control File</a></dt>
            </dl>
          </dd>

          <dt>9. <a href="#AEN1295">Form Support and Hold
          Queues</a></dt>

          <dd>
            <dl>
              <dt>9.1. <a href="#AEN1298">Hold Queues</a></dt>
            </dl>
          </dd>

          <dt>10. <a href="#AEN1351">Interfacing to Vintage,
          Legacy, and SunOS Print Spoolers</a></dt>

          <dt>11. <a href="#AEN1363">Managing Enterprise Level
          Printing Systems</a></dt>

          <dd>
            <dl>
              <dt>11.1. <a href="#AEN1366">Templates and Standard
              Configurations</a></dt>

              <dt>11.2. <a href="#AEN1383">Master Print Servers,
              One User Printcap</a></dt>

              <dt>11.3. <a href="#AEN1391">Master Print Servers,
              Local Spooling</a></dt>

              <dt>11.4. <a href="#AEN1399">Master Print Servers,
              Selection by User</a></dt>

              <dt>11.5. <a href="#AEN1411">The Great Grand Dad Of
              All Printcap Files</a></dt>

              <dt>11.6. <a href="#AEN1417">Using Printcap Filters
              and Central Databases</a></dt>
            </dl>
          </dd>

          <dt>12. <a href="#AEN1434"><b class=
          "APPLICATION">LPRngTool</b></a></dt>

          <dt>A. <a href="#SECFEATURES"><b class=
          "APPLICATION">LPRng</b></a></dt>

          <dd>
            <dl>
              <dt>A.1. <a href="#MAILLIST">Documentation</a></dt>

              <dt>A.2. <a href="#AEN1548">Installation</a></dt>

              <dt>A.3. <a href="#AEN1560">License</a></dt>

              <dt>A.4. <a href="#AEN1566">Commercial
              Support</a></dt>

              <dt>A.5. <a href="#LPRNGDIST">Web Site, FTP Site, and
              Mirrors</a></dt>

              <dt>A.6. <a href="#AEN1607">Mailing List</a></dt>

              <dt>A.7. <a href="#FAQREF">PGP Public Key</a></dt>
            </dl>
          </dd>

          <dt>B. <a href="#AEN1621">References and
          Standards</a></dt>

          <dd>
            <dl>
              <dt>B.1. <a href="#AEN1625">RFCs</a></dt>

              <dt>B.2. <a href="#POSTSCRIPT">PostScript</a></dt>

              <dt>B.3. <a href="#PCL">HP PCL 5</a></dt>

              <dt>B.4. <a href="#PJL">HP PJL</a></dt>

              <dt>B.5. <a href="#AEN1668">PDF</a></dt>
            </dl>
          </dd>

          <dt>C. <a href="#RFC1179REF">RFC 1179 - Line Printer
          Daemon Protocol</a></dt>

          <dd>
            <dl>
              <dt>C.1. <a href="#LPDPORT">Ports and
              Connections</a></dt>

              <dt>C.2. <a href="#REMOTESUPPORT">Protocol Requests
              and Replies</a></dt>

              <dt>C.3. <a href="#JOBTRANSFER">Job Transfer</a></dt>

              <dt>C.4. <a href="#AEN2015">Data File
              Transfer</a></dt>

              <dt>C.5. <a href="#AEN2051">Control File
              Contents</a></dt>

              <dt>C.6. <a href="#AEN2250"><b class=
              "APPLICATION">lpq</b> Requests</a></dt>

              <dt>C.7. <a href="#AEN2270"><b class=
              "APPLICATION">lprm</b> Requests</a></dt>

              <dt>C.8. <a href="#LPCREREAD">LPC Requests</a></dt>

              <dt>C.9. <a href="#SENDBLOCKFORMAT">Block Job
              Transfer</a></dt>

              <dt>C.10. <a href="#AEN2472">Authenticated
              Transfer</a></dt>
            </dl>
          </dd>
        </dl>
      </div>

      <div class="LOT">
        <dl class="LOT">
          <dt><b>List of Tables</b></dt>

          <dt>3-1. <a href="#NEWPS">Network Print Server
          Configuration Information</a></dt>

          <dt>C-1. <a href="#RF1179COMMANDS">RFC1179
          Commands</a></dt>

          <dt>C-2. <a href="#CFLINES">Control File Lines and
          Purpose</a></dt>

          <dt>C-3. <a href="#LPCCOMMANDS">LPC Commands</a></dt>
        </dl>
      </div>

      <div class="LOT">
        <dl class="LOT">
          <dt><b>List of Figures</b></dt>

          <dt>1. <a href="#AEN60"><b class="APPLICATION">lpq</b>
          status</a></dt>

          <dt>1-1. <a href="#FG1">Print Spooler
          Architecture</a></dt>

          <dt>1-2. <a href="#FG2">Configuration Files</a></dt>

          <dt>1-3. <a href="#FG3">Printcap</a></dt>

          <dt>1-4. <a href="#FG4">lpd.conf Defaults File</a></dt>

          <dt>1-5. <a href="#FG5">lpd.perm Permissions
          File</a></dt>

          <dt>1-6. <a href="#FG6">Clients and Configuration
          Files</a></dt>

          <dt>1-7. <a href="#FG7">${HOME}/.printcap
          Information</a></dt>

          <dt>1-8. <a href="#FG8">Using <b class=
          "APPLICATION">checkpc</b></a></dt>

          <dt>1-9. <a href="#FG9">Using <b class=
          "APPLICATION">checkpc</b> -f</a></dt>

          <dt>2-1. <a href="#AEN184">Basic Printcap Entry</a></dt>

          <dt>2-2. <a href="#AEN189">Run checkpc</a></dt>

          <dt>2-3. <a href="#AEN194">Check for Running
          Server</a></dt>

          <dt>2-4. <a href="#AEN200">Run <b class=
          "APPLICATION">lpq</b></a></dt>

          <dt>2-5. <a href="#AEN205">Run <b class=
          "APPLICATION">lpc</b></a></dt>

          <dt>2-6. <a href="#AEN212">Run <b class=
          "APPLICATION">lpr</b></a></dt>

          <dt>2-7. <a href="#AEN217">Run <b class=
          "APPLICATION">lprm</b></a></dt>

          <dt>2-8. <a href="#AEN222">Enable Printing</a></dt>

          <dt>2-9. <a href="#AEN228">Using <b class=
          "APPLICATION">lpr</b> -V</a></dt>

          <dt>2-10. <a href="#AEN236">The <b class=
          "APPLICATION">lpr</b> Options</a></dt>

          <dt>2-11. <a href="#AEN242">Debug Options</a></dt>

          <dt>2-12. <a href="#AEN247">The <b class=
          "APPLICATION">lpr</b> -D1 Output</a></dt>

          <dt>2-13. <a href="#AEN258">Using <b class=
          "APPLICATION">lpr</b> -Dnetwork</a></dt>

          <dt>2-14. <a href="#AEN270">Debugging <b class=
          "APPLICATION">lpq</b></a></dt>

          <dt>2-15. <a href="#AEN282">Basic <b class=
          "APPLICATION">lpq</b> Information</a></dt>

          <dt>2-16. <a href="#AEN293">Using the <b class=
          "APPLICATION">lpq</b> -l Option</a></dt>

          <dt>2-17. <a href="#AEN306">Using the <b class=
          "APPLICATION">lpq</b> -L Option</a></dt>

          <dt>2-18. <a href="#AEN313">Job Completion</a></dt>

          <dt>2-19. <a href="#AEN318">Summary Status
          Displays</a></dt>

          <dt>2-20. <a href="#AEN334"><b class=
          "APPLICATION">lpd</b> Options</a></dt>

          <dt>2-21. <a href="#AEN340">Using <b class=
          "APPLICATION">lpd</b> Debug Options</a></dt>

          <dt>2-22. <a href="#AEN346">Debugging Spool
          Queue</a></dt>

          <dt>2-23. <a href="#AEN357">Setting Queue Debug
          Options</a></dt>

          <dt>2-24. <a href="#AEN364"><tt class="LITERAL">log</tt>
          File</a></dt>

          <dt>3-1. <a href="#AEN373">Printer Types</a></dt>

          <dt>3-2. <a href="#AEN383">Interface Types</a></dt>

          <dt>3-3. <a href="#P2">Parallel Port</a></dt>

          <dt>3-4. <a href="#P1">Parallel Port Printcap</a></dt>

          <dt>3-5. <a href="#P3">Loading Linux Parallel Port
          Driver</a></dt>

          <dt>3-6. <a href="#P4">Parallel Port Problems</a></dt>

          <dt>3-7. <a href="#N1">Network Ports</a></dt>

          <dt>3-8. <a href="#N2">Network Port Printcap</a></dt>

          <dt>3-9. <a href="#N3">Benefits of Network Port
          Printcap</a></dt>

          <dt>3-10. <a href="#N4">Network Print Server</a></dt>

          <dt>3-11. <a href="#AEN649">Using Program To Send To
          Printer</a></dt>

          <dt>3-12. <a href="#AEN656">Protocols, Packages, and
          Transfer Programs</a></dt>

          <dt>3-13. <a href="#AEN664">Printcap For Transfer
          Programs</a></dt>

          <dt>3-14. <a href="#WRAPPER">Samba <b class=
          "APPLICATION">smbclient</b> Wrapper</a></dt>

          <dt>3-15. <a href="#PC"><tt class=
          "LITERAL">$PRINTCAP_ENTRY</tt></a></dt>

          <dt>3-16. <a href="#AEN697">Novell and Appletalk
          Wrappers</a></dt>

          <dt>3-17. <a href="#S1">Serial Port</a></dt>

          <dt>3-18. <a href="#S2">Serial Port Printcap</a></dt>

          <dt>4-1. <a href="#AEN730">Page Description
          Lanaguages</a></dt>

          <dt>4-2. <a href="#AEN735">How To Identify Print
          Formats</a></dt>

          <dt>4-3. <a href="#FILE">Using the <b class=
          "APPLICATION">file</b> Application</a></dt>

          <dt>4-4. <a href="#AEN747">One PostScript Page</a></dt>

          <dt>4-5. <a href="#AEN751">Generate One Page</a></dt>

          <dt>4-6. <a href="#AEN757">PostScript Document
          Structuring Conventions</a></dt>

          <dt>4-7. <a href="#AEN767">Tools for PostScript Document
          Manipulation</a></dt>

          <dt>4-8. <a href="#AEN774">Selection of Pages + 4up
          Printing</a></dt>

          <dt>4-9. <a href="#AEN777">PostScript Output</a></dt>

          <dt>4-10. <a href="#AEN782">End Of PostScript Job: ^D
          (CTRL-D)</a></dt>

          <dt>4-11. <a href="#AEN790">One PCL Page</a></dt>

          <dt>4-12. <a href="#AEN795">Generate One Page</a></dt>

          <dt>4-13. <a href="#AEN805">PJL Example</a></dt>

          <dt>4-14. <a href="#AEN813">Text Files and The
          Jaggies</a></dt>

          <dt>4-15. <a href="#AEN822">Fixing The Jaggies</a></dt>

          <dt>4-16. <a href="#AEN828">Magical Mystery
          Formats</a></dt>

          <dt>4-17. <a href="#AEN835">GhostScript To The
          Rescue</a></dt>

          <dt>4-18. <a href="#AEN839">GhostScript Devices</a></dt>

          <dt>4-19. <a href="#AEN846">GhostScript Support</a></dt>

          <dt>4-20. <a href="#AEN861">Printing Test Pages To
          Parallel Port</a></dt>

          <dt>4-21. <a href="#AEN865">Using Netcat (<b class=
          "APPLICATION">nc</b>)</a></dt>

          <dt>5-1. <a href="#AEN874">Filters</a></dt>

          <dt>5-2. <a href="#AEN880">Filter Specification in
          Printcap Entry</a></dt>

          <dt>5-3. <a href="#AEN887">Specifying Job Datafile
          Format</a></dt>

          <dt>5-4. <a href="#AEN901">Filter Execution
          Environment</a></dt>

          <dt>5-5. <a href="#AEN915">Command Line Options</a></dt>

          <dt>5-6. <a href="#AEN929">Filter Exit Codes</a></dt>

          <dt>5-7. <a href="#AEN941">Solid As A Rock Filter
          Operation</a></dt>

          <dt>5-8. <a href="#AEN946">Solid As A Used Paper Coffee
          Filter Operation</a></dt>

          <dt>5-9. <a href="#FILTERTEMPLATE">Filter Template in <b
          class="APPLICATION">perl</b></a></dt>

          <dt>5-10. <a href="#AEN964">How To Determine The Type of
          Job File</a></dt>

          <dt>5-11. <a href="#FPC">Printcap for Filter</a></dt>

          <dt>5-12. <a href="#FDB">Using Filter With
          $debug=1</a></dt>

          <dt>5-13. <a href="#FNODB">Using Filter With
          $debug=0</a></dt>

          <dt>5-14. <a href="#AEN994"><b class=
          "APPLICATION">ifhp</b></a></dt>

          <dt>5-15. <a href="#AEN1006">ifhp.conf Configuration
          Information</a></dt>

          <dt>5-16. <a href="#AEN1011">Default Printer Magic
          Cookies</a></dt>

          <dt>5-17. <a href="#AEN1016">PostScript Only
          Printer</a></dt>

          <dt>5-18. <a href="#AEN1026">Using the <b class=
          "APPLICATION">ifhp</b> Filter</a></dt>

          <dt>5-19. <a href="#AEN1033">Example of <b class=
          "APPLICATION">ifhp</b> Operation</a></dt>

          <dt>5-20. <a href="#AEN1041">Using -Z to Pass Options to
          <b class="APPLICATION">ifhp</b></a></dt>

          <dt>5-21. <a href="#AEN1050">Testing <b class=
          "APPLICATION">ifhp</b> Operations</a></dt>

          <dt>5-22. <a href="#AEN1065">Phaser/Appsocket
          Support</a></dt>

          <dt>6-1. <a href="#NB1">Changing JetDirect
          Configuration</a></dt>

          <dt>6-2. <a href="#AEN1085">Printcap Option <tt class=
          "LITERAL">:sh</tt> and <b class="APPLICATION">lpr</b> -h
          (No Header) Option</a></dt>

          <dt>6-3. <a href="#AEN1096">Removing Banner
          Lines</a></dt>

          <dt>6-4. <a href="#AEN1105">Forcing Banner Pages</a></dt>

          <dt>6-5. <a href="#AEN1110">Generating Banner
          Page</a></dt>

          <dt>6-6. <a href="#AEN1134">Basic Accounting
          Information</a></dt>

          <dt>6-7. <a href="#AEN1141">Accounting File
          Information</a></dt>

          <dt>6-8. <a href="#AC2">Filter Accounting
          Information</a></dt>

          <dt>6-9. <a href="#AC3">Accounting Gotchas</a></dt>

          <dt>6-10. <a href="#AEN1172">Accounting Using Banner
          Pages</a></dt>

          <dt>7-1. <a href="#PP1">Printer Pools and Load
          Sharing</a></dt>

          <dt>7-2. <a href="#PP2">Load Balancing Printcap</a></dt>

          <dt>7-3. <a href="#AEN1193">Load Balancing to Remote
          Queues</a></dt>

          <dt>7-4. <a href="#AEN1198">Printcap for Chooser</a></dt>

          <dt>7-5. <a href="#AEN1207">Chooser Program
          Operation</a></dt>

          <dt>7-6. <a href="#AEN1217">Filter Template in <b class=
          "APPLICATION">Perl</b></a></dt>

          <dt>7-7. <a href="#AEN1222">Choosing A
          Destintation</a></dt>

          <dt>7-8. <a href="#AEN1237">Chooser Exit Codes</a></dt>

          <dt>8-1. <a href="#AEN1247">Evil (BAD) Way</a></dt>

          <dt>8-2. <a href="#AEN1253">Not So Evil Way</a></dt>

          <dt>8-3. <a href="#AEN1262">Add Options Using <tt class=
          "LITERAL">:append_z</tt></a></dt>

          <dt>8-4. <a href="#AEN1270">Diabolically Fiendishly
          Clever Method</a></dt>

          <dt>8-5. <a href="#UPDATEZ">Using <tt class=
          "LITERAL">update_z</tt></a></dt>

          <dt>9-1. <a href="#AEN1300">Hold Queues</a></dt>

          <dt>9-2. <a href="#AEN1303">All Hold Queues</a></dt>

          <dt>9-3. <a href="#AEN1308">Releasing Jobs for
          Printing</a></dt>

          <dt>9-4. <a href="#AEN1315">Releasing Jobs For Scheduled
          Print Run</a></dt>

          <dt>9-5. <a href="#HOLDCLASS">Using Job Classes</a></dt>

          <dt>9-6. <a href="#AEN1334">Setting New Job Classes and
          Disabling Job Classes</a></dt>

          <dt>9-7. <a href="#AEN1340">Modifying Control File Using
          <b class="APPLICATION">update_class</b></a></dt>

          <dt>9-8. <a href="#AEN1346">The <b class=
          "APPLICATION">update_class</b> Filter</a></dt>

          <dt>10-1. <a href="#AEN1359">Using <tt class=
          "LITERAL">:bk</tt> (Berkeley Kompatible) Flag</a></dt>

          <dt>11-1. <a href="#AEN1368">Templates in
          Printcaps</a></dt>

          <dt>11-2. <a href="#AEN1373">Using <b class=
          "APPLICATION">lpc</b> client all</a></dt>

          <dt>11-3. <a href="#AEN1385">Master User Printcap File,
          No Local Spooling</a></dt>

          <dt>11-4. <a href="#AEN1393">Master User Printcap File,
          Local Spooling</a></dt>

          <dt>11-5. <a href="#AEN1401">Master User Printcap File,
          No Local Spooling</a></dt>

          <dt>11-6. <a href="#AEN1413">All In One</a></dt>

          <dt>11-7. <a href="#AEN1419">Printcap Path Configuration
          Information</a></dt>

          <dt>11-8. <a href="#AEN1429">Example of Returned Printcap
          Value</a></dt>

          <dt>12-1. <a href="#AEN1437">Starting Screen</a></dt>

          <dt>12-2. <a href="#AEN1442">Printcap Entry
          Selection</a></dt>

          <dt>12-3. <a href="#AEN1447">Add A Printer</a></dt>

          <dt>12-4. <a href="#AEN1452">Option
          Specification</a></dt>

          <dt>12-5. <a href="#AEN1457">Advanced Options</a></dt>

          <dt>12-6. <a href="#AEN1462"><b class=
          "APPLICATION">ifhp</b> Options</a></dt>

          <dt>12-7. <a href="#AEN1468">Saving Printcap
          Entry</a></dt>

          <dt>12-8. <a href="#AEN1473">Checkpc Results</a></dt>
        </dl>
      </div>

      <div class="PREFACE">
        <hr>

        <h1><a name="AEN21">Preface</a></h1>

        <p>A good cookbook will provide the reader not only with a
        set of recipes that sound delicious but also with a set of
        instructions that will allow novices to experts to prepare
        them. Of course, there are cookbooks for novices, cookbooks
        for experts, and then the gastronmic encyclopedias.</p>

        <p>These <i class="EMPHASIS">Recipes for Printing</i> are a
        collection of old favorites, not of the author, but of the
        hundreds of users of <b class="APPLICATION">LPRng</b> and
        other print spooling systems. They are not a complete
        discussion of the printing <i class="EMPHASIS">haute
        cuisine</i>, but deal more with the preparation of the <i
        class="EMPHASIS">Minnesota Hot Dish</i>. As I find from
        personal experience, you need to make a casserole for a
        family dinner far more often than to prepare <i class=
        "EMPHASIS">mijot&eacute;e de lentilles au lardons, dos de
        poisson-chat r&ocirc;ti, au vinaigre d'herbes</i> for that
        one-time special dinner.</p>

        <p>The various test files, scripts and examples in this
        document are also in the <b class="APPLICATION">LPRng</b>
        distribution in the <tt class=
        "FILENAME">/LPRng-xxx/UTILS</tt> directory.</p>

        <p>Enjoy! Bon Appetite!</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN34">1.
          Acknowledgements</a></h1>

          <p>I would like to thank all of the <b class=
          "APPLICATION">LPRng</b> users who so relentlessly tried
          an incredible number of permutations and combinations
          printers, software, and networks, and whose requests for
          <i class="EMPHASIS">just one more feature</i> led to the
          development of the <b class="APPLICATION">LPRng</b>
          software.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN40">2. Conventions</a></h1>

          <p>Many examples will show commands run by ordinary or
          privleged users. The prompt character will indicate the
          user:</p>

          <div class="INFORMALTABLE">
            <a name="AEN43"></a>

            <table border="0" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">User</th>

                  <th align="LEFT" valign="TOP">Prompt</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">Normal user</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "PROMPT">host {20} % su</tt></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">root</tt></td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "PROMPT">host {2} #</tt></td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>Recipes and major examples will be show as:</p>

          <div class="FIGURE">
            <a name="AEN60"></a>

            <p><b>Figure 1. lpq status</b></p>
<pre class="SCREEN">
    h110: {64} % lpq
    Printer: lp@h110
     Queue: no printable jobs in queue
     Status: job 'cfA711h110.private' removed at 17:11:43.919
     Filter_status: done at 17:11:43.823
</pre>
          </div>
          <br>
          <br>

          <p>Smaller sets of code or commands will be shown as:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN65"></a>
<pre class="SCREEN">
    Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN67">3. Disclaimer</a></h1>

          <p>THIS DOCUMENTATION AND THE DESCRIBED SOFTWARE AND
          PROCEDURES IS PROVIDED BY THE AUTHORS "AS IS" AND ANY
          EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
          TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
          FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
          SHALL THE AUTHORS BE LIABLE FOR ANY DIRECT, INDIRECT,
          INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
          (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
          GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
          BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
          OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
          TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
          WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF ADVISED
          OF THE POSSIBILITY OF SUCH DAMAGE.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN70">Chapter 1. Introduction - The Basics
        and Variations</a></h1>

        <div class="FIGURE">
          <a name="FG1"></a>

          <p><b>Figure 1-1. Print Spooler Architecture</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="spooler.png"></p>
          </div>
        </div>

        <p>The <b class="APPLICATION">LPRng</b> print spooling
        system has the components shown in <a href="#FG1">Figure
        1-1</a>. A program generates output and pipes it to the <b
        class="APPLICATION">lpr</b> application or the <b class=
        "APPLICATION">lpr</b> application is used to print a file.
        The <b class="APPLICATION">lpr</b> application connects to
        the <b class="APPLICATION">lpd</b> print server over a
        network connection and then transfers the print job data
        and print options. The <b class="APPLICATION">lpd</b>
        server will store the job information <a href="#FG2">Figure
        1-2</a> in a spool directory and when the output device is
        available will transfer the job to the printing device.</p>

        <p>Since the print job may not be in the appropriate format
        for the ouput device a <b class="APPLICATION">filter</b>
        program may be used to prepare the output data or perform
        special operations on the output device. Alternatively, the
        print job can be forwarded to another print spooler <a
        href="#FG1">Figure 1-1</a>, transferred directly to a
        TCP/IP network port.</p>

        <div class="FIGURE">
          <a name="FG2"></a>

          <p><b>Figure 1-2. Configuration Files</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="configfiles.png"></p>
          </div>
        </div>

        <p>&#13;As shown in <a href="#FG2">Figure 1-2</a>, the <b
        class="APPLICATION">LPRng</b> print spooler uses the <tt
        class="FILENAME">/etc/printcap</tt>, <tt class=
        "FILENAME">/etc/lpd.conf</tt>, and <tt class=
        "FILENAME">/etc/lpd.perms</tt>, files to get its
        operational parameters. The the <tt class=
        "FILENAME">/etc/printcap</tt> file defines a set of spool
        queues, each of which holds print jobs. The a print job
        consists of a <i class="EMPHASIS">control</i> file (<tt
        class="LITERAL">cfAnnnHHHHHHH</tt>) and one or more data
        files (<tt class="LITERAL">dfAnnnHHHHHHH</tt> <tt class=
        "LITERAL">dfBnnnHHHHHHH</tt>, etc); the control file
        contains information such as the user name, file names, and
        printing options, while the data files contain the data to
        be printed.</p>

        <div class="FIGURE">
          <a name="FG3"></a>

          <p><b>Figure 1-3. Printcap</b></p>
<pre class="SCREEN">
    # Common configuration information
    .common:sd=/var/spool/lpd/%P
      :sh:mx=0:force_localhost
    
    # forward to remote spooler
    lp:cm=Default Printer
     :tc=.common
     :lp=raw@10.0.0.1
           #  legacy - :rp=raw:rm=10.0.0.1
    
    # lp0 - open a device
    lp0|aliasforlp0:cm=Parallel Port Printer:\
      :tc=.common:lp=/dev/lpt0:
    
    # lp1 - open a network connection
    lp1:tc=.common:lp=10.0.0.14%9100
    
    # lp2 - run a program
    lp2:tc=.common:lp=|/usr/local/bin/smbprint
</pre>
        </div>

        <p>&#13;The <tt class="FILENAME">/etc/printcap</tt> file
        format is very simple in appearance but complex in
        information. By convention, lines starting with <tt class=
        "LITERAL">#</tt> are comments; a printcap entry starts with
        the entry name followed by one or more <i class=
        "EMPHASIS">aliases</i>, followed by options.</p>

        <p>The <tt class="LITERAL">:tc</tt> option specifies a
        printcap entry for inclusion; there can be more than one
        entry and they are processed in order that they appear in
        the <tt class="LITERAL">:tc</tt> list. The other options
        are processed <i class="EMPHASIS">after</i> the <tt class=
        "LITERAL">:tc</tt> list; this means that the printcap
        options overide the ones from the <tt class=
        "LITERAL">:tc</tt> list. If a entry name starts with a
        period (<tt class="LITERAL">.</tt>), then the <b class=
        "APPLICATION">LPRng</b> system uses it only for <tt class=
        "LITERAL">:tc</tt> lists. This is similar to the use of <i
        class="EMPHASIS">hidden</i> files, i.e. - files whose names
        start with a period are not displayed by the <b class=
        "APPLICATION">ls</b> command.</p>

        <p>&#13;</p>

        <div class="FIGURE">
          <a name="FG4"></a>

          <p><b>Figure 1-4. lpd.conf Defaults File</b></p>
<pre class="SCREEN">
    # Purpose: always print banner, ignore lpr -h option
    #   default ab@ (FLAG off)
    # Purpose: query accounting server when connected
    #   default achk@ (FLAG off)
    # Purpose: accounting at end (see also af, la, ar, as)
    #   default ae=jobend $H $n $P $k $b $t  (STRING)
    # Purpose: name of accounting file (see also la, ar)
    #   default af=acct  (STRING)
    
    # Purpose: use long job number (0 - 999999) when a job is submitted
    #   default longnumber@ (FLAG off)
    longnumber
</pre>
        </div>
        &#13;<br>
        <br>

        <p>The <tt class="FILENAME">/etc/lpd.conf</tt> file can be
        used to override the set of default values for the print
        spooler or other printing applications. By the way, all of
        the <b class="APPLICATION">LPRng</b> options and their
        default values are defined in this file in the
        comments.</p>

        <div class="FIGURE">
          <a name="FG5"></a>

          <p><b>Figure 1-5. lpd.perm Permissions File</b></p>
<pre class="SCREEN">
    ACCEPT SERVICE=C SERVER REMOTEUSER=root,papowell
    ACCEPT SERVICE=C LPC=lpd,status,printcap
    REJECT SERVICE=C
    ACCEPT SERVICE=M SAMEHOST SAMEUSER
    ACCEPT SERVICE=M SERVER REMOTEUSER=root
    REJECT SERVICE=M
    DEFAULT ACCEPT
</pre>
        </div>

        <p>The <tt class="FILENAME">/etc/lpd.perms</tt> file (<a
        href="#FG5">Figure 1-5</a>) is used by <b class=
        "APPLICATION">lpd</b> to determine who is allowed to
        perform various operations. The format of this file is
        modelled on that of a <i class="EMPHASIS">packet
        filter</i>. When a request is made, the file is scanned for
        matches; each match sets a success or fail condition. The
        success or fail of the last match (or the last default
        value) will determine whether or not to perform the
        operation.</p>

        <div class="FIGURE">
          <a name="FG6"></a>

          <p><b>Figure 1-6. Clients and Configuration Files</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="clients.png"></p>
          </div>
        </div>

        <p>The <b class="APPLICATION">LPRng</b> client applications
        <b class="APPLICATION">lpr</b>, <b class=
        "APPLICATION">lprm</b>, <b class="APPLICATION">lpq</b>, and
        <b class="APPLICATION">lpc</b> use the <tt class=
        "FILENAME">/etc/lpd.conf</tt>, <tt class=
        "FILENAME">/etc/printcap</tt> and <tt class=
        "LITERAL">${HOME}/.printap</tt> files (if they exist) (<a
        href="#FG6">Figure 1-6</a>). The values in the <tt class=
        "LITERAL">${HOME}/.printcap</tt> file are used to override
        the values in the <tt class="FILENAME">/etc/printcap</tt>
        file, and the first printcap entry in the <tt class=
        "LITERAL">${HOME}/.printap</tt> file becomes the default
        printer for the user (see <a href="#FG7">Figure
        1-7</a>).</p>

        <div class="FIGURE">
          <a name="FG7"></a>

          <p><b>Figure 1-7. ${HOME}/.printcap Information</b></p>
<pre class="SCREEN">
    # force your default printer
    #  - forces first entry to be lp_out
    lp_out:
    
    # send everything to your secret server
    *:lp=%P@secret_server:force_localhost@
    
    # combine the two above:
    lp|*:lp=%P@secret_server:force_localhost@
    
    # and of course, you can specify extra lpr options
    # for those special purpose printers and total abuse
    landscape:lpr= -Zlandscape -Plp
</pre>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN160">1.1. Checking the
          Printing System</a></h1>

          <div class="FIGURE">
            <a name="FG8"></a>

            <p><b>Figure 1-8. Using checkpc</b></p>
<pre class="SCREEN">
    h110: {1} % su
    Password:
    h110# checkpc
    h110# checkpd -V
    LPRng-3.7.10, Copyright 1988-2001 Patrick Powell, &lt;papowell@lprng.com&gt;
    Checking for configuration files '/etc/lpd.conf'
      found '/etc/lpd.conf', mod 0100644
    Checking for printcap files '/etc/printcap'
      found '/etc/printcap', mod 0100644
     DaemonUID 1, DaemonGID 1
    Using Config file '/etc/lpd.conf'
    LPD lockfile '/var/run/lpd.515'
    ...
    Checking printer 'lp'
     Checking directory: '/var/spool/lpd/lp'
       directory '/var'
       directory '/var/spool'
       directory '/var/spool/lpd'
       directory '/var/spool/lpd/lp'
      checking 'control.lp' file
      checking 'status.lp' file
      checking 'status' file
      checking 'log' file
      checking 'acct' file
</pre>
          </div>

          <p>The <b class="APPLICATION">checkpc</b> utility will
          read and parse the printcap file. It will report a
          zillion errors if something is wrong.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN168">1.2. Fixing the
          Problems</a></h1>

          <div class="FIGURE">
            <a name="FG9"></a>

            <p><b>Figure 1-9. Using checkpc -f</b></p>
<pre class="SCREEN">
    h110: {1} % checkpc
    Warning -  bad directory - /var/spool/lpd/lp
    Warning -   Printer_DYN 'lp' spool dir '/var/spool/lpd/lp' needs fixing
    Warning -  bad directory - /var/spool/lpd/lp0
    Warning -   Printer_DYN 'lp0' spool dir '/var/spool/lpd/lp0' needs fixing
    h110: {2} % su
    Password:
    h110# checkpc -f
    Warning -   changing ownership '/var/spool/lpd/lp' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp0' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp0' to 1/1
    h110# exit
    h110: {3} % checkpc
    h110: {4} % checkpc
</pre>
          </div>

          <p>The <tt class="LITERAL">checkpc -f</tt> (<tt class=
          "LITERAL">-f</tt> for <i class="EMPHASIS">fix</i>) will
          make <b class="APPLICATION">checkpc</b> attempt create
          missing files, set permissions, and take basic corrective
          actions. If it fails, then you have probably a <i class=
          "EMPHASIS">very</i> bad <tt class=
          "FILENAME">/etc/printcap</tt> file.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN181">Chapter 2. Simple Spooling</a></h1>

        <p>This section covers the basic facilities that you will
        probably encounter when trying to set up a print queue. We
        will start with a basic print queue and then run through
        the setup steps.</p>

        <div class="FIGURE">
          <a name="AEN184"></a>

          <p><b>Figure 2-1. Basic Printcap Entry</b></p>
<pre class="SCREEN">
    # Common configuration information
    .common:sd=/var/spool/lpd/%P
      :sh:mx=0:force_localhost
    lp:cm=Default Printer, Forward to remote
     :tc=.common
     :lp=raw@10.0.0.1
    
    # lp0 - open a device
    lp0:cm=Parallel Port Printer
      :tc=.common:lp=/dev/lpt0:
</pre>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN187">2.1. Setting Up The
          Print Queues</a></h1>

          <div class="FIGURE">
            <a name="AEN189"></a>

            <p><b>Figure 2-2. Run checkpc</b></p>
<pre class="SCREEN">
    h110: {1} % checkpc
    Warning -  bad directory - /var/spool/lpd/lp
    Warning -   Printer_DYN 'lp' spool dir '/var/spool/lpd/lp' needs fixing
    Warning -  bad directory - /var/spool/lpd/lp0
    Warning -   Printer_DYN 'lp0' spool dir '/var/spool/lpd/lp0' needs fixing
    h110: {2} % su
    Password:
    h110# checkpc -f
    Warning -   changing ownership '/var/spool/lpd/lp' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp0' to 1/1
    Warning -   changing ownership '/var/spool/lpd/lp0' to 1/1
    h110# exit
    h110: {3} % checkpc
    h110: {4} % checkpc
</pre>
          </div>

          <p>First, you run <tt class="LITERAL">checkpc -f</tt>.
          This will tell you if something is wrong with the
          printcap.</p>

          <div class="FIGURE">
            <a name="AEN194"></a>

            <p><b>Figure 2-3. Check for Running Server</b></p>
<pre class="SCREEN">
    h110: {5} % lpc lpd
    Printer 'lp@localhost' - cannot open connection - Connection refused
    Make sure the remote host supports the LPD protocol
    h110: {6} % su
    Password:
    h110# lpd
    h110# lpc lpd
    lpd server pid 6418 on h110.private
    h110# exit
    exit
    h110: {7} % lpc lpd
    lpd server pid 6418 on h110.private
</pre>
          </div>

          <p>Next, you make sure the <b class="APPLICATION">lpd</b>
          server is running, and if it is not, then you restart
          it.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="AEN200"></a>

            <p><b>Figure 2-4. Run lpq</b></p>
<pre class="SCREEN">
    h110: {373} % lpq -a
    Printer: lp@h110
     Queue: no printable jobs in queue
    Printer: lp0@h110
     Queue: no printable jobs in queue
</pre>
          </div>
          &#13;<br>
          <br>

          <p>You now make sure that you can get the print queue
          status.</p>

          <div class="FIGURE">
            <a name="AEN205"></a>

            <p><b>Figure 2-5. Run lpc</b></p>
<pre class="SCREEN">
    h110: {374} % lpc stop lp lp0
    Printer: lp@h110
    lp@h110.private: stopped
    Printer: lp0@h110
    lp0@h110.private: stopped
    h110: {375} % lpq -a
    Printer: lp@h110 (printing disabled)
     Queue: no printable jobs in queue
    Printer: lp0@h110 (printing disabled)
     Queue: no printable jobs in queue
</pre>
          </div>

          <p>Use <b class="APPLICATION">lpc</b> to disable
          printing.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="AEN212"></a>

            <p><b>Figure 2-6. Run lpr</b></p>
<pre class="SCREEN">
    h110: {376} % echo hi &gt;/tmp/hi
    h110: {377} % lpr /tmp/hi
    h110: {378} % lpq
    Printer: lp@h110 (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID          Class Job Files         Size Time
    1      papowell@h110+445    A   445 /tmp/hi          3 17:40:51
    h110: {379} % lpr -Plp0 /tmp/hi
    h110: {380} % lpq -Plp0
    Printer: lp0@h110 (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID          Class Job Files         Size Time
    1      papowell@h110+449    A   449 /tmp/hi          3 17:41:05
</pre>
          </div>
          <br>
          <br>

          <p>Now try spooling a job.</p>

          <div class="FIGURE">
            <a name="AEN217"></a>

            <p><b>Figure 2-7. Run lprm</b></p>
<pre class="SCREEN">
    h110: {381} % lprm
    Printer lp@h110:
      checking perms 'papowell@h110+445'
      dequeued 'papowell@h110+445'
    h110: {382} % lprm -Plp0
    Printer lp0@h110:
      checking perms 'papowell@h110+449'
      dequeued 'papowell@h110+449'
</pre>
          </div>

          <p>Now try removing a job.</p>

          <div class="FIGURE">
            <a name="AEN222"></a>

            <p><b>Figure 2-8. Enable Printing</b></p>
<pre class="SCREEN">
    h110: {383} % lpc enable lp lp0
    Printer: lp@h110
    lp@h110.private: enabled
    Printer: lp0@h110
    lp0@h110.private: enabled
</pre>
          </div>

          <p>Finally, enable printing.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN226">2.2. Diagnostics for
          Spooling Problems</a></h1>

          <div class="FIGURE">
            <a name="AEN228"></a>

            <p><b>Figure 2-9. Using lpr -V</b></p>
<pre class="SCREEN">
    h110: {388} % lpr -V /tmp/hi
    LPRng-3.7.10, Copyright 1988-2001 Patrick Powell, &lt;papowell@lprng.com&gt;
    sending job 'papowell@h110+29' to lp@localhost
    connecting to 'localhost', attempt 1
    connected to 'localhost'
    requesting printer lp@localhost
    sending control file 'cfA029h110.private' to lp@localhost
    completed sending 'cfA029h110.private' to lp@localhost
    sending data file 'dfA029h110.private' to lp@localhost
    completed sending 'dfA029h110.private' to lp@localhost
    done job 'papowell@h110+29' transfer to lp@localhost
</pre>
          </div>

          <p>The first line of defense is to see what is happening
          when you try to spool a job. The <tt class="LITERAL">lpr
          -V</tt> (<tt class="LITERAL">-V</tt> for <i class=
          "EMPHASIS">Verbose</i>) will show a simple high level
          trace.</p>

          <div class="FIGURE">
            <a name="AEN236"></a>

            <p><b>Figure 2-10. The lpr Options</b></p>
<pre class="SCREEN">
    h110: {389} % lpr -=
    lpr: Illegal option '='
    Usage: lpr [-Pprinter[@host]] [-A] [-B] [-Cclass] [-Fformat] [-G] [-Jinfo]
       [-(K|#)copies] [-Q] [-Raccountname]  [-Ttitle]  [-Uuser[@host]] [-V]
       [-Zoptions] [-b] [-m mailaddr] [-h] [-i indent] [-l] [-w width ] [-r]
       [-Ddebugopt ] [--] [ filenames ...  ]
     -A          - use authentication specified by AUTH environment variable
     -B          - filter files and reduce job to single file before sending
     -C class    - job class
     -D debugopt - debugging flags
     -F format   - job format
       -b,-l        - binary or literal format
        c,d,f,g,l,m,p,t,v are also format options
     -G          - filter individual job files before sending
     -J info     - banner and job information
     -K copies, -# copies   - number of copies
     -P printer[@host] - printer on host
     -Q          - put 'queuename' in control file
     -Raccntname - accounting information
     -T title    - title for 'pr' (-p) formatting
     -U username - override user name (restricted)
     -V          - Verbose information during spooling
     -X path     - user specified filter for job files
     -Y          - connect and send to TCP/IP port (direct mode)
     -Z options  - options to pass to filter
     -h          - no header or banner page
     -i indent   - indentation
     -k          - do not use tempfile when sending to server
     -m mailaddr - mail final status to mailaddr
     -r          - remove files after spooling
     -w width    - width to use
     --          - end of options, files follow
     filename '-'  reads from STDIN
     PRINTER, LPDEST, NPRINTER, NGPRINTER environment variables set default printer.
    LPRng-3.7.10, Copyright 1988-2001 Patrick Powell, &lt;papowell@lprng.com&gt;
</pre>
          </div>

          <p>Use the <tt class="LITERAL">-=</tt> option to see the
          available options.</p>

          <div class="FIGURE">
            <a name="AEN242"></a>

            <p><b>Figure 2-11. Debug Options</b></p>
<pre class="SCREEN">
    h110: {392} % lpr -D=
    debug usage: -D [ num | flag=num | flag=str | flag | flag@ | flag+N ]*
      flags recognized: network[+N,@], database[+N,@], lpr[+N,@],
       lpc[+N,@], lprm[+N,@], lpq[+N,@], log[+N,@],
       test=num
</pre>
          </div>

          <p>The <tt class="LITERAL">-D=</tt> option shows the
          debugging flags available.</p>

          <div class="FIGURE">
            <a name="AEN247"></a>

            <p><b>Figure 2-12. The lpr -D1 Output</b></p>
<pre class="SCREEN">
    h110: {395} % lpr -D1 /tmp/hi &gt;&amp;/tmp/x
    2001-10-18-05:29:05 [8052]  Initialize: /dev/null fd 3
    2001-10-18-05:29:05 [8052]  initsetproctitle: using builtin
    2001-10-18-05:29:05 [8052] lpr  Setup_uid: OriginalEUID 0, OriginalRUID 1001
    2001-10-18-05:29:05 [8052] lpr  Setup_uid: OriginalEGID 1001, OriginalRGID 1001
    2001-10-18-05:29:05.761 [8052] lpr  Setup_configuration: starting, Allow_getenv 0
    2001-10-18-05:29:05.761 [8052] lpr  Setup_configuration: Configuration file '/etc/lpd.conf'
    2001-10-18-05:29:05.761 [8052] lpr  Setup_configuration: Require_configfiles_DYN '1'
    2001-10-18-05:29:05.761 [8052] lpr  Get_config: required '1', '/etc/lpd.conf'
    2001-10-18-05:29:05.762 h110 [8052] lpr
       Get_local_host: ShortHost_FQDN=h110, FQDNHost_FQDN=h110.private
    2001-10-18-05:29:05.763 h110 [8052] lpr
       Is_server 0, DaemonUID 1, DaemonGID 1, UID 0, EUID 0, GID 1001, EGID 1001
    2001-10-18-05:29:05.763 h110 [8052] lpr
       Setup_configuration: Host 'h110.private', ShortHost 'h110', user 'papowell'
    ...
</pre>
          </div>

          <p>The <b class="APPLICATION">lpr</b> <tt class=
          "LITERAL">-D1</tt> (diagnostic level 1) shows a summary
          of the various steps taken to send the job. If you want
          more detail, try <b class="APPLICATION">lpr</b> <tt
          class="LITERAL">-D2</tt>; or even <b class=
          "APPLICATION">lpr</b> <tt class="LITERAL">-D3</tt>;.</p>

          <div class="FIGURE">
            <a name="AEN258"></a>

            <p><b>Figure 2-13. Using lpr -Dnetwork</b></p>
<pre class="SCREEN">
    h110: {400} % lpr -Dnetwork /tmp/hi
    lp: getconnection: START host localhost, timeout 10, connection_type 1
    lp: getconnection: fqdn found localhost.my.domain, h_addr_list count 1
    lp: Link_dest_port_num: port 515 = 515
    lp: getconnection: AGAIN port 808, min 512, max 1023, count 0, connects 0
    lp: Link_dest_port_num: port 515 = 515
    lp: getconnection: sock 3, src ip 127.0.0.1, port 808
    lp: getconnection: dest ip 127.0.0.1, port 515
    lp: getconnection: connection to 'localhost' socket 3, errormsg 'No Error'
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^Blp
    ', count 4, ack 0xbfbfc3d0
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^B142 cfA065h110.private
    ', count 24, ack 0xbfbfbf90
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str 'Hh110.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Apapowell@h110+65
    D2001-10-18-05:34:18.939
    Qlp
    N/tmp/hi
    fdfA065h110.private
    UdfA065h110.private
    ', count 143, ack 0xbfbfbf90
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^C3 dfA065h110.private
    ', count 22, ack 0xbfbfbf24
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '', count 1, ack 0xbfbfbf24
    lp: Link_send: final status NO ERROR
</pre>
          </div>

          <p>The <b class="APPLICATION">lpr</b> <tt class=
          "LITERAL">-Dnetwork</tt> (network diagnostic level 1)
          shows the network operations performed by <b class=
          "APPLICATION">lpr</b>. If you want more detail, try <b
          class="APPLICATION">lpr</b> <tt class=
          "LITERAL">-Dnetwork+2</tt> or even <b class=
          "APPLICATION">lpr</b> <tt class=
          "LITERAL">-Dnetwork+3</tt>.</p>

          <div class="FIGURE">
            <a name="AEN270"></a>

            <p><b>Figure 2-14. Debugging lpq</b></p>
<pre class="SCREEN">
    h110: {1} % lpq -=
    lpq: Illegal option '='
    usage: lpq [-aAclV] [-Ddebuglevel] [-Pprinter] [-tsleeptime]
      -A           - use authentication specified by AUTH environment variable
      -a           - all printers
      -c           - clear screen before update
      -l           - increase (lengthen) detailed status information
                     additional l flags add more detail.
      -L           - maximum detailed status information
      -n linecount - linecount lines of detailed status information
      -Ddebuglevel - debug level
      -Pprinter    - specify printer
      -s           - short (summary) format
      -tsleeptime  - sleeptime between updates
      -V           - print version information
    
    h110: {2} % lpq -D1
    2001-10-18-05:39:09 [8090]  Initialize: /dev/null fd 3
    2001-10-18-05:39:09 [8090]  initsetproctitle: using builtin
    2001-10-18-05:39:09 [8090] lpq  Setup_uid: OriginalEUID 0, OriginalRUID 1001
    ...
    
    h110: {3} % lpq -Dnetwork
    lp: getconnection: START host localhost, timeout 10, connection_type 1
    lp: getconnection: fqdn found localhost.my.domain, h_addr_list count 1
    lp: Link_dest_port_num: port 515 = 515
    lp: getconnection: AGAIN port 862, min 512, max 1023, count 0, connects 0
    lp: Link_dest_port_num: port 515 = 515
    lp: getconnection: sock 3, src ip 127.0.0.1, port 862
    ...
</pre>
          </div>

          <p>The <b class="APPLICATION">lpq</b>, <b class=
          "APPLICATION">lprm</b>, and <b class=
          "APPLICATION">lpc</b> applications also support the <tt
          class="LITERAL">-=</tt> and <tt class="LITERAL">-D</tt>
          (debug) options.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN280">2.3. What Went Wrong
          With My Job?</a></h1>

          <div class="FIGURE">
            <a name="AEN282"></a>

            <p><b>Figure 2-15. Basic lpq Information</b></p>
<pre class="SCREEN">
    
    h110: {1} % lpr /tmp/hi
    h110: {1} % lpq
    Printer: lp@h110
     Queue: 1 printable job
     Server: pid 8741 active
     Unspooler: pid 8742 active
     Status: processing 'dfA740h110.private', size 3, format 'f',
        IF filter 'ifhp' at 08:16:58.465
     Filter_status: code = 10003, 'Warming Up' at 08:17:02.045
     Rank   Owner/ID         Class Job Files      Size Time
    active papowell@h110+740  A    740 /tmp/hi       3 08:16:58
</pre>
          </div>

          <p>The first thing to do is check the status of your job
          with <b class="APPLICATION">lpq</b>. This will show the
          current jobs in the queue and <b class=
          "APPLICATION">lpd</b> server. The <tt class=
          "LITERAL">Server</tt> value is the process that is
          responsible for sending jobs to the printer. It starts
          the <tt class="LITERAL">Unspooler</tt> process that does
          the actual transfer to the remote system. Each time a job
          is processed a new <tt class="LITERAL">Unspooler</tt>
          process is created. The <tt class="LITERAL">Server</tt>
          process stays active until there is no further work to be
          done for the print queue.</p>

          <div class="FIGURE">
            <a name="AEN293"></a>

            <p><b>Figure 2-16. Using the lpq -l Option</b></p>
<pre class="SCREEN">
    h110: {2} % lpq -l
    Printer: lp@h110
     Queue: 1 printable job
     Server: pid 8741 active
     Unspooler: pid 8742 active
     Status: printing job 'papowell@h110+740' at 08:16:58.465
     Status: processing 'dfA740h110.private', size 3, format 'f',
         IF filter 'ifhp' at 08:16:58.465
     Filter_status: getting end using 'pjl job/eoj' at 08:16:59.902
     Filter_status: code = 10003, 'Warming Up' at 08:17:02.045
     Rank   Owner/ID          Class Job Files      Size Time
    active papowell@h110+740  A     740 /tmp/hi       3 08:16:58
    h110: {3} % lpq -lll
    Printer: lp@h110
     Queue: 1 printable job
     Server: pid 8741 active
     Unspooler: pid 8742 active
     Status: accounting at start at 08:16:58.455
     Status: opening device 'h14%9100' at 08:16:58.455
     Status: printing job 'papowell@h110+740' at 08:16:58.465
     Status: processing 'dfA740h110.private', size 3, format 'f',
         IF filter 'ifhp' at 08:16:58.465
     Filter_status: data sent at 08:16:59.902
     Filter_status: sent job file at 08:16:59.902
     Filter_status: getting end using 'pjl job/eoj' at 08:16:59.902
     Filter_status: code = 10003, 'Warming Up' at 08:17:02.045
     Rank   Owner/ID          Class Job Files      Size Time
    active papowell@h110+740  A     740 /tmp/hi       3 08:16:58
</pre>
          </div>

          <p>The <b class="APPLICATION">lpq</b> <tt class=
          "LITERAL">-l</tt> (<i class="EMPHASIS">longer</i>) option
          increases the number of <tt class="LITERAL">Status</tt>
          and <tt class="LITERAL">Filter_status</tt> lines shown.
          These lines come from the <tt class=
          "LITERAL">status.%P</tt> and <tt class=
          "LITERAL">status</tt> files in the spool queue. Adding
          more <tt class="LITERAL">-l</tt> options increases the
          amount of status shown.</p>

          <div class="FIGURE">
            <a name="AEN306"></a>

            <p><b>Figure 2-17. Using the lpq -L Option</b></p>
<pre class="SCREEN">
    
    h110: {4} % lpq -L
    Printer: lp@h110
     Queue: 1 printable job
     Server: pid 8741 active
     Unspooler: pid 8742 active
     Status: waiting for subserver to exit at 08:16:58.451
     Status: subserver pid 8742 starting at 08:16:58.455
     Status: accounting at start at 08:16:58.455
     Status: opening device 'h14%9100' at 08:16:58.455
     Status: printing job 'papowell@h110+740' at 08:16:58.465
     Status: processing 'dfA740h110.private', size 3, format 'f',
         IF filter 'ifhp' at 08:16:58.465
     .....
    
     Filter_status: decoded job type 'PCL' at 08:16:59.901
     Filter_status: job type 'PCL' at 08:16:59.901
     Filter_status: transferring 3 bytes at 08:16:59.902
     Filter_status: 100 percent done at 08:16:59.902
     Filter_status: data sent at 08:16:59.902
     Filter_status: sent job file at 08:16:59.902
     Filter_status: getting end using 'pjl job/eoj' at 08:16:59.902
     Filter_status: code = 10003, 'Warming Up' at 08:17:02.045
     .....
    
     Rank   Owner/ID          Class Job Files     Size Time
    active papowell@h110+740    A   740 /tmp/hi      3 08:16:58
</pre>
          </div>

          <p>If you want to see <i class="EMPHASIS">LOTS</i> of
          status, use <tt class="LITERAL">lpq -L</tt>, which shows
          all the avilable status information.</p>

          <div class="FIGURE">
            <a name="AEN313"></a>

            <p><b>Figure 2-18. Job Completion</b></p>
<pre class="SCREEN">
    h110: {5} % lpq
    Printer: lp@h110
     Queue: no printable jobs in queue
     Status: job 'cfA740h110.private' removed at 08:18:07.776
     Filter_status: done at 08:18:07.756
    h110: {6} % lpq -lll
    Printer: lp@h110
     Queue: no printable jobs in queue
     Status: printing job 'papowell@h110+740' at 08:16:58.465
     Status: processing 'dfA740h110.private', size 3, format 'f',
         IF filter 'ifhp' at 08:16:58.465
     Status: IF filter 'ifhp' filter finished at 08:18:07.757
     Status: printing finished at 08:18:07.757
     Status: accounting at end at 08:18:07.774
     Status: finished 'papowell@h110+740', status 'JSUCC' at 08:18:07.774
     Status: subserver pid 8742 exit status 'JSUCC' at 08:18:07.775
     Status: lp@h110.private: job 'cfA740h110.private' printed at 08:18:07.775
     Status: job 'cfA740h110.private' removed at 08:18:07.776
     Filter_status: transferring 3 bytes at 08:16:59.902
     Filter_status: 100 percent done at 08:16:59.902
     Filter_status: data sent at 08:16:59.902
     Filter_status: sent job file at 08:16:59.902
     Filter_status: getting end using 'pjl job/eoj' at 08:16:59.902
     Filter_status: code = 10003, 'Warming Up' at 08:17:02.045
     Filter_status: end of job detected at 08:18:06.457
     Filter_status: pagecounter 105341 after 1 attempts at 08:18:07.756
     Filter_status: pagecounter 105341, pages 1 at 08:18:07.756
     Filter_status: done at 08:18:07.756
</pre>
          </div>

          <p>When your job is finished, you can use the <tt class=
          "LITERAL">lpq -lll</tt> options to see the final results
          of processing the job.</p>

          <div class="FIGURE">
            <a name="AEN318"></a>

            <p><b>Figure 2-19. Summary Status Displays</b></p>
<pre class="SCREEN">
    h110: {7} % lpq -s
    lp@h110 0 jobs
    h110: {239} % lpq -s -a
    lp@h110 0 jobs
    lp0@h110 0 jobs (printing disabled)
    h110: {8} % lpc status
     Printer    Printing Spooling Jobs  Server Subserver Redirect Status/(Debug)
    lp@h110      enabled  enabled    0    none    none
    h110: {9} % lpc status all
     Printer    Printing Spooling Jobs  Server Subserver Redirect Status/(Debug)
    lp@h110      enabled  enabled    0    none    none
    lp0@h110    disabled  enabled    0    none    none
    h110: {10} % exit
</pre>
          </div>

          <p>The <tt class="LITERAL">lpq -s</tt> (<i class=
          "EMPHASIS">short</i> status) shows a single summary line
          for status. Adding the <tt class="LITERAL">-a</tt> (<i
          class="EMPHASIS">all</i> queues) will print information
          for all the print queues.</p>

          <p>The <tt class="LITERAL">lpc status</tt> command
          queries the <b class="APPLICATION">lpd</b> server and
          reports the status of the queues operated by the <b
          class="APPLICATION">lpd</b> server. The <tt class=
          "LITERAL">lpd status all</tt> will show the status of all
          the print queues.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN331">2.4. Diagnostics for
          <b class="APPLICATION">lpd</b> Problems</a></h1>

          <div class="FIGURE">
            <a name="AEN334"></a>

            <p><b>Figure 2-20. lpd Options</b></p>
<pre class="SCREEN">
    h110# lpd -=
    lpd: Illegal option '='
    usage: lpd [-FV] [-D dbg] [-L log]
     Options
     -D dbg      - set debug level and flags
                     Example: -D10,remote=5
                     set debug level to 10, remote flag = 5
     -F          - run in foreground, log to STDERR
                   Example: -D10,remote=5
     -L logfile  - append log information to logfile
     -V          - show version info
    h110# lpd -D=
    debug usage: -D [ num | flag=num | flag=str | flag | flag@ | flag+N ]*
      flags recognized: network[+N,@], database[+N,@], lpr[+N,@],
       lpc[+N,@], lprm[+N,@], lpq[+N,@], log[+N,@],
       test=num
</pre>
          </div>

          <p>The <b class="APPLICATION">lpd</b> server can be
          started in debug mode. However, the amount of information
          produced can be overwhelming. If you need to determine
          what is happening during initial connection, then you
          will have to do this.</p>

          <div class="FIGURE">
            <a name="AEN340"></a>

            <p><b>Figure 2-21. Using lpd Debug Options</b></p>
<pre class="SCREEN">
    h110# lpd
    h110# lpd -F -D1
    2001-10-18-05:56:55 [8156] lpd  Initialize: starting
    ...
    2001-10-18-05:56:55.228 h110 [8156] lpd  lpd: listening socket fd -6
    Fatal error - Another print spooler is using TCP printer
        port, possibly lpd process '8154'
    2001-10-18-05:56:55.228 h110 [8156] lpd  cleanup: done, exit(1)
    h110# killall lpd
    h110# lpd -F -D1
    2001-10-18-05:57:05 [8158] lpd  Initialize: starting
    ...
    2001-10-18-05:57:05.800 h110 [8159] Waiting  lpd: LOOP START
    2001-10-18-05:57:05.800 h110 [8159] Waiting
          lpd: starting select timeout 'yes', 600 sec, max_socks 7
    
    ---- other window
         h110: {5} % lpr /tmp/hi
    ----
    
    2001-10-18-05:57:44.341 h110 [8159] Waiting
         lpd: select returned 1, error 'No Error'
    2001-10-18-05:57:44.342 h110 [8159] Waiting
         lpd: fd 5 readable
    2001-10-18-05:57:44.342 h110 [8159] Waiting  lpd: connection fd 8
    2001-10-18-05:57:44.351 h110 [8159] Waiting  Start_worker: fd 8
    
    2001-10-18-05:57:44.356 h110 [8171] RECV  lp: Fix_Rm_Rp_info: printer name 'lp'
    2001-10-18-05:57:44.356 h110 [8171] RECV  Reset_config: starting
    2001-10-18-05:57:44.361 h110 [8171] RECV
         lp: Select_pc_info: looking for 'lp', depth 0
    ...
</pre>
          </div>

          <p>This shows <i class="EMPHASIS">all</i> of the
          information available about the printing operation. But
          it is jumbled all together. Usually you want to see just
          the information about a single spool queue.</p>

          <div class="FIGURE">
            <a name="AEN346"></a>

            <p><b>Figure 2-22. Debugging Spool Queue</b></p>
<pre class="SCREEN">
    Printcap:
      lp:sd=/var/spool/lpd/%P
        :db=<i class="EMPHASIS">DebugOptions</i>
           db=1     - output to device level 1,
           db=lpc db=lpq db=lpr db=lprm
                    - incoming lpc, lpq, lpr, lprm operations
    
    Spool Queue:  /var/spool/lpd/lp
      Default Files - created by <b class="APPLICATION">checkpc</b>
        control.%P  - queue control (enable, disable...)
        acct        - accounting
        status      - filter status
        status.%P   - queue status
        log         - diagnostics
</pre>
          </div>

          <p>The <b class="APPLICATION">checkpc</b> program creates
          a standard set of files in each spool queue, including
          the <tt class="LITERAL">log</tt> file. The <tt class=
          "LITERAL">:db=</tt><i class="EMPHASIS">DebugOptions</i>
          enables debugging output for the specified operation.
          Information is sent to the <tt class="LITERAL">log</tt>
          file as soon as the print queue directory and debug flags
          for the spool queue are determined.</p>

          <div class="FIGURE">
            <a name="AEN357"></a>

            <p><b>Figure 2-23. Setting Queue Debug Options</b></p>
<pre class="SCREEN">
    h110# vi /etc/printcap
      set:
        lp:...
          :db=lpr
    h110# lpc reread
    lpd server pid 8200 on h110.private, sending SIGHUP
</pre>
          </div>

          <p>Edit the printcap. You can then use <tt class=
          "LITERAL">lpc reread</tt> to signal the <b class=
          "APPLICATION">lpd</b> process to read the new <tt class=
          "FILENAME">/etc/printcap</tt> file.</p>

          <div class="FIGURE">
            <a name="AEN364"></a>

            <p><b>Figure 2-24. <tt class="LITERAL">log</tt>
            File</b></p>
<pre class="SCREEN">
    2001-10-18-06:11:30.349 h110 [8216] RECV
       lp: Receive_job: debug 'lpr', Debug 0, DbgFlag 0x1000
    2001-10-18-06:11:30.349 h110 [8216] RECV
       lp: Receive_job: spooling_disabled 0
    2001-10-18-06:11:30.349 h110 [8216] RECV
       lp: Receive_job: sending 0 ACK for job transfer request
    2001-10-18-06:11:30.349 h110 [8216] RECV
       lp: Receive_job: from localhost.my.domain- getting file transfer line
    2001-10-18-06:11:30.349 h110 [8216] RECV
       lp: Receive_job: read from localhost.my.domain-
           status 0 read 23 bytes '^B131 cfA215h110.private'
</pre>
          </div>

          <p>You can now use the <tt class="LITERAL">log</tt> file
          to see the individual queue operations. The size of the
          log file is determined by the <tt class=
          "LITERAL">max_log_file_size</tt> (default is 1000Kbytes);
          when the log file exceeds this it is truncted to 25% of
          its maximum length.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN371">Chapter 3. Printers</a></h1>

        <div class="FIGURE">
          <a name="AEN373"></a>

          <p><b>Figure 3-1. Printer Types</b></p>
<pre class="SCREEN">
    Printers:
      Cheap and Slow Ink Dispensers
      Not So Cheap Fast Printers
      Vintage Stuff On Sale
      Legacy Junk You Are Stuck With
</pre>
        </div>

        <p>Your office mate has just purchased a nice new $99
        ink-jet printer and wants to use it on his office desktop.
        Your boss calls you in and tells you that the new <i class=
        "EMPHASIS">PlattenPusher 5500</i> printer will arrive and
        it needs to be operational ASAP. And finally, you pick up a
        really good bargin on a used <i class=
        "EMPHASIS">HP4mPlus</i> laser printer, which all the folks
        on the <b class="APPLICATION">LPRng</b> mailing list
        recommend as the most reliable (and SLOW...) printer they
        ever used.</p>

        <p>With your luck, probably all three happen on the same
        day. Welcome to the wonderful world of printers.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN381">3.1.
          Interface</a></h1>

          <div class="FIGURE">
            <a name="AEN383"></a>

            <p><b>Figure 3-2. Interface Types</b></p>
<pre class="SCREEN">
    Connection:
      Parallel port : write only (no status)
                      read/write (maybe you get status)
      Serial port:    read/write (status)
      Network:        serial port emulator
                      parallel port emulator
                      print spooler emulator
                      whacko interface
</pre>
          </div>

          <p>The type of interface on your printer is usually a
          function of the printer cost and speed. The low cost/low
          speed printers usually have a parallel port interface,
          while the higher cost/higher speed printers usually have
          both a parallel port <i class="EMPHASIS">and</i> a
          network interface. Serial ports are usually found only on
          older model printers or those which have very special
          facilities.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN388">3.2. Parallel
          Port</a></h1>

          <div class="FIGURE">
            <a name="P2"></a>

            <p><b>Figure 3-3. Parallel Port</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="parallel.png"></p>
            </div>
          </div>

          <p>Some printers provide <i class="EMPHASIS">status</i>
          information. In order to do this they need a <i class=
          "EMPHASIS">bidirectional</i> communications channel. The
          parallel port interface found on the original X86
          PC/XT/ATX systems was write only. However, there were a
          couple of signals (<tt class="LITERAL">OUT OF PAPER</tt>,
          <tt class="LITERAL">ERROR</tt>, etc.) that provided
          status information to the computer system. By monitoring
          these signals the host computer could tell the user that
          there were problems with the printer. Fiendishly clever
          engineers discovered that they could use these signals to
          implement a <i class="EMPHASIS">bidirectional data
          channel</i> over the parallel port. They could even put
          multiple devices (daisy chained) on the parallel port.
          Needless to say, of the hundreds of companies that used
          bidirectional parallel interfaces no two of them used the
          same method.</p>

          <p>In a fit of desperation, the IEEE1284 standard (well,
          actually 3 standards) were developed to allow at least
          some sort of general consensus on how a bidirectional
          parallel port should work.</p>

          <p>If you are interested in the details about Parallel
          Ports, see <a href="http://www.fapo.com/1284int.htm"
          target="_top">http://www.fapo.com/1284int.htm</a> for a
          nice introduction, and the IEEE1394 Trade Association
          Home Page <a href="http://www.1394ta.org/" target=
          "_top">http://www.1394ta.com/</a> for pointers to other
          information.</p>

          <p>The good news is that if your printer is IEEE1284
          compliant, then it has a functional bidirectional
          interface that will return status and other information.
          The bad news, <i class="EMPHASIS">really</i> bad news,
          and <i class="EMPHASIS">really</i> <i class=
          "EMPHASIS">really</i> bad news is a) there is no software
          level API for using bidirectionality; b) the parallel IO
          drivers that exist differ from version to version; c)
          most of the time the status returned by the printer is
          useless anyways.</p>

          <p>Given this set of problems I recommend that you:</p>

          <ul>
            <li>
              <p>Put only one device (your printer) on each
              parallel port.</p>
            </li>

            <li>
              <p>Do not expect to get status information back from
              the printer.</p>
            </li>
          </ul>

          <div class="FIGURE">
            <a name="P1"></a>

            <p><b>Figure 3-4. Parallel Port Printcap</b></p>
<pre class="SCREEN">
    lp:lp=/dev/lpt0
      :sd=/var/spool/lpd/%P
</pre>
          </div>
          &#13;<br>
          <br>

          <p>As shown in <a href="#FG1">Figure 1-1</a>, the
          printcap entry for a parallel port (without a filter) is
          really simple. If your printer is offline or powered
          down, <b class="APPLICATION">lpd</b> will not be able to
          open the parallel port and you will see an endless list
          of error messages in the status file.</p>

          <div class="FIGURE">
            <a name="P3"></a>

            <p><b>Figure 3-5. Loading Linux Parallel Port
            Driver</b></p>
<pre class="SCREEN">
    [papowell@h112 papowell]$ su
    Password:
    [root@h112 papowell]# echo &lt;/dev/lp0
    [root@h112 papowell]# cd /proc/sys/dev/parport/
    [root@h112 parport]# ls default  parport0
    [root@h112 parport]# cd parport0
    [root@h112 parport0]# ls autoprobe  autoprobe0  autoprobe1  autoprobe2
       autoprobe3  base-addr  devices  dma  irq  modes  spintime
    [root@h112 parport0]# cat autoprobe
    CLASS:PRINTER; MODEL:DESKJET 670C;
    MANUFACTURER:HEWLETT-PACKARD;
    DESCRIPTION:Hewlett-Packard DeskJet 670C;
    COMMAND SET:MLC,PCL,PML;
</pre>
          </div>

          <p>The Linux system uses loadable module drivers for the
          parallel ports and newer releases support the IEEE1284 <i
          class="EMPHASIS">device probe</i> functions. You can use
          the command shown in <a href="#P3">Figure 3-5</a> to load
          the modules; the <tt class="LITERAL">echo
          &lt;/dev/lp0</tt> command tries to open the device in <tt
          class="LITERAL">read</tt> mode, and then exits after
          reading nothing... which might suggest that you cannot
          get status from the device. If you have the <tt class=
          "LITERAL">/proc</tt> system installed, then you can see
          what the IEEE1284 probe function returned.</p>

          <div class="FIGURE">
            <a name="P4"></a>

            <p><b>Figure 3-6. Parallel Port Problems</b></p>
<pre class="SCREEN">
    One Interrupt per Output Character
       - One Interrupt per Blocks of Characters (DMA)
       - Hope that DMA works
    May operate by <i class="EMPHASIS">polling</i>
    Don't try to daisy chain devices
</pre>
          </div>

          <p>While you may think that you are getting a high
          throughput to the parallel port, in actual fact it may be
          very slow. In the worst case you will get a an interrupt
          for every character output. Even worse, sometimes the
          parallel port driver will <i class="EMPHASIS">spin
          block</i> for a small period of time in the hopes that a
          character will be accepted by the printer so it can send
          another one. Finally, while many users have successfully
          daisy chained multiple devices, there is a resounding
          silence from them when asked about the success of
          simultaneous use of the devices.</p>

          <p>To add insult to injury, some systems do not even
          support interrupts with their parallel port hardware. To
          do IO, they periodically <i class="EMPHASIS">poll</i> the
          output device to see if it is ready to accept another
          character.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN439">3.3. Network
          Ports</a></h1>

          <div class="FIGURE">
            <a name="N1"></a>

            <p><b>Figure 3-7. Network Ports</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="network.png"></p>
            </div>
          </div>

          <p>Most devices that support a network connection do so
          by either providing support for a print spooler interface
          (<b class="APPLICATION">lpd</b>) or by emulating a
          bidirectional connection to the printing device (<i
          class="EMPHASIS">socket</i> or <i class=
          "EMPHASIS">appsocket</i>). If your printer provides
          status reporting, it is <i class="EMPHASIS">strongly</i>
          recommended that you use the socket interface. This will
          allow you to monitor conditions reported by the
          printer.</p>

          <div class="FIGURE">
            <a name="N2"></a>

            <p><b>Figure 3-8. Network Port Printcap</b></p>
<pre class="SCREEN">
    lp:lp=10.0.0.14%9100
      :sd=/var/spool/lpd/%P
    
    lp2:lp=raw@10.0.0.14
      :sd=/var/spool/lpd/%P
      # legacy :rp:rm support
      # :rp=raw:rm=10.0.0.14
</pre>
          </div>

          <p>The printcap for a network printer is shown in <a
          href="#N2">Figure 3-8</a>. You can use the <tt class=
          "LITERAL">:rp:rm</tt> options if you want.</p>

          <div class="FIGURE">
            <a name="N3"></a>

            <p><b>Figure 3-9. Benefits of Network Port
            Printcap</b></p>
<pre class="SCREEN">
    High Speed
    Low Error Rate (+ Error Detection)
    Long Distances
    Very low system overhead
</pre>
          </div>

          <p>Network port printing is effectively the highest
          speed. The TCP/IP protocol provides both flow control and
          error detection/correction. The printer and host system
          can be separated by quite large distances. Finally, the
          overhead of the TCP/IP connection is very low in terms of
          hardware and software.</p>

          <div class="FIGURE">
            <a name="N4"></a>

            <p><b>Figure 3-10. Network Print Server</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="printserver.png"></p>
            </div>
          </div>

          <p>If you have legacy systems that have serial or
          parallel ports, you can buy a <i class="EMPHASIS">Network
          Print Server</i> box. These have a network interface and
          one or more parallel or serial port interfaces.</p>

          <div class="TABLE">
            <a name="NEWPS"></a>

            <p><b>Table 3-1. Network Print Server Configuration
            Information</b></p>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Manufacturer</th>

                  <th align="LEFT" valign="TOP">Model</th>

                  <th align="LEFT" valign="TOP">RFC1179 Port Name
                  (rp=XXX)</th>

                  <th align="LEFT" valign="TOP">Send to TCP
                  port</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.cannon.com/" target="_top">Cannon
                  Printer</a></td>

                  <td align="LEFT" valign="TOP">Cannon 460 PS, no
                  hard drive</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">xjdirect</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Cannon 460 PS hard
                  drive</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">xjprint</tt> - print immediately,<tt
                  class="LITERAL">xjhold</tt> - print later</td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.digprod.com/" target="_top">Digital
                  Products Inc.</a></td>

                  <td align="LEFT" valign="TOP">NETPrint Print
                  Server</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PORT</tt><tt class="LITERAL">n</tt>,
                  where <tt class="LITERAL">n</tt> is port on
                  server</td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.efi.com/" target="_top">Electronics
                  For Imaging Inc.</a></td>

                  <td align="LEFT" valign="TOP">Fiery RIP i
                  series</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">normalq</tt> or <tt class=
                  "LITERAL">urgentq</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Fiery RIP XJ
                  series</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">xjprint</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Fiery RIP XJ+ and
                  SI series</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">print_</tt><tt class=
                  "LITERAL">Model</tt>, e.g. <tt class=
                  "LITERAL">print_DocuColor</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Fiery models
                  ZX2100, ZX3300, X2, X2e</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">print</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.emulex.com/" target="_top">Emulex
                  Corp.</a></td>

                  <td align="LEFT" valign="TOP">NETJet/NETQue print
                  server</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PASSTHRU</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.extendsys.com/" target=
                  "_top">Extended Systems Inc.</a></td>

                  <td align="LEFT" valign="TOP">ExtendNet Print
                  Server</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">Printer<tt class=
                  "REPLACEABLE"><i>n</i></tt></tt>, where <tt
                  class="LITERAL">n</tt> is port on server</td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.hp.com/" target=
                  "_top">Hewlett-Packard</a></td>

                  <td align="LEFT" valign="TOP">JetDirect interface
                  card</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">raw</tt></td>

                  <td align="LEFT" valign="TOP">9100</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.hp.com/" target=
                  "_top">Hewlett-Packard</a></td>

                  <td align="LEFT" valign="TOP">JetDirect Multiport
                  Server</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">port 1 - raw1, port 2 - raw2,
                  etc.</tt></td>

                  <td align="LEFT" valign="TOP">port 1 - 9100, port
                  2 - 9101, etc.</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.i-data.com/" target=
                  "_top">I-Data</a></td>

                  <td align="LEFT" valign="TOP">Easycom 10
                  Printserver</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">par1</tt> (parallel port 1)</td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Easycom 100
                  Printserver</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">LPDPRT1</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.printers.ibm.com/" target=
                  "_top">IBM</a></td>

                  <td align="LEFT" valign="TOP">Network Printer 12,
                  17, 24, and 24PS</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PASS</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.lantronix.com/" target=
                  "_top">Lantronix</a></td>

                  <td align="LEFT" valign="TOP">EPS1, EPS2</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">EPS_<tt class="LITERAL">X_S1 (serial)
                  port 1, EPS_X</tt>_P1 (parallel) port 2</tt>,
                  etc.</td>

                  <td align="LEFT" valign="TOP">3001 (port 1), 3002
                  (port 2), etc.</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.qms.com/" target="_top">QMS</a></td>

                  <td align="LEFT" valign="TOP">Various Models</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">RAW</tt></td>

                  <td align="LEFT" valign="TOP">35 (AppSocket)</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.tek.com/color_printers/" target=
                  "_top">Tektronix</a></td>

                  <td align="LEFT" valign="TOP">Tektronix printer
                  network cards</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PS</tt> (PostScript), <tt class=
                  "LITERAL">PCL</tt> (PCL), or <tt class=
                  "LITERAL">AUTO</tt>(Auto-selection between PS,
                  PCL, or HPGL). Not reliable.</td>

                  <td align="LEFT" valign="TOP">9100 (AppSocket on
                  some models)</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.rosel.com" target="_top">Rose
                  Electronics</a></td>

                  <td align="LEFT" valign="TOP">Microserve Print
                  Servers</td>

                  <td align="LEFT" valign="TOP">lp</td>

                  <td align="LEFT" valign="TOP">9100</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><a href=
                  "http://www.xerox.com/" target=
                  "_top">Xerox</a></td>

                  <td align="LEFT" valign="TOP">Models 4505, 4510,
                  4517, 4520</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PASSTHRU</tt></td>

                  <td align="LEFT" valign="TOP">2501 (AppSocket on
                  some models)</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Model 4512</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PORT1</tt></td>

                  <td align="LEFT" valign="TOP">10001
                  (programmable)</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Model N17</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">RAW</tt></td>

                  <td align="LEFT" valign="TOP">9100</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Models N24 and
                  N32</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">RAW</tt></td>

                  <td align="LEFT" valign="TOP">2000</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Models 4900, 4915,
                  4925, C55</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">PS</tt></td>

                  <td align="LEFT" valign="TOP">2000</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">&nbsp;</td>

                  <td align="LEFT" valign="TOP">Document Centre
                  DC220/230</td>

                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">lp</tt></td>

                  <td align="LEFT" valign="TOP">- Unknown if
                  supported -</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>All company, brand, and product names are properties
          of their respective owners.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN647">3.4. Sending To SMB
          (Samba, Microsoft) Printer, Novell, Appletalk</a></h1>

          <div class="FIGURE">
            <a name="AEN649"></a>

            <p><b>Figure 3-11. Using Program To Send To
            Printer</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="samba.png"></p>
            </div>
          </div>

          <p>There are a wide number of other print spooling
          systems that have been developed over the years. Most of
          these use proprietary or arcane protocols to transfer
          files. These include the <span class="ACRONYM">SMB</span>
          protocol used by Microsoft, the Novell print spooler
          support, and the Apple corporation Appletalk (Copyright,
          Trademarks where applicable). These systems usually run
          on or with non-UNIX Operating Systems or on proprietary
          hardware. But over the years packages have been developed
          to interface to these systems.</p>

          <div class="FIGURE">
            <a name="AEN656"></a>

            <p><b>Figure 3-12. Protocols, Packages, and Transfer
            Programs</b></p>
<pre class="SCREEN">
    Protocol        Package       Transfer Program
    SMB (CIFS)      Samba         smbclient + wrapper
       WWW: <a href="http://www.samba.org" target=
"_top">http://www.samba.org</a>
    Novell Netware  ncpfs (Linux) nprint + wrapper
       FTP: <a href="ftp.gwdg.de/pub/linux/misc/ncpfs" target=
"_top">ftp.gwdg.de/pub/linux/misc/ncpfs</a>
       (Also Linux Kernel Documentation/filesystems)
    Appletalk       CAPS          pap + wrapper
       WWW: <a href="http://sourceforge.net/projects/netatalk"
target="_top">http://sourceforge.net/projects/netatalk</a>
       WWW: <a href="http://www.umich.edu/~rsug/netatalk" target=
"_top">http://www.umich.edu/~rsug/netatalk</a>
</pre>
          </div>

          <p>Each of these programs will transfer a print job to a
          remote system.</p>

          <div class="FIGURE">
            <a name="AEN664"></a>

            <p><b>Figure 3-13. Printcap For Transfer
            Programs</b></p>
<pre class="SCREEN">
    lp:
      <i class="EMPHASIS">OR</i>
      :lp=|/usr/local/lib/filters/smbprint
      <i class="EMPHASIS">OR</i>
      :lp=|/usr/local/lib/filters/ncpprint
      <i class="EMPHASIS">OR</i>
      :lp=|/usr/local/lib/filters/atalkprint
      # and the magic happens here
      :options=authfile="auth" host="h114" printer="lp" workgroup="ASTART"
      # See the LPRng/UTILS directory
</pre>
          </div>

          <p>You can specify a <i class="EMPHASIS">program</i> to
          do the transfer to the remote host. The program will
          connect to the remote system and transfer <tt class=
          "LITERAL">STDIN</tt> to the printer. Errors will be
          written to <tt class="LITERAL">STDERR</tt> and be put in
          the log by <b class="APPLICATION">LPRng</b>.</p>

          <div class="FIGURE">
            <a name="WRAPPER"></a>

            <p><b>Figure 3-14. Samba smbclient Wrapper</b></p>
<pre class="SCREEN">
    #!/bin/sh
    # configuration
    smbclient=/usr/local/bin/smbclient
    
    # get options from $PRINTCAP_ENTRY environment variable
    PATH=/bin:/usr/bin:/usr/local/bin
    options=`echo "${PRINTCAP_ENTRY}" | sed -n 's/:options=//p' `
    echo OPTIONS $options &gt;&amp;2
    if [ -n "$options" ] ; then
        # paranoia:  $options=`echo |perl -sp 's/[^\w\s,-+%="\']/ /'`
        eval dummy=v `echo $options`;
    fi
    
    if [ "$oldversion" != "" -a "$authfile" != "" -a -f "$authfile" ] ; then
        . $authfile;
        $authfile=
    fi
    
    if [ "$translate" = "yes" ]; then
     command="translate ; print -"
    else
     command="print -"
    fi
    
    echo $smbclient "$share" ${password:+password} -E \
     ${username:+-U} ${username:+username} ${hostip:+-I} \
     $hostip -N ${workgroup:+-W} $workgroup \
     ${authfile:+-A} $authfile -c "$command" &gt;&amp;2
    $smbclient "$share" ${password} -E \
     ${username:+-U} ${username} ${hostip:+-I} \
     $hostip -N ${workgroup:+-W} $workgroup \
     ${authfile:+-A} $authfile -c "$command" &gt;&amp;2
</pre>
          </div>

          <p>The <b class="APPLICATION">smbprint</b> script is run
          with the <tt class="LITERAL">$PRINTCAP_ENTRY</tt>
          environment variable set to the printcap (See <a href=
          "#PC">Figure 3-15</a>). The value is scanned for the <tt
          class="LITERAL">:options</tt> line and then this line is
          used with <tt class="LITERAL">eval</tt> to set variables.
          This is a slight security risk and you should not have
          any metacharacters in the options field, so you can
          optionally strain them out or you can trust in your
          editting skills in the printcap.</p>

          <div class="FIGURE">
            <a name="PC"></a>

            <p><b>Figure 3-15. <tt class=
            "LITERAL">$PRINTCAP_ENTRY</tt></b></p>
<pre class="SCREEN">
    lp:
      :lp=|/usr/local/lib/filters/smbprint
      :options=authfile="auth" host="h114" printer="lp" workgroup="ASTART"
</pre>
          </div>

          <p>There older versions of the <b class=
          "APPLICATION">smbclient</b> required the user name and
          password on the command line. Unfortunately, the <tt
          class="LITERAL">ps</tt> command would show the command
          line options, allowing users to see the password. Newer
          versions can read username and password from an
          authentication file. We can use either version by setting
          the <tt class="LITERAL">oldversion</tt> option.</p>

          <p>Finally, we echo the command for logging purposes
          (note that <tt class="LITERAL">$password</tt> is <i
          class="EMPHASIS">not</i> displayed and then run the <tt
          class="LITERAL">smbclient</tt> command.</p>

          <div class="FIGURE">
            <a name="AEN697"></a>

            <p><b>Figure 3-16. Novell and Appletalk
            Wrappers</b></p>
<pre class="SCREEN">
    ncpprint:
     ....
     usercmd=""
     if [ "$username" != "" ]; then
       if [ "$password" != "" ]; then
         usercmd="-U $username -P $password"
       else
         usercmd="-U $username -n"
       fi
     fi
     nprint=/usr/bin/nprint -S $server -q $printer \
        $usercmd -N - 2&gt;/dev/null
    
    atalkprint:
     ...
     /usr/bin/pap -p "$username:$printer@$host"
</pre>
          </div>

          <p>This general template can also be used with the <b
          class="APPLICATION">nprint</b> command from the Novell
          Netware support package to send files to a Novel Netware
          printers and the <b class="APPLICATION">pap</b> command
          from the Netatalk package.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN703">3.5. Serial
          Port</a></h1>

          <div class="FIGURE">
            <a name="S1"></a>

            <p><b>Figure 3-17. Serial Port</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="serial.png"></p>
            </div>
          </div>

          <p>A serial line is usually bidirectional in operation,
          but there are very few printers that will return status
          information. The most notable exception to this are <tt
          class="LITERAL">PostScript</tt> printers. If you use a
          serial port printer, it is absolutely essential that you
          implement <i class="EMPHASIS">flow control</i>, and
          almost mandatory that you use <tt class=
          "LITERAL">hardware</tt> or <tt class=
          "LITERAL">RTS-CTS</tt> (Request To Send and Clear To
          Send) flow control. Finally, you need to have the serial
          line operate in <tt class="LITERAL">RAW</tt> mode, so
          that the serial line driver does not abuse the output
          stream by introducing extraneous <tt class=
          "LITERAL">CR-LF</tt> sequences, and changing control
          characters such as <tt class="LITERAL">ESC</tt> (Escape)
          into <tt class="LITERAL">^E</tt> sequences.</p>

          <div class="FIGURE">
            <a name="S2"></a>

            <p><b>Figure 3-18. Serial Port Printcap</b></p>
<pre class="SCREEN">
    lp:lp=/dev/tty00
      :stty=raw crtscts 19200
      :sd=/var/spool/lpd/%P
      # optional Open Read Write
      #:rw
</pre>
          </div>

          <p>The <tt class="LITERAL">:stty=...</tt> option is used
          to set line characteristics and takes a subset of the <b
          class="APPLICATION">stty</b> application parameters. You
          need to set the line speed and mode. If you need to get
          status information back from the printer, you should add
          the <tt class="LITERAL">:rw</tt> (Open Read-Write)
          flag.</p>

          <p>As you might suspect, the serial port is limited by
          the line speed. In addition, it has a higher rate of
          errors than you might expect. Most printers that use a
          serial port are for <i class="EMPHASIS">legacy</i>
          purposes or have low speed and low data transfer
          requirements.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN728">Chapter 4. Printer Job
        Formats</a></h1>

        <div class="FIGURE">
          <a name="AEN730"></a>

          <p><b>Figure 4-1. Page Description Lanaguages</b></p>
<pre class="SCREEN">
    Printer Input File Formats:
    
      Postscript (Level 1, 2, 3)
      PCL (PCL 5)
      Text (Really Legacy PCL)
    
      PJL
        Configuration Specification for Job
         - PostScript or PCL or HPGL or ...
    
      Magic Mystery Proprietary Format
</pre>
        </div>

        <p>Most printers will only print jobs that have a
        particular format. These formats are called <i class=
        "EMPHASIS">Page Description Languages</i>. The most common
        are PostScript, PCL, and HPGL.</p>

        <div class="FIGURE">
          <a name="AEN735"></a>

          <p><b>Figure 4-2. How To Identify Print Formats</b></p>
<pre class="SCREEN">
    Print Job Job Types
       Start of File           File Type
    
       %!                      PostScript - Level Unknown
       %!PS-Adobe-1.0          PostScript - Level 1.0
       %!PS-Adobe-2.0          PostScript - Level 2.0
       %!PS-Adobe-2.1          PostScript - Level 2.0
       %!PS-Adobe-3.0          PostScript - Level 2.0
       \033%-12345X@PJL        HP Printer Job Language data
       \033E\033               HP PCL printer data
       This ...                Text
</pre>
        </div>

        <p>The type of file can be identified by looking at the
        content near the start of the file. This is how the <b
        class="APPLICATION">file</b> program determines the type of
        file <a href="#FG1">Figure 1-1</a>.</p>

        <div class="FIGURE">
          <a name="FILE"></a>

          <p><b>Figure 4-3. Using the file Application</b></p>
<pre class="SCREEN">
    h110: {1} % file *
    Makefile:          ASCII English text
    atalkprint:        Bourne shell script text executable
    logo.gif:          GIF image data, version 89a, 250 x 91,
    one.pcl:           HP PCL printer data
    one.ps:            PostScript document text conforming at level 3.0
    one.pjl:           HP Printer Job Language data
    rewindstdin:       ELF 32-bit LSB executable
    testpage-a4.fig:   FIG image text, version 3.1
    testpage-a4.ps:    PostScript document text conforming at level 2.0
    testpage.fig:      FIG image text, version 3.1
</pre>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN745">4.1.
          PostScript</a></h1>

          <div class="FIGURE">
            <a name="AEN747"></a>

            <p><b>Figure 4-4. One PostScript Page</b></p>
<pre class="SCREEN">
    %!PS-Adobe-3.0
    %% one page (i.e. - a page with a 1 on it)
    %%/Times-Roman
    /Courier
    findfont 200 scalefont setfont
    72 300 moveto
    (1) show
    showpage
    
    
     -- from PostScript Reference Manual 1986
        Adobe (www.adobe.com)
</pre>
          </div>

          <p>This is an example of a PostScript File.</p>

          <div class="FIGURE">
            <a name="AEN751"></a>

            <p><b>Figure 4-5. Generate One Page</b></p>
<pre class="SCREEN">
    h110: {1} % echo 1 |groff -Tps &gt;/tmp/one.ps
    h110: {2} % more /tmp/one.ps
    %!PS-Adobe-3.0
    %%Creator: groff version 1.16.1
    %%CreationDate: Thu Oct 18 12:48:45 2001
    %%DocumentNeededResources: font Times-Roman
    %%DocumentSuppliedResources: procset grops 1.16 1
    %%Pages: 1
    %%PageOrder: Ascend
    %%Orientation: Portrait
    %%EndComments
    %%BeginProlog
    %%BeginResource: procset grops 1.16 1
    /setpacking where{
    pop
    currentpacking
    true setpacking
    }if
    /grops 120 dict dup begin
    /SC 32 def
    /A/show load def
    /B{0 SC 3 -1 roll widthshow}bind def
</pre>
          </div>

          <p>The quick way to generate a test page is use <b class=
          "APPLICATION">groff</b>. The <tt class="LITERAL">groff
          -Tps</tt> outputs PostScript.</p>

          <div class="FIGURE">
            <a name="AEN757"></a>

            <p><b>Figure 4-6. PostScript Document Structuring
            Conventions</b></p>
<pre class="SCREEN">
    Specifies how a PostScript print job should be formatted
    Divides the job up into a  <i class=
"EMPHASIS">prolog</i> and <i class="EMPHASIS">body</i>
    The body contains <i class="EMPHASIS">pages</i>
       - each page is in an individual section
       - each page is <i class="EMPHASIS">independant</i>
    
    Various Levels - 3.0 with PostScript Level 3, etc.
</pre>
          </div>

          <p>Most document generation systems produce PostScript
          that meets the PostScript Document Structuring
          Convention. This allows you to <i class=
          "EMPHASIS">massage</i> PostScript Documents in several
          ways.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="AEN767"></a>

            <p><b>Figure 4-7. Tools for PostScript Document
            Manipulation</b></p>
<pre class="SCREEN">
    GhostScript - format conversion
       WWW: <a href="http://www.ghostscript.com" target=
"_top">http://www.ghostscript.com</a>
    PSUtils  - utilities to massage PostScript by Angus Duggan
       FTP: <a href="ftp://ftp.dcs.ed.ac.uk/pub/ajcd/" target=
"_top">ftp://ftp.dcs.ed.ac.uk/pub/ajcd/</a>
       WWW: <a href="http://www.dcs.ed.ac.uk/home/ajcd/psutils/"
target="_top">http://www.dcs.ed.ac.uk/home/ajcd/psutils/</a>
    psbook            rearranges pages into signatures
    psselect          selects pages and page ranges
    pstops            performs general page rearrangement and selection
    psnup             put multiple pages per physical sheet of paper
    psresize          alter document paper size
    epsffit           fits an EPSF file to a given bounding box
    getafm     (sh)   outputs PostScript to retrieve AFM file from printer
    showchar   (sh)   outputs PostScript to draw a character with metric info
    fixdlsrps  (perl) filter to fix DviLaser/PS output so that PSUtils works
    fixfmps    (perl) filter to fix framemaker documents so that psselect etc. work
    fixmacps   (perl) filter to fix Macintosh documents with saner version of md
    fixpsditps (perl) filter to fix Transcript psdit documents to work with PSUtils
    fixpspps   (perl) filter to fix PSPrint PostScript so that psselect etc. work
    fixscribeps (perl) filter to fix Scribe PostScript so that psselect etc. work
    fixtpps    (perl) filter to fix Troff Tpscript documents
    fixwfwps   (perl) filter to fix Word for Windows documents for PSUtils
    fixwpps    (perl) filter to fix WordPerfect documents for PSUtils
    fixwwps    (perl) filter to fix Windows Write documents for PSUtils
    extractres (perl) filter to extract resources from PostScript files
    includeres (perl) filter to include resources into PostScript files
    psmerge    (perl) hack script to merge multiple PostScript files
</pre>
          </div>
          &#13;<br>
          <br>

          <p>The combination of GhostScript and PSutils by Angus
          Duggan are a powerful combination.</p>

          <div class="FIGURE">
            <a name="AEN774"></a>

            <p><b>Figure 4-8. Selection of Pages + 4up
            Printing</b></p>
<pre class="SCREEN">
    h110: {81} % psselect -p20-24 LPRng-HOWTO.ps | psnup -4 &gt;p4up.ps
    [20] [21] [22] [23] [24] Wrote 5 pages, 38404 bytes
    [1] [2] Wrote 2 pages, 42769 bytes
</pre>
          </div>

          <div class="FIGURE">
            <a name="AEN777"></a>

            <p><b>Figure 4-9. PostScript Output</b></p>

            <div class="MEDIAOBJECT">
              <p><img src="x_nup.png"></p>
            </div>
          </div>

          <div class="FIGURE">
            <a name="AEN782"></a>

            <p><b>Figure 4-10. End Of PostScript Job: ^D
            (CTRL-D)</b></p>
<pre class="SCREEN">
    ^D is recognized as an 'end of job'
       - causes reset of PostScript interpreter to defaults
    
    ^D%!PS-Adobe-3.0
    ...
    ^D
    
    The Dreaded ^D at Start of Job - causes problems
      Rest of job may be ignored!
      Solution: strip off ^D at start
        (ifhp = ps_eoj_at_start@)
    
    The Dreaded ^D at End of Job - causes problems when
      you are trying to massage postscript or append jobs
      Solution: strip off ^D everywhere
        (ifhp = ps_eoj_at_end@)
</pre>
          </div>

          <p>The <tt class="LITERAL">^D</tt> (<tt class=
          "LITERAL">CTRL-D</tt>) character is evil - it usually
          should not be put into raw files.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN788">4.2. PCL</a></h1>

          <div class="FIGURE">
            <a name="AEN790"></a>

            <p><b>Figure 4-11. One PCL Page</b></p>
<pre class="SCREEN">
    ^[E^[&amp;u600D^[&amp;l2A^[&amp;l0O^[&amp;l0E^[(0N^[(s1p0s0b4101T
      ^[(s24V^[*p655x942Y1^L^[E
    
    Note: ^[ is ESC or \033
          ^[E is 'reset printer configuration'
</pre>
          </div>

          <p>This is an example of a PCL file. Note that the file
          starts with <tt class="LITERAL">^[E</tt>, or the reset
          configuration string. All PCL jobs should start with this
          so that the previous job does not cause a problem.</p>

          <div class="FIGURE">
            <a name="AEN795"></a>

            <p><b>Figure 4-12. Generate One Page</b></p>
<pre class="SCREEN">
    h110: {1} % echo 1 | groff -Tlj4 &gt;/tmp/one.pcl
    h110: {2} % more
    ^[E^[&amp;u600D^[&amp;l2A^[&amp;l0O^[&amp;l0E^[(0N^[(s1p0s0b4101T
      ^[(s24V^[*p655x942Y1^L^[E
</pre>
          </div>

          <p>The quick way to generate a test page is use <b class=
          "APPLICATION">groff</b>. The <tt class="LITERAL">groff
          -Tlj4</tt> outputs PCL level 5. Again, watch out for the
          evil <tt class="LITERAL">^D</tt> (<tt class=
          "LITERAL">CTRL-D</tt>) characters.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN803">4.3. Printer Job
          Language (PJL) and PostScript, PCL</a></h1>

          <div class="FIGURE">
            <a name="AEN805"></a>

            <p><b>Figure 4-13. PJL Example</b></p>
<pre class="SCREEN">
    ^[%-12345X@PJL
    @PJL RDYMSG DISPLAY = ":"
    @PJL USTATUSOFF
    @PJL USTATUS JOB = ON
    @PJL USTATUS DEVICE = ON
    @PJL USTATUS PAGE = ON
    @PJL USTATUS TIMED = 10
    @PJL ENTER LANGUAGE = POSTSCRIPT
    ^D%!
    %!PS-Adobe-3.0
    %% one page (i.e. - a page with a 1 on it)
    %%/Times-Roman
    /Courier
    findfont 200 scalefont setfont
    72 300 moveto
    (1) show
    showpage
    ^D^[%-12345X@PJL
    @PJL RDYMSG DISPLAY = ":"
    @PJL EOJ NAME = ":"
    @PJL USTATUSOFF
    @PJL USTATUS JOB = ON
    @PJL USTATUS DEVICE = ON
    @PJL USTATUS PAGE = ON
    @PJL USTATUS TIMED = 10
    @PJL RDYMSG DISPLAY = "Done: :"
    ^[%-12345X
</pre>
          </div>

          <p>Printer Job Language is used to set up configuration
          and other facilities for a printer. It can establish
          defaults for printing and provide direction to the
          printer on how to handle job items not specified by the
          PostScript or PCL language.</p>

          <p>The PJL Reset command <tt class=
          "LITERAL">^[%-12345X</tt> performs a Print Job lanaguage
          independent reset. This allows PJL to be used with
          PostScript or PCL.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN811">4.4. Text
          Files</a></h1>

          <div class="FIGURE">
            <a name="AEN813"></a>

            <p><b>Figure 4-14. Text Files and The Jaggies</b></p>
<pre class="SCREEN">
    Text
      - usually ASCII characters
    
    The Dreaded Jaggies
    
    File:
    
       This is what you
       see on the printer
    
    Printer output:
    
       This is what you
                       see on the printer
</pre>
          </div>

          <p>Text is usually just ASCII characters. Unix lines are
          terminated with new line (<tt class="LITERAL">NL</tt> or
          <tt class="LITERAL">\012</tt>, and when sent to a printer
          result in <i class="EMPHASIS">The Jaggies</i>. You need
          to have carriage returns (<tt class="LITERAL">CR</tt> or
          <tt class="LITERAL">\015</tt> added to the file. You need
          to fix this by one of several methods.</p>

          <div class="FIGURE">
            <a name="AEN822"></a>

            <p><b>Figure 4-15. Fixing The Jaggies</b></p>
<pre class="SCREEN">
    Fixing The Jaggies:
     Convert NL to CR/NL
       Quick and Dirty
         sed -e 's/$/\r/'
       OR
         lpf (<b class="APPLICATION">LPRng</b> utility)
    
     Make PCL Printer Interpret CR as CR/LF
       ^[E  -&gt;  ^[E&amp;k2G
       Remove the PCL Reset and add the &amp;k2G
        (CR -&gt; CR/LF command)
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN826">4.5. Magical Mystery
          Proprietary Format</a></h1>

          <div class="FIGURE">
            <a name="AEN828"></a>

            <p><b>Figure 4-16. Magical Mystery Formats</b></p>
<pre class="SCREEN">
    Magical Mystery Proprietary Format
      -  Usually a RASTER format
    
      -  legacy devices such as Versatek Plotters
    
      -  new super cheap InkJet Printers
         The host system needs to do conversion to raster file
      -  Dirty Little Secret - some of these understand PCL Level 5
         (monochrome) and are compatible with HP LaserJet 4.
</pre>
          </div>

          <p>You should try and see if your printer understands
          PCL. Try using GhostScript with the <tt class=
          "LITERAL">hpdj</tt>, <tt class="LITERAL">ljet3</tt> or
          <tt class="LITERAL">ljet4</tt>.</p>

          <div class="FIGURE">
            <a name="AEN835"></a>

            <p><b>Figure 4-17. GhostScript To The Rescue</b></p>
<pre class="SCREEN">
    h110: {64} % gs --help
    AFPL Ghostscript 6.50 (2000-12-02)
    Copyright (C) 2000 Aladdin Enterprises, Menlo Park, CA.  All rights reserved.
    Usage: gs [switches] [file1.ps file2.ps ...]
    Most frequently used switches: (you can use # in place of =)
     -dNOPAUSE           no pause after page   | -q       `quiet', fewer messages
     -g&lt;width&gt;x&lt;height&gt;  page size in pixels   | -r&lt;res&gt;  pixels/inch resolution
     -sDEVICE=&lt;devname&gt;  select device         | -dBATCH  exit after last file
     -sOutputFile=&lt;file&gt; select output file: - for stdout, |command for pipe,
                                             embed %d or %ld for page #
    Input formats: PostScript PostScriptLevel1 PostScriptLevel2 PDF
</pre>
          </div>

          <p>You can read PostScript level 1, 2, or PDF with this
          version of GhostScript.</p>

          <div class="FIGURE">
            <a name="AEN839"></a>

            <p><b>Figure 4-18. GhostScript Devices</b></p>
<pre class="SCREEN">
    Available devices:
       x11 bbox x11alpha x11cmyk x11cmyk2 x11cmyk4 x11cmyk8 x11gray2 x11gray4
       x11mono x11rg16x x11rg32x atx23 atx24 atx38 deskjet djet500 fs600
       laserjet ljetplus ljet2p ljet3 ljet3d ljet4 ljet4d lp2563 oce9050 lj5mono
       lj5gray epswrite pswrite pdfwrite pxlmono pxlcolor bit bitrgb bitcmyk
       bmpmono bmpgray bmpsep1 bmpsep8 bmp16 bmp256 bmp16m bmp32b cgmmono cgm8
       cgm24 jpeg jpeggray miff24 pcxmono pcxgray pcx16 pcx256 pcx24b pcxcmyk
       pcx2up pbm pbmraw pgm pgmraw pgnm pgnmraw ppm ppmraw pnm pnmraw pkm
       pkmraw pksm pksmraw plan9bm pngmono pnggray png16 png256 png16m psmono
       psgray psrgb faxg3 faxg32d faxg4 tiffcrle tiffg3 tiffg32d tiffg4 tifflzw
       tiffpack tiff12nc tiff24nc appledmp iwhi iwlo iwlq bj10e bj200 ccr
       cdeskjet cdjcolor cdjmono cdj500 cdj550 declj250 dnj650c lj4dith pj pjxl
       pjxl300 bjc600 bjc800 escp djet500c cljet5 cljet5pr cljet5c lj3100sw
       coslw2p coslwxl cp50 epson eps9mid eps9high ibmpro epsonc ap3250 st800
       stcolor uniprint lj250 paintjet pjetxl hl7x0 imagen jetp3852 lbp8 lips3
       lp8000 m8510 necp6 lq850 lxm5700m oki182 okiibm photoex sj48 t4693d2
       t4693d4 t4693d8 tek4696 cfax dfaxlow dfaxhigh cif inferno mgrmono
       mgrgray2 mgrgray4 mgrgray8 mgr4 mgr8 sgirgb sunhmono cdj850 hpdj pcl3
       hpdjplus hpdjportable hpdj310 hpdj320 hpdj340 hpdj400 hpdj500 hpdj500c
       hpdj510 hpdj520 hpdj540 hpdj550c hpdj560c hpdj600 hpdj660c hpdj670c
       hpdj680c hpdj690c hpdj850c hpdj855c hpdj870c hpdj890c hpdj1120c cdj970
       stp nullpage
</pre>
          </div>

          <p>GhostScript converts PostScript to a wide range of
          output device formats. The interesting ones are <tt
          class="LITERAL">ljet4</tt>, <tt class=
          "LITERAL">lj5mono</tt>, <tt class="LITERAL">hpdj</tt>,
          and so forth. These are Ink Jet printers with various
          strange behaviors.</p>

          <div class="FIGURE">
            <a name="AEN846"></a>

            <p><b>Figure 4-19. GhostScript Support</b></p>
<pre class="SCREEN">
    <a href="http://www.ghostscript.com" target=
"_top">http://www.ghostscript.com</a>
    <a href="http://www.cs.wisc.edu/~ghost" target=
"_top">http://www.cs.wisc.edu/~ghost</a>
    <a href="http://www.cs.wisc.edu/~ghost/doc/printer.htm" target=
"_top">http://www.cs.wisc.edu/~ghost/doc/printer.htm</a>
    <a href="http://www.cs.wisc.edu/~ghost/doc/AFPL/devices.htm"
target=
"_top">http://www.cs.wisc.edu/~ghost/doc/AFPL/devices.htm</a>
</pre>
          </div>

          <p>The <a href="http://www.ghostscript.com" target=
          "_top">http://www.ghostscript.com</a> site has links to
          just about everything concerned with GhostScript. the <a
          href="http://www.cs.wisc.edu/~ghost" target=
          "_top">http://www.cs.wisc.edu/~ghost</a> site mirrors
          much of this information. The <a href=
          "http://www.cs.wisc.edu/~ghost/doc/printer.htm" target=
          "_top">printer.htm</a> and <a href=
          "http://www.cs.wisc.edu/~ghost/doc/AFPL/devices.htm"
          target="_top">devices.htm</a> are good sources for
          information about printing.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN859">4.6. Printing Test
          Pages</a></h1>

          <div class="FIGURE">
            <a name="AEN861"></a>

            <p><b>Figure 4-20. Printing Test Pages To Parallel
            Port</b></p>
<pre class="SCREEN">
    #!/bin/sh
    for i in one.pcl one.pjl one.ps ; do
     cat $i &gt;/dev/lp0
    done
</pre>
          </div>

          <p>The easiest way to print the test pages is to try them
          all. This is brutal, but you may need to do it at least
          once.</p>

          <div class="FIGURE">
            <a name="AEN865"></a>

            <p><b>Figure 4-21. Using Netcat (nc)</b></p>
<pre class="SCREEN">
    nc -  Netcat by Mudge
    <a href="http://www.avian.org/" target=
"_top">http://www.avian.org/</a>
    <a href="ftp://ftp.lprng.com/pub/LPRng/TOOLS/netcat" target=
"_top">ftp://ftp.lprng.com/pub/LPRng/TOOLS/netcat</a>
    #!/bin/sh
    for i in one.pcl one.pjl one.ps ; do
     nc -w10 10.0.0.14 9100  &lt;$i
    done
    
    h110: {453} % sh -x /tmp/testnc
    + nc -w10 -v -v 10.0.0.14 9100
    h14.private [10.0.0.14] 9100 (jetdirect) open
    @PJL USTATUS DEVICE
    CODE=10003
    DISPLAY="02 WARMING UP"
    ONLINE=TRUE
    
    ...
    @PJL USTATUS TIMED
    CODE=10001
    DISPLAY="Done: papowell /"
    ONLINE=TRUE
    
    ^C
</pre>
          </div>

          <p>Netcat is a handy tool for testing network connections
          to a printer. You can also use it as a port mapper and
          find out what interesting ports are open on your print
          spooler box.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN872">Chapter 5. Filters</a></h1>

        <div class="FIGURE">
          <a name="AEN874"></a>

          <p><b>Figure 5-1. Filters</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="filter.png"></p>
          </div>
        </div>

        <p>A filter is responsible for converting the job data
        files to a format compatible with the printer, transfering
        the job to the printer, and monitoring for any
        problems.</p>

        <div class="FIGURE">
          <a name="AEN880"></a>

          <p><b>Figure 5-2. Filter Specification in Printcap
          Entry</b></p>
<pre class="SCREEN">
    # <b class="APPLICATION">LPRng</b>
    lp:
      :filter=/.../filter
    
    # Legacy BSD (<b class=
"APPLICATION">LPRng</b> is backwards compatible)
    lp:
      # file 'format' is lower case letter X, filter is
      # 'Xf' option value, default format is 'f' so default
      # filter is 'if'
      :if=/.../filter
      :hf=/.../filter
</pre>
        </div>

        <p>The legacy BSD printing system required you to specify a
        filter for all input types. LPRng uses <tt class=
        "LITERAL">:filter</tt> to specify a default filter. Much
        more in line with modern printing.</p>

        <div class="FIGURE">
          <a name="AEN887"></a>

          <p><b>Figure 5-3. Specifying Job Datafile Format</b></p>
<pre class="SCREEN">
    <b class="APPLICATION">LPRng</b> 'format' selection:
    
       h110: {295} % lpr -Fx /tmp/hi
    
    Legacy BSD 'format' selection:
    
    h110: {295} % lpr -x /tmp/hi
    
    Format 'b' (Binary) or 'l' (Literal)
     for 'Passthrough' Operation - format 'l' is used
    
    h110: {295} % lpr -l /tmp/hi
    h110: {295} % lpr -b /tmp/hi
    
    Control file example:
        Hh110.private
        J/tmp/hi
        Lpapowell
        N/tmp/hi
        fdfA383h110.private  &lt;- first letter is format
        UdfA383h110.private
   
</pre>
        </div>

        <p>The <b class="APPLICATION">lpr</b> <tt class=
        "LITERAL">-Fx</tt> (<i class="EMPHASIS">Filter</i> <tt
        class="LITERAL">x</tt>) option allows you to specify the
        filter type. Which, of course, if you use the <tt class=
        "LITERAL">:filter</tt> option is ignored. The Binary or
        Literal (<tt class="LITERAL">-b</tt> or <tt class=
        "LITERAL">-l</tt> requests <i class="EMPHASIS">Pass
        Through</i> treatment from the filter. The filter is still
        used, but it is passed a special flag.</p>

        <p>In the control file, lines starting with lower case
        letters specify a format and the data file to print with
        the format.</p>

        <div class="FIGURE">
          <a name="AEN901"></a>

          <p><b>Figure 5-4. Filter Execution Environment</b></p>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :filter=/filter
      :lp=/dev/lp
    
    Execution:
      CWD is spool directory (/var/spool/lpd/lp)
    
    Environment:
      PATH=...               - from <tt class=
"FILENAME">/etc/lpd.conf</tt>
      LD_LIBRARY_PATH=...    - from <tt class=
"FILENAME">/etc/lpd.conf</tt>
      PRINTER=lp
      PRINTCAP_ENTRY=lp:        - printcap entry
        :sd=/var/spool/lpd/lp     with %P fixed up
        :filter=/filter
        :lp=/dev/lp
      CONTROL=Aroot@h110+383    - job control file
        CA
        D2001-10-19-06:40:59.968
        Hh110.private
        J/tmp/hi
        Lroot
        Proot
        Qlp
        N/tmp/hi
        fdfA383h110.private
        UdfA383h110.private
</pre>
        </div>

        <p>The <tt class="LITERAL">PRINTCAP_PATH</tt> environment
        variable has new lines before every colon (<tt class=
        "LITERAL">:</tt>) so you can split it up easily in the
        filter. See <a href="#WRAPPER">Figure 3-14</a> for an
        example of this use. The <tt class="LITERAL">CONTROL</tt>
        value is the job control file. The control file contains
        the job print request sent to <b class=
        "APPLICATION">lpd</b>. The output device is opened <tt
        class="LITERAL">Read-Write</tt> if the <tt class=
        "LITERAL">:rw</tt> flag is set and it is a real device.
        Also, if the output is a filter or network connection then
        then the output is <tt class="LITERAL">Read-Write</tt>.</p>

        <div class="FIGURE">
          <a name="AEN915"></a>

          <p><b>Figure 5-5. Command Line Options</b></p>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :filter=/filter
      :lp=/dev/lp
    
    /filter &lt;dfA383h110.private &gt;/dev/lp
         <i class=
"EMPHASIS">STDIN, STDOUT, STDERR to Filter_status</i>
    
    -CA -D2001-10-19-06:40:59.968 -Hh110.private -J/tmp/hi -Lroot -Qlp
         <i class="EMPHASIS">From the control file</i>
    
    -Plp -Ff
     <i class=
"EMPHASIS">Legacy and LPRng, -P printer, -F format</i>
    
    -n root -h h110.private -f dfA383h110.private
       ...
     <i class=
"EMPHASIS">there are more lower case options than you want to think about</i>
   
</pre>
        </div>

        <p>The filter command line options are really agressive due
        to history and feeping creaturism. All of the lines in the
        control file with a capital letter are passed as shown, the
        <tt class="LITERAL">-F</tt> is used for the print job
        format, and the <tt class="LITERAL">-c</tt> is set if the
        job format was <tt class="LITERAL">l</tt> (Binary or
        Literal). The <tt class="LITERAL">-f</tt> also is the name
        of the data file. <tt class="LITERAL">STDIN</tt> is set to
        the data file and <tt class="LITERAL">STDOUT</tt> to the
        output device or network connection. Just to make life
        interesting, the name of the accounting file (if it is
        specified in the printcap or if it has a default value) is
        passed as the last parameter.</p>

        <div class="FIGURE">
          <a name="AEN929"></a>

          <p><b>Figure 5-6. Filter Exit Codes</b></p>
<pre class="SCREEN">
    Exit Code                Action
    0 (JSUCC)                Successful, send filter output to printer
    1 (JFAIL)                Failed, retry later
    2 (JABORT)               Failed, do not retry, and Abort printing
    3 (JREMOVE)              Remove job
    4 (JHOLD)                Set job HOLD flag
</pre>
        </div>

        <p>The filter program exit codes can be used to control how
        the job is processed. The <tt class="LITERAL">JSUCC</tt>
        (0) value is the normal successful exit code. The <tt
        class="LITERAL">JFAIL</tt> (1) value is used to indicate
        some sort of temporary failure and the job should be
        retried again. The <tt class="LITERAL">JABORT</tt> (2) is
        more serious, and indicates some system error. The job
        should not be retried and printing should stop. The <tt
        class="LITERAL">JREMOVE</tt> (3) code simply removes the
        job. This is useful if the job is unprintable. Finally, the
        <tt class="LITERAL">JHOLD</tt> sets the job <tt class=
        "LITERAL">HOLD</tt> flag. The job will not be released for
        printing until the <b class="APPLICATION">lpc</b> <tt
        class="LITERAL">release</tt> command releases it.</p>

        <div class="FIGURE">
          <a name="AEN941"></a>

          <p><b>Figure 5-7. Solid As A Rock Filter
          Operation</b></p>
<pre class="SCREEN">
    Filter:
      - examines input format using <b class="APPLICATION">file</b>
      - decides if file format is compatible with printer
          if not, can run a conversion program to convert
          the output.
      - initializes printer by sending magic cookies to it
          magic cookies depend on particular device, model, etc.
      - transfers output to printer, optionally inserting various
          control codes, CR -&gt; CR/LF
      - if printer can reports status, then gets status as it does
          the transfer operation.
      - after transferring job,  sends more magic cookies to tell
          printer that job is over
      - monitors printer for error status
      - exits with an appropriate error code telling exactly what
         problems (if any) were encountered.
</pre>
        </div>

        <p>This is what a real filter should do. Note that it
        appears to be obvious that you would need to do all
        this.</p>

        <div class="FIGURE">
          <a name="AEN946"></a>

          <p><b>Figure 5-8. Solid As A Used Paper Coffee Filter
          Operation</b></p>
<pre class="SCREEN">
    Filter:
     - Tosses job at GhostScript for conversion, sets
          GhostScript output to STDOUT
     - Returns GhostScript exit status
</pre>
        </div>

        <p>OK, I am being a bit harsh. But this is not too far from
        the truth. Most filter packages are somewhere between the
        two extremes.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN951">5.1. Writing Your Own
          Filter</a></h1>

          <p>If you want to write your own filter you can start
          with the following simple examples. In practice you have
          two choices: <b class="APPLICATION">Perl</b> or <b class=
          "APPLICATION">sh</b>. The first in a filter is to get the
          various environment and option values. We will write a
          simple filter that converts PostScript files into 4 up
          PostScript files.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="FILTERTEMPLATE"></a>

            <p><b>Figure 5-9. Filter Template in perl</b></p>
<pre class="SCREEN">
    #!/usr/bin/perl
    use Getopt::Std;
    my $debug = 0;    # always... sigh...
    my(%opt, @pc, %options);
    
    # get command line options
    getopts( 'A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q:R:T:S:U:V:W:X:Y:Z:'
    . 'a:b:cd:e:f:g:h:i:j:k:l:m:n:o:p:q:r:t:s:u:v:w:x:y:z:', \%opt );
    while( @ARGV ){ $opt{acct} = pop @ARGV ; };
    
    # split up the PRINTCAP_ENTRY environment variable value
    @pc = split /\n\s*:/s, ($ENV{PRINTCAP_ENTRY} || "");
    shift @pc;  # throw way first entry field, printer name
    # set the options
    foreach (@pc){ # set the options values
        if( /^(.+)=(.*)/ ){ $options{$1} = $2;
        } elsif ( /^(.+)@/ ){ $options{$1} = 0;
        } else { $options{$_} = 1; }
    }
    
    if( $debug ){ # for those interested
        my $s = "";
        foreach my $v (sort keys %options ){ $s .= "$v='$options{$v}',"; }
        print STDERR "Printcap: '$s'\n"; $s="";
        foreach my $v (sort keys %opt){ $s .= "$v='$opt{$v}',"; }
        print STDERR "Args: '$s'\n";
    }
</pre>
          </div>
          &#13;<br>
          <br>

          <p>This example shows how to get the various environment
          variables and command line options and put them into
          handy <i class="EMPHASIS">hashes</i> for easy access. You
          should note the special treatment of the <tt class=
          "LITERAL">-c</tt> option and the arguments at the end of
          the command line. The last argument is the name of the
          accounting file (if any).</p>

          <div class="FIGURE">
            <a name="AEN964"></a>

            <p><b>Figure 5-10. How To Determine The Type of Job
            File</b></p>
<pre class="SCREEN">
    my $file = `/usr/bin/file -`; # we find the file type
    chomp $file;
    print STDERR "File: '$file'\n" if $debug; # show the file type
    sysseek STDIN,0,0 or die "cannot seek STDIN - $!";      # rewind to start of file
    my $is_postscript = ($file =~ /PostScript/i);
    print STDERR "Postscript: '$is_postscript'\n" if $debug; # show the file type
    if( $is_postscript ){
        my $status = system "/usr/local/bin/psnup", "-4";
        if( $status ){
            print STDERR "psnup failed - $!\n";
            exit 1;
        }
        exit 0;
    }
    while( &lt;STDIN&gt; ){ print };
    exit 0;
</pre>
          </div>

          <p>To determine the file type we use the <b class=
          "APPLICATION">file</b> application. This reads the first
          part of the input file and then writes out the determined
          file type on its <tt class="LITERAL">STDOUT</tt>. We
          check to see if the file is a PostScript file and then
          run the <tt class="LITERAL">psnup</tt> command. If it is
          not, then we simply write copy <tt class=
          "LITERAL">STDIN</tt> to <tt class=
          "LITERAL">STDOUT</tt>.</p>

          <div class="FIGURE">
            <a name="FPC"></a>

            <p><b>Figure 5-11. Printcap for Filter</b></p>
<pre class="SCREEN">
    nup:force_localhost
      :filter=/usr/local/libexec/filters/nup
      :sd=/var/spool/lpd/%P
      :lp=lp@localhost
    
    (Don't forget to run checkpc!)
</pre>
          </div>

          <p>We set make a printcap entry. Note the use of <tt
          class="LITERAL">force_localhost</tt> to make sure that
          the print jobs are sent to the right print queue! The
          filter output will then be sent to <tt class=
          "LITERAL">lp@localhost</tt> for final printing.</p>

          <div class="FIGURE">
            <a name="FDB"></a>

            <p><b>Figure 5-12. Using Filter With $debug=1</b></p>
<pre class="SCREEN">
     Status: processing 'dfA946h110.private', size 145, format 'f',
          IF filter 'nup' at 07:27:30.938
     Status: IF filter 'nup' filter msg - 'Printcap: 'cm='Class Test Printer 1',....
     Status: IF filter 'nup' filter msg - 'Args: 'A='papowell@h110+946',C='A',....
     Status: IF filter 'nup' filter msg - 'File: 'standard input: PostScript document'
          at 07:27:30.938
     Status: IF filter 'nup' filter msg - 'Postscript: '1'' at 07:27:30.938
     Status: IF filter 'nup' filter msg - 'Wrote 0 pages, 1775 bytes' at 07:27:30.940
     Status: IF filter 'nup' filter finished at 07:27:30.941
     Status: sending job 'papowell@h110+946' to lp@localhost at 07:27:30.943
</pre>
          </div>

          <p><a href="#FDB">Figure 5-12</a> shows the status output
          when we set the <tt class="LITERAL">$debug=1</tt>. This
          is recommended when you are testing your filters.</p>

          <div class="FIGURE">
            <a name="FNODB"></a>

            <p><b>Figure 5-13. Using Filter With $debug=0</b></p>
<pre class="SCREEN">
     Status: processing 'dfA021h110.private', size 145, format 'f',
       IF filter 'nup' at 07:38:22.416
     Status: IF filter 'nup' filter msg - 'Wrote 0 pages, 1775 bytes'
       at 07:38:22.472
     Status: IF filter 'nup' filter finished at 07:38:22.473
     Status: sending job 'papowell@h110+21' to t6@localhost at 07:38:22.475
</pre>
          </div>

          <p><a href="#FNODB">Figure 5-13</a> shows the status
          output when we set the <tt class="LITERAL">$debug=0</tt>.
          As you can see, it is less chatty and just as informative
          to most users.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN991">5.2. The <b class=
          "APPLICATION">LPRng</b> IFHP Filter</a></h1>

          <div class="FIGURE">
            <a name="AEN994"></a>

            <p><b>Figure 5-14. ifhp</b></p>
<pre class="SCREEN">
    <b class="APPLICATION">ifhp</b>   (IFHP)
      part of the <b class="APPLICATION">LPRng</b> suite
      separate from <b class="APPLICATION">LPRng</b>
      not quite as strong as a brick,
        but better than a wet paper coffee filter.
    
      ifhp.conf contains printer configuration information
</pre>
          </div>

          <p>The <b class="APPLICATION">ifhp</b> filter is part of
          the LPRng family of programs. It is distributed
          separately because the release and update times did not
          orginally match. The <b class="APPLICATION">ifhp</b>
          filter is intended for use with the <b class=
          "APPLICATION">LPRng</b> software and undergoes much of
          the same testing.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="AEN1006"></a>

            <p><b>Figure 5-15. ifhp.conf Configuration
            Information</b></p>
<pre class="SCREEN">
    ###   Supported Printers
    
    ### default - HP 4M Plus, PostScript, PJL, PCL, status, pagecount support
    ### apple - PostScript printer, text to PS conversion, status, pagecount support
    ### postscript - PostScript printer, text to PS conversion, status, pagecount support
    ### ps - PostScript printer, text to PS conversion, status, pagecount support
    ### pcl - PCL only printer, no status
    ### pcl_gs - HP Laserjet 4 PCL only printer, write only, no status
    ### hpiiisi - HP LaserJet III (PCL and PostScript Interpreter)
</pre>
          </div>
          &#13;<br>
          <br>

          <p>Each printer type has an entry in the <tt class=
          "LITERAL">ifhp.conf</tt> configuration file. For
          convenience these are put at the start of the file.</p>

          <div class="FIGURE">
            <a name="AEN1011"></a>

            <p><b>Figure 5-16. Default Printer Magic
            Cookies</b></p>
<pre class="SCREEN">
    # magic cookie definitions
    [default]
    # printer capabilities
    pjl    # can do PJL
    pcl    # can do PCL 5
    ps     # can do PS
    text   # can do TEXT
    
    status  # returns status by default
    sync    # needs sync magic cookie sent
    ps_sync=
      serverdict begin 0 exitserver
      statusdict begin false setenginesync end
            # PostScript sync magic cookie definition
    
    # definition of available user options
    pjl_user_opts=[ ... simplex duplex ... ]
    
    # magic cookie strings for use when PJL, PostScript or PCL file
    pjl_duplex=@PJL SET DUPLEX = ON
    ps_duplex=   statusdict begin true setduplexmode false settumble end
    pcl_duplex=\033&amp;l1S
</pre>
          </div>

          <p>Each printer has a configuration section where the
          printer capabilities are defined, the user options that
          are available are specified, and the magic cookies that
          need to be sent to the printer to have the operations
          happen are defined. The <tt class="LITERAL">default</tt>
          entry species the set of defaults for all the
          printers.</p>

          <div class="FIGURE">
            <a name="AEN1016"></a>

            <p><b>Figure 5-17. PostScript Only Printer</b></p>
<pre class="SCREEN">
    a2ps_converter= /usr/local/bin/a2ps \%s{a2ps_options}
    a2ps_options= -q -B -1 -M \%M{papersize} --borders=no -o-
    gzip_decompress = /usr/bin/gzip -c -d
    
    # model for 'apple', 'postscript' or 'ps'
    [ apple postscript ps ]
    pjl@
    pcl@
    ps
    text@
    file_output_match = [
      *postscript*       ps
      *text*             ps  \%s{a2ps_converter}
      *pdf*              ps  \%s{pdf2ps_converter}
      *gzip_compressed*  filter  \%s{gzip_decompress}
      ]
    
    # do {
    #   $file = (lc ` file - `) =~ s/[\s\n]/_/gs;
    #   foreach $line (@file_output_match) {
    #     last if globmatch( $file, $line-&gt;[0] );
    #   }
    #   if( $line-&gt;[2] ){
    #      run $file-&gt;[2] and convert input file to format
    #   }
    # } while $line and $line-&gt;[1] != "filter"
    # outfile file format is $line-&gt;[1]
</pre>
          </div>

          <p>Here is an example of a PostScript only printer. The
          <tt class="LITERAL">pjl@</tt> <tt class=
          "LITERAL">pcl@</tt> and <tt class="LITERAL">text@</tt>
          entries turn off PJL, PCL, and TEXT for the printer.</p>

          <p>The <tt class="LITERAL">file_output_match</tt> entry
          is used to implement a simple conversion facility that
          will try to find a conversion from one file type to
          another. It is deliberately simple minded, on the grounds
          that if you have a special type that you need to do
          conversions for all the time then you better make sure
          you do it right.</p>

          <p>&#13;</p>

          <div class="FIGURE">
            <a name="AEN1026"></a>

            <p><b>Figure 5-18. Using the ifhp Filter</b></p>
<pre class="SCREEN">
    Printcap:
    
    lp:sd=/var/spool/lpd/%P
      :filter=/usr/local/lib/filters/ifhp
      :lp=/dev/lp
      # a PostScript printer that does not return status
      :ifhp= model=ps,status@
</pre>
          </div>
          &#13;<br>
          <br>

          <p>The <tt class="LITERAL">:ifhp=</tt> option is used to
          pass options to ifhp. You can also use <tt class=
          "LITERAL">ifhp -Toption</tt> as well. In this example we
          specify a PostScript printer that does not return
          status.</p>

          <div class="FIGURE">
            <a name="AEN1033"></a>

            <p><b>Figure 5-19. Example of ifhp Operation</b></p>
<pre class="SCREEN">
    h110: {205} %  lpr /tmp/f.pdf
    h110: {205} %  lpq -L
     Filter_status: using model 'DEFAULT' at 09:36:36.475
     Filter_status: pagecount using 'pjl info pagecount' at 09:36:36.477
     Filter_status: setting up printer at 09:36:36.477
     Filter_status: getting sync using 'pjl echo' at 09:36:36.477
     Filter_status: sync done at 09:36:38.335
     Filter_status: pagecounter 105340 after 1 attempts at 09:36:38.349
     Filter_status: pagecounter 105340 at 09:36:38.349
     Filter_status: sending job file at 09:36:38.350
     Filter_status: starting transfer at 09:36:38.350
     Filter_status: file program = '/usr/bin/file -' at 09:36:38.350
     Filter_status: started FILE_UTIL- 'file' at 09:36:38.351
     Filter_status: file information = 'pdf_document,_version_1.2' at 09:36:38.415
     Filter_status: initial job type 'pdf_document,_version_1.2' at 09:36:38.415
     Filter_status: decoded job type 'POSTSCRIPT' at 09:36:38.415
     Filter_status: job type 'POSTSCRIPT', converter '/usr/local/bin/pdf2ps - -'
         at 09:36:38.415
     Filter_status: started CONVERTER- 'pdf2ps' at 09:36:38.416
     Filter_status: converter done, output 707742 bytes at 09:36:39.589
     Filter_status: transferring 707742 bytes at 09:36:39.590
     Filter_status: 26 percent done at 09:36:40.338
     Filter_status: 52 percent done at 09:36:41.082
     Filter_status: 78 percent done at 09:36:41.830
     Filter_status: data sent at 09:36:44.501
     Filter_status: sent job file at 09:36:44.501
     Filter_status: getting end using 'pjl job/eoj' at 09:36:44.501
     Filter_status: end of job detected at 09:43:50.268
     Filter_status: pagecounter 105359 after 1 attempts at 09:43:51.503
     Filter_status: pagecounter 105359, pages 19 at 09:43:51.504
     Filter_status: done at 09:43:51.504
</pre>
          </div>

          <p>As you can see the information produced by the <b
          class="APPLICATION">ifhp</b> filter is more than adequate
          for tracing its steps. You might want to try adding <tt
          class="LITERAL">:ifhp=debug=1</tt>, <tt class=
          "LITERAL">:ifhp=debug=2</tt>, or even for the customary
          debugging information.</p>

          <div class="FIGURE">
            <a name="AEN1041"></a>

            <p><b>Figure 5-20. Using -Z to Pass Options to
            ifhp</b></p>
<pre class="SCREEN">
    h110: {227} % lpr -Zlandscape,duplex,copies=3 /tmp/hi
    
    Standard <b class="APPLICATION">ifhp</b> Options:
    
    Paper/Media Selection:
      a3, a4, a5, ledger, legal, letter
      envelope, oversize, transparency
      mediaselect=N
    
    Input Selection:
     inlower, inupper, manual
    
    Output Selection:
      outlower, outupper
    
    Copies:
      copies=N
    
    Orientation:
      landscape, portrait
    
    Duplex:
      duplex, duplexshort, simplex, lduplex, sduplex
</pre>
          </div>

          <p>Job formatting options are passed to <tt class=
          "LITERAL">ifhp</tt> using the <b class=
          "APPLICATION">lpr</b> <tt class="LITERAL">-Z</tt>. These
          are put into the control file with the -Z option.</p>

          <div class="FIGURE">
            <a name="AEN1050"></a>

            <p><b>Figure 5-21. Testing ifhp Operations</b></p>
<pre class="SCREEN">
    #!/bin/sh
    # sendhp.sh
    cp /dev/null /tmp/log
    cp /dev/null /tmp/out
    IP=10.0.0.14
    ifhp=/usr/libexec/filters/ifhp
    # $ifhp -Tdev=$IP%9100,trace,debug=4 &lt;/tmp/one.ps 2&gt;&amp;1 | tee /tmp/log
    # $ifhp -Tdev=$IP%9100,trace,debug=1,appsocket,status,pagecount,waitend &lt;/tmp/one.ps 2&gt;&amp;1 | tee /tmp/log
    # $ifhp -Tdev=$IP%9100,trace,debug=1,pagecount_poll=2 &lt;/tmp/one.ps 2&gt;&amp;1 | tee /tmp/log
    $ifhp -Tdev=/tmp/out,trace,model=hp5 &lt;/tmp/one.ps 2&gt;&amp;1 | tee /tmp/log
    
    h110: {475} % sh /tmp/sendhp.sh
    ifhp 06:48:04.430 [3438] main: using model 'hp5'
    ifhp 06:48:04.433 [3438] Process_job: setting up printer
    ifhp 06:48:04.433 [3438] Do_accounting: pagecounter 0
    ifhp 06:48:04.434 [3438] Process_job: sending job file
    ifhp 06:48:04.434 [3438] Send_job: starting transfer
    ifhp 06:48:04.434 [3438] Send_job: initial job type 'POSTSCRIPT'
    ifhp 06:48:04.434 [3438] Send_job: decoded job type 'POSTSCRIPT'
    ifhp 06:48:04.434 [3438] Send_job: job type 'POSTSCRIPT'
    ifhp 06:48:04.434 [3438] Send_job: transferring 145 bytes
    ifhp 06:48:04.434 [3438] Send_job: 100 percent done
    ifhp 06:48:04.434 [3438] Send_job: data sent
    ifhp 06:48:04.434 [3438] Process_job: sent job file
    ifhp 06:48:04.434 [3438] Do_accounting: pagecounter 0, pages 0
    ifhp 06:48:04.434 [3438] Process_job: done
    
    h110: {475} % more /tmp/out
    ^[%-12345X@PJL
    @PJL RDYMSG DISPLAY = ":"
    @PJL USTATUSOFF
    @PJL USTATUS JOB = ON
    ...
</pre>
          </div>

          <p>You can test <b class="APPLICATION">ifhp</b> and see
          what it does by using the <tt class="LITERAL">-T</tt>
          command line option. This is equivalent to using the <tt
          class="FILENAME">/etc/printcap</tt> <tt class=
          "LITERAL">ifhp</tt> option.&#13;</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1059">5.3. Taming the Wild
          Phaser Printer</a></h1>

          <p>There are several printers that have network
          interfaces but which require very special treatment.
          Among these printers are the Tektronics <tt class=
          "LITERAL">Phaser</tt> printers, some legacy Xerox
          printers, and some plotters. These devices require that
          the network connection be opened and closed multiple
          times when sending a job. In order to handle this we have
          the <i class="EMPHASIS">filter</i> open the connection.
          This type of operations is called the <tt class=
          "LITERAL">appsocket</tt> protocol.</p>

          <div class="FIGURE">
            <a name="AEN1065"></a>

            <p><b>Figure 5-22. Phaser/Appsocket Support</b></p>
<pre class="SCREEN">
    Printcap:
    lp:
      :lp=/dev/null
      :filter=/.../ifhp
      :ifhp=model=phaser  # OR
      :ifhp=appsocket,status,pagecount,waitend,dev=10.0.0.14%9100
    
    Offline Test:
    
    IP=10.0.0.14
    ifhp -Tdev=trace,debug=1,appsocket,status,pagecount,waitend,dev=10.0.0.14%9100
      &lt;/tmp/one.ps 2&gt;&amp;1 | tee /tmp/log
</pre>
          </div>
          &#13;<br>
          <br>

          <p>You need to specify the remote host and port to use to
          the <tt class="LITERAL">ifhp</tt> filter, as well as the
          <tt class="LITERAL">appsocket</tt> option. You should
          test this first using the offline test mode.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1071">Chapter 6. Banner Pages and
        Accounting</a></h1>

        <p>Banner pages are usually a waste of paper unless you
        need to make sure that user jobs are separated clearly.
        Even then, unless banner pages are on different stock or
        color they are usually ignored and thrown away.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1074">6.1. Suppressing
          Banner Pages</a></h1>

          <p>Most users do not <i class="EMPHASIS">want</i> banner
          pages, as they are a waste of paper. Some printers,
          especially the HP family of printers, will generate a
          banner page when you send a job to them using the <tt
          class="LITERAL">lpd</tt> protocol (i.e. <tt class=
          "LITERAL">lp=port@host</tt>.</p>

          <div class="FIGURE">
            <a name="NB1"></a>

            <p><b>Figure 6-1. Changing JetDirect
            Configuration</b></p>
<pre class="SCREEN">
    h110: {492} % telnet 10.0.0.14
    Trying 10.0.0.14...
    Connected to h14.private.
    Escape character is '^]'.
     
    Please type [Return] two times, to initialize telnet configuration
    For HELP type "?"
    &gt; ?
     
    ===JetDirect Telnet Configuration===
     
            Configured Parameters
            IP Address      : 10.0.0.14
            Subnet Mask     : 255.255.255.0
            Default Gateway : 10.0.0.1
            Syslog Server   : 0.0.0.0
            Idle Timeout    : 121 Seconds
            Banner          : 1
    &gt; banner: 0
    &gt; quit
</pre>
          </div>

          <p>Your first line of defense is to try to disable banner
          printing by the printer. This can be done (for HP
          Printers) as in <a href="#NB1">Figure 6-1</a>. Note that
          the user name and password are not set by default so
          effectively anybody can modify your printer
          configuration.</p>

          <div class="FIGURE">
            <a name="AEN1085"></a>

            <p><b>Figure 6-2. Printcap Option <tt class=
            "LITERAL">:sh</tt> and lpr -h (No Header)
            Option</b></p>
<pre class="SCREEN">
    Printcap:
      lp: ... :sh
    
    Command line:
      h110: {838} % lpr -h /tmp/hi
    
    No 'L' line in control file
</pre>
          </div>

          <p>The banner printing is triggered by the <tt class=
          "LITERAL">L</tt> (Login name?) line in the control file.
          You can use the printcap <tt class="LITERAL">:sh</tt>
          (suppress header pages or banner pages) or the command
          line <b class="APPLICATION">lpr</b> <tt class=
          "LITERAL">-h</tt> option to prevent <b class=
          "APPLICATION">lpr</b> from putting this line into the
          control file.</p>

          <div class="FIGURE">
            <a name="AEN1096"></a>

            <p><b>Figure 6-3. Removing Banner Lines</b></p>
<pre class="SCREEN">
    Printcap:
    lp:...
    :incoming_control_filter=/.../nobanner
    
    
    nobanner Script:
    
    #!/usr/bin/perl
    ...
    See <a href="#FILTERTEMPLATE">Figure 5-9</a>
      
      # read stdin
      my( $file );
      $file = join "", &lt;STDIN&gt;;
      $file =~ s/^L.*$//m;
      print $file;
      exit 0
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1100">6.2. Forcing Banner
          Pages</a></h1>

          <p>The <tt class="LITERAL">:ab</tt> (always print a
          banner page) is used by the <b class=
          "APPLICATION">lpd</b> server to force banner page
          generation. Even if the user tries to suppress it, it
          will still try to print a banner page.</p>

          <div class="FIGURE">
            <a name="AEN1105"></a>

            <p><b>Figure 6-4. Forcing Banner Pages</b></p>
<pre class="SCREEN">
    lp:...
    
    lp:server
      :ab   # force a banner page on printing
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1108">6.3. Generating
          Banner Pages</a></h1>

          <div class="FIGURE">
            <a name="AEN1110"></a>

            <p><b>Figure 6-5. Generating Banner Page</b></p>
<pre class="SCREEN">
    lp:
      :of=/.../ifhp
      :bp=/.../banner.ps  # for banner at start
      # :be=/.../banner.ps  # for banner at end
      # :bs=/.../banner.ps  # for banner at start
    
    <b class="APPLICATION">LPRng</b> banner generators:
      /usr/local/libexec/filters/psbanner - PostScript
      /usr/local/libexec/filters/pclbanner - PCL
      /usr/local/libexec/filters/lpbanner - Text
</pre>
          </div>

          <p>If you want to have a banner page printed you need to
          have two additional <b class="APPLICATION">lpd</b>
          facilities in the printcap entry: a banner printing
          program (<tt class="LITERAL">:bp=...</tt>) and a filter
          to handle banner printing (<tt class=
          "LITERAL">:of=...</tt>). The <tt class="LITERAL">bp</tt>
          causes the banner to be put at the start of the job, the
          <tt class="LITERAL">be</tt> at the end of the job
          (overrides <tt class="LITERAL">bp</tt>), and you can use
          <tt class="LITERAL">bs</tt> and <tt class=
          "LITERAL">be</tt> to have banners at both start and end
          of jobs.</p>

          <p>The banner printing programs are run exactly as a
          normal filter program, and the output is used as the
          banner to be printed. The <b class=
          "APPLICATION">LPRng</b> <b class=
          "APPLICATION">psbanner</b>, <b class=
          "APPLICATION">pclbanner</b>, and <b class=
          "APPLICATION">lpbanner</b> programs can be modified for
          local use.</p>

          <p>If your printer requires special setup or
          conditioning, then you will have to specify a filter for
          the banner program. Historically this is done using the
          <tt class="LITERAL">of</tt> option. This filter is
          started, the banner page sent to it, and then the filter
          is suspended (don't ask), the job is printed, and then
          the filter is restarted. Finally, if a banner is needed
          at the end of the job it is generated and sent.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1130">6.4.
          Accounting</a></h1>

          <p>For a detailed discussion of accounting, please
          consult the <b class="APPLICATION">LPRng</b> HOWTO
          documentation. We will briefly cover some simple recipes
          for disaster here.</p>

          <div class="FIGURE">
            <a name="AEN1134"></a>

            <p><b>Figure 6-6. Basic Accounting Information</b></p>
<pre class="SCREEN">
    
    lp: 
      :af=acct    # accounting file
        or
          :af=|/...       # filter to run
          :af=host%port   # remote server to query
      :as=jobstart $H $n $P $k $b $t   # line to print
      :as=/...    # filter to run at start of job
      :ae=jobend $H $n $P $k $b $t   # line to print
      :ae=/...    # filter to run at start of job
    
      :achk       # check to see if allowed to print
</pre>
          </div>

          <p>The <tt class="LITERAL">:af</tt> entry specifies
          either a file, a network connection, or a program to run.
          If a file, then accounting information is written to the
          file; if a program, then the program is run; if a network
          connection then a TCP/IP connection is made to the
          specified host and port. The <tt class="LITERAL">:as</tt>
          and <tt class="LITERAL">:ae</tt> entries specify the
          format of the line to print or a program to run at the
          start and end of the job respectively.</p>

          <div class="FIGURE">
            <a name="AEN1141"></a>

            <p><b>Figure 6-7. Accounting File Information</b></p>
<pre class="SCREEN">
    jobstart '-Hh110.private' '-npapowell' '-Pt1' '-kcfT456h110.private'
       '-b3' '-t2001-10-21-15:17:12.000'
    jobend '-Hh110.private' '-npapowell' '-Pt1' '-kcfT456h110.private'
        '-b3' '-t2001-10-21-15:17:
</pre>
          </div>

          <p>The accounting information provided by the <b class=
          "APPLICATION">lpd</b> server is very basic and does not
          include page usage. However, we can have the print
          filters write information to the file as well.</p>

          <div class="FIGURE">
            <a name="AC2"></a>

            <p><b>Figure 6-8. Filter Accounting Information</b></p>
<pre class="SCREEN">
     
    jobstart '-Hh110.private' '-nroot' '-Plp' '-kcfA129h110.private'
       '-b48780' '-t2001-10-19-09:36:36.000'
    filestart '-q26132' '-p105340' '-t2001-10-19-09:36:38.350'
        '-Aroot@h110+129' '-nroot' '-Plp'
    fileend '-b19' '-T435' '-q26132' '-p105359' '-t2001-10-19-09:43:51.504'
         '-Aroot@h110+129' '-nroot' '-Plp'
    jobend '-Hh110.private' '-nroot' '-Plp' '-kcfA129h110.private' '-b48780' '-t2001-10-19-09:43:51.000'
</pre>
          </div>

          <p>The <tt class="LITERAL">filestart</tt> and <tt class=
          "LITERAL">fileend</tt> lines were written by the <b
          class="APPLICATION">ifhp</b> filter. The <tt class=
          "LITERAL">-p</tt> (pagecounter) values are the starting
          and ending values for the physical page counter on the
          printer. The <tt class="LITERAL">-b</tt> value is the
          number of pages used and the <tt class="LITERAL">-T</tt>
          the number of seconds used.</p>

          <p>Remember that <b class="APPLICATION">ifhp</b> can only
          get accurate page counting information if there is a
          physical page counter and it can be accurately read. This
          requires a bidirectional network link. Parallel ports <i
          class="EMPHASIS">do not work</i>. Also, your printer must
          support either PJL or PostScript, and have a hardware
          page counter. Finally, the page counter must be updated
          in a timely manner and reflect the number of pages used
          by each job.</p>

          <p>The <tt class="LITERAL">:achk</tt> checks to see if
          the user has permission to print. At the start of the
          job, if the accounting destination is a program or
          network connection, after writing the information <b
          class="APPLICATION">lpd</b> reads a line from program or
          connection. This line is used to determine if the user
          has permission to print. The return value can also cause
          the job to be held or deleted.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1162">6.5. Accounting
          Gotchas</a></h1>

          <div class="FIGURE">
            <a name="AC3"></a>

            <p><b>Figure 6-9. Accounting Gotchas</b></p>
<pre class="SCREEN">
    jobstart '-Hh110.private' '-nroot' '-Plp' '-kcfA129h110.private'
       '-b48780' '-t2001-10-19-09:36:36.000'
    filestart '-q26132' '-p105340' '-t2001-10-19-09:36:38.350'
        '-Aroot@h110+129' '-nroot' '-Plp'
    jobstart '-Hh110.private' '-nroot' '-Plp' '-kcfA129h110.private'
       '-b49780' '-t2001-10-19-09:36:36.000'
    filestart '-q27992' '-p105340' '-t2001-10-19-09:36:38.350'
        '-Aroot@h110+129' '-nroot' '-Plp'
</pre>
          </div>

          <p>Observe the accounting file in <a href="#PP1">Figure
          7-1</a>. Clearly something has happened. The clever
          student (ummm... user?) has killed off the printer just
          as his last page has come out. There is no usage line.
          You will have to calculate usage based on the differences
          between the pagecounters at the start of each job.</p>

          <p>Of course, this can also be the result of a printer
          failure, bad print job, etc. etc. etc. Not to mention
          elves. Most student labs have lots of elves lurking in
          the background that cause endless headaches.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1170">6.6. Accounting
          Including Banner Pages</a></h1>

          <div class="FIGURE">
            <a name="AEN1172"></a>

            <p><b>Figure 6-10. Accounting Using Banner
            Pages</b></p>
<pre class="SCREEN">
    lp:
      :of=/.../ifhp
      :...
</pre>
          </div>

          <p>The <tt class="LITERAL">:of</tt> filter is used to
          print the banner pages. Now the information in the
          accounting file inclues the banner pages as well as the
          job pages.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1177">Chapter 7. Printer Pools and Load
        Sharing</a></h1>

        <div class="FIGURE">
          <a name="PP1"></a>

          <p><b>Figure 7-1. Printer Pools and Load Sharing</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="pooling.png"></p>
          </div>
        </div>

        <p>A printer pool does load sharing amoung a group of
        printers. When you send a job to the main spool queue the
        job is then sent to the next available printer. If all of
        the printers are busy then the job is held in the queue <a
        href="#PP1">Figure 7-1</a>.</p>

        <div class="FIGURE">
          <a name="PP2"></a>

          <p><b>Figure 7-2. Load Balancing Printcap</b></p>
<pre class="SCREEN">
    main:
      :sd=/var/spool/lpd/%P:sv=sv1,sv2,sv3
    
    sv1:
      :sd=/var/spool/lpd/%P:ss=main:lp=...
    sv2:
      :sd=/var/spool/lpd/%P:ss=main:lp=...
    sv3:
      :sd=/var/spool/lpd/%P:ss=main:lp=...
</pre>
        </div>

        <p>The printcap for setting up spooling is shown in <a
        href="#PP2">Figure 7-2</a>. The <tt class=
        "LITERAL">:sv</tt> option marks this queue as the input
        queue for load balancing and the <tt class=
        "LITERAL">:ss</tt> option specifies that this queue is the
        destination for load balancing. The server queues must have
        an associated device and send the jobs to the associated
        device.</p>

        <div class="FIGURE">
          <a name="AEN1193"></a>

          <p><b>Figure 7-3. Load Balancing to Remote Queues</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="chooser.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1198"></a>

          <p><b>Figure 7-4. Printcap for Chooser</b></p>
<pre class="SCREEN">
    main:
      # program to select destination
      :chooser=/.../chooser
      :destinations=s1@host1,s2@host2,s3@host3
      # You can even combine the two forms
      #  sv=...
</pre>
        </div>

        <p>The <tt class="LITERAL">:chooser</tt> value is an
        executable program that is provided a list of destinations,
        by using the <tt class="LITERAL">:destinations</tt> value
        in the <tt class="LITERAL">$PRINTCAP_ENTRY</tt>. We will
        show how to use this in the next section.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1205">7.1. Implementing
          Smart Load Balancing</a></h1>

          <div class="FIGURE">
            <a name="AEN1207"></a>

            <p><b>Figure 7-5. Chooser Program Operation</b></p>
<pre class="SCREEN">
    # In Perlish
    @list = PC('destination');  # get destination list
    foreach $printer (@list) {
        if( PrinterAvailable( $printer ){
            print $printer . "\n";
            last;
        }
    }
</pre>
          </div>

          <p>The <tt class="LITERAL">PrinterAvailable</tt> function
          would determine the availability of the destination
          printer by an appropriate method - <b class=
          "APPLICATION">lpq</b> query, testing to see if a
          connection can be made to the device, etc.</p>

          <p>If you specify a <tt class="LITERAL">:chooser</tt> for
          a <tt class="LITERAL">:sv</tt> type of load balance
          queue, then the chooser program can also be used. Lets
          look at a simple <tt class="LITERAL">chooser</tt>
          implementation.</p>

          <div class="FIGURE">
            <a name="AEN1217"></a>

            <p><b>Figure 7-6. Filter Template in Perl</b></p>
<pre class="SCREEN">
    #!/usr/bin/perl
    use Getopt::Std;
    my $debug = 1;    # always... sigh...
    my(%opt, @pc, %options);
    
    # get command line options
    getopts( 'A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q:R:T:S:U:V:W:X:Y:Z:'
    . 'a:b:cd:e:f:g:h:i:j:k:l:m:n:o:p:q:r:t:s:u:v:w:x:y:z:', \%opt );
    while( @ARGV ){ $opt{acct} = pop @ARGV ; };
    
    # split up the PRINTCAP_ENTRY environment variable value
    @pc = split /\n\s*:/s, ($ENV{PRINTCAP_ENTRY} || "");
    shift @pc;  # throw way first entry field, printer name
    # set the options
    foreach (@pc){ # set the options values
        if( /^(.+)=(.*)/ ){ $options{$1} = $2;
        } elsif ( /^(.+)@/ ){ $options{$1} = 0;
        } else { $options{$_} = 1; }
    }
    
    if( $debug ){ # for those interested
        my $s = "";
        foreach my $v (sort keys %options ){ $s .= "$v='$options{$v}',"; }
        print STDERR "Printcap: '$s'\n";
        $s="";
        foreach my $v (sort keys %opt){ $s .= "$v='$opt{$v}',"; }
        print STDERR "Args: '$s'\n";
    }
   
</pre>
          </div>

          <p>This is the standard filter template. We use this
          almost everywhere.</p>

          <div class="FIGURE">
            <a name="AEN1222"></a>

            <p><b>Figure 7-7. Choosing A Destintation</b></p>
<pre class="SCREEN">
    my (@list, @destinations);
    if( $options{sv} ){ # if we have :sv then we read them from STDIN
        while( &lt;STDIN&gt; ){ chomp; push @destinations, $_; }
    } else { # else we use the 'destinations' printcap value
        @list = split /[,\s]+/, ($options{destinations} || "");
        # and we randomize - this is a bit of perl magic
        while( @list ){
            push @destinations,(splice @list,rand(@list),1);
        }
    }
    # and we split the destinations up...
    print STDERR "Destinations '@destinations'\n" if $debug;
    # and now we search
    my $lpq="/usr/bin/lpq";
    foreach ( @destinations ){
        my $status = "";
        next if not $_;
        # run the lpq
        eval { alarm(10); $status = `$lpq -s -P$_`; }; alarm(0);
        chomp $status;
        print STDERR "STATUS '$_' $status\n" if $debug;;
        # we reject queues that are not suitable
        next if( $status =~ /disabled/ or $status != / 0 jobs / );
        print STDERR "chose '$_' from @$destinations\n";
        print $_;
        last;
    }
</pre>
          </div>

          <p>We first get the list of destinations - from <tt
          class="LITERAL">STDIN</tt> if we have helping an <tt
          class="LITERAL">:sv</tt> load balance queue, or from the
          <tt class="LITERAL">:destinations</tt> printcap entry. In
          the later case we randomize the list so that we spread
          the load over different printers rather than sending to
          the first printer in the list. We then run a command or
          application that gets the print queue status or whatever
          we need to decide if the printer is ready. Notice the
          timeouts. This is usually not necessary but you might run
          into this problem some day. We then look at the status
          and decide if we can use the printer.</p>

          <p>If no printer is available then nothing is printed on
          <tt class="LITERAL">STDOUT</tt>, and the <b class=
          "APPLICATION">lpd</b> process will wait until either a
          printer becomes available or for a timeout specified by
          the <tt class="LITERAL">:chooser_interval</tt> value
          (default 10 seconds) in the printcap entry or <tt class=
          "FILENAME">/etc/lpd.conf</tt> file.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1234">7.2. Using <tt class=
          "LITERAL">:chooser</tt> Exit Codes</a></h1>

          <div class="FIGURE">
            <a name="AEN1237"></a>

            <p><b>Figure 7-8. Chooser Exit Codes</b></p>
<pre class="SCREEN">
    Exit Code                Action
    0 (JSUCC)                Use chooser output for destination
                             (No destination, retry later)
    1 (JFAIL)                Failed - retry later
                             (same as JSUCC, no destination)
    2 (JABORT)               Abort printing, wait for restart
    3 (JREMOVE)              Remove job
    4 (JHOLD)                Set job HOLD flag
</pre>
          </div>

          <p>The <tt class="LITERAL">:chooser</tt> program exit
          codes can be used to control printing. The <tt class=
          "LITERAL">JHOLD</tt> and <tt class="LITERAL">JREMOVE</tt>
          exit codes are job specific; they can be used to hold or
          remove a job.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1244">Chapter 8. Wildcards, Bounce Queues,
        and Forwarding</a></h1>

        <p>One of the things you might want to do is have a set of
        queues that massage the various jobs and then send them to
        a destination printer.</p>

        <div class="FIGURE">
          <a name="AEN1247"></a>

          <p><b>Figure 8-1. Evil (BAD) Way</b></p>
<pre class="SCREEN">
    landscape:force_localhost
      :ifhp=model=xx
      :filter=/.../convert_to_landscape | /.../ifhp
      :lp=10.0.0.14%9100
    
    portrait:force_localhost
      :ifhp=model=xx
      :filter=/.../convert_to_landscape | /.../ifhp
      :lp=10.0.0.14%9100
    
    lp:tc=.common
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
</pre>
        </div>

        <p>Each queue will now fight for a connection to the
        destination printer.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1251">8.1. Bounce
          Queues</a></h1>

          <div class="FIGURE">
            <a name="AEN1253"></a>

            <p><b>Figure 8-2. Not So Evil Way</b></p>
<pre class="SCREEN">
    landscape:tc=.common
      :filter=/.../convert_to_landscape
      :lp=lp@localhost
    
    portrait:tc=.common
      :filter=/.../convert_to_landscape
      :lp=lp@localhost
    
    lp:tc=.common
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
</pre>
          </div>

          <p>You have various filters set up so that each queue
          does a conversion and then forwards it to the real
          printer for output. No fighting. This method is called <i
          class="EMPHASIS">bounce queues</i> as the job <i class=
          "EMPHASIS">bounces</i> through the <i class=
          "EMPHASIS">queues</i>, getting modified at each
          stage.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1260">8.2. Adding -Z
          Options Using Bounce Queues</a></h1>

          <div class="FIGURE">
            <a name="AEN1262"></a>

            <p><b>Figure 8-3. Add Options Using <tt class=
            "LITERAL">:append_z</tt></b></p>
<pre class="SCREEN">
    landscape:tc=.common
      :append_z=landscape
      :lp=lp@localhost
    
    portrait:tc=.common
      :append_z=portrait
      :lp=lp@localhost
    
    # ifhp (or other) filter uses the -Z options
    lp:tc=.common
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
</pre>
          </div>

          <p>Now you can add one option at a time. But what if you
          want to do landscape and duplex mode at the same time?
          You need to create a <tt class=
          "LITERAL">landscape_duplex</tt> queue. The combinations
          become very unweildy.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="INCOMING">8.3. Adding Options
          By Modifying Control File</a></h1>

          <div class="FIGURE">
            <a name="AEN1270"></a>

            <p><b>Figure 8-4. Diabolically Fiendishly Clever
            Method</b></p>
<pre class="SCREEN">
    .common=force_localhost:sd=/var/spool/lpd/%P:sh:mx=0
    
    lp|lp_*  # we recognize lp_xxxx for this filter
      :tc=.common
      :incoming_control_filter=/.../update_z
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
    
    -- for landscape:
    h110: {838} % lpr -Plp_landscape
       -&gt; Control file:  Zlandscape
    
    -- for portrait
    h110: {838} % lpr -Plp_portrait
       -&gt; Control file:  Zlandscape
    
    -- for landscape and duplex
    h110: {838} % lpr -Plp_landscape_duplex -Zother
       -&gt; Control file:  Zother,landscape,duplex
</pre>
          </div>

          <p>You can use a <i class="EMPHASIS">wildcard</i> in the
          printer name. The <b class="APPLICATION">LPRng</b> code
          will first try to match a printer name against the
          non-wildcard printer names. If this fails then it will
          look for the first match using a <i class=
          "EMPHASIS">glob</i> type of match.</p>

          <p>When the job is received the name that was used to
          send the job will be put into the control file as the <tt
          class="LITERAL">Q</tt> line and is passed as a <tt class=
          "LITERAL">-Q</tt> option to and filters. The <tt class=
          "LITERAL">:incoming_control_filter</tt> is passed the
          original control file on its <tt class=
          "LITERAL">STDIN</tt> and sends a modified version on <tt
          class="LITERAL">STDOUT</tt>. This allows the control file
          to be modified as it is received.</p>

          <p>One of the ways to modify the control file is to
          convert suffixes of the print queue name (i.e. - <tt
          class="LITERAL">_option</tt>) to <tt class=
          "LITERAL">-Z</tt> option values and append these to the
          <tt class="LITERAL">Z</tt> line of the control file.</p>

          <div class="FIGURE">
            <a name="UPDATEZ"></a>

            <p><b>Figure 8-5. Using <tt class=
            "LITERAL">update_z</tt></b></p>
<pre class="SCREEN">
    #!/usr/bin/perl
    ...
      See <a href="#FILTERTEMPLATE">Figure 5-9</a>
    
    # read stdin
    my( $file, $Zopts, $Q );
    $file = join "", &lt;STDIN&gt;;
    print STDERR "File '$file'\n" if $debug;
    
    # first use command line Queue name, then control file Q
    # then the printer name, then control file P
    $Q = $opt{Q}; ($Q) = $file =~ /^Q(.*)$/m if not $Q;
    # if no queue name fall back to printer name
    $Q = $opt{P} if not $Q; ($Q) = $file =~ /^P(.*)$/m if not $Q;
    $Q = "" if not $Q;  # stupid -w... sigh...
    
    # get Zopts
    ($Zopts) = $file =~ /^Z(.*)$/m;
    $Zopts = "" if not $Zopts; # stupid -w ... sigh ...
    
    print STDERR "Q '$Q', Zopts '$Zopts'\n" if $debug;
    
    # now we split up the name and use as parameters for Z options
    while( $Q =~ /_([^_]+)/g ){
        # you can simply append them:
        $Zopts .= ",$1";
        # or you can test and then append translated format
        # $Zopts .= $xlate{$1} if $late{$1}
    }
    $Zopts =~ s/^,//; # remove leading comma
    print "Final '$Zopts'\n" if $debug;
    if( $Zopts ){
        $file = "Z$Zopts\n" . $file if( not ($file =~ s/^Z.*$/Z$Zopts/m));
    }
    print $file;
    exit 0
</pre>
          </div>

          <p>The <tt class="LITERAL">-Q</tt> option or control file
          <tt class="LITERAL">Q</tt> line is used to get the name
          of the print queue. The suffixes are then processed in
          turn. You can either simply append them or have a hash
          translate these values.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1295">Chapter 9. Form Support and Hold
        Queues</a></h1>

        <p>Sometimes jobs require a special setup on a printer, and
        jobs cannot be printed unless it is done. There are several
        ways to handle this.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1298">9.1. Hold
          Queues</a></h1>

          <div class="FIGURE">
            <a name="AEN1300"></a>

            <p><b>Figure 9-1. Hold Queues</b></p>
<pre class="SCREEN">
    .common=force_localhost:sd=/var/spool/lpd/%P:sh:mx=0
    
    setup1:tc=.common
      :ah        # always hold incoming jobs
      :lp=lp@localhost
    setup2:tc=.common
      :ah        # always hold incoming jobs
      :lp=lp@localhost
    lp:tc=.common  # print queue
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
</pre>
          </div>

          <div class="FIGURE">
            <a name="AEN1303"></a>

            <p><b>Figure 9-2. All Hold Queues</b></p>
<pre class="SCREEN">
    h110: {853} % lpq -Psetup1
    Printer: setup1@h110 (dest t1@localhost) (autohold)
     Queue: no printable jobs in queue
    Printer: t1@h110 'Test Printer 1' (printing disabled)
     Queue: no printable jobs in queue
    h110: {854} % lpr -Psetup1 /tmp/hi
    h110: {855} % lpq -Psetup1
    Printer: setup1@h110 (dest t1@localhost) (autohold)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Rank   Owner/ID                  Class Job Files                 Size Time
    hold   papowell@h110+356            A   356 /tmp/hi                  3 15:02:50
    Printer: t1@h110 'Test Printer 1' (printing disabled)
     Queue: no printable jobs in queue
</pre>
          </div>

          <p>When we print jobs to a <tt class="LITERAL">:ah</tt>
          or always hold queue, the job is not processed until
          released. We can release one or all the jobs that are
          being held.</p>

          <div class="FIGURE">
            <a name="AEN1308"></a>

            <p><b>Figure 9-3. Releasing Jobs for Printing</b></p>
<pre class="SCREEN">
    h110: {856} % lpc release setup1 all
    Printer: setup1@h110
    setup1: selected 'papowell@h110+356'
    setup1@h110.private: started
    h110: {857} % lpq -Psetup1
    Printer: setup1@h110 (dest t1@localhost) (autohold)
     Queue: no printable jobs in queue
     Status: job 'cfA356h110.private' removed at 15:03:49.053
    Printer: t1@h110 'Test Printer 1' (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID                  Class Job Files                 Size Time
    1      papowell@h110+356            A   356 /tmp/hi                  3 15:03:49
    h110: {858} %
</pre>
          </div>

          <p>We can release the jobs which are then forwarded to
          the main queue for printing.</p>

          <p>We can also set up <i class="EMPHASIS">Time
          Release</i> queues using the <tt class=
          "LITERAL">cron</tt> time scheduling system.</p>

          <div class="FIGURE">
            <a name="AEN1315"></a>

            <p><b>Figure 9-4. Releasing Jobs For Scheduled Print
            Run</b></p>
<pre class="SCREEN">
    Printcap:
      nightrun:
        :ah        # always hold incoming jobs
        :lp=lp@localhost
    
    Crontab Entry To Release Jobs:
    
    #minute hour mday month wday    who command
    1   3   *   *   *   root    /usr/sbin/lpc release nightrun all
</pre>
          </div>

          <p>You can also use the <b class="APPLICATION">LPRng</b>
          <i class="EMPHASIS">class</i> facility. The <b class=
          "APPLICATION">lpr</b> <tt class="LITERAL">-Cclass</tt>
          option sets the <tt class="LITERAL">Cclass</tt> line in
          the control file. You can then use the <b class=
          "APPLICATION">lpc</b> <tt class="LITERAL">class</tt>
          facility to select job classes to print.</p>

          <div class="FIGURE">
            <a name="HOLDCLASS"></a>

            <p><b>Figure 9-5. Using Job Classes</b></p>
<pre class="SCREEN">
    h110: {870} % lpc class t1 top,middle
    Printer: t1@h110
    classes printed 'top,middle'
    t1@h110.private: class updated
    h110: {871} % lpq
    Printer: t1@h110 'Test Printer 1' (classes top,middle)
     Queue: no printable jobs in queue
    h110: {872} % lpr -Clow /tmp/a
    h110: {873} % lpq
    Printer: t1@h110 'Test Printer 1' (classes top,middle)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Rank   Owner/ID                  Class Job Files                 Size Time
    holdclass papowell@h110+451         L   451 /tmp/a               38404 15:16:39
    h110: {874} % lpr -Ctop /tmp/hi
    h110: {875} % lpq
    Printer: t1@h110 'Test Printer 1' (classes top,middle)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Status: job 'cfT456h110.private' removed at 15:17:12.932
     Rank   Owner/ID                  Class Job Files                 Size Time
    holdclass papowell@h110+451         L   451 /tmp/a               38404 15:16:39
</pre>
          </div>

          <p>You can specify a current list of classes to be
          printed using the <b class="APPLICATION">lpc</b> <tt
          class="LITERAL">class</tt> command. As shown in <a href=
          "#HOLDCLASS">Figure 9-5</a>. the jobs not in the current
          classes are held until explicitly released or until the
          class is changed. You can disable the job class facility
          by setting the class to <tt class="LITERAL">off</tt>.</p>

          <div class="FIGURE">
            <a name="AEN1334"></a>

            <p><b>Figure 9-6. Setting New Job Classes and Disabling
            Job Classes</b></p>
<pre class="SCREEN">
    h110: {877} % lpc class t1 low
    Printer: t1@h110
    classes printed 'low'
    t1@h110.private: class updated
    h110: {879} % lpq -ll
    Printer: t1@h110 'Test Printer 1' (classes low)
     Queue: no printable jobs in queue
     Status: finished 'papowell@h110+451', status 'JSUCC' at 15:22:03.178
     Status: subserver pid 84477 exit status 'JSUCC' at 15:22:03.179
     Status: t1@h110.private: job 'cfL451h110.private' printed at 15:22:03.180
     Status: job 'cfL451h110.private' removed at 15:22:03.181
    
    h110: {39} % lpc class t1 off
    Printer: t1@h110
    all classes printed
    t1@h110.private: class updated
    h110: {40} % lpq
    Printer: t1@h110 'Test Printer 1'
     Queue: no printable jobs in queue
     Status: job 'cfL451h110.private' removed at 15:22:03.181
</pre>
          </div>

          <p>You can also put a class value into the control file
          using the <tt class=
          "LITERAL">incoming_control_filter</tt> facility described
          in <a href="#INCOMING">Section 8.3</a>.</p>

          <div class="FIGURE">
            <a name="AEN1340"></a>

            <p><b>Figure 9-7. Modifying Control File Using
            update_class</b></p>
<pre class="SCREEN">
    lp|lp_*:tc=.common
      :incoming_control_filter=/.../update_class
      :ifhp=model=xx
      :filter=/.../ifhp
      :lp=10.0.0.14%9100
</pre>
          </div>

          <p>The <tt class="LITERAL">:incoming_control_filter</tt>
          will now update the class to whatever you want.</p>

          <div class="FIGURE">
            <a name="AEN1346"></a>

            <p><b>Figure 9-8. The update_class Filter</b></p>
<pre class="SCREEN">
    #!/usr/bin/perl
    ...
      See <a href="#FILTERTEMPLATE">Figure 5-9</a>
    
    # read stdin
    my( $file, $Copts, $Q );
    $file = join "", &lt;STDIN&gt;;
    print STDERR "File '$file'\n" if $debug;
    
    # first use command line Queue name, then control file Q
    # then the printer name, then control file P
    $Q = $opt{Q}; ($Q) = $file =~ /^Q(.*)$/m if not $Q;
    # if no queue name fall back to printer name
    $Q = $opt{P} if not $Q; ($Q) = $file =~ /^P(.*)$/m if not $Q;
    $Q = "" if not $Q;  # stupid -w... sigh...
    
    # get Copts
    ($Copts) = $file =~ /^C(.*)$/m;
    $Copts = "" if not $Copts; # stupid -w ... sigh ...
    
    print STDERR "Q '$Q', Copts '$Copts'\n" if $debug;
    
    # now we split up the name and use as parameters for C option
    while( $Q =~ /_([^_]+)/g ){
        $Copts = $1;
    }
    print "Final '$Copts'\n" if $debug;
    if( $Copts ){
        $file = "C$Copts\n" . $file if( not ($file =~ s/^C.*$/C$Copts/m));
    }
    print $file;
    exit 0
</pre>
          </div>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1351">Chapter 10. Interfacing to Vintage,
        Legacy, and SunOS Print Spoolers</a></h1>

        <p>Some legacy, vintage, and other print spoolers do not
        meet the RFC1179 requirements, or accept only control files
        with options used by the original BSD (1984 vintage) print
        spooler and only in the order used by the original BSD
        (1984 vintage) print spooler. The <tt class=
        "LITERAL">:bk</tt> (<i class="EMPHASIS">Berkely
        Kompatible</i>) option causes <b class=
        "APPLICATION">lpd</b> to generate control files compatible
        with this format. If you encounter problems with
        transferring files to these systems, try using the <tt
        class="LITERAL">:bk</tt> option first.</p>

        <p>&#13;</p>

        <div class="FIGURE">
          <a name="AEN1359"></a>

          <p><b>Figure 10-1. Using <tt class="LITERAL">:bk</tt>
          (Berkeley Kompatible) Flag</b></p>
<pre class="SCREEN">
    lp:force_localhost@     # make control files berkeley
      :bk
      :lp=...
</pre>
        </div>
        &#13;<br>
        <br>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1363">Chapter 11. Managing Enterprise Level
        Printing Systems</a></h1>

        <p>If you are doing management of more than 20 printers,
        then you already know the headaches. You need to make the
        printers available to all/some/none of your users, each
        user has a different set of requirements, and no two
        printers are the same. The following are some helpful
        suggestions and recipes for managing printer
        information.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1366">11.1. Templates and
          Standard Configurations</a></h1>

          <div class="FIGURE">
            <a name="AEN1368"></a>

            <p><b>Figure 11-1. Templates in Printcaps</b></p>
<pre class="SCREEN">
    .common
      :sh:sd=/var/spool/lpd/%P:force_localhost
    .hplj4
      :ifhp=model=hp4
      :filter=/.../ifhp
    
    # server information
    hp4:server:tc=.common,.hplj4
      :lp=10.0.0.14%9100
    
    #client information
    hp4:client:lp=%P@server1
</pre>
          </div>

          <p>You should set up a standard set of templates to see
          what you have. You can then use <b class=
          "APPLICATION">lpc</b> to see what the printcap is.</p>

          <div class="FIGURE">
            <a name="AEN1373"></a>

            <p><b>Figure 11-2. Using lpc client all</b></p>
<pre class="SCREEN">
    .defaults
     :ab@
     ...
    
    .config
    
    .all
     :t1
     :t2
    
    #Printcap Information
    t1|t1_*
     :filter=/usr/local/libexec/filters/ifhp
     :lp=/var/tmp/t1_lp
     :sd=/var/spool/lpd/%P
    t2|Test Printer 2
     :lf=log
     :lp=t1@h110.private
     :sd=/var/spool/lpd/%P
</pre>
          </div>

          <p>You can use <tt class="LITERAL">lpc client all</tt> to
          see the printcap information as the <b class=
          "APPLICATION">LPRng</b> clients would see it. This allows
          you to check out the various printcaps before you use
          them. You can also use <tt class="LITERAL">lpc server
          all</tt> to see the printcap information as the <b class=
          "APPLICATION">lpd</b> server would see it.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1383">11.2. Master Print
          Servers, One User Printcap</a></h1>

          <div class="FIGURE">
            <a name="AEN1385"></a>

            <p><b>Figure 11-3. Master User Printcap File, No Local
            Spooling</b></p>
<pre class="SCREEN">
    # Just information for clients
    #  list all of the printers for this server
    lp1|lp2|.....
      :client:lp=%Q@server1.private:force_localhost@
    lp99|....
      :client:lp=%Q@server2.private:force_localhost@
</pre>
          </div>

          <p>This will allow you to send jobs directly to the print
          server. You use the <tt class="LITERAL">lp=%Q@server</tt>
          form for the destination. Note that you will need <b
          class="APPLICATION">LPRng</b> version 3.8.0 or later for
          this to work.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1391">11.3. Master Print
          Servers, Local Spooling</a></h1>

          <div class="FIGURE">
            <a name="AEN1393"></a>

            <p><b>Figure 11-4. Master User Printcap File, Local
            Spooling</b></p>
<pre class="SCREEN">
    # Just information for clients
    #  list all of the printers for this server
    lp1|lp2|.....
      :client:lp=%Q@server1.private:force_localhost
    
    lp99|....
      :client:lp=%Q@server2.private:force_localhost
</pre>
          </div>

          <p>Observe that you have two queues, one per print
          server. You use the <tt class="LITERAL">lp=%Q@server</tt>
          form of the destination. Note that you will need <b
          class="APPLICATION">LPRng</b> version 3.8.0 or later for
          this to work.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1399">11.4. Master Print
          Servers, Selection by User</a></h1>

          <div class="FIGURE">
            <a name="AEN1401"></a>

            <p><b>Figure 11-5. Master User Printcap File, No Local
            Spooling</b></p>
<pre class="SCREEN">
    #  list all of the printers for this server
    lp1|lp2|.....
    OR
    lp1|*
      :client:lp=%Q@server1.private:force_localhost@
      :oh=*.engineering.private
    
    lp1|lp2|.....
    OR
    lp1|*
      :client:lp=%Q@server2.private:force_localhost@
      :oh=*.marketing.private
</pre>
          </div>

          <p>You can use the <tt class="LITERAL">:oh=</tt><i class=
          "EMPHASIS">Pattern</i> to select the set of printcap
          entries that can be used on a host. The <i class=
          "EMPHASIS">Pattern</i> can be IP Address/netmask (<tt
          class="LITERAL">10.0.0.0/24</tt> or <tt class=
          "LITERAL">10.0.0.0/255.255.255.0</tt>) or a wildcard
          match for the DNS resovled host name (<tt class=
          "LITERAL">*.eng.private</tt>).</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1411">11.5. The Great Grand
          Dad Of All Printcap Files</a></h1>

          <div class="FIGURE">
            <a name="AEN1413"></a>

            <p><b>Figure 11-6. All In One</b></p>
<pre class="SCREEN">
    #  list all of the printers for this server
    lp1|lp2|.....
      :client:lp=%Q@server1.private:force_localhost@
      :oh=*.engineering.private
    lp1|lp2|.....
      :client:lp=%Q@server2.private:force_localhost@
      :oh=*.marketing.private
    lp1:server
      :....
    lp2:server
      :....
</pre>
          </div>

          <p>Add all the printer information in as well. Huge
          printcap files. But very easy to manage. But how do you
          get them to the user?</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1417">11.6. Using Printcap
          Filters and Central Databases</a></h1>

          <div class="FIGURE">
            <a name="AEN1419"></a>

            <p><b>Figure 11-7. Printcap Path Configuration
            Information</b></p>
<pre class="SCREEN">
    /etc/lpd.conf:
    
    # Purpose: lpd printcap path
    #   default lpd_printcap_path= (STRING)
    # Purpose: /etc/printcap files
    #   default printcap_path= /etc/printcap   (STRING)
    printcap_path=|/usr/local/libexec/get_printcap
</pre>
          </div>

          <p>If the <tt class="FILENAME">/etc/lpd.conf</tt> <tt
          class="LITERAL">printcap_path</tt> value is a filter,
          then the <b class="APPLICATION">LPRng</b> application
          will write the name of the requested printer to the <tt
          class="LITERAL">STDIN</tt> of the filter program and
          expect to read one or more printcap entries from <tt
          class="LITERAL">STDOUT</tt>. If the printcap entry
          contains a <tt class="LITERAL">:tc</tt> reference, then
          this entry will be looked up in turn.</p>

          <div class="FIGURE">
            <a name="AEN1429"></a>

            <p><b>Figure 11-8. Example of Returned Printcap
            Value</b></p>
<pre class="SCREEN">
    Configuration: printcap_path = |/usr/local/bin/get_ldap_pc
    
    h110: {917} % lpr -Plp
    
      Printcap access equivalent to Perlish:
       $printcap = `echo lp | /usr/local/bin/get_ldap_pc`
    
    Configuration: lpd_printcap_path = |/usr/local/bin/get_lpd_ldap_pc
       lpd server will do:
       $printcap = `echo lp | /usr/local/bin/get_lpd_ldap_pc`
</pre>
          </div>

          <p>The exercise of building the necessary <tt class=
          "LITERAL">LDAP</tt> database, extracting the information
          in a printcap form using the Perl</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="AEN1434">Chapter 12. <b class=
        "APPLICATION">LPRngTool</b></a></h1>

        <div class="FIGURE">
          <a name="AEN1437"></a>

          <p><b>Figure 12-1. Starting Screen</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_open.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1442"></a>

          <p><b>Figure 12-2. Printcap Entry Selection</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_printcaps.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1447"></a>

          <p><b>Figure 12-3. Add A Printer</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_add.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1452"></a>

          <p><b>Figure 12-4. Option Specification</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_edit.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1457"></a>

          <p><b>Figure 12-5. Advanced Options</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_advanced.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1462"></a>

          <p><b>Figure 12-6. ifhp Options</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_ifhpfilter.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1468"></a>

          <p><b>Figure 12-7. Saving Printcap Entry</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_write.png"></p>
          </div>
        </div>

        <div class="FIGURE">
          <a name="AEN1473"></a>

          <p><b>Figure 12-8. Checkpc Results</b></p>

          <div class="MEDIAOBJECT">
            <p><img src="x_checkpc.png"></p>
          </div>
        </div>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="SECFEATURES">Appendix A. <b class=
        "APPLICATION">LPRng</b></a></h1>

        <p>The <b class="APPLICATION">LPRng</b> print spooler
        software was developed to be robust, reliable, secure,
        scalable, and portable. It has been used since 1988 in
        extremely demanding academic printing environments such as
        University of Minnesota, MIT, and Rutgers, commercial
        companies such as Dow Jones and Abbot Pharmaceuticals, as
        well as being distributed with Linux, FreeBSD, and other
        systems. Each of these environments has a unique set of
        problems, demanding various configuration and
        administrative capabilities. For example, the simple single
        user system with a single or limited number of printers
        requires easy configuration and simple diagnostic
        procedures, while the network based printing system
        requires highly robust error logging, authentication, and
        failover support. <b class="APPLICATION">LPRng</b> provides
        a highly flexible configuration system that allows it to
        perform optimally in all of these environments.</p>

        <p>The <b class="APPLICATION">LPRng</b> software has three
        components: the <b class="APPLICATION">lpd</b> print
        spooler and the user client applications <b class=
        "APPLICATION">lpr</b>, <b class="APPLICATION">lpq</b>, <b
        class="APPLICATION">lprm</b>, etc.; the IFHP print filter
        (<b class="APPLICATION">ifhp</b>) which is used to convert
        jobs into a suitable for a particular printer, and the the
        LPRngTool Graphic User Interface (<b class=
        "APPLICATION">lprngtool</b>) which provides a simple and
        easy to use configuration and monitoring tool for the <b
        class="APPLICATION">LPRng</b> print spooler.</p>

        <p><b class="APPLICATION">LPRng</b> mimics many of the
        features of the <i class="EMPHASIS">vintage</i> or <i
        class="EMPHASIS">legacy</i> Berkeley (University of
        California - Berkeley) Line Printer (LPR) package found on
        Berkeley derivatives of the Unix operating system. <b
        class="APPLICATION">LPRng</b> will print a document with
        little or no knowledge of the content or special processing
        required to print the document on a stand-alone machine or
        in a distributed printing environment. New (as compared to
        Berkeley LPR) features include: lightweight <b class=
        "APPLICATION">lpr</b>, <b class="APPLICATION">lpc</b> and
        <b class="APPLICATION">lprm</b> programs, dynamic
        redirection of print queues, automatic job holding, highly
        verbose diagnostics, load balancing queues; enhanced
        security (SUID not required in most environments), and easy
        configuration.</p>

        <p><b class="APPLICATION">LPRng</b> started life at the
        University of Waterloo in 1986 as PLP (Public Line
        Printer), a replacement for the original BSD <b class=
        "APPLICATION">lpd</b> code. This was a one-shot effort by
        the author, Patrick Powell, to develop freely redistributed
        code without the restrictions of the BSD/AT&amp;T license
        and would allow non-licensed sites to fix and patch
        problems. From 1988 to 1992 individuals and groups added
        features, hacked, slashed, and modified the PLP code,
        coordinated largely by Justin Mason (<tt class=
        "EMAIL">&lt;<a href=
        "mailto:jmason@iona.ie">jmason@iona.ie</a>&gt;</tt>) who
        started the <b class="APPLICATION">LPRng</b> mailing
        list.</p>

        <p>In 1992 while at San Diego State University Prof. Powell
        redesigned and reimplemented the PLP code and named the
        result <b class="APPLICATION">LPRng</b>. The goals of the
        <b class="APPLICATION">LPRng</b> project were to build a
        server system that was as close to user abuse proof as
        possible, that would provide services limited only by the
        inherent capacities of the support system, RFC1179
        compliant, and with extensive debugging capabilities to
        allow quick and easy diagnostics of problems.</p>

        <p>In 1999 the code base for <b class=
        "APPLICATION">LPRng</b> was again reorganized in order to
        provide a common method for running on non-UNIX platforms
        such as Microsoft Windows NT, Apple Rhapsody, and embedded
        systems.</p>

        <p>As a side effect of this work, many security problems
        that could develop were identified and steps taken to
        ensure that they were not present in <b class=
        "APPLICATION">LPRng</b>. For example, <b class=
        "APPLICATION">LPRng</b> clients such as lpr, lprm, lpc, and
        lpq can run as ordinary users programs, the lpd server can
        run as a non-root user once a network port has been opened,
        and all text formatting operations done by <b class=
        "APPLICATION">LPRng</b> use a very restricted and highly
        secure version of the <b class="APPLICATION">snprintf</b>
        function.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="MAILLIST">A.1.
          Documentation</a></h1>

          <p>The main <b class="APPLICATION">LPRng</b>
          documentation is the LPRng-HOWTO, which is available in
          several formats. Information about <b class=
          "APPLICATION">LPRng</b> and the latest release can be
          found on the <b class="APPLICATION">LPRng</b> web page <a
          href="http://www.lprng.com/LPRng.html" target=
          "_top">http://www.lprng.com/LPRng.html</a></p>

          <p>The <b class="APPLICATION">ifhp</b> documentation is
          the IFHP-HOWTO, which is available in the <b class=
          "APPLICATION">ifhp</b> distribution. Information about <b
          class="APPLICATION">ifhp</b> and the latest release can
          be found on the <b class="APPLICATION">LPRng</b> web page
          <a href="http://www.lprng.com/LPRng.html" target=
          "_top">http://www.lprng.com/LPRng.html</a></p>

          <p>There is also a mailing list at <a href=
          "mailto:lprng-request@lprng.com?subject=subscribe"
          target="_top">lprng@lprng.com</a>. To post to the list
          you must subscribe by sending send an email to <a href=
          "mailto:lprng-request@lprng.com?subject=subscribe"
          target="_top">lprng-request@lprng.com</a>, with the
          message subject or body containing the word `subscribe'
          or `help'.</p>

          <p>Several presentations of <b class=
          "APPLICATION">LPRng</b> and print spooling software have
          been made at the Large Installation System Administrator
          (LISA) conferences. The presentation at the LISA 98
          conference is in the PowerPoint file <tt class=
          "FILENAME">LISA98.ppt</tt> in the <b class=
          "APPLICATION">LPRng</b> distribution
          documentation.&#13;</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1548">A.2.
          Installation</a></h1>

          <p>It is recommended that installation be done from the
          source distribution, and that the files be put in the <tt
          class="FILENAME">/usr/bin</tt>, <tt class=
          "FILENAME">/usr/sbin</tt>, and <tt class=
          "FILENAME">/etc</tt> directories, as most existing
          applications require them there.</p>

          <p>Get the source code distribution from the main <b
          class="APPLICATION">LPRng</b> site or one of the mirror
          sites show in <a href="#LPRNGDIST">Section A.5</a>. The
          install using:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1557"></a>
<pre class="SCREEN">
    %&gt; gunzip -c LPRng-XXX.tgz | tar xvf -
    %&gt; cd LPRng-XXX
       <i class=
"EMPHASIS">(You might want to read the README and INSTALL files)</i>
    %&gt; ./configure --prefix=/usr --sysconfdir=/etc
       #if your OS does not support shared libraries, use:
       # ./configure --disable-shared --prefix=/usr --sysconfdir=/etc
    %&gt; make clean all
    %&gt; su
    password: xxxxx
    #&gt; make install
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1560">A.3. License</a></h1>

          <p>The <b class="APPLICATION">LPRng</b> Print Spooler and
          the ifhp Print Filter software are distributed under the
          <a href="license.txt" target="_top">GNU Public License
          (GPL) and the Artistic License</a>. Users can choose to
          redistribute or use the software under a license that is
          appropriate for their purpose. Other licenses and
          distribution agreements are available by contacting <a
          href="http://www.astart.com" target="_top">AStArt
          Technologies</a> for information.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1566">A.4. Commercial
          Support</a></h1>

          <p><a href="http://www.astart.com" target="_top">AStArt
          Technologies</a> provides commercial support and
          enhancements for the <b class="APPLICATION">LPRng</b> and
          other network software. AStArt provides network and
          system consulting services for UNIX and NT systems, as
          well as real time and network software.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="LPRNGDIST">A.5. Web Site, FTP
          Site, and Mirrors</a></h1>

          <p>Web Page: <a href="http://www.lprng.com" target=
          "_top">http://www.lprng.com</a></p>

          <p>Main FTP Site:</p>

          <table border="0">
            <tbody>
              <tr>
                <td><a href="ftp://ftp.lprng.com/pub/LPRng" target=
                "_top">ftp://ftp.lprng.com/pub/LPRng</a> (US)</td>
              </tr>
            </tbody>
          </table>
          <br>
          <br>

          <p>Mirrors:</p>

          <table border="0">
            <tbody>
              <tr>
                <td><a href=
                "ftp://ftp.cs.columbia.edu/pub/archives/pkg/LPRng"
                target=
                "_top">ftp://ftp.cs.columbia.edu/pub/archives/pkg/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.cise.ufl.edu/pub/mirrors/LPRng" target=
                "_top">ftp://ftp.cise.ufl.edu/pub/mirrors/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.cs.umn.edu/pub/LPRng"
                target="_top">ftp://ftp.cs.umn.edu/pub/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://uiarchive.uiuc.edu/pub/packages/LPRng"
                target=
                "_top">ftp://uiarchive.uiuc.edu/pub/packages/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.sage-au.org.au/pub/printing/spooler/lprng/"
                 target=
                "_top">ftp://ftp.sage-au.org.au/pub/printing/spooler/lprng/</a>
                (AU)</td>
              </tr>

              <tr>
                <td><a href="ftp://mirror.aarnet.edu.au/pub/LPRng/"
                target=
                "_top">ftp://mirror.aarnet.edu.au/pub/LPRng/</a>
                (AU/NZ)</td>
              </tr>

              <tr>
                <td><a href=
                "http://mirror.aarnet.edu.au/pub/LPRng/" target=
                "_top">http://mirror.aarnet.edu.au/pub/LPRng/</a>
                (AU/NZ)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://sunsite.ualberta.ca/pub/Mirror/LPRng"
                target=
                "_top">ftp://sunsite.ualberta.ca/pub/Mirror/LPRng</a>
                (CA)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.informatik.uni-hamburg.de/pub/os/unix/utils/LPRng"
                 target=
                "_top">ftp://ftp.informatik.uni-hamburg.de/pub/os/unix/utils/LPRng</a>
                (DE)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.uni-paderborn.de/pub/unix/printer/LPRng"
                target=
                "_top">ftp://ftp.uni-paderborn.de/pub/unix/printer/LPRng</a>
                (DE)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.mono.org/pub/LPRng" target=
                "_top">ftp://ftp.mono.org/pub/LPRng</a> (UK)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.iona.com/pub/plp/LPRng"
                target="_top">ftp://ftp.iona.com/pub/plp/LPRng</a>
                (IE)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://uabgate.uab.ericsson.se/pub/unix/LPRng"
                target=
                "_top">ftp://uabgate.uab.ericsson.se/pub/unix/LPRng</a>
                (SE)</td>
              </tr>
            </tbody>
          </table>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1607">A.6. Mailing
          List</a></h1>

          <p>To join the <b class="APPLICATION">LPRng</b> mailing
          list, please send mail to <a href=
          "mailto: lprng-request@lprng.com" target=
          "_top">lprng-request@lprng.com</a> with the word
          'subscribe' in the BODY.</p>

          <p>The <b class="APPLICATION">LPRng</b> mailing list is
          archived on <a href="http://www.findmail.com/list/lprng"
          target="_top">http://www.findmail.com/list/lprng</a></p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="FAQREF">A.7. PGP Public
          Key</a></h1>

          <p>The <b class="APPLICATION">LPRng</b> distributions
          have an MD5 checksum calculated, which is then signed
          with a PGP public key. Here is the key for validating the
          checksums:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1619"></a>
<pre class="SCREEN">
    Type Bits/KeyID    Date       User ID
    pub  1024/00D95C9D 1997/01/31 Patrick A. Powell \
       &lt;papowell@lprng.com&gt;
    
    -----BEGIN PGP PUBLIC KEY BLOCK-----
    Version: 2.6.3i
    
    mQCNAzLygTQAAAEEANBW5fPYjN3wSAnP9xWOUc3CvsMUxjip0cN2sY5qrdoJyIhn
    qbAspBopR+tGQfyp5T7C21yfWRRnfXmoJ3FVtgToAsJUYmzoSFY08eDx+rmSqCLe
    rdJjX8aG8jVXpGipEo9U4QsUK+OKzx3/y/OaK4cizoWqKvy1l4lEzDsA2VydAAUT
    tCdQYXRyaWNrIEEuIFBvd2VsbCA8cGFwb3dlbGxAYXN0YXJ0LmNvbT6JAJUDBRA0
    XonoiUTMOwDZXJ0BAQ2cBAC7zU9Fn3sC3x0USJ+3vjhg/qA+Gjb5Fi1dJd4solc4
    vJvtf0UL/1/rGipbR+A0XHpHzJUMP9ZfJzKZjaK/d0ZBNlS3i+JnypypeQiAqo9t
    FV0OyUCwDfWybgAORuAa2V6UJnAhvj/7TpxMmCApolaIb4yFyKunHa8aBxN+17Ro
    rrQlUGF0cmljayBBLiBQb3dlbGwgPHBhcG93ZWxsQHNkc3UuZWR1PokAlQMFEDLy
    gTSJRMw7ANlcnQEBYBYD/0zTeoiDNnI+NjaIei6+6z6oakqO70qFVx0FG3aP3kRH
    WlDhdtFaAuaMRh+RItHfFfcHhw5K7jiJdgKiTgGfj5Vt3OdHYkeeh/sddqgf9YnS
    tpj0u5NfrotPTUw39n6YTgS5/aW0PQfO9dx7jVUcGeod1TGXTe9mIhDMwDJI4J14
    =3Zbp
    -----END PGP PUBLIC KEY BLOCK-----
</pre>
          </div>
          <br>
          <br>
        </div>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="AEN1621">Appendix B. References and
        Standards</a></h1>

        <p>The following references and standards have been used in
        the development of the <b class="APPLICATION">LPRng</b>
        software.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1625">B.1. RFCs</a></h1>

          <p>During the early development of the Internet
          developers did not want to go through the laborious
          process of developing formal standards and applying to a
          standards body such as the EIA, IEEE, or ISO. Instead,
          they called the standards documents they developed [<span
          class="CITATION">Requests for Comments</span>]. These
          soon became <i class="EMPHASIS">de facto</i> standards,
          and with the formal acceptance of the TCP/IP protocol as
          a network standard, <i class="EMPHASIS">de jure</i> as
          well.</p>

          <p>You can get copies of the RFCs from literally hundreds
          of network sites, including <a href="http://www.isi.edu"
          target="_top">http://www.isi.edu</a>, <a href=
          "http://www.faqs.org/rfcs" target=
          "_top">http://www.faqs.org/rfcs</a>, <a href=
          "ftp://NIS.NSF.NET" target="_top">NIS.NSF.NET</a>, <a
          href="ftp://RFC.JVNC.NET" target="_top">RFC.JVNC.NET</a>,
          or <a href="ftp://FTP.ISI.EDU" target=
          "_top">FTP.ISI.EDU</a>.</p>

          <p>The [<span class="CITATION">RFC1179 - Line Printer
          Daemon Protocol</span>] describes the protocol used to
          transfer jobs from client program to print server. See <a
          href="#RFC1179REF">RFC1179</a> for more a discussion of
          this protocol and more details about the RFC. The <a
          href="rfc1179.txt" target="_top">rfc1179.txt</a> file is
          included in the <b class="APPLICATION">LPRng</b>
          distribution documentation.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="POSTSCRIPT">B.2.
          PostScript</a></h1>

          <p>PostScript is one of the <i class="EMPHASIS">de
          facto</i> standards for print jobs. The Adobe Corporation
          (<a href="http://www.adobe.com" target=
          "_top">http://www.adobe.com</a>) provides an excellent
          set of references for the PostScript language. They have
          made many of these available for downloading from their
          web sites or have published them in book form.</p>

          <p>The [<span class="CITATION">PostScript Language
          Reference Manual</span>] contains a great deal of
          technical information about the PostScript Language, and
          is the language reference manual.</p>

          <p>The [<span class="CITATION">PostScript Language
          Tutorial and Cookbook</span>] is a very nice and easy to
          read introduction to PostScript programming, and has some
          very useful utilities. Combined with <b class=
          "APPLICATION">GhostScript</b> and the <b class=
          "APPLICATION">gv</b> display program you can very easily
          learn to write your own small PostScript programs, and
          more importantly, can learn to understand the contents of
          PostScript files.</p>

          <p>The [<span class="CITATION">PostScript Language
          Program Design</span>] is the companion to the [<span
          class="CITATION">PostScript Language Tutorial and
          Cookbook</span>], and has more complex examples of
          PostScript programs. More importantly, it also
          introduces, although without explanation, the PostScript
          Document Structuring Conventions described in Appendix G
          of the The [<span class="CITATION">PostScript Language
          Reference Manual</span>]. This alone makes it useful.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="PCL">B.3. HP PCL 5</a></h1>

          <p>The Hewlett-Packard (HP) PCL Printer Language is the
          second de-facto standard for print jobs. Currently,
          Hewlett-Packard makes documentation for PCL available
          through their [<span class="CITATION">Developer
          Program</span>]. You will need to register and then
          search their site for the [<span class="CITATION">PCL 5
          Printer Language Reference Manual</span>].</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="PJL">B.4. HP PJL</a></h1>

          <p>The Hewlett-Packard (HP) Printer Job Language is used
          to control various features of HP printers. The [<span
          class="CITATION">Printer Job Language Reference
          Manual</span>] is also available from Hewlett-Packard (<a
          href="http://www.hp.com" target=
          "_top">http://www.hp.com</a>) through their [<span class=
          "CITATION">Developer Program</span>].</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN1668">B.5. PDF</a></h1>

          <p>The Portable Document Format (<tt class=
          "LITERAL">pdf</tt>) was developed by Adobe to be a more
          useful method of distributing documentation for view by
          online systems and software. The [<span class=
          "CITATION">Portable Document Format Reference
          Manual</span>] is available from Adobe (<a href=
          "http://www.adobe.com" target=
          "_top">http://www.adobe.com</a>). While <tt class=
          "LITERAL">pdf</tt> is not used directly as a print job
          language, it is one of the more common formats for files
          that need to be printed. It can be converted to
          PostScript by most <tt class="LITERAL">pdf</tt> viewers
          such as GhostScript and Adobe Acrobat.</p>
        </div>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="RFC1179REF">Appendix C. RFC 1179 - Line
        Printer Daemon Protocol</a></h1>

        <p>RFC1179 can be obtained from the <b class=
        "APPLICATION">LPRng</b> distribution, in the
        LPRng_DOC/rfc1179 directory, or from one of many sites
        which mirror the RFCs.</p>

        <p>This RFC is an <i class="EMPHASIS">informational</i>
        RFC, which means that the information in it is meant as a
        guide to users, and not as a fixed standard. In addition,
        the RFC tried to document the behavior of the BSD <b class=
        "APPLICATION">lpd</b> print server, and left out many
        details dealing with error recover, error messages,
        extensions to the protocol, etc.</p>

        <p>In this section, I will try to explain what RFC1179
        specifies as a protocol, and many of the problems
        encountered in trying to use it.</p>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="LPDPORT">C.1. Ports and
          Connections</a></h1>

          <p>Options used:</p>

          <ul>
            <li>
              <p><tt class="LITERAL">lpd_port=</tt><i class=
              "EMPHASIS">Port for <b class="APPLICATION">lpd</b> to
              accept connection</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">originate_port=</tt><i class=
              "EMPHASIS">Ports to originate connections on</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">reuse_addr</tt> FLAG <i class=
              "EMPHASIS">Set SO_REUSEADDR flag on
              connection</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">retry_econnrefused</tt> FLAG
              <i class="EMPHASIS">Retry on connect ECONNREFUSED
              error</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">retry_nolink</tt> FLAG <i
              class="EMPHASIS">Retry on device open or connection
              ffailure</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">socket_linger=</tt><i class=
              "EMPHASIS">socket linger timeout</i></p>
            </li>
          </ul>
          <br>
          <br>

          <p>RFC1179 requires that the <b class=
          "APPLICATION">lpd</b> server listen for TCP/IP
          connections on port 515. This port is registered with the
          Internet Naming Authority, and the <tt class=
          "FILENAME">/etc/services</tt> file or TCP/IP services
          database usually has an entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1716"></a>
<pre class="SCREEN">
    printer     515/tcp     spooler     # line printer spooler
</pre>
          </div>
          <br>
          <br>

          <p>RFC1179 explicitly states that all connections to port
          515 must originate from ports 721-731. The reason for
          this restriction is due to the UNIX concept of <i class=
          "EMPHASIS">reserved</i> and <i class=
          "EMPHASIS">privileged</i> ports. By convention, ports in
          the range 1-1023 can only <i class="EMPHASIS">bound</i>
          by processes whose Effective User ID (EUID) is 0 (root).
          This, ordinary users could not originate a connection
          from the reserved or privileged port range.</p>

          <p>In a UNIX environment, this means that the user
          programs <b class="APPLICATION">lpr</b>, <b class=
          "APPLICATION">lpq</b>, <b class="APPLICATION">lprm</b>,
          and <b class="APPLICATION">lpc</b> would have to be
          SETUID root.</p>

          <p>As experience has shown, for security purposes, the
          fewer programs that need to have privileged status, the
          better. <b class="APPLICATION">LPRng</b> uses the <tt
          class="LITERAL">lpd_port=printer</tt> configuration
          option to set the actual port to be use. By default, this
          is port 515, but can be set to other values.</p>

          <p>The restriction of originating ports to 721-731 causes
          another set of problems. Part of the TCP/IP protocol is
          concerned with avoiding communications problems resulting
          from the arrival of old or <i class="EMPHASIS">stale</i>
          packets. When a connection between <tt class=
          "LITERAL">sourcehost, sourceport</tt> and <tt class=
          "LITERAL">desthost, destport</tt> is made, a set of
          sequence numbers is established and used for sending and
          acknowledgement of data. When the connection terminates,
          the TCP/IP protocol restricts the establishment of a new
          connection between <tt class="LITERAL">sourcehost,
          sourceport</tt> and <tt class="LITERAL">desthost,
          destport</tt> for a period long enough for all <i class=
          "EMPHASIS">stale</i> packets to be removed from the
          system. This is approximately 10 minutes long.</p>

          <p>In order to simplify assignments of ports, timing out
          connections, and other matters, many TCP/IP packages do
          keep track of explicit connections <i class=
          "EMPHASIS">originating</i> from a port, but simply
          prevent the port from being reused for either origination
          or reception of a connection. They do, however, keep
          track of the active connections <i class=
          "EMPHASIS">to</i> a port, and perform timeouts on these.
          This is usually much simpler to implement, as it can be
          done with a list attached to the port.</p>

          <p>This implementation method creates some problems when
          a large number of connections must be originated from a
          relatively small number of port numbers. Observe what
          happens when host 1 tries to send a large number of jobs
          to a server 2. The following connections are established
          and terminated: <tt class="LITERAL">host 1, port 721</tt>
          and <tt class="LITERAL">host 2, port 515</tt> <tt class=
          "LITERAL">host 1, port 722</tt> and <tt class=
          "LITERAL">host 2, port 515</tt> <tt class="LITERAL">host
          1, port 723</tt> and <tt class="LITERAL">host 2, port
          515</tt> <tt class="LITERAL">host 1, port 724</tt> and
          <tt class="LITERAL">host 2, port 515</tt> <tt class=
          "LITERAL">host 1, port 725</tt> and <tt class=
          "LITERAL">host 2, port 515</tt> <tt class="LITERAL">host
          1, port 726</tt> and <tt class="LITERAL">host 2, port
          515</tt> <tt class="LITERAL">host 1, port 727</tt> and
          <tt class="LITERAL">host 2, port 515</tt> <tt class=
          "LITERAL">host 1, port 728</tt> and <tt class=
          "LITERAL">host 2, port 515</tt> <tt class="LITERAL">host
          1, port 729</tt> and <tt class="LITERAL">host 2, port
          515</tt> <tt class="LITERAL">host 1, port 730</tt> and
          <tt class="LITERAL">host 2, port 515</tt> <tt class=
          "LITERAL">host 1, port 731</tt> and <tt class=
          "LITERAL">host 2, port 515</tt></p>

          <p>Now according to the RFC1179 rules and the TCP/IP
          protocol, we will have to wait until one of these
          connections terminates before we can make another. On the
          originating system, if the TCP/IP implementation does
          timeouts on the originating port, we will have to wait
          for the timeout to elapse before we can make a new
          connection. Unfortunately, there is no way to find out
          what the status of the port is, so we will have to try
          them each in turn until we get a successful
          connection.</p>

          <p>The <b class="APPLICATION">LPRng</b> code has tried to
          provide several methods to deal with these problems.
          Firstly, the <tt class="LITERAL">originate_port=512
          1023</tt> option specifies the range of ports used to
          originate connections when the software is running either
          as ROOT or SETUID root. By strict RFC1179 rules, this
          should be <tt class="LITERAL">originate_port=721
          731</tt>, but it turns out that most BSD <b class=
          "APPLICATION">lpd</b> based implementations only check
          for a <i class="EMPHASIS">reserved</i> originating port.
          By using 512 ports we get a greatly reduced rate of
          errors due to lack of ports due to pending timeouts.</p>

          <p>However, on some systems which are acting as servers
          for a large number of printers even increasing this port
          range is insufficient, and steps need to be taken use the
          originating port numbers more efficiently. The Berkeley
          TCP/IP implementation <tt class=
          "FUNCTION">getsockopt()</tt> and <tt class=
          "FUNCTION">setsockopt()</tt> allows the user to
          manipulate some of the underlying timeouts and options of
          the TCP/IP network. When a TCP/IP connection is
          established, the <tt class="FUNCTION">setsockopt()</tt>
          facility can be used to set the <tt class=
          "LITERAL">SO_REUSEADDR</tt> flag on the connection. This
          flag effectively sets the timeout value on the ports and
          connections to 0, allowing immediate reuse of the ports.
          When done on an originating end of a connection, this
          will allow the originating port number to be reused
          immediately.</p>

          <p>It would appear that by setting <tt class=
          "LITERAL">SO_REUSEADDR</tt> on the originating end that
          we have solved our problems. However, unless the
          destination end of the connection sets its <tt class=
          "LITERAL">SO_REUSEADDR</tt> flag on the connection, it
          will still do a timeout. Thus when we try to make a
          connection from a port that was active within a short
          period of time to the same host, then it will reject the
          connection until the timeout is over.</p>

          <p>The <tt class="LITERAL">reuse_addr</tt> flag (default
          off) forces the <b class="APPLICATION">LPRng</b> software
          to set the <tt class="LITERAL">SO_REUSEADDR</tt> flag on
          originating connections. As indicated, this will allow
          ports to be reused immediately for outgoing connections,
          rather than waiting for a timeout.</p>

          <p>While the <tt class="LITERAL">reuse_addr</tt> flag
          usually allows us to reuse ports, there is still the
          problem of dealing with connections failing due to the
          remote site rejecting the connection due to a pending
          timeout from a previous connection. A careful study of
          the original BSD TCP/IP network code and of some others
          indicates that when a connection fails due to a pending
          timeout, an ECONNREFUSED error code is returned to a <tt
          class="FUNCTION">connect()</tt> system call. If this
          happens and we suspect that the remote site is rejecting
          the connection due to a timeout problem, then we should
          retry making the connection but from a new port, and
          continue retrying until all possible ports are used.</p>

          <p>The <tt class="LITERAL">retry_econnrefused</tt>
          (default on) flag is used to specify that we retry
          connections in this manner. When this is set, a <tt
          class="LITERAL">connection refused</tt> error causes the
          connection to be retried using a new port. This will be
          repeated until all available ports have been tried.</p>

          <p>When printing a job and the <b class=
          "APPLICATION">lpd</b> server connection to a remote site
          or device open fails, the <tt class=
          "LITERAL">retry_nolink</tt> (default on) will cause the
          attempt to be retried indefinitely. The combination of
          <tt class="LITERAL">retry_econnrefused</tt> and <tt
          class="LITERAL">retry_nolink</tt> will provide robust
          connection attempts to remote systems.</p>

          <p>While the above problems cause difficulties when
          making connections, there are also problems when
          terminating connections. After closing a socket, the
          TCP/IP software will try to flush any pending data to the
          destination. Unfortunately, on some systems it will only
          do this while the process is active. This has caused
          problems on systems which terminate a process it has
          received an abnormal (signal caused) termination.</p>

          <p>The <tt class="FUNCTION">setsockopt()</tt> SO_LINGER
          option allows the user to specify that when a socket is
          closed normally, that the process should block until
          pending data is flushed or for the <tt class=
          "LITERAL">socket_linger</tt> period. If <tt class=
          "LITERAL">socket_linger</tt> is 0, then no SO_LINGER
          operation is done.</p>

          <p>In summary, if you experience problems with connection
          failures due to port exhaustion, first try setting the
          <tt class="LITERAL">reuse_port</tt> flag, and you should
          see a reduction. Check to ensure that the <tt class=
          "LITERAL">retry_econnrefused</tt> and <tt class=
          "LITERAL">retry_nolink</tt> flags are set, and the error
          code in the log and status files. If the failures
          continue, then the problem is caused by the remote end
          having timeout limitations and there is little you can do
          except to set a very long <tt class=
          "LITERAL">connect_retry</tt> interval, say <tt class=
          "LITERAL">connect_retry=120</tt> (2 minutes).</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="REMOTESUPPORT">C.2. Protocol
          Requests and Replies</a></h1>

          <p>Options used:</p>

          <ul>
            <li>
              <p><tt class="LITERAL">remote_support=</tt><i class=
              "EMPHASIS">Remote operations supported</i></p>
            </li>
          </ul>
          <br>
          <br>

          <p>After a connection has been established, a request can
          be sent to the <b class="APPLICATION">lpd</b> server. The
          request consists of a single octet indicating the request
          type, followed by the printer (or print queue) name,
          followed by a set of options for the request, followed by
          a LF (line feed) character.</p>

          <div class="TABLE">
            <a name="RF1179COMMANDS"></a>

            <p><b>Table C-1. RFC1179 Commands</b></p>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">NNN</th>

                  <th align="LEFT" valign="TOP">RFC1179</th>

                  <th align="LEFT" valign="TOP">Operation</th>

                  <th align="LEFT" valign="TOP">program</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">1</td>

                  <td align="LEFT" valign="TOP">yes</td>

                  <td align="LEFT" valign="TOP">start print</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">2</td>

                  <td align="LEFT" valign="TOP">yes</td>

                  <td align="LEFT" valign="TOP">transfer a printer
                  job</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">3</td>

                  <td align="LEFT" valign="TOP">yes</td>

                  <td align="LEFT" valign="TOP">print short form of
                  queue status</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">4</td>

                  <td align="LEFT" valign="TOP">yes</td>

                  <td align="LEFT" valign="TOP">print long form of
                  queue status</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">5</td>

                  <td align="LEFT" valign="TOP">yes</td>

                  <td align="LEFT" valign="TOP">remove jobs</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lprm</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">6</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">do control
                  operation</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">7</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">transfer a block
                  format print job</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">8</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">secure command
                  transfer</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">9</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">verbose status
                  information</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpr</b></td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>After the request has been sent, then a reply will be
          returned. In general the reply has the following
          form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1883"></a>
<pre class="SCREEN">
    \000\n    Success
    \NNN\n    Failure (NNN is error code)
    text\n    Text or status information
</pre>
          </div>
          <br>
          <br>

          <p>As can be seen, this protocol is extremely simple, but
          there are a set of problems due to the loosely written
          language of RFC1179.</p>

          <ol type="1">
            <li>
              <p>Firstly, while RFC1179 sets limits on the lengths
              of commands, it does not strictly set limits on the
              characters set used in the commands. This can result
              in problems when trying to print status information,
              headers on banners, and other details.</p>
            </li>

            <li>
              <p>The original RFC1179 protocol did not provide any
              way to do remote control of queues or <b class=
              "APPLICATION">lpd</b> servers. This has been added to
              the protocol. As a side effect, if you try to use <b
              class="APPLICATION">lpc</b> to control a non-<b
              class="APPLICATION">LPRng</b> printer, it will not
              work.</p>
            </li>

            <li>
              <p>You can specify that a network printer is non-<b
              class="APPLICATION">LPRng</b> by using the <tt class=
              "LITERAL">remote_support=RQVMC</tt> option and
              specify the operations supported by the printer. The
              letters R, Q, M, and C stand for <b class=
              "APPLICATION">lpr</b>, <b class=
              "APPLICATION">lpq</b>, <b class=
              "APPLICATION">lprm</b>, and <b class=
              "APPLICATION">lpc</b> operations respectively, and
              indicate that these are supported. If <tt class=
              "LITERAL">remote_support</tt> does not allow a
              particular operation, then the <b class=
              "APPLICATION">LPRng</b> software will not send a
              corresponding request to the printer. For example,
              <tt class="LITERAL">remote_support=R</tt> would
              restrict operations to spooling jobs only, and the <b
              class="APPLICATION">LPRng</b> software would not
              query the printer for status.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="JOBTRANSFER">C.3. Job
          Transfer</a></h1>

          <p>Options used:</p>

          <ul>
            <li>
              <p><tt class="LITERAL">longnumber</tt> FLAG <i class=
              "EMPHASIS">Long job number (6 digits)</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">send_data_first</tt> FLAG <i
              class="EMPHASIS">Send data files first</i></p>
            </li>

            <li>
              <p><tt class="LITERAL">use_shorthost</tt><i class=
              "EMPHASIS">Use short hostname</i></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A job transfer operation starts with a job transfer
          request, followed by several file transfer operations. At
          the end of the file transfers, the connection should be
          closed.</p>

          <p>A file transfer request has the form:</p>

          <div class="INFORMALTABLE">
            <a name="AEN1924"></a>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Command</th>

                  <th align="LEFT" valign="TOP">Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">\001\n</td>

                  <td align="LEFT" valign="TOP">abort</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\002nnnn
                  cfname</td>

                  <td align="LEFT" valign="TOP">control file
                  transfer</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\003nnnn
                  dfname</td>

                  <td align="LEFT" valign="TOP">data file
                  transfer</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>The abort operation is used to terminate job transfer
          and indicate that the job should not be processed for
          printing. The connection will be closed and the partly
          transferred job will be discarded.</p>

          <p>The control file and data file transfer commands have
          a length (in bytes) of the file and the name of the file
          to be transferred. When the command is received, the
          server will reply with a status line:</p>

          <div class="INFORMALTABLE">
            <a name="AEN1942"></a>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Status</th>

                  <th align="LEFT" valign="TOP">Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">\000</td>

                  <td align="LEFT" valign="TOP">Accepted,
                  proceed</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\nnn</td>

                  <td align="LEFT" valign="TOP">Rejected with error
                  code</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>The reply is only a single octet. Some defective
          implementations of RFC1179 send a LF after the octet,
          which makes life very difficult. <b class=
          "APPLICATION">LPRng</b> makes an effort to detect these
          non-conforming RFC1179 systems and will accept jobs from
          them. However, it will not send jobs to them.</p>

          <p>If <b class="APPLICATION">LPRng</b> sends a reject
          code, as an extension to RFC1179 it also sends an error
          message. Note that the values for error codes are not
          defined, nor are their causes. <b class=
          "APPLICATION">LPRng</b> uses the following values for
          error codes, which appear to be compatible with many, but
          not all, of the BSD <b class="APPLICATION">lpd</b> based
          systems:</p>

          <div class="INFORMALTABLE">
            <a name="AEN1961"></a>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Code</th>

                  <th align="LEFT" valign="TOP">Error</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">\000</td>

                  <td align="LEFT" valign="TOP">Accepted,
                  proceed</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\001</td>

                  <td align="LEFT" valign="TOP">Queue not accepting
                  jobs</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\002</td>

                  <td align="LEFT" valign="TOP">Queue temporarily
                  full, retry later</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">\003</td>

                  <td align="LEFT" valign="TOP">Bad job format, do
                  not retry</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>When the sender gets the reply indicating success, it
          sends the <tt class="LITERAL">nnnn</tt> bytes of the
          control or data file, followed by a <tt class=
          "LITERAL">\000</tt> octet. The receiver will then reply
          as above; a single <tt class="LITERAL">\000</tt> octet
          indicating success.</p>

          <p>The above procedure is carried out until all data
          files and the control file of a job are transferred.</p>

          <p>RFC1179 is silent on the following issues:</p>

          <ol type="1">
            <li>
              <p>When sending a job, do you send the control file
              first, followed by the data file(s), or the data
              files first?</p>
            </li>

            <li>
              <p>When sending multiple jobs, can you send them on a
              single connection, or do you have to establish a new
              connection for each job?</p>
            </li>
          </ol>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> will <i class=
          "EMPHASIS">accept</i> jobs whether they are sent control
          or data files first. By default, it sends the control
          file first, followed by the data file. If the destination
          system requires that the data files be sent first, the
          <tt class="LITERAL">send_data_first</tt> printcap option
          can be used to force data files to be sent first.</p>

          <p>RFC1179 states that: <a name="AEN1996"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>The name of the control file ... should start with
            ASCII "cfA", followed by a three digit job number,
            followed by the host name which has constructed the
            control file.</p>
          </blockquote>
          <br>
          <br>

          <p>The <i class="EMPHASIS">should</i> in this wording
          indicates that this is simply a guideline, and that other
          formats are possible. Some of the major problems with
          this format are as follows:</p>

          <ol type="1">
            <li>
              <p>The restriction to 3 digits means that at most
              1000 jobs can be in a queue. Strangely, some systems
              generate far more than 1000 jobs a day, and need to
              archive them on a regular basis. The <tt class=
              "LITERAL">longnumber</tt> option will allow <b class=
              "APPLICATION">LPRng</b> to use a 6 digit job number
              for files in the print queue.</p>
            </li>

            <li>
              <p>The host name format is not specified. Some
              implementations consider that this is the short host
              name, while others think it is the fully qualified
              domain name (FQDN). <b class="APPLICATION">LPRng</b>,
              by default, will use the FQDN host name. However, the
              <tt class="LITERAL">use_shorthost</tt> option will
              force it to use short host names in control and data
              files.</p>
            </li>

            <li>
              <p>The <tt class="LITERAL">cfA</tt> control file name
              was modified to allow the job priority to be used as
              the A letter of the control file. By default, this is
              A (lowest, i.e. <tt class="LITERAL">cfA</tt>) and but
              can range to Z (highest, i.e. <tt class=
              "LITERAL">cfZ</tt>). All known spoolers except <b
              class="APPLICATION">LPRng</b> seem to ignore the
              actual value of the letter.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN2015">C.4. Data File
          Transfer</a></h1>

          <p>As mentioned before a data file is transferred using
          the command below.</p>

          <div class="INFORMALTABLE">
            <a name="AEN2018"></a>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Command</th>

                  <th align="LEFT" valign="TOP">Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">\003nnnn
                  dfname</td>

                  <td align="LEFT" valign="TOP">data file
                  transfer</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>From RFC1179: <a name="AEN2029"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>The data file may contain any 8 bit values at all.
            The total number of bytes in the stream may be sent as
            the first operand, otherwise the field should be
            cleared to 0. The name of the data file should start
            with ASCII "dfA". This should be followed by a three
            digit job number. The job number should be followed by
            the host name which has constructed the data file.
            Interpretation of the contents of the data file is
            determined by the contents of the corresponding control
            file.</p>
          </blockquote>
          <br>
          <br>

          <p>There are several surprises in RFC1179.</p>

          <ol type="1">
            <li>
              <p>Apparently a job should only consist of a single
              data file. This is a severe limitation, and in fact
              the BSD <b class="APPLICATION">lpr</b> and other
              print spoolers process jobs with multiple data files.
              By convention, these data files have names of the
              form <tt class="LITERAL">dfA</tt>, <tt class=
              "LITERAL">dfB</tt>, ... <tt class="LITERAL">dfZ</tt>,
              <tt class="LITERAL">dfa</tt>, <tt class=
              "LITERAL">dfz</tt>.</p>
            </li>

            <li>
              <p>The RFC does not specify that the control file and
              data file job numbers must be identical. Most
              implementations follow this convention, which
              simplifies life tremendously.</p>
            </li>

            <li>
              <p>The RFC does not specify that the control file and
              data file job host names must be identical. Most
              implementations follow this convention, which
              simplifies life tremendously.</p>
            </li>

            <li>
              <p>A zero length data file does not cause a data
              transfer to take place. <b class=
              "APPLICATION">LPRng</b> modifies this action to be
              slightly different. When a zero length data file
              transfer is indicated, all of the input until the
              connection is closed is used as the contents of the
              data file.</p>

              <p>When <i class="EMPHASIS">piping</i> into the <b
              class="APPLICATION">lpr</b> program, this can be very
              useful as it eliminates the need to create temporary
              files on the local host. Note that some print
              spoolers do not use this interpretation, and this
              option should be used carefully.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN2051">C.5. Control File
          Contents</a></h1>

          <p>The control file consists of a set of lines which
          either provide printing information or specify data files
          to be printed. The information lines start with upper
          case letters or digits, while the data files lines start
          with lower case letters. Here is a sample control
          file:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2054"></a>
<pre class="SCREEN">
    Hh4.private
    J(stdin)
    CA
    Lpapowell
    Apapowell@h4+955
    Ppapowell
    fdfA955h4.private
    N(stdin)
    UdfA955h4.private
</pre>
          </div>
          <br>
          <br>

          <p>The following are the letters and their meanings in
          the control file.</p>

          <div class="TABLE">
            <a name="CFLINES"></a>

            <p><b>Table C-2. Control File Lines and Purpose</b></p>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Letter</th>

                  <th align="LEFT" valign="TOP">Defined</th>

                  <th align="LEFT" valign="TOP">Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">A</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">Identifier for
                  job</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">C</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Class for banner
                  page</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">H</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Host name</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">I</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Indent
                  Printing</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">J</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Job name for banner
                  page</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">L</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print banner
                  page</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">M</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Mail When
                  Printed</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">N</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Name of source
                  file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">P</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">User
                  identification</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">Q</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">Queue name</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">R</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">Accounting
                  info</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">S</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Symbolic link
                  data</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">T</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Title for pr</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">U</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Unlink data
                  file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">W</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Width of
                  output</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">Z</td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">LPRng</b></td>

                  <td align="LEFT" valign="TOP">Filter options</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">1</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">troff R font</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">2</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">troff I font</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">3</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">troff B font</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">4</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">troff S font</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">c</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Plot CIF file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">d</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print DVI file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">f</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print formatted
                  file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">g</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Plot file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">k</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Reserved for use by
                  Kerberized <b class="APPLICATION">LPRng</b>
                  clients and servers.</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">l</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print file leaving
                  control characters</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">n</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print ditroff
                  output file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">o</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print Postscript
                  output file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">p</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print file with
                  'pr' format</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">t</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print troff output
                  file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">v</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Print raster
                  file</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP">z</td>

                  <td align="LEFT" valign="TOP">RFC1179</td>

                  <td align="LEFT" valign="TOP">Reserved for future
                  use with the Palladium print system.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>The <tt class="LITERAL">A</tt> (Identifier) line was
          introduced to record a unique system wide job identifier
          for <b class="APPLICATION">LPRng</b> submitted jobs. This
          is basically formed from the user name, job number, and
          host at the time of submission. For example: <tt class=
          "LITERAL">papowell@h4+955</tt> is job number 995
          submitted by papowell from host h4.</p>

          <p>The <tt class="LITERAL">C</tt> (Class) line is set by
          the <tt class="COMMAND">lpr -C class</tt> option, and the
          value can be used to control printing. For example, the
          <tt class="COMMAND">lpc class zone</tt> command would
          restrict job printing to only jobs with class <tt class=
          "LITERAL">zone</tt>.</p>

          <p>The <tt class="LITERAL">H</tt> (hostname), <tt class=
          "LITERAL">P</tt> (username), and <tt class=
          "LITERAL">J</tt> (jobname) fields are used to identify
          the host and user which sent the job, and to provide
          information to be displayed by <b class=
          "APPLICATION">lpq</b> when reporting job status.</p>

          <p>The <tt class="LITERAL">L</tt> (print banner page)
          field is one that has caused many problems for users.
          RFC1179 indicates that its presence causes the banner
          page to be printed, and its absence suppresses banner
          pages. The <tt class="COMMAND">lpr -h</tt> option
          suppresses putting this line into the control file.
          Usually the <tt class="LITERAL">L</tt> field is a
          duplicate of the <tt class="LITERAL">P</tt> field.</p>

          <p>The <tt class="LITERAL">M</tt> (mail information)
          field supplies a mail address for <b class=
          "APPLICATION">LPRng</b> to send mail to when a job is
          completed.</p>

          <p>The <tt class="LITERAL">N</tt> (file name) field is
          usually provided to identify the file name corresponding
          to the data file. This can be used to print names on page
          separators, etc. <b class="APPLICATION">LPRng</b> largely
          ignores this line.</p>

          <p>The <tt class="LITERAL">I</tt> (indent) and <tt class=
          "LITERAL">W</tt> (width) fields are supposed to specify a
          page indent and width for printing. These fields are
          passed to filters if they are present.</p>

          <p>The <tt class="LITERAL">Q</tt> (queue name) field is
          an <b class="APPLICATION">LPRng</b> extension, and
          contains the name of the print queue the job was
          originally sent to.&#13;</p>

          <p>The <tt class="LITERAL">R</tt> (accounting info) field
          was added by <b class="APPLICATION">LPRng</b> to allow a
          specified account to be billed for job printing. The <tt
          class="COMMAND">lpr -Rname</tt> option can be used to
          specify the accounting name.</p>

          <p>The <tt class="LITERAL">S</tt> (symbolic link) and <tt
          class="LITERAL">U</tt> (unlink after printing) lines were
          used by the original BSD <b class="APPLICATION">lpd</b>
          print system to control how it passed files to the print
          server. <b class="APPLICATION">LPRng</b> ignores these
          lines. In fact, it will remove <tt class="LITERAL">S</tt>
          lines and force the <tt class="LITERAL">U</tt> lines to
          refer only to job data files. This closes a nasty
          security loophole on non-<b class="APPLICATION">LPRng</b>
          print spoolers.</p>

          <p>The <tt class="LITERAL">T</tt> (pr job title) is used
          with the <tt class="COMMAND">lpr -p</tt> operation to
          supply a banner to the <tt class="LITERAL">pr</tt>
          program.</p>

          <p>The <tt class="LITERAL">Z</tt> (filter options) value
          is specified with <tt class="COMMAND">lpr -Zoption</tt>
          and is passed to the data file filters during the
          printing operation.</p>

          <p>All of the lower case letters are reserved for format
          specifications for data files. In the control file, these
          are followed by the name of the data file to which they
          correspond. While in principle different data files in
          the control file can have different formats, this has not
          been implemented in any known spooling system.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN2250">C.6. <b class=
          "APPLICATION">lpq</b> Requests</a></h1>

          <p>The RFC1179 protocol specifies that <b class=
          "APPLICATION">lpq</b> print status requests can be sent
          to the <b class="APPLICATION">lpd</b> server. The lpq
          requests have the format:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2256"></a>
<pre class="SCREEN">
    \003printer [id]* \n    short
    \004printer [id]* \n    long
    \009printer [id]* \n    <b class=
"APPLICATION">LPRng</b> extension- verbose
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> print server will
          then return queue status and close the data
          connection.</p>

          <p>RFC1179 does not state in any manner what the format
          of the queue status should be. Thus, implementors have
          been free to augment or change the status as they like.
          Even the BSD <b class="APPLICATION">lpq</b> status format
          has been changed from different versions.</p>

          <p>The <tt class="LITERAL">id</tt> values are used to
          select the jobs to be displayed. <b class=
          "APPLICATION">LPRng</b> displays any job whose ID,
          hostname, or user name information from the control file
          <tt class="LITERAL">A</tt>, <tt class="LITERAL">H</tt>,
          or <tt class="LITERAL">P</tt> fields match any of the id
          values.</p>

          <p>Note that since there is no identification of the
          information requestor, then restriction of information is
          almost impossible.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN2270">C.7. <b class=
          "APPLICATION">lprm</b> Requests</a></h1>

          <p>The RFC1179 protocol specifies that <b class=
          "APPLICATION">lprm</b> job removal requests can be sent
          to the <b class="APPLICATION">lpd</b> server. The lpq
          requests have the format:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2276"></a>
<pre class="SCREEN">
    \005printer user [id]* \n
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> print server will
          search the specified print queue and remove any job whose
          ID, hostname, or user name information from the control
          file <tt class="LITERAL">A</tt>, <tt class=
          "LITERAL">H</tt>, or <tt class="LITERAL">P</tt> fields
          match any of the id values and for which the user has
          permission to perform a removal operation.</p>

          <p>Most RFC1179 compatible spoolers use the user
          information in the request as the name of the user which
          spooled the job. However, in a network environment this
          is extremely easy to fabricate, and is at best a weak
          type of authentication.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="LPCREREAD">C.8. LPC
          Requests</a></h1>

          <p><b class="APPLICATION">LPRng</b> has extended the
          RFC1179 protocol to allow queue and printer control
          commands to be sent to the <b class="APPLICATION">lpd</b>
          server. The format of these commands are:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2290"></a>
<pre class="SCREEN">
    \006printer user key [options]
</pre>
          </div>
          <br>
          <br>

          <p>The following commands are supported.</p>

          <div class="TABLE">
            <a name="LPCCOMMANDS"></a>

            <p><b>Table C-3. LPC Commands</b></p>

            <table border="1" class="CALSTABLE">
              <thead>
                <tr>
                  <th align="LEFT" valign="TOP">Command</th>

                  <th align="LEFT" valign="TOP">Operation</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td align="LEFT" valign="TOP">Command</td>

                  <td align="LEFT" valign="TOP">Operation</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">active [printer[@host]]</tt></td>

                  <td align="LEFT" valign="TOP">check to see if
                  server accepting connections</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">abort (printer[@host] | all)</tt> </td>

                  <td align="LEFT" valign="TOP">terminate server
                  process printing job</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">disable (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">disable
                  queueing</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">debug (printer[@host] | all)
                  debugparms</tt> </td>

                  <td align="LEFT" valign="TOP">set debug level for
                  printer</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">enable (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">enable
                  queueing</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">hold (printer[@host] | all)
                  (name[@host] | job | all)*</tt> </td>

                  <td align="LEFT" valign="TOP">hold job</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">holdall (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">hold all jobs
                  on</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">kill (printer[@host] | all)</tt> </td>

                  <td align="LEFT" valign="TOP">stop and restart
                  server</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">lpd [printer[@host]]</tt> </td>

                  <td align="LEFT" valign="TOP">get <b class=
                  "APPLICATION">lpd</b> PID for server</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">lpq (printer[@host] | all) (name[@host]
                  | job | all)*</tt> </td>

                  <td align="LEFT" valign="TOP">invoke <b class=
                  "APPLICATION">lpq</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">lprm (printer[@host] | all)
                  (name[@host]|host|job| all)*</tt> </td>

                  <td align="LEFT" valign="TOP">invoke <b class=
                  "APPLICATION">lprm</b></td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">move printer (user|jobid)* target</tt>
                  </td>

                  <td align="LEFT" valign="TOP">move jobs to new
                  queue</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">noholdall (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">hold all jobs
                  off</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">printcap (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">report printcap
                  values</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">quit</tt> </td>

                  <td align="LEFT" valign="TOP">exit LPC</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">redirect (printer[@host] | all)
                  (printer@host | off )*</tt> </td>

                  <td align="LEFT" valign="TOP">redirect jobs</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">release (printer[@host] | all)
                  (name[@host] | job | all)*</tt> </td>

                  <td align="LEFT" valign="TOP">release job</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">reread [printer[@host]]</tt></td>

                  <td align="LEFT" valign="TOP"><b class=
                  "APPLICATION">lpd</b> reread database
                  information</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">start (printer[@host] | all)</tt> </td>

                  <td align="LEFT" valign="TOP">start printing</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">status (printer[@host] | all)</tt>
                  </td>

                  <td align="LEFT" valign="TOP">status of
                  printers</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">stop (printer[@host] | all)</tt> </td>

                  <td align="LEFT" valign="TOP">stop printing</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">topq (printer[@host] | all)
                  (name[@host] | job | all)*</tt> </td>

                  <td align="LEFT" valign="TOP">reorder job</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">defaultq</tt> </td>

                  <td align="LEFT" valign="TOP">default queue for
                  <b class="APPLICATION">lpd</b> server</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">local (printer | all)</tt> </td>

                  <td align="LEFT" valign="TOP">client printcap and
                  configuration information</td>
                </tr>

                <tr>
                  <td align="LEFT" valign="TOP"><tt class=
                  "LITERAL">server (printer | all)</tt> </td>

                  <td align="LEFT" valign="TOP">server printcap and
                  configuration information</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>Many of these commands support extremely specialized
          operations for print queue management, However, the
          following are the most commonly used and are supported by
          the BSD <b class="APPLICATION">lpd</b> print spooling
          system as well:</p>

          <ul>
            <li>
              <p><tt class="LITERAL">start, stop, enable,
              disable</tt> Start and stop will start and stop
              printing for a specified queue. Enable and disable
              enable and disable sending and/or accepting jobs for
              the queue.</p>
            </li>

            <li>
              <p><tt class="LITERAL">abort, kill</tt> Abort will
              cause the process doing the actual job printing to be
              terminated. Kill does an abort, and then restarts the
              printing process. These commands are used to restart
              a queue printing after some disaster.</p>
            </li>

            <li>
              <p><tt class="LITERAL">topq</tt> Places selected jobs
              at the top of the print queue.</p>
            </li>

            <li>
              <p><tt class="LITERAL">status</tt> Shows a status
              display of the print spools on the server.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The following commands are extensions to the basic set
          provided by the BSD <b class="APPLICATION">lpd</b>
          system.</p>

          <ul>
            <li>
              <p><tt class="LITERAL">lpq, lprm</tt> Invokes the lpq
              or lprm program from lpc. Useful when in the
              interactive mode.</p>
            </li>

            <li>
              <p><tt class="LITERAL">hold, holdall, release</tt>
              The hold command will cause the selected jobs to be
              held until released. The holdall jobs sets all jobs
              submitted to the queue to be held until released. The
              release command releases jobs for printing. If a job
              has had an error and is in the error state, the
              release command will cause it to be reprinted.</p>
            </li>

            <li>
              <p><tt class="LITERAL">move, redirect</tt> The move
              command will move selected jobs to the specified
              spool queue. The redirect command sends all jobs
              submitted to the queue to be sent to the specified
              queue.</p>
            </li>

            <li>
              <p><tt class="LITERAL">active, lpd, reread</tt> The
              active command will connect to the server for the
              printer. This is used to check to see if non-<b
              class="APPLICATION">LPRng</b> print servers are
              active. The lpd command will connect to the server
              and get the process id (PID) of the <b class=
              "APPLICATION">lpd</b> server. The reread command
              causes a SIGHUP signal to be sent to the lpd process,
              causing it to reread the <tt class=
              "FILENAME">lpd.conf</tt>, <tt class=
              "FILENAME">printcap</tt>, and <tt class=
              "FILENAME">lpd.perms</tt> files. This is done when
              configuration information has been modified and the
              administrator wants to have the server use the new
              information.</p>
            </li>

            <li>
              <p><tt class="LITERAL">debug</tt> This is a
              desperation facility for developers that allows
              dynamic enabling of debug information generation. Not
              normally used in general operation.</p>
            </li>

            <li>
              <p><tt class="LITERAL">local, server</tt> These
              commands will print out the configuration information
              in the local <tt class="FILENAME">lpd.conf</tt> file,
              as well as the printcap information for the specified
              printers; <tt class="LITERAL">client</tt> prints what
              the <b class="APPLICATION">LPRng</b> clients (<tt
              class="LITERAL">lpr, lpq, ...</tt>) would use while
              <tt class="LITERAL">server</tt> prints what the <b
              class="APPLICATION">LPRng</b> server (<b class=
              "APPLICATION">lpd</b>) would use if running on this
              host. This is an extremely useful diagnostic tool for
              administrators. Not normally used in general
              operation.</p>
            </li>
          </ul>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="SENDBLOCKFORMAT">C.9. Block
          Job Transfer</a></h1>

          <p>Options used:</p>

          <ul>
            <li>
              <p><tt class="LITERAL">send_block_format</tt> FLAG <i
              class="EMPHASIS">Transfer job as a block</i></p>
            </li>
          </ul>
          <br>
          <br>

          <p>In normal job transfer operations, the sender and
          receiver have a handshake interaction in order to
          transfer a print job. Each file is sent individually. The
          <tt class="LITERAL">send_block_format</tt> option forces
          a Block Job Transfer operation. This causes the sender to
          transfer a single file containing all the job printing
          information, including control file and data files.</p>

          <p>The transfer command line has the form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2468"></a>
<pre class="SCREEN">
    \007printer size\n
</pre>
          </div>
          <br>
          <br>

          <p>The receiver will return any acknowledgement of a
          single 0 octet, and then the size bytes of the job will
          be transferred by the sender. At the end of the transfer
          a single 0 octet is added, and the receiver will indicate
          success by returning a single 0 octet. Any other value
          returned by the receiver indicates an error
          condition.</p>

          <p>The file transferred by the sender is simply the
          command lines that it would have normally sent for job
          transfer, followed by the control or data file
          values.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h1 class="SECT1"><a name="AEN2472">C.10. Authenticated
          Transfer</a></h1>

          <p>RFC1179 does not provide any authentication or
          encryption mechanism for the transfer of jobs or commands
          to the <b class="APPLICATION">lpd</b> print server. The
          Authenticated Transfer operation was added to allow an
          encrypted or authenticated transfer of print jobs or
          commands.</p>

          <p>Since there are various restrictions on the
          incorporation of authentication facilities into programs,
          <b class="APPLICATION">LPRng</b> supports authentication
          by providing a simple interface to encryption
          programs.</p>

          <p>The idea is that when authentication is required when
          sending a job, <b class="APPLICATION">LPRng</b> will
          generate a block transfer job as described for the <a
          href="#SENDBLOCKFORMAT">Block Job Transfer</a> operation,
          and then invoke a set of programs to encryt and transfer
          the file, and encrypt and transfer the returned
          status.</p>

          <p>Similarly, when sending a command, the command
          information will be placed in a file and the encrypted
          file will be transferred.</p>

          <p>This technique means that the programs and support to
          do encryption are external to <b class=
          "APPLICATION">LPRng</b>, and can use any type of method
          that they choose to implement the secure and/or
          authenticated transfer.</p>
        </div>
      </div>
    </div>
    <hr>
  </body>
</html>

