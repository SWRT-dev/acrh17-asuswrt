<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta name="generator" content="HTML Tidy, see www.w3.org">
    <title>LPRng Reference Manual</title>
    <meta name="GENERATOR" content=
    "Modular DocBook HTML Stylesheet Version 1.7">
  </head>

  <body class="BOOK" bgcolor="#FFFFFF" text="#000000" link=
  "#0000FF" vlink="#840084" alink="#0000FF">
    <div class="BOOK">
      <a name="AEN1"></a>
<table><tr valign=top>
<td width=25%>
<a href="http://www.lprng.com">
<img align=left SRC="LPRng.jpg" ALT="LPRngLogo" height=60>
</a>
</td>
<td width=50%></td><td width=25% >
<a href="http://www.lprng.com">
<img align=right SRC="LPRngT-L.jpg" ALT="LPRngTool" height=75>
</a>
</td></tr></table>

      <div class="TITLEPAGE">
        <h1 class="TITLE"><a name="AEN2">LPRng Reference
        Manual</a></h1>

        <h2 class="SUBTITLE">5 Sep 2003 (For LPRng-3.8.22)</h2>

        <h3 class="AUTHOR"><a name="AEN5"></a>Patrick A Powell</h3>

        <div class="AFFILIATION">
          <div class="ADDRESS">
            <p class="ADDRESS"><code class="EMAIL">&lt;<a href=
            "mailto:papowell@lprng.com">papowell@lprng.com</a>&gt;</code><br>

            AStArt&nbsp;Technologies<br>
            6741&nbsp;Convoy&nbsp;Court,<br>
            San&nbsp;Diego,&nbsp;CA&nbsp;92111<br>
            Phone&nbsp;858-874-6543<br>
            Fax&nbsp;858-751-2435</p>
          </div>
        </div>

        <p class="COPYRIGHT">Copyright &copy; 1996-2001 Patrick
        Powell</p>

        <div>
          <div class="ABSTRACT">
            <a name="AEN21"></a>

            <p>The LPRng; Printing Software consists of the <b
            class="APPLICATION">LPRng</b> print spooler, the <b
            class="APPLICATION">ifhp</b> print filter, and the <b
            class="APPLICATION">LPRngTool</b> graphical user
            interface.</p>

            <p>The <b class="APPLICATION">LPRng</b> print spooler
            is an enhanced, extended, and portable implementation
            of the Berkeley <b class="APPLICATION">lpr</b> print
            spooler functionality. While providing the same
            interface and meeting RFC1179 requirements, the
            implementation is completely independent and provides
            support for the following features: lightweight (no
            databases needed) lpr, lpc, and lprm programs; dynamic
            redirection of print queues; printer pooling and load
            balancing; automatic job holding; highly verbose
            diagnostics; client programs do not need to run SETUID
            root; greatly enhanced security checks; load balancing
            across multiple printers; and a greatly improved
            permission and authorization mechanism. The source
            software compiles and runs on a wide variety of UNIX
            systems, and is compatible with other print spoolers
            and network printers that use the <b class=
            "APPLICATION">lpr</b> interface and meet RFC1179
            requirements. Included in the <b class=
            "APPLICATION">LPRng</b> print spooler distribution is a
            set of customizable banner page generation
            programs.</p>

            <p>The SVR4 lp and lpstat functionality is provided by
            a set of emulator programs, and <b class=
            "APPLICATION">LPRng</b> can be easily integrated with
            the Samba SMB support package. For users that require
            secure and/or authenticated printing support, <b class=
            "APPLICATION">LPRng</b> supports SSL (using <b class=
            "APPLICATION">OpenSSL</b>), Kerberos 5, MIT Kerberos 4
            extensions to LPR, PGP, and simple MD5 based
            authentication. Additional authentication support is
            extremely simple to add.</p>

            <p>The <b class="APPLICATION">ifhp</b> print filter
            converts print jobs into formats compatible with
            PostScript, PCL, text, and other printers and provides
            diagnostic and error information as well as accounting
            information.</p>

            <p>The ;LPRngTool&amp; Graphical User Interface
            provides a simple to use configuration and monitoring
            tool. It allows users to monitor printers and generate
            printcap entries in a simple manner, as well as
            providing extensive help and diagnostics.</p>
          </div>
        </div>

        <div class="LEGALNOTICE">
          <a name="AEN18"></a>

          <div class="IMPORTANT">
            <blockquote class="IMPORTANT">
              <p><b>Important:</b> THIS DOCUMENTATION AND THE
              DESCRIBED SOFTWARE IS PROVIDED BY THE AUTHORS "AS IS"
              AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT
              NOT LIMITED TO, THE IMPLIED WARRANTIES OF
              MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
              ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS BE
              LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
              EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
              NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
              SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
              INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
              LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
              TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
              ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF
              ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
            </blockquote>
          </div>
        </div>
        <hr>
      </div>

      <div class="TOC">
        <dl>
          <dt><b>Table of Contents</b></dt>

          <dt><a href="#AEN38">Preface</a></dt>

          <dd>
            <dl>
              <dt>1. <a href="#AEN40">Introduction</a></dt>

              <dt>2. <a href="#AEN53">Acknowledgements</a></dt>

              <dt>3. <a href="#AEN58">Shell Prompts</a></dt>

              <dt>4. <a href="#AEN77">Typographic
              Conventions</a></dt>

              <dt>5. <a href="#AEN126">Notes, warnings, and
              examples</a></dt>
            </dl>
          </dd>

          <dt>1. <a href="#INTRODUCTION">Introduction</a></dt>

          <dd>
            <dl>
              <dt>1.1. <a href="#SECFEATURES">What is <b class=
              "APPLICATION">LPRng</b>?</a></dt>

              <dt>1.2. <a href="#MAILLIST">Additional
              Resources</a></dt>

              <dt>1.3. <a href="#AEN216">Frequently Asked
              Questions</a></dt>

              <dt>1.4. <a href="#AEN225">License, Copyright, and
              Disclaimer</a></dt>

              <dt>1.5. <a href="#AEN232">Commercial
              Support</a></dt>

              <dt>1.6. <a href="#AEN237">Web Site</a></dt>

              <dt>1.7. <a href="#SECFTP">FTP Sites</a></dt>

              <dt>1.8. <a href="#AEN277">Mailing List</a></dt>

              <dt>1.9. <a href="#FAQREF">PGP Public Key</a></dt>

              <dt>1.10. <a href="#AEN291">References and
              Standards</a></dt>

              <dd>
                <dl>
                  <dt>1.10.1. <a href="#AEN295">RFCs</a></dt>

                  <dt>1.10.2. <a href=
                  "#POSTSCRIPT">PostScript</a></dt>

                  <dt>1.10.3. <a href="#PCL">HP PCL 5</a></dt>

                  <dt>1.10.4. <a href="#PJL">HP PJL</a></dt>

                  <dt>1.10.5. <a href="#AEN338">PDF</a></dt>
                </dl>
              </dd>
            </dl>
          </dd>

          <dt>2. <a href="#INSTALLATION">Installation</a></dt>

          <dd>
            <dl>
              <dt>2.1. <a href="#AEN350">Getting Source Code and
              Support Programs</a></dt>

              <dt>2.2. <a href="#AEN433"><var class=
              "ENVAR">PATH</var> Environment Variable and
              Utilities</a></dt>

              <dt>2.3. <a href="#NFSMOUNT">Network Mounted File
              System and Spool Directories</a></dt>

              <dt>2.4. <a href="#USERGROUP">Daemon User and Daemon
              Group</a></dt>

              <dt>2.5. <a href="#AEN485">Configuration</a></dt>

              <dt>2.6. <a href="#REQUIRECONFIG">System and User
              Printcap, lpd.conf, and lpd.perms files</a></dt>

              <dt>2.7. <a href="#AEN926">Checking System
              Installation with <b class=
              "APPLICATION">checkpc</b></a></dt>

              <dt>2.8. <a href="#AEN962">Compilation and
              Install</a></dt>

              <dt>2.9. <a href="#AEN1000">Installation
              Problems</a></dt>

              <dt>2.10. <a href="#UPDATE">Updating Print Spooler
              Software and Startup Scripts</a></dt>

              <dd>
                <dl>
                  <dt>2.10.1. <a href="#AEN1093">SunOS, Linux, and
                  BSD Derived Systems</a></dt>

                  <dt>2.10.2. <a href="#SOLARISINSTALL">Solaris,
                  HP-UX, and other SysVR4 Derived Systems</a></dt>
                </dl>
              </dd>

              <dt>2.11. <a href="#LPSIMULATION">Emulation for UNIX
              SystemV <b class="APPLICATION">lp</b> and <b class=
              "APPLICATION">lpstat</b></a></dt>

              <dt>2.12. <a href="#SMB">SAMBA and <b class=
              "APPLICATION">LPRng</b></a></dt>

              <dt>2.13. <a href="#SETUID">Security
              Concerns</a></dt>
            </dl>
          </dd>

          <dt>3. <a href="#SYSTEMSPECIFIC">System Specific
          Notes</a></dt>

          <dd>
            <dl>
              <dt>3.1. <a href="#SOLARIS">Solaris</a></dt>

              <dt>3.2. <a href="#LINUX">Linux</a></dt>

              <dt>3.3. <a href="#AIX">AIX</a></dt>

              <dt>3.4. <a href="#APPLETALK">AppleTalk
              Support</a></dt>
            </dl>
          </dd>

          <dt>4. <a href="#TUTORIAL">Print Spooling
          Tutorial</a></dt>

          <dd>
            <dl>
              <dt>4.1. <a href="#OVERVIEW">Overview</a></dt>

              <dt>4.2. <a href="#SAMPLEPRINTCAP">Sample Printcap
              Entry</a></dt>

              <dt>4.3. <a href="#TUTORIALCONFIG">Setting Up the
              Tutorial Configuration</a></dt>

              <dt>4.4. <a href="#RESTORING">Restoring Original
              Configuration</a></dt>

              <dt>4.5. <a href="#PRINTINGANDCHECKING">Printing a
              File and Checking Status</a></dt>

              <dt>4.6. <a href="#SELECTINGPRINTQUEUE">Selecting the
              Print Queue</a></dt>

              <dt>4.7. <a href="#CONTROLLINGPRINTQUEUE">Controlling
              the Print Queue</a></dt>

              <dt>4.8. <a href="#JOBREMOVAL">Job Removal</a></dt>

              <dt>4.9. <a href="#PRINTJOBFILTERS">Print Job
              Filters</a></dt>

              <dd>
                <dl>
                  <dt>4.9.1. <a href="#CONTROLFILES">Control Files
                  and Filter Options</a></dt>

                  <dt>4.9.2. <a href=
                  "#FILTERENVIRONMENTVARS">Filter Environment
                  Variables</a></dt>

                  <dt>4.9.3. <a href=
                  "#USINGCOMMANDLINEANDPRINTCAP">Using Command Line
                  and Printcap Options In Filters</a></dt>

                  <dt>4.9.4. <a href="#FILTEREXITCODES">Filter Exit
                  Codes</a></dt>

                  <dt>4.9.5. <a href=
                  "#JOBFORMATSANDFILTERSELECTION">Job Formats and
                  Filter Selection</a></dt>
                </dl>
              </dd>

              <dt>4.10. <a href="#JOBFILEFORMATCONVERSION">Job File
              Format Conversion with Filters</a></dt>

              <dd>
                <dl>
                  <dt>4.10.1. <a href="#AEN2787">Simple Filter with
                  File Format Detection</a></dt>

                  <dt>4.10.2. <a href="#AEN2836">The <b class=
                  "APPLICATION">ifhp</b> Filter</a></dt>

                  <dt>4.10.3. <a href="#JAGGIES">The Jaggies - LF
                  to CR-LF Conversion With lpf</a></dt>

                  <dt>4.10.4. <a href="#AEN3029">Store and Forward
                  Spool Queues</a></dt>

                  <dt>4.10.5. <a href="#AEN3062">Filtering Job
                  Files In Transit</a></dt>
                </dl>
              </dd>

              <dt>4.11. <a href="#AEN3103">Printcap Basics</a></dt>

              <dd>
                <dl>
                  <dt>4.11.1. <a href="#AEN3142">Printcap
                  Processing Format</a></dt>

                  <dt>4.11.2. <a href="#AEN3201">Printcap
                  Information From Programs and Databases</a></dt>

                  <dt>4.11.3. <a href="#AEN3260">User Printcap
                  Information</a></dt>
                </dl>
              </dd>

              <dt>4.12. <a href="#AEN3273">Banner Printing and the
              OF filter</a></dt>

              <dt>4.13. <a href="#AEN3376">Printing from <b class=
              "APPLICATION">lpr</b> Directly To A Device</a></dt>

              <dt>4.14. <a href="#AEN3423">Moving Jobs From Queue
              to Queue and Redirecting Queues</a></dt>

              <dt>4.15. <a href="#AEN3470">Print Job Classes, User
              Requested Job Priority, and Form Support</a></dt>

              <dt>4.16. <a href="#AEN3515">Holding and Releasing
              Jobs</a></dt>

              <dt>4.17. <a href="#AEN3593">Load Balance Queues and
              Printer Pools</a></dt>

              <dt>4.18. <a href="#AEN3694">Routing Jobs To Print
              Queues</a></dt>

              <dt>4.19. <a href="#AEN3767">Job Options and the Z
              Control File Entry</a></dt>

              <dd>
                <dl>
                  <dt>4.19.1. <a href="#AEN3805">Setting Job
                  Options Using the Printcap</a></dt>

                  <dt>4.19.2. <a href="#AEN3827">Converting SystemV
                  Options to LPRng Options</a></dt>

                  <dt>4.19.3. <a href="#AEN3841">Selecting a Single
                  Option - Muliple Queues</a></dt>

                  <dt>4.19.4. <a href=
                  "#INCOMINGCONTROLFILTER">Selecting Multiple
                  Options - Single Queue</a></dt>
                </dl>
              </dd>

              <dt>4.20. <a href="#AEN3885">Interfacing to Non-LPRng
              Spoolers</a></dt>

              <dt>4.21. <a href="#AEN3917">Debugging, Tracing, and
              Log Files</a></dt>
            </dl>
          </dd>

          <dt>5. <a href="#LPRNGCLIENTS"><b class=
          "APPLICATION">LPRng</b> Clients - lpr, lprm, lpq, lpc,
          lpstat</a></dt>

          <dd>
            <dl>
              <dt>5.1. <a href="#PRINTERINFO">Printer and Server
              Information</a></dt>

              <dt>5.2. <a href="#AEN4113">Command Line
              -Pprinter@host</a></dt>

              <dt>5.3. <a href="#AEN4119">Command Line
              -Pprinter</a></dt>

              <dt>5.4. <a href="#AEN4125">PRINTER, LPDEST,
              NPRINTER, and NGPRINTER Environment
              Variables</a></dt>

              <dt>5.5. <a href="#AEN4141">Wildcard Printcap
              Entry</a></dt>

              <dt>5.6. <a href="#AEN4148">First Printcap
              Entry</a></dt>

              <dt>5.7. <a href="#DEFAULTRMRP">Default Printer and
              Server Host</a></dt>

              <dt>5.8. <a href="#FORCELOCALHOST">Force Connection
              to Localhost</a></dt>

              <dt>5.9. <a href="#ALLOWUSERSETTING">User
              Identification</a></dt>
            </dl>
          </dd>

          <dt>6. <a href="#LPR"><b class="APPLICATION">lpr</b> -
          Job Spooler Program</a></dt>

          <dd>
            <dl>
              <dt>6.1. <a href="#DEFAULTFORMAT">Job Format
              Options</a></dt>

              <dt>6.2. <a href="#AEN4267">Job Pretty Printing,
              Banners, Priority, and Accounting</a></dt>

              <dt>6.3. <a href="#CLASSPRIORITY">Job Class and
              Priority</a></dt>

              <dt>6.4. <a href="#JOBCOPIES">Job Copies and Job
              Size</a></dt>

              <dt>6.5. <a href="#JOBCOMPLETION">Job Completion
              Notification Requested</a></dt>

              <dt>6.6. <a href="#AEN4373">Remove Files After
              Spooling</a></dt>

              <dt>6.7. <a href="#APPEND-Z">The -Z Passthrough to
              Filter Options</a></dt>

              <dt>6.8. <a href="#QQ">Record Queue Name in Control
              File</a></dt>

              <dt>6.9. <a href="#CHECKFORNONPRINTABLE">Check For
              Nonprintable File</a></dt>

              <dt>6.10. <a href="#LPRBOUNCE">Job Filtering By
              LPR</a></dt>

              <dt>6.11. <a href="#RG">Restrict Queue Use to Group
              Members</a></dt>

              <dt>6.12. <a href="#SAFECHARS">Fixing Bad Control
              Files and Metacharacters</a></dt>

              <dt>6.13. <a href="#MINFREE">Minimum Spool Queue Free
              Space</a></dt>

              <dt>6.14. <a href="#FORCEFQDNHOSTNAME">FQDN Host
              Information</a></dt>
            </dl>
          </dd>

          <dt>7. <a href="#LPQ"><b class="APPLICATION">lpq</b> -
          Status Monitoring Program</a></dt>

          <dd>
            <dl>
              <dt>7.1. <a href="#AEN4566"><b class=
              "APPLICATION">lpq</b> Queue Selection (lpq -Pprinter,
              lpq -a)</a></dt>

              <dt>7.2. <a href="#AEN4572"><b class=
              "APPLICATION">lpq</b> Job Selection</a></dt>

              <dt>7.3. <a href="#AEN4579"><b class=
              "APPLICATION">lpq</b> Short Format (lpq -s)</a></dt>

              <dt>7.4. <a href="#AEN4590"><b class=
              "APPLICATION">lpq</b> Long Format (lpq, lpq -l, lpq
              -L)</a></dt>

              <dt>7.5. <a href="#AEN4601"><b class=
              "APPLICATION">lpq</b> Verbose Format (lpq
              -v)</a></dt>

              <dt>7.6. <a href="#STALLEDTIME">Job Taking Too Long -
              Stalled</a></dt>

              <dt>7.7. <a href="#AEN4619">Configuring Format and
              Displayed Information</a></dt>

              <dd>
                <dl>
                  <dt>7.7.1. <a href="#CLASSINSTATUS">Display Class
                  Information</a></dt>

                  <dt>7.7.2. <a href="#REVERSELPQFORMAT">Reverse
                  Short and Long <b class="APPLICATION">lpq</b>
                  Formats</a></dt>

                  <dt>7.7.3. <a href="#SHORTSTATUS">Status Line
                  Length and Line Count</a></dt>

                  <dt>7.7.4. <a href="#FORCELPQSTATUS"><b class=
                  "APPLICATION">lpq</b> Status Format Determined by
                  Requesting Host Address</a></dt>
                </dl>
              </dd>
            </dl>
          </dd>

          <dt>8. <a href="#LPRM"><b class="APPLICATION">lprm</b> -
          Job Removal Program</a></dt>

          <dd>
            <dl>
              <dt>8.1. <a href="#AEN4713"><b class=
              "APPLICATION">lprm</b> Queue Selection (lprm
              -Pprinter, lprm -a)</a></dt>

              <dt>8.2. <a href="#AEN4719"><b class=
              "APPLICATION">lprm</b> Job Selection</a></dt>
            </dl>
          </dd>

          <dt>9. <a href="#LPC"><b class="APPLICATION">lpc</b> -
          Administration Program</a></dt>

          <dd>
            <dl>
              <dt>9.1. <a href="#AEN4753">Informational Commands -
              status, flush, active, reread</a></dt>

              <dt>9.2. <a href="#AEN4771">Queue Management -
              enable, disable, up, down</a></dt>

              <dt>9.3. <a href="#AEN4783">Printing Management -
              start, stop, up, down</a></dt>

              <dt>9.4. <a href="#AEN4792">Problem Management -
              abort, redo, kill</a></dt>

              <dt>9.5. <a href="#AEN4798">Job Scheduling - topq,
              holdall, noholdall, hold, release</a></dt>

              <dt>9.6. <a href="#LPCREDIRECT">Queue Management -
              class, redirect, move</a></dt>
            </dl>
          </dd>

          <dt>10. <a href="#CHECKPC"><b class=
          "APPLICATION">checkpc</b> - Configuration Validation
          Utility</a></dt>

          <dd>
            <dl>
              <dt>10.1. <a href="#AEN4835">Maintenance</a></dt>

              <dt>10.2. <a href="#AEN4851">Printcap
              Information</a></dt>
            </dl>
          </dd>

          <dt>11. <a href="#PRINTERCOMM">Printer Communication and
          Protocols</a></dt>

          <dd>
            <dl>
              <dt>11.1. <a href="#NETWORKPRINTER">Network
              Printers</a></dt>

              <dt>11.2. <a href="#AEN4867">RFC1179 (LPD)
              Connection</a></dt>

              <dt>11.3. <a href="#SOCKETAPI">Socket API</a></dt>

              <dt>11.4. <a href="#APPSOCKET">AppSocket TCP/IP
              Protocol</a></dt>

              <dt>11.5. <a href="#SECNETWORK">Network Print Server
              Boxes</a></dt>

              <dt>11.6. <a href="#AEN4976">Network Print Server
              Configuration Information</a></dt>

              <dt>11.7. <a href="#AEN5157">HP JetDirect
              Interface</a></dt>

              <dd>
                <dl>
                  <dt>11.7.1. <a href="#AEN5162">Resetting To
                  Factory Defaults</a></dt>

                  <dt>11.7.2. <a href="#AEN5169">Setting Up IP
                  Networking and Address</a></dt>

                  <dt>11.7.3. <a href="#AEN5174">BOOTP
                  Information</a></dt>

                  <dt>11.7.4. <a href="#AEN5182">Telnet
                  Configuration</a></dt>

                  <dt>11.7.5. <a href="#AEN5187">Disabling Banner
                  Page Generation</a></dt>
                </dl>
              </dd>

              <dt>11.8. <a href="#AEN5193">Problems With Network
              Print Servers</a></dt>

              <dd>
                <dl>
                  <dt>11.8.1. <a href="#AEN5197">Network Print
                  Server Not Responding</a></dt>

                  <dt>11.8.2. <a href="#AEN5206">Network Print
                  Server Does Not Handle LPQ, LPRM</a></dt>

                  <dt>11.8.3. <a href="#AEN5214">Incomplete Job
                  Transfers</a></dt>
                </dl>
              </dd>

              <dt>11.9. <a href="#AEN5224">Printing to a SMB
              (MicroSoft) Printer</a></dt>

              <dt>11.10. <a href="#AEN5238">Printing to AppleTalk
              Printers</a></dt>

              <dt>11.11. <a href="#AEN5262">Parallel Port
              Printers</a></dt>

              <dt>11.12. <a href="#SECSERIAL">Serial
              Printers</a></dt>
            </dl>
          </dd>

          <dt>12. <a href="#PRINTCAPREF">Printcap Database</a></dt>

          <dd>
            <dl>
              <dt>12.1. <a href="#PRINTCAPPARSE">The Printcap
              Parsing Rules</a></dt>

              <dt>12.2. <a href="#SIMPLE">Simple Client Printcap
              Entry</a></dt>

              <dt>12.3. <a href="#CM">Simple Server Printcap
              Example</a></dt>

              <dt>12.4. <a href="#AEN5732">Using :oh To Select
              Printcap Information</a></dt>

              <dt>12.5. <a href="#AEN5758">Using the Wildcard
              Printcap Entry</a></dt>

              <dt>12.6. <a href="#AEN5770">Enterprise Strength
              Printcap Example</a></dt>

              <dt>12.7. <a href="#AEN5787">Remote Printer Using
              RFC1179</a></dt>

              <dt>12.8. <a href="#AEN5821">Remote Printer Using
              Socket API</a></dt>

              <dt>12.9. <a href="#AEN5848">Parallel
              Printer</a></dt>

              <dt>12.10. <a href="#SERIAL">Serial Printer</a></dt>

              <dt>12.11. <a href="#LPDBOUNCE">Bounce Queue</a></dt>

              <dt>12.12. <a href="#TRANSLATEFORMAT">Job Format
              Translation</a></dt>

              <dt>12.13. <a href="#DESTINATIONS">Dynamic
              Routing</a></dt>

              <dt>12.14. <a href="#LOADBALANCE">Printer Load
              Balancing</a></dt>

              <dt>12.15. <a href="#PRINTCAPPATH">Locations of
              Printcap Files</a></dt>

              <dd>
                <dl>
                  <dt>12.15.1. <a href="#AEN6076">Separate Server
                  and Client Printcap Files</a></dt>

                  <dt>12.15.2. <a href="#ALLPC"><var class=
                  "LITERAL">all</var> Printcap Entry</a></dt>
                </dl>
              </dd>

              <dt>12.16. <a href="#SECOH">Single Printcap File for
              Large Installation</a></dt>

              <dt>12.17. <a href="#AEN6118">Management Strategies
              for Large Installations</a></dt>

              <dt>12.18. <a href="#SECNIS">Using Programs To Get
              Printcap Information</a></dt>

              <dd>
                <dl>
                  <dt>12.18.1. <a href="#AEN6138">How to use NIS
                  and <b class="APPLICATION">LPRng</b></a></dt>

                  <dt>12.18.2. <a href="#AEN6165">How to use NIS
                  and <b class="APPLICATION">LPRng</b> - Sven
                  Rudolph</a></dt>
                </dl>
              </dd>

              <dt>12.19. <a href="#AEN6228">Lexmark
              Printers</a></dt>

              <dt>12.20. <a href="#P450">Tektronix Phaser
              Printers</a></dt>

              <dt>12.21. <a href="#AEN6242">Duplex
              Printing</a></dt>

              <dt>12.22. <a href="#AEN6263">Solaris, Newsprint and
              FrameMaker</a></dt>
            </dl>
          </dd>

          <dt>13. <a href="#SPOOLQUEUE">Spool Queues and
          Files</a></dt>

          <dd>
            <dl>
              <dt>13.1. <a href="#AEN6313">Spool Queue</a></dt>

              <dt>13.2. <a href="#QUEUELOCKFILE">Queue Lock
              File</a></dt>

              <dt>13.3. <a href="#QUEUECONTROLFILE">Spool Control
              File</a></dt>

              <dt>13.4. <a href="#LOGFILES">Log and Status
              Files</a></dt>

              <dt>13.5. <a href="#JOBFILES">Job Files</a></dt>

              <dt>13.6. <a href="#AEN6660">Job Hold File</a></dt>

              <dt>13.7. <a href="#AH">Job State</a></dt>

              <dt>13.8. <a href="#USEIDENTIFIER">Job
              Identifier</a></dt>
            </dl>
          </dd>

          <dt>14. <a href="#CONFIGFILE">Configuration File,
          Defaults and Overrides</a></dt>

          <dd>
            <dl>
              <dt>14.1. <a href="#AEN6784">Configuration File
              Format</a></dt>

              <dt>14.2. <a href="#AEN6798">Legacy
              Compatibility</a></dt>
            </dl>
          </dd>

          <dt>15. <a href="#JOBSTEPS">Job Processing</a></dt>

          <dd>
            <dl>
              <dt>15.1. <a href="#CONFIGSETUP">Configuration and
              Setup Options</a></dt>

              <dt>15.2. <a href="#SUBMITTING">Submitting Jobs and
              Service Requests</a></dt>

              <dt>15.3. <a href="#RECEPTION">Job Reception</a></dt>

              <dt>15.4. <a href="#SPOOLQ">Spool Queue
              Processing</a></dt>

              <dt>15.5. <a href="#OPENDEVICE">Opening the Output
              Device</a></dt>

              <dt>15.6. <a href="#BANNERPRINTING">Printing
              Banners</a></dt>

              <dt>15.7. <a href="#PRINTINGJOB">Printing Job
              Files</a></dt>

              <dt>15.8. <a href="#AEN7427">Printing Banner At End
              of Job</a></dt>

              <dt>15.9. <a href="#NORMALTERM">Normal
              Termination</a></dt>

              <dt>15.10. <a href="#ABNORMALTERM">Abnormal
              Termination</a></dt>

              <dt>15.11. <a href="#BK">Forwarding Jobs</a></dt>

              <dt>15.12. <a href="#DEBUGGING">Debugging</a></dt>
            </dl>
          </dd>

          <dt>16. <a href="#FILTERS">Filters</a></dt>

          <dd>
            <dl>
              <dt>16.1. <a href="#AEN7758">Filter
              Functions</a></dt>

              <dt>16.2. <a href="#EXITCODES">Filter Exit
              Codes</a></dt>

              <dd>
                <dl>
                  <dt>16.2.1. <a href="#JSUCC">JSUCC</a></dt>

                  <dt>16.2.2. <a href="#JFAIL">JFAIL</a></dt>

                  <dt>16.2.3. <a href="#JABORT">JABORT</a></dt>

                  <dt>16.2.4. <a href="#JREMOVE">JREMOVE</a></dt>

                  <dt>16.2.5. <a href="#JHOLD">JHOLD</a></dt>

                  <dt>16.2.6. <a href="#JNOSPOOL">JNOSPOOL and
                  JNOPRINT</a></dt>

                  <dt>16.2.7. <a href="#JSIGNAL">JSIGNAL</a></dt>

                  <dt>16.2.8. <a href=
                  "#JNORETRY">JFAILNORETRY</a></dt>

                  <dt>16.2.9. <a href="#JOTHER">Other
                  Values</a></dt>
                </dl>
              </dd>

              <dt>16.3. <a href="#PRINTJOBFORMATS">Print Job
              Formats</a></dt>

              <dt>16.4. <a href="#OFDETAILS">OF Filter</a></dt>

              <dt>16.5. <a href="#PR"><b class=
              "APPLICATION">lpr</b> -p format</a></dt>

              <dt>16.6. <a href="#AEN7980"><b class=
              "APPLICATION">lpr</b> binary (-l) format</a></dt>

              <dt>16.7. <a href="#CHAININGFILTERS">Chaining
              Filters</a></dt>

              <dt>16.8. <a href="#FILTEROPTIONS">Filter Command
              Line Options and Environment Variables</a></dt>

              <dt>16.9. <a href="#AEN8397"><b class=
              "APPLICATION">LPRng</b> Supported Filters</a></dt>

              <dd>
                <dl>
                  <dt>16.9.1. <a href="#AEN8404">Filter Support
                  Conventions</a></dt>
                </dl>
              </dd>

              <dt>16.10. <a href="#LPF">lpf</a></dt>

              <dt>16.11. <a href="#IFHP"><b class=
              "APPLICATION">ifhp</b> Filter</a></dt>
            </dl>
          </dd>

          <dt>17. <a href="#PERMSREF">Permissions and
          Authentication</a></dt>

          <dd>
            <dl>
              <dt>17.1. <a href="#DEFAULTPERMISSION">Permission
              Checking Algorithm</a></dt>

              <dt>17.2. <a href="#AEN8680">Rule Matching
              Procedures</a></dt>

              <dd>
                <dl>
                  <dt>17.2.1. <a href="#AEN8708">DEFAULT</a></dt>

                  <dt>17.2.2. <a href="#AEN8716">SERVICE</a></dt>

                  <dt>17.2.3. <a href="#AEN8764">USER</a></dt>

                  <dt>17.2.4. <a href=
                  "#AEN8771">REMOTEUSER</a></dt>

                  <dt>17.2.5. <a href="#AEN8780">HOST</a></dt>

                  <dt>17.2.6. <a href=
                  "#AEN8787">REMOTEHOST</a></dt>

                  <dt>17.2.7. <a href=
                  "#AEN8793">REMOTEPORT</a></dt>

                  <dt>17.2.8. <a href="#AEN8799">PORT</a></dt>

                  <dt>17.2.9. <a href="#AEN8802">IP</a></dt>

                  <dt>17.2.10. <a href="#AEN8805">REMOTEIP</a></dt>

                  <dt>17.2.11. <a href="#AEN8808">LPC</a></dt>

                  <dt>17.2.12. <a href="#AEN8815">SAMEUSER</a></dt>

                  <dt>17.2.13. <a href="#AEN8821">SAMEHOST</a></dt>

                  <dt>17.2.14. <a href="#AEN8827">SERVER</a></dt>

                  <dt>17.2.15. <a href="#AEN8836">FORWARD</a></dt>

                  <dt>17.2.16. <a href="#AEN8844">GROUP</a></dt>

                  <dt>17.2.17. <a href=
                  "#AEN8852">REMOTEGROUP</a></dt>

                  <dt>17.2.18. <a href=
                  "#AEN8857">CONTROLLINE</a></dt>

                  <dt>17.2.19. <a href="#AEN8866">AUTH</a></dt>

                  <dt>17.2.20. <a href="#AEN8872">AUTHTYPE</a></dt>

                  <dt>17.2.21. <a href="#AEN8878">AUTHUSER</a></dt>

                  <dt>17.2.22. <a href="#AEN8884">IFIP</a></dt>
                </dl>
              </dd>

              <dt>17.3. <a href="#PERMSPATH">Permission File
              Location</a></dt>

              <dt>17.4. <a href="#AEN8919">Example Permission
              File</a></dt>

              <dt>17.5. <a href="#AEN8932">Complex Permission
              Checking</a></dt>

              <dt>17.6. <a href="#AEN8947">More Examples</a></dt>

              <dt>17.7. <a href="#AUTHREF">Authentication</a></dt>

              <dt>17.8. <a href="#AEN8974">User
              Identification</a></dt>

              <dt>17.9. <a href="#AEN8980">RFC1179 Protocol
              Extensions</a></dt>

              <dt>17.10. <a href="#AUTH">Authentication
              Operations</a></dt>

              <dt>17.11. <a href="#AEN9083">Permission
              Checking</a></dt>

              <dt>17.12. <a href="#AEN9115">PGP Authentication
              Support</a></dt>

              <dd>
                <dl>
                  <dt>17.12.1. <a href="#PGPPATH">Printcap
                  Configuration</a></dt>

                  <dt>17.12.2. <a href="#AEN9205">User Files and
                  Environment Variables</a></dt>
                </dl>
              </dd>

              <dt>17.13. <a href="#KERBEROS">Using Kerberos 5 for
              Authentication</a></dt>

              <dd>
                <dl>
                  <dt>17.13.1. <a href="#AEN9246"><b class=
                  "APPLICATION">LPRng</b> Configuration</a></dt>

                  <dt>17.13.2. <a href="#AEN9260">Kerberos
                  Installation Procedure</a></dt>

                  <dt>17.13.3. <a href="#AEN9312"><b class=
                  "APPLICATION">LPRng</b> Configuration</a></dt>

                  <dt>17.13.4. <a href="#AEN9322">Printcap
                  Entries</a></dt>

                  <dt>17.13.5. <a href="#AEN9381">User Environment
                  Variables and Files</a></dt>
                </dl>
              </dd>

              <dt>17.14. <a href="#AEN9386">Using Kerberos 4 for
              Authentication</a></dt>

              <dd>
                <dl>
                  <dt>17.14.1. <a href="#AEN9392">Printcap
                  Entries</a></dt>
                </dl>
              </dd>

              <dt>17.15. <a href="#AEN9412">Using SSL for
              Authentication</a></dt>

              <dd>
                <dl>
                  <dt>17.15.1. <a href="#AEN9445">Certificate
                  Management</a></dt>

                  <dt>17.15.2. <a href="#AEN9462">Creating Root
                  Certificate</a></dt>

                  <dt>17.15.3. <a href="#AEN9468">Creating Client
                  and Server Certificates</a></dt>

                  <dt>17.15.4. <a href="#AEN9479">Creating Signing
                  Certificates</a></dt>

                  <dt>17.15.5. <a href="#AEN9483">Permissions and
                  Certificate Revocation</a></dt>
                </dl>
              </dd>

              <dt>17.16. <a href="#AEN9489">Using MD5 for
              Authentication</a></dt>

              <dd>
                <dl>
                  <dt>17.16.1. <a href="#AEN9498">Printcap
                  Entries</a></dt>

                  <dt>17.16.2. <a href="#AEN9546">User Environment
                  Variables and Files</a></dt>
                </dl>
              </dd>

              <dt>17.17. <a href="#AEN9556">Adding Authentication
              Support</a></dt>

              <dd>
                <dl>
                  <dt>17.17.1. <a href="#AEN9564">Printcap
                  Support</a></dt>

                  <dt>17.17.2. <a href="#AEN9578">Code
                  Support</a></dt>

                  <dt>17.17.3. <a href="#AEN9637">Connection and
                  Transfer Authentication</a></dt>
                </dl>
              </dd>
            </dl>
          </dd>

          <dt>18. <a href="#ACCOUNTINGREF">Accounting</a></dt>

          <dd>
            <dl>
              <dt>18.1. <a href="#ACCOUNTINGSERVER">Accounting
              Printcap Options</a></dt>

              <dt>18.2. <a href="#AEN9682">Accounting
              Information</a></dt>

              <dt>18.3. <a href="#AEN9696">Accounting File</a></dt>

              <dt>18.4. <a href="#AEN9736">Authorization and
              Quotas</a></dt>

              <dt>18.5. <a href="#AEN9761">Accessing Printer
              Hardware Pagecounters</a></dt>

              <dt>18.6. <a href="#AEN9772">Reliable
              Accounting</a></dt>

              <dt>18.7. <a href="#AEN9787"><b class=
              "APPLICATION">LPRng</b> accounting.pl
              Utility</a></dt>
            </dl>
          </dd>

          <dt>19. <a href="#RFC1179REF">RFC 1179 - Line Printer
          Daemon Protocol</a></dt>

          <dd>
            <dl>
              <dt>19.1. <a href="#LPDPORT">Ports and
              Connections</a></dt>

              <dt>19.2. <a href="#REMOTESUPPORT">Protocol Requests
              and Replies</a></dt>

              <dt>19.3. <a href="#JOBTRANSFER">Job
              Transfer</a></dt>

              <dt>19.4. <a href="#AEN10191">Data File
              Transfer</a></dt>

              <dt>19.5. <a href="#AEN10227">Control File
              Contents</a></dt>

              <dt>19.6. <a href="#AEN10430"><b class=
              "APPLICATION">lpq</b> Requests</a></dt>

              <dt>19.7. <a href="#AEN10453"><b class=
              "APPLICATION">lprm</b> Requests</a></dt>

              <dt>19.8. <a href="#LPCREREAD">LPC Requests</a></dt>

              <dt>19.9. <a href="#SENDBLOCKFORMAT">Block Job
              Transfer</a></dt>

              <dt>19.10. <a href="#AEN10656">Authenticated
              Transfer</a></dt>
            </dl>
          </dd>

          <dt>20. <a href="#FAQ">The Most Frequently Asked
          Questions</a></dt>

          <dd>
            <dl>
              <dt>20.1. <a href="#AEN10675">Why do I get malformed
              from address errors?</a></dt>

              <dt>20.2. <a href="#AEN10703">It was working
              normally, then I get connection refused
              errors</a></dt>

              <dt>20.3. <a href="#AEN10735">Job is not in print
              queue, but it gets printed!</a></dt>

              <dt>20.4. <a href="#AEN10790">Job disappears and is
              never printed, but lpr works</a></dt>

              <dt>20.5. <a href="#AEN10807">I get messages about
              bad control file format</a></dt>

              <dt>20.6. <a href="#RFC1179">What is RFC 1179, the
              Line Printer Daemon Protocol?</a></dt>

              <dt>20.7. <a href="#AEN10839">I want to replace lp,
              lpstat, etc, but my programs need them</a></dt>
            </dl>
          </dd>

          <dt>21. <a href="#REMOTELOGGER">Remote Logger
          Operation</a></dt>

          <dd>
            <dl>
              <dt>21.1. <a href="#LOGGER">Logger Network
              Communication</a></dt>

              <dt>21.2. <a href="#AEN10892">Logger
              Messages</a></dt>

              <dt>21.3. <a href="#AEN10897">Message Format</a></dt>

              <dt>21.4. <a href="#AEN10925">Dump Messages</a></dt>

              <dt>21.5. <a href="#AEN10928">LPD Messages</a></dt>

              <dt>21.6. <a href="#AEN10933">Job Status Messages -
              UPDATE</a></dt>

              <dt>21.7. <a href="#AEN10945">Printer Status Messages
              - PRSTATUS</a></dt>
            </dl>
          </dd>

          <dt>A. <a href="#OPTIONINDEX">Index To All The
          Configuration and Printcap Options</a></dt>

          <dt>B. <a href="#LICENSE">License</a></dt>

          <dt>C. <a href="#TESTING">Testing and Diagnostic
          Facilities</a></dt>

          <dd>
            <dl>
              <dt>C.1. <a href="#AEN11656">Compiling the Test
              Version</a></dt>

              <dt>C.2. <a href="#AEN11663">Setting Up The Test
              Version Spool Queues</a></dt>

              <dt>C.3. <a href="#AEN11691">Running the Test Version
              Software</a></dt>
            </dl>
          </dd>

          <dt><a href="#AEN11720">Index</a></dt>
        </dl>
      </div>

      <div class="LOT">
        <dl class="LOT">
          <dt><b>List of Tables</b></dt>

          <dt>4-1. <a href="#FILTEROPTIONSTABLE">Filter
          Options</a></dt>

          <dt>4-2. <a href="#JOBFORMAT">Job Formats and Filter
          Selection</a></dt>

          <dt>4-3. <a href="#IFHPOPTS"><b class=
          "APPLICATION">:ifhp=</b> Options</a></dt>

          <dt>11-1. <a href="#NEWPS">Network Print Server
          Configuration Information</a></dt>

          <dt>13-1. <a href="#CFLINE">Control File Lines</a></dt>

          <dt>16-1. <a href="#PRINTFILTERCOMMAND">Print Filter
          Command Line Options</a></dt>

          <dt>16-2. <a href="#FILTEROPTIONFLAGS">Filter Command
          Line Options and Values</a></dt>

          <dt>16-3. <a href="#AEN8271">Filter Command Line Option
          Format</a></dt>

          <dt>16-4. <a href="#FILTERENV">Filter Environment
          Variables</a></dt>

          <dt>17-1. <a href="#PERMSKEYWORDS">Permission Keywords
          and Purpose</a></dt>

          <dt>19-1. <a href="#RF1179COMMANDS">RFC1179
          Commands</a></dt>

          <dt>19-2. <a href="#CFLINES">Control File Lines and
          Purpose</a></dt>

          <dt>19-3. <a href="#LPCCOMMANDS">LPC Commands</a></dt>

          <dt>A-1. <a href="#LPRNGOPTIONS"><b class=
          "APPLICATION">LPRng</b> Options</a></dt>
        </dl>
      </div>

      <div class="PREFACE">
        <hr>

        <h1><a name="AEN38"></a>Preface</h1>

        <div class="SECT1">
          <h2 class="SECT1"><a name="AEN40">1.
          Introduction</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> Print Spooler
          provides the essential printing services for UNIX and
          UNIX-like operating systems. It can be configured to work
          in small, large, or enterprise level environments. The <b
          class="APPLICATION">ifhp</b> Print Filter is used with <b
          class="APPLICATION">LPRng</b> to convert print jobs into
          a format compatible with a particular printer and the
          while it may briefly describe the <b class=
          "APPLICATION">ifhp</b> operation, Finally, the <b class=
          "APPLICATION">LPRngTool</b> Graphical User Interface
          provides an easy to use configuration and monitoring tool
          for the <b class="APPLICATION">LPRng</b> print
          spooler.</p>

          <p>This document is the basic reference for the <b class=
          "APPLICATION">LPRng</b> print spooler software; the <b
          class="APPLICATION">ifhp</b> documentation and <b class=
          "APPLICATION">LPRngTool</b> should be consulted for
          details about their operation.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN53">2.
          Acknowledgements</a></h2>

          <p>I would like to thank all of the <b class=
          "APPLICATION">LPRng</b> users who so relentlessly tried
          the incredible number of permutations and combinations of
          printers and software, and whose requests for <span
          class="emphasis"><i class="EMPHASIS">just one more
          feature</i></span> led to the development of the
          software.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN58">3. Shell
          Prompts</a></h2>

          <p>The following table shows the default system prompt
          and superuser prompt. The examples will use this prompt
          to indicate which user you should be running the example
          as.</p>

          <div class="INFORMALTABLE">
            <a name="AEN61"></a>

            <table border="0" frame="void" class="CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>User</th>

                  <th>Prompt</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>Normal user</td>

                  <td><samp class="PROMPT">%</samp></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">root</var></td>

                  <td><samp class="PROMPT">#</samp></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN77">4. Typographic
          Conventions</a></h2>

          <p>The following table describes the typographic
          conventions used in this book.</p>

          <div class="INFORMALTABLE">
            <a name="AEN80"></a>

            <table border="0" frame="void" class="CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Meaning</th>

                  <th>Examples</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>The name of commands, files, and directories.
                  On screen computer output.</td>

                  <td>
                    <p>Edit your <tt class="FILENAME">.login</tt>
                    file.</p>

                    <p>Use <tt class="COMMAND">ls -a</tt> to list
                    all files.</p>
<pre class="SCREEN">
    You have mail.
</pre>
                    <br>
                    <br>
                  </td>
                </tr>

                <tr>
                  <td>What you type, when contrasted with on-screen
                  computer output.</td>

                  <td>
<pre class="SCREEN">
    <samp class="PROMPT">%</samp> <kbd class="USERINPUT">su</kbd>
    Password:
</pre>
                  </td>
                </tr>

                <tr>
                  <td>Manual page references.</td>

                  <td>Use <span class="CITEREFENTRY"><span class=
                  "REFENTRYTITLE">su</span>(1)</span> to change
                  user names.</td>
                </tr>

                <tr>
                  <td>User and group names</td>

                  <td>Only <var class="LITERAL">root</var> can do
                  this.</td>
                </tr>

                <tr>
                  <td>Emphasis</td>

                  <td>You <span class="emphasis"><i class=
                  "EMPHASIS">must</i></span> do this.</td>
                </tr>

                <tr>
                  <td>Command line variables; replace with the real
                  name or variable.</td>

                  <td>To delete a file, type <tt class="COMMAND">rm
                  <tt class="FILENAME"><var class=
                  "REPLACEABLE">filename</var></tt></tt></td>
                </tr>

                <tr>
                  <td>Environment variables</td>

                  <td><var class="ENVAR">$HOME</var> is your home
                  directory.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN126">5. Notes, warnings,
          and examples</a></h2>

          <p>Within the text appear notes, warnings, and
          examples.</p>

          <div class="NOTE">
            <blockquote class="NOTE">
              <p><b>Note:</b> Notes are represented like this, and
              contain information that you should take note of, as
              it may affect what you do.</p>
            </blockquote>
          </div>

          <div class="WARNING">
            <blockquote class="WARNING">
              <p><b>Warning</b>Warnings are represented like this,
              and contain information warning you about possible
              damage if you do not follow the instructions. This
              damage may be physical, to your hardware or to you,
              or it may be non-physical, such as the inadvertent
              deletion of important files.</p>
            </blockquote>
          </div>

          <div class="INFORMALEXAMPLE">
            <a name="AEN133"></a>

            <p>Examples are represented like this, and typically
            contain examples you should walk through, or show you
            what the results of a particular action should be.</p>
          </div>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="INTRODUCTION"></a>Chapter 1. Introduction</h1>

        <p>Printing is one of the essential services provided by
        computer systems. Users want reliable and easy to use
        methods of printing that require a minimum amount of effort
        to used and understand. On single user systems with a
        directly attached printer they perceive that the printing
        process is simply a matter of <span class="emphasis"><i
        class="EMPHASIS">storing</i></span> or <span class=
        "emphasis"><i class="EMPHASIS">spooling</i></span> a file,
        and then transferring it to the printer in a timely manner.
        In the classical <span class="emphasis"><i class=
        "EMPHASIS">multi-user</i></span> systems, each user expects
        to share a common printer with one or more users; the print
        <span class="emphasis"><i class=
        "EMPHASIS">spooling</i></span> system provides arbitration
        and sharing of the printer among the various users. In a
        <span class="emphasis"><i class=
        "EMPHASIS">network</i></span> based multi-user system,
        there may be one or more printers shared by multiple users
        on many different systems. The print <span class=
        "emphasis"><i class="EMPHASIS">spoolers</i></span> will
        need to cooperate to provide print services to the users in
        a simple an predictable manner.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECFEATURES">1.1. What is <b
          class="APPLICATION">LPRng</b>?</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> print spooler
          software was developed to be robust, reliable, secure,
          scalable, and portable. It has been used since 1988 in
          extremely demanding academic printing environments such
          as University of Minnesota, MIT, and Rutgers, commercial
          companies such as Dow Jones and Abbot Pharmaceuticals, as
          well as being distributed with Linux, FreeBSD, and other
          systems. Each of these environments has a unique set of
          problems, demanding various configuration and
          administrative capabilities. For example, the simple
          single user system with a single or limited number of
          printers requires easy configuration and simple
          diagnostic procedures, while the network based printing
          system requires highly robust error logging,
          authentication, and failover support. <b class=
          "APPLICATION">LPRng</b> provides a highly flexible
          configuration system that allows it to perform optimally
          in all of these environments.</p>

          <p>The <b class="APPLICATION">LPRng</b> software has
          three components: the <b class="APPLICATION">lpd</b>
          print spooler and the user client applications <b class=
          "APPLICATION">lpr</b>, <b class="APPLICATION">lpq</b>, <b
          class="APPLICATION">lprm</b>, etc.; the IFHP print filter
          (<b class="APPLICATION">ifhp</b>) which is used to
          convert jobs into a suitable for a particular printer,
          and the the LPRngTool Graphic User Interface (<b class=
          "APPLICATION">lprngtool</b>) which provides a simple and
          easy to use configuration and monitoring tool for the <b
          class="APPLICATION">LPRng</b> print spooler.</p>

          <p><b class="APPLICATION">LPRng</b> mimics many of the
          features of the <span class="emphasis"><i class=
          "EMPHASIS">vintage</i></span> or <span class=
          "emphasis"><i class="EMPHASIS">legacy</i></span> Berkeley
          (University of California - Berkeley) Line Printer (LPR)
          package found on Berkeley derivatives of the Unix
          operating system. <b class="APPLICATION">LPRng</b> will
          print a document with little or no knowledge of the
          content or special processing required to print the
          document on a stand-alone machine or in a distributed
          printing environment. New (as compared to Berkeley LPR)
          features include: lightweight <b class=
          "APPLICATION">lpr</b>, <b class="APPLICATION">lpc</b> and
          <b class="APPLICATION">lprm</b> programs, dynamic
          redirection of print queues, automatic job holding,
          highly verbose diagnostics, load balancing queues;
          enhanced security (SUID not required in most
          environments), and easy configuration.</p>

          <p><b class="APPLICATION">LPRng</b> started life at the
          University of Waterloo in 1986 as PLP (Public Line
          Printer), a replacement for the original BSD <b class=
          "APPLICATION">lpd</b> code. This was a one-shot effort by
          the author, Patrick Powell, to develop freely
          redistributed code without the restrictions of the
          BSD/AT&amp;T license and would allow non-licensed sites
          to fix and patch problems. From 1988 to 1992 individuals
          and groups added features, hacked, slashed, and modified
          the PLP code, coordinated largely by Justin Mason (<code
          class="EMAIL">&lt;<a href=
          "mailto:jmason@iona.ie">jmason@iona.ie</a>&gt;</code>)
          who started the <b class="APPLICATION">LPRng</b> mailing
          list.</p>

          <p>In 1992 while at San Diego State University Prof.
          Powell redesigned and reimplemented the PLP code and
          named the result <b class="APPLICATION">LPRng</b>. The
          goals of the <b class="APPLICATION">LPRng</b> project
          were to build a server system that was as close to user
          abuse proof as possible, that would provide services
          limited only by the inherent capacities of the support
          system, RFC1179 compliant, and with extensive debugging
          capabilities to allow quick and easy diagnostics of
          problems.</p>

          <p>In 1999 the code base for <b class=
          "APPLICATION">LPRng</b> was again reorganized in order to
          provide a common method for running on non-UNIX platforms
          such as Microsoft Windows NT, Apple Rhapsody, and
          embedded systems.</p>

          <p>As a side effect of this work, many security problems
          that could develop were identified and steps taken to
          ensure that they were not present in <b class=
          "APPLICATION">LPRng</b>. For example, <b class=
          "APPLICATION">LPRng</b> clients such as lpr, lprm, lpc,
          and lpq can run as ordinary users programs, the lpd
          server can run as a non-root user once a network port has
          been opened, and all text formatting operations done by
          <b class="APPLICATION">LPRng</b> use a very restricted
          and highly secure version of the <b class=
          "APPLICATION">snprintf</b> function.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="MAILLIST">1.2. Additional
          Resources</a></h2>

          <p>The main <b class="APPLICATION">LPRng</b>
          documentation is the LPRng Reference Manual, which is
          available in several formats. Information about <b class=
          "APPLICATION">LPRng</b> and the latest release can be
          found on the <b class="APPLICATION">LPRng</b> web page <a
          href="http://www.lprng.com/LPRng.html" target=
          "_top">http://www.lprng.com/LPRng.html</a></p>

          <p>The <b class="APPLICATION">ifhp</b> documentation is
          the IFHP-HOWTO, which is available in the <b class=
          "APPLICATION">ifhp</b> distribution. Information about <b
          class="APPLICATION">ifhp</b> and the latest release can
          be found on the <b class="APPLICATION">LPRng</b> web page
          <a href="http://www.lprng.com/LPRng.html" target=
          "_top">http://www.lprng.com/LPRng.html</a></p>

          <p>There is also a mailing list at <a href=
          "mailto:lprng-request@lprng.com?subject=subscribe"
          target="_top">lprng@lprng.com</a>. To post to the list
          you must subscribe by sending send an email to <a href=
          "mailto:lprng-request@lprng.com?subject=subscribe"
          target="_top">lprng-request@lprng.com</a>, with the
          message subject or body containing the word `subscribe'
          or `help'.</p>

          <p>Several presentations of <b class=
          "APPLICATION">LPRng</b> and print spooling software have
          been made at the Large Installation System Administrator
          (LISA) conferences. The presentation at the LISA 98
          conference is in the PowerPoint file <tt class=
          "FILENAME">LISA98.ppt</tt> in the <b class=
          "APPLICATION">LPRng</b> distribution
          documentation.&#13;</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN216">1.3. Frequently Asked
          Questions</a></h2>

          <p>There are a list of Frequently Asked Questions that
          appear regularly on the <b class="APPLICATION">LPRng</b>
          mailing list. See <a href="#FAQ">The Most Frequently
          Asked Questions</a>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN225">1.4. License,
          Copyright, and Disclaimer</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> Print Spooler and
          the ifhp Print Filter software are distributed under the
          <a href="license.txt" target="_top">GNU Public License
          (GPL) and the Artistic License</a>. Users can choose to
          redistribute or use the software under a license that is
          appropriate for their purpose. Other licenses and
          distribution agreements are available by contacting <a
          href="http://www.astart.com" target="_top">AStArt
          Technologies</a> for information.</p>

          <p>THE MATERIAL IN THESE SOFTWARE PACKAGES AND DOCUMENTS
          IS PROVIDED WITHOUT FEE AND AS-IS WITH NO WARRANTY
          REGARDING FITNESS OF USE FOR ANY PURPOSE. THE AUTHOR AND
          ALL CONTRIBUTORS ARE NOT LIABLE FOR ANY DAMAGES, DIRECT
          OR INDIRECT, RESULTING FROM THE USE OF THE SOFTWARE OR
          ANY INFORMATION PROVIDED IN THIS DOCUMENT.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN232">1.5. Commercial
          Support</a></h2>

          <p><a href="http://www.astart.com" target="_top">AStArt
          Technologies</a> provides commercial support and
          enhancements for the <b class="APPLICATION">LPRng</b> and
          other network software. AStArt provides network and
          system consulting services for UNIX and NT systems, as
          well as real time and network software.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN237">1.6. Web Site</a></h2>

          <p>Web Page: <a href="http://www.lprng.com" target=
          "_top">http://www.lprng.com</a></p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECFTP">1.7. FTP
          Sites</a></h2>

          <p>Main FTP Site:</p>

          <table border="0">
            <tbody>
              <tr>
                <td><a href="ftp://ftp.lprng.com/pub/LPRng" target=
                "_top">ftp://ftp.lprng.com/pub/LPRng</a> (US)</td>
              </tr>
            </tbody>
          </table>
          <br>
          <br>

          <p>Mirrors:</p>

          <table border="0">
            <tbody>
              <tr>
                <td><a href=
                "ftp://ftp.u-aizu.ac.jp/pub/net/lpr/LPRng" target=
                "_top">ftp://ftp.u-aizu.ac.jp/pub/net/lpr/LPRng</a>
                (JA)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.cs.columbia.edu/pub/archives/pkg/LPRng"
                target=
                "_top">ftp://ftp.cs.columbia.edu/pub/archives/pkg/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.cise.ufl.edu/pub/mirrors/LPRng" target=
                "_top">ftp://ftp.cise.ufl.edu/pub/mirrors/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.cs.umn.edu/pub/LPRng"
                target="_top">ftp://ftp.cs.umn.edu/pub/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://uiarchive.uiuc.edu/pub/ftp/ftp.lprng.com/pub/LPRng"
                 target=
                "_top">ftp://uiarchive.uiuc.edu/pub/ftp/ftp.lprng.com/pub/LPRng</a>
                (US)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.sage-au.org.au/pub/printing/spooler/lprng/"
                 target=
                "_top">ftp://ftp.sage-au.org.au/pub/printing/spooler/lprng/</a>
                (AU)</td>
              </tr>

              <tr>
                <td><a href="ftp://mirror.aarnet.edu.au/pub/LPRng/"
                target=
                "_top">ftp://mirror.aarnet.edu.au/pub/LPRng/</a>
                (AU/NZ)</td>
              </tr>

              <tr>
                <td><a href=
                "http://mirror.aarnet.edu.au/pub/LPRng/" target=
                "_top">http://mirror.aarnet.edu.au/pub/LPRng/</a>
                (AU/NZ)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://sunsite.ualberta.ca/pub/Mirror/LPRng"
                target=
                "_top">ftp://sunsite.ualberta.ca/pub/Mirror/LPRng</a>
                (CA)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.informatik.uni-hamburg.de/pub/os/unix/utils/LPRng"
                 target=
                "_top">ftp://ftp.informatik.uni-hamburg.de/pub/os/unix/utils/LPRng</a>
                (DE)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://ftp.uni-paderborn.de/pub/unix/printer/LPRng"
                target=
                "_top">ftp://ftp.uni-paderborn.de/pub/unix/printer/LPRng</a>
                (DE)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.mono.org/pub/LPRng" target=
                "_top">ftp://ftp.mono.org/pub/LPRng</a> (UK)</td>
              </tr>

              <tr>
                <td><a href="ftp://ftp.iona.com/pub/plp/LPRng"
                target="_top">ftp://ftp.iona.com/pub/plp/LPRng</a>
                (IE)</td>
              </tr>

              <tr>
                <td><a href=
                "ftp://uabgate.uab.ericsson.se/pub/unix/LPRng"
                target=
                "_top">ftp://uabgate.uab.ericsson.se/pub/unix/LPRng</a>
                (SE)</td>
              </tr>
            </tbody>
          </table>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN277">1.8. Mailing
          List</a></h2>

          <p>To join the <b class="APPLICATION">LPRng</b> mailing
          list, please send mail to <a href=
          "mailto: lprng-request@lprng.com" target=
          "_top">lprng-request@lprng.com</a> with the word
          'subscribe' in the BODY.</p>

          <p>The <b class="APPLICATION">LPRng</b> mailing list is
          archived on <a href="http://www.findmail.com/list/lprng"
          target="_top">http://www.findmail.com/list/lprng</a></p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="FAQREF">1.9. PGP Public
          Key</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> distributions
          have an MD5 checksum calculated, which is then signed
          with a PGP public key. Here is the key for validating the
          checksums:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN289"></a>
<pre class="SCREEN">
    Type Bits/KeyID    Date       User ID
    pub  1024/00D95C9D 1997/01/31 Patrick A. Powell \
       &lt;papowell@lprng.com&gt;
    
    -----BEGIN PGP PUBLIC KEY BLOCK-----
    Version: 2.6.3i
    
    mQCNAzLygTQAAAEEANBW5fPYjN3wSAnP9xWOUc3CvsMUxjip0cN2sY5qrdoJyIhn
    qbAspBopR+tGQfyp5T7C21yfWRRnfXmoJ3FVtgToAsJUYmzoSFY08eDx+rmSqCLe
    rdJjX8aG8jVXpGipEo9U4QsUK+OKzx3/y/OaK4cizoWqKvy1l4lEzDsA2VydAAUT
    tCdQYXRyaWNrIEEuIFBvd2VsbCA8cGFwb3dlbGxAYXN0YXJ0LmNvbT6JAJUDBRA0
    XonoiUTMOwDZXJ0BAQ2cBAC7zU9Fn3sC3x0USJ+3vjhg/qA+Gjb5Fi1dJd4solc4
    vJvtf0UL/1/rGipbR+A0XHpHzJUMP9ZfJzKZjaK/d0ZBNlS3i+JnypypeQiAqo9t
    FV0OyUCwDfWybgAORuAa2V6UJnAhvj/7TpxMmCApolaIb4yFyKunHa8aBxN+17Ro
    rrQlUGF0cmljayBBLiBQb3dlbGwgPHBhcG93ZWxsQHNkc3UuZWR1PokAlQMFEDLy
    gTSJRMw7ANlcnQEBYBYD/0zTeoiDNnI+NjaIei6+6z6oakqO70qFVx0FG3aP3kRH
    WlDhdtFaAuaMRh+RItHfFfcHhw5K7jiJdgKiTgGfj5Vt3OdHYkeeh/sddqgf9YnS
    tpj0u5NfrotPTUw39n6YTgS5/aW0PQfO9dx7jVUcGeod1TGXTe9mIhDMwDJI4J14
    =3Zbp
    -----END PGP PUBLIC KEY BLOCK-----
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN291">1.10. References and
          Standards</a></h2>

          <p>The following references and standards have been used
          in the development of the <b class=
          "APPLICATION">LPRng</b> software.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN295">1.10.1.
            RFCs</a></h3>

            <p>During the early development of the Internet
            developers did not want to go through the laborious
            process of developing formal standards and applying to
            a standards body such as the EIA, IEEE, or ISO.
            Instead, they called the standards documents they
            developed [<span class="CITATION">Requests for
            Comments</span>]. These soon became <span class=
            "emphasis"><i class="EMPHASIS">de facto</i></span>
            standards, and with the formal acceptance of the TCP/IP
            protocol as a network standard, <span class=
            "emphasis"><i class="EMPHASIS">de jure</i></span> as
            well.</p>

            <p>You can get copies of the RFCs from literally
            hundreds of network sites, including <a href=
            "http://www.isi.edu" target=
            "_top">http://www.isi.edu</a>, <a href=
            "http://www.faqs.org/rfcs" target=
            "_top">http://www.faqs.org/rfcs</a>, <a href=
            "ftp://NIS.NSF.NET" target="_top">NIS.NSF.NET</a>, <a
            href="ftp://RFC.JVNC.NET" target=
            "_top">RFC.JVNC.NET</a>, or <a href="ftp://FTP.ISI.EDU"
            target="_top">FTP.ISI.EDU</a>.</p>

            <p>The [<span class="CITATION">RFC1179 - Line Printer
            Daemon Protocol</span>] describes the protocol used to
            transfer jobs from client program to print server. See
            <a href="#RFC1179REF">RFC1179</a> for more a discussion
            of this protocol and more details about the RFC. The <a
            href="rfc1179.txt" target="_top">rfc1179.txt</a> file
            is included in the <b class="APPLICATION">LPRng</b>
            distribution documentation.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="POSTSCRIPT">1.10.2.
            PostScript</a></h3>

            <p>PostScript is one of the <span class="emphasis"><i
            class="EMPHASIS">de facto</i></span> standards for
            print jobs. The Adobe Corporation (<a href=
            "http://www.adobe.com" target=
            "_top">http://www.adobe.com</a>) provides an excellent
            set of references for the PostScript language. They
            have made many of these available for downloading from
            their web sites or have published them in book
            form.</p>

            <p>The [<span class="CITATION">PostScript Language
            Reference Manual</span>] contains a great deal of
            technical information about the PostScript Language,
            and is the language reference manual.</p>

            <p>The [<span class="CITATION">PostScript Language
            Tutorial and Cookbook</span>] is a very nice and easy
            to read introduction to PostScript programming, and has
            some very useful utilities. Combined with <a href=
            "#GHOSTSCRIPT">GhostScript</a> and the <a href=
            "#GV">gv</a> display program you can very easily learn
            to write your own small PostScript programs, and more
            importantly, can learn to understand the contents of
            PostScript files.</p>

            <p>The [<span class="CITATION">PostScript Language
            Program Design</span>] is the companion to the [<span
            class="CITATION">PostScript Language Tutorial and
            Cookbook</span>], and has more complex examples of
            PostScript programs. More importantly, it also
            introduces, although without explanation, the
            PostScript Document Structuring Conventions described
            in Appendix G of the The [<span class=
            "CITATION">PostScript Language Reference
            Manual</span>]. This alone makes it useful.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="PCL">1.10.3. HP PCL
            5</a></h3>

            <p>The Hewlett-Packard (HP) PCL Printer Language is the
            second de-facto standard for print jobs. Currently,
            Hewlett-Packard makes documentation for PCL available
            through their [<span class="CITATION">Developer
            Program</span>]. You will need to register and then
            search their site for the [<span class="CITATION">PCL 5
            Printer Language Reference Manual</span>].</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="PJL">1.10.4. HP PJL</a></h3>

            <p>The Hewlett-Packard (HP) Printer Job Language is
            used to control various features of HP printers. The
            [<span class="CITATION">Printer Job Language Reference
            Manual</span>] is also available from Hewlett-Packard
            (<a href="http://www.hp.com" target=
            "_top">http://www.hp.com</a>) through their [<span
            class="CITATION">Developer Program</span>].</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN338">1.10.5. PDF</a></h3>

            <p>The Portable Document Format (<var class=
            "LITERAL">pdf</var>) was developed by Adobe to be a
            more useful method of distributing documentation for
            view by online systems and software. The [<span class=
            "CITATION">Portable Document Format Reference
            Manual</span>] is available from Adobe (<a href=
            "http://www.adobe.com" target=
            "_top">http://www.adobe.com</a>). While <var class=
            "LITERAL">pdf</var> is not used directly as a print job
            language, it is one of the more common formats for
            files that need to be printed. It can be converted to
            PostScript by most <var class="LITERAL">pdf</var>
            viewers such as GhostScript and Adobe Acrobat.</p>
          </div>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="INSTALLATION"></a>Chapter 2. Installation</h1>

        <p>The basic components of the <b class=
        "APPLICATION">LPRng</b> system are the executables and the
        database files. This section deals with generating and
        installing the executable files.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN350">2.1. Getting Source
          Code and Support Programs</a></h2>

          <ol type="1">
            <li>
              <p>Obtain the latest or stable version of the <b
              class="APPLICATION">LPRng</b> source code from a <a
              href="#SECFTP"><b class="APPLICATION">LPRng</b> FTP
              Site</a>.</p>
            </li>

            <li>
              <p>Obtain the latest or stable version of the <b
              class="APPLICATION">ifhp</b> filter source code from
              a <a href="#SECFTP"><b class="APPLICATION">LPRng</b>
              FTP Site</a>. This filter is used to support
              PostScript, PCL, and text printers.</p>
            </li>

            <li>
              <p>Obtain the following GNU programs from one of the
              many <a href="http://www.gnu.org" target="_top">GNU
              Software Mirror Sites</a> and install them. See the
              directions in the GNU Zip distribution for
              details.</p>

              <div class="VARIABLELIST">
                <dl>
                  <dt>GNU <b class="APPLICATION">gzip</b>
                  Compression Utility</dt>

                  <dd>
                    <p>Used to generate the compressed <b class=
                    "APPLICATION">LPRng</b> distribution.</p>
                  </dd>

                  <dt>GNU <b class="APPLICATION">tar</b> Archive
                  Utility</dt>

                  <dd>
                    <p><a href="http://www.gnu.org" target=
                    "_top">GNU</a> <b class="APPLICATION">tar</b>
                    supports <b class="APPLICATION">gzip</b>
                    compression and decompression and is used to
                    generate the <b class="APPLICATION">LPRng</b>
                    distribution.</p>
                  </dd>

                  <dt>GNU <b class="APPLICATION">make</b></dt>

                  <dd>
                    <p><b class="APPLICATION">LPRng</b> requires <a
                    href="http://www.gnu.org" target="_top">GNU</a>
                    <b class="APPLICATION">make</b> for
                    configuration and installation.</p>
                  </dd>

                  <dt>GNU <b class="APPLICATION">gcc</b> Compiler
                  or ANSI C Compiler</dt>

                  <dd>
                    <p><b class="APPLICATION">LPRng</b> requires
                    and ANSI C compiler. If you do not have an ANSI
                    C compiler then please use the <a href=
                    "http://www.gnu.org" target="_top">GNU</a> <b
                    class="APPLICATION">gcc</b> compiler.</p>
                  </dd>
                </dl>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>Solaris Sparc and X86 Binaries for GCC and Make
              can be obtained from <a href=
              "http://sunfreeware.com/" target=
              "_top">http://sunfreeware.com/</a>.</p>
            </li>

            <li>
              <p>While the following are not essential to <b class=
              "APPLICATION">LPRng</b> they are used by the <b
              class="APPLICATION">ifhp</b> filter.</p>

              <div class="VARIABLELIST">
                <dl>
                  <dt><b class="APPLICATION">file</b> - File
                  Identification Utility</dt>

                  <dd>
                    <a name="FILEPROG"></a>

                    <p>The Open Source <b class=
                    "APPLICATION">file</b> utility by Ian F. Darwin
                    can be obtained from <a href=
                    "ftp://ftp.astron.com/pub/file/" target=
                    "_top">ftp://ftp.astron.com/pub/file/</a>. or
                    <a href=
                    "ftp://ftp.lprng.com/pub/LPRng/UNIXTOOLS/file/"
                    target=
                    "_top">ftp://ftp.lprng.com/pub/LPRng/UNIXTOOLS/file/</a>.
                    This is a greatly improved version of the
                    original UNIX file utility and may be used by
                    the <b class="APPLICATION">ifhp</b> filter to
                    do file recognition.</p>
                  </dd>

                  <dt><b class="APPLICATION">gs</b> -
                  GhostScript</dt>

                  <dd>
                    <a name="GHOSTSCRIPT"></a>

                    <p>GhostScript can be obtained from <a href=
                    "http://www.cs.wisc.edu/~ghost/" target=
                    "_top">http://www.cs.wisc.edu/~ghost/</a> or <a
                    href="http://www.ghostscript.com" target=
                    "_top">http://www.ghostscript.com</a>.
                    GhostScript is a PostScript interpreter that
                    allows you to translate PostScript to various
                    printer compatible formats such as PCL, as well
                    as displaying the code on a terminal. You might
                    also want to get the PDF extensions that allows
                    GhostScript to read and print PDF files.</p>
                  </dd>

                  <dt><b class="APPLICATION">gv</b> -
                  GhostView</dt>

                  <dd>
                    <a name="GV"></a>

                    <p>Of course you will want to get the <b class=
                    "APPLICATION">gv</b> program that uses
                    GhostScript to display PostScript on an X
                    terminal. It can be obtained from <a href=
                    "http://wwwthep.physik.uni-mainz.de/~plass/gv/"
                    target=
                    "_top">http://wwwthep.physik.uni-mainz.de/~plass/gv/</a></p>
                  </dd>
                </dl>
              </div>
              <br>
              <br>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN433">2.2. <var class=
          "ENVAR">PATH</var> Environment Variable and
          Utilities</a></h2>

          <p>Make sure that directory where you you have installed
          the GNU tools is one of the first entries in the shell
          search <var class="ENVAR">PATH</var> environment
          variable. For example, if you have installed the
          utilities in the (default) directory <tt class=
          "FILENAME">/usr/local/bin</tt>, this should be one of the
          first entries in the <var class="ENVAR">PATH</var>. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN440"></a>
<pre class="SCREEN">
    PATH=/usr/local/bin:/bin:/sbin:/usr/bin
</pre>
          </div>
          <br>
          <br>

          <p>If you are compiling the distribution on a Solaris
          system you will need to use the utilities in the <tt
          class="FILENAME">/usr/ccs/bin</tt> directory. This
          directory must be in the <var class="ENVAR">PATH</var>
          <span class="emphasis"><i class=
          "EMPHASIS">after</i></span> the directory where the GNU
          utilities have been installed. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN446"></a>
<pre class="SCREEN">
    PATH=/usr/local/bin:/bin:/sbin:/usr/bin:/usr/ccs/bin
</pre>
          </div>
          <br>
          <br>

          <p>Check to see that the GNU <b class=
          "APPLICATION">make</b> utility and not the default OS <b
          class="APPLICATION">make</b> is being used by default.
          Use <tt class="COMMAND">make -v</tt> to determine what
          version you are using:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN452"></a>

            <p class="LITERALLAYOUT"><samp class="PROMPT">h4: {1}
            %</samp> <kbd class="USERINPUT">make -v</kbd><br>
            GNU&nbsp;Make&nbsp;version&nbsp;3.78,&nbsp;by&nbsp;Richard&nbsp;Stallman&nbsp;and&nbsp;Roland&nbsp;McGrath.<br>

            Copyright&nbsp;(C)&nbsp;1988-1999</p>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="NFSMOUNT">2.3. Network Mounted
          File System and Spool Directories</a></h2>

          <div class="WARNING">
            <blockquote class="WARNING">
              <p><b>Warning</b>It is strongly recommended that the
              print spool directories and essential printer
              configuration file files should <span class=
              "emphasis"><i class="EMPHASIS">NOT</i></span> be in
              an NFS mounted file system or on a file system which
              is NFS exported.</p>
            </blockquote>
          </div>

          <p>The <b class="APPLICATION">LPRng</b> <b class=
          "APPLICATION">lpd</b> print server makes heavy use of
          file locking to coordinate and synchronize process
          activities. Given the historical and ongoing problems of
          file locking on and NFS mounted file system, not to
          mention the high overhead for doing file locking in a
          distributed environment, it is strongly recommended that
          spool directories <span class="emphasis"><i class=
          "EMPHASIS">NOT</i></span> be on an NFS mounted partition
          or on a partition that is NFS exported.</p>

          <p>This warning extends to other network file systems as
          well.</p>

          <p>In addition, the configuration file such as <tt class=
          "FILENAME">/etc/printcap</tt> must be available or
          printing will not function. Care should be taken to
          ensure that these files are stable and available at all
          times.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="USERGROUP">2.4. Daemon User
          and Daemon Group</a></h2>

          <p>The <b class="APPLICATION">lpd</b> server is started
          at system initialization time and initially runs as ROOT
          (Effective <acronym class="ACRONYM">UID</acronym> 0). It
          performs all file and other operations with <span class=
          "emphasis"><i class="EMPHASIS">non-privileged</i></span>
          user <var class="LITERAL">daemon</var> Effective <acronym
          class="ACRONYM">UID</acronym> and group <var class=
          "LITERAL">daemon</var> Effective GID, and does a <code
          class="FUNCTION">setuid()</code> to these UID and GID
          values when running programs. The client programs such as
          <b class="APPLICATION">lpr</b> operate with the effective
          user IDs of the user which started them.</p>

          <p>Most UNIX systems already have user <var class=
          "LITERAL">daemon</var> and group <var class=
          "LITERAL">daemon</var>, or a similar ones. If suitable
          user and group IDs are not present then the appropriate
          system administration tools should be used to create
          them. The configuration <var class=
          "LITERAL">--with-userid=UID</var> and <var class=
          "LITERAL">--with-groupid=GID</var> can be used to specify
          the user and group IDs. The user ID must <span class=
          "emphasis"><i class="EMPHASIS">not</i></span> have login
          capability.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN485">2.5.
          Configuration</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> package consists
          of the following executables and configuration files:</p>

          <ul>
            <li>
              <p><b class="APPLICATION">lpd</b> - the <b class=
              "APPLICATION">lpd</b> print server program</p>
            </li>

            <li>
              <p><b class="APPLICATION">lpr</b>, <b class=
              "APPLICATION">lpq</b>, <b class=
              "APPLICATION">lprm</b>, <b class=
              "APPLICATION">lpc</b>, and <b class=
              "APPLICATION">lpstat</b> client programs for
              printing, status queries, job removal, server
              configuration, and System V <b class=
              "APPLICATION">lpstat</b> emulation respectively.</p>
            </li>

            <li>
              <p><tt class="FILENAME">printcap</tt> print queue
              database file which is used by all the server and
              client programs</p>
            </li>

            <li>
              <p><tt class="FILENAME">lpd.conf</tt> <b class=
              "APPLICATION">LPRng</b> configuration options which
              is used by all the server and client programs</p>
            </li>

            <li>
              <p><tt class="FILENAME">lpd.perms</tt> permission
              information which is used by the <b class=
              "APPLICATION">lpd</b> server to control user
              actions.</p>
            </li>
          </ul>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> uses the <b class=
          "APPLICATION">configure</b> script generated by the <a
          href="http://www.gnu.org" target="_top">GNU</a> <b class=
          "APPLICATION">autoconf</b> utility to generate a set of
          <tt class="FILENAME">Makefiles</tt>. These are used by <a
          href="http://www.gnu.org" target="_top">GNU</a> <b class=
          "APPLICATION">make</b> to compile and install the <b
          class="APPLICATION">LPRng</b> software. The following <tt
          class="FILENAME">Makefile</tt> variables and values are
          set by <b class="APPLICATION">configure</b> to specify
          the location of the <b class="APPLICATION">LPRng</b>
          software:</p>

          <div class="INFORMALTABLE">
            <a name="AEN525"></a>

            <table border="1" class="CALSTABLE">
              <col>
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Configure Variable</th>

                  <th>Default Value</th>

                  <th>Expanded Default Value</th>

                  <th>Override</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td><var class="LITERAL">${prefix}</var></td>

                  <td><var class="LITERAL">/usr/local</var></td>

                  <td><var class="LITERAL">--prefix=PATH</var></td>

                  <td>&nbsp;</td>
                </tr>

                <tr>
                  <td><var class=
                  "LITERAL">${exec_prefix}</var></td>

                  <td><var class="LITERAL">${prefix}</var></td>

                  <td><var class="LITERAL">/usr/local</var></td>

                  <td><var class="LITERAL">--execprefix=
                  PATH</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${bindir}</var></td>

                  <td><var class=
                  "LITERAL">${exec_prefix}/bin</var></td>

                  <td><var class=
                  "LITERAL">/usr/local/bin</var></td>

                  <td><var class="LITERAL">--bindir=
                  PATH</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${sbindir}</var></td>

                  <td><var class=
                  "LITERAL">${exec_prefix}/sbin</var></td>

                  <td><var class=
                  "LITERAL">/usr/local/sbin</var></td>

                  <td><var class="LITERAL">--sbindir=
                  PATH</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${libexecdir}</var></td>

                  <td><var class="LITERAL">${exec_prefix}
                  /libexec</var></td>

                  <td><var class=
                  "LITERAL">/usr/local/libexec</var></td>

                  <td><var class="LITERAL">--libexecdir=
                  PATH</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${sysconfdir}</var></td>

                  <td><var class="LITERAL">${prefix}/etc</var></td>

                  <td><var class=
                  "LITERAL">/usr/local/etc</var></td>

                  <td><var class="LITERAL">--sysconfdir=
                  PATH</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${mandir}</var></td>

                  <td><var class="LITERAL">${prefix}/man</var></td>

                  <td><var class=
                  "LITERAL">/usr/local/man</var></td>

                  <td><var class="LITERAL">--mandir=
                  PATH</var></td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>These are used to install the following files:</p>

          <div class="INFORMALTABLE">
            <a name="AEN596"></a>

            <table border="1" class="CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Configure Variable</th>

                  <th>Files</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td><var class="LITERAL">${bindir}</var></td>

                  <td><var class="LITERAL">lpr, lprm, lpq,
                  lpstat</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${sbindir}</var></td>

                  <td><var class="LITERAL">lpc, checkpc,
                  lpd</var></td>
                </tr>

                <tr>
                  <td><var class=
                  "LITERAL">${libexecdir}/filters</var></td>

                  <td><var class="LITERAL">lpf, pclbanner,
                  psbanner, lpbanner</var></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">${sysconfdir}</var></td>

                  <td><var class="LITERAL">lpd.conf, lpd.perms,
                  printcap</var></td>
                </tr>

                <tr>
                  <td><var class=
                  "LITERAL">${mandir}/man[1-9]</var></td>

                  <td><var class="LITERAL">man pages</var></td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>You can set explicit values for the paths by using the
          override <var class="LITERAL">--name=PATH</var>. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN630"></a>
<pre class="SCREEN">
    ./configure --prefix=/usr --sysconfdir=/etc \
        --mandir=/usr/share/man
</pre>
          </div>
          <br>
          <br>

          <div class="INFORMALTABLE">
            <a name="AEN632"></a>

            <table border="1" class="CALSTABLE">
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Variable</th>

                  <th>Value</th>

                  <th>Files</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>${bindir}</td>

                  <td>/usr/bin</td>

                  <td>/usr/bin/{lpr,lprm,lpq,lpstat}</td>
                </tr>

                <tr>
                  <td>${sbindir}</td>

                  <td>/usr/sbin</td>

                  <td>/usr/sbin/{lpc,checkpc,lpd}</td>
                </tr>

                <tr>
                  <td>${libexecdir}/filters</td>

                  <td>/usr/libexec/filters</td>

                  <td>/usr/libexec/filters{lpf, pclbanner,
                  psbanner, lpbanner}</td>
                </tr>

                <tr>
                  <td>${sysconfdir}</td>

                  <td>/etc</td>

                  <td>/etc/{lpd.conf,lpd.perms,printcap}</td>
                </tr>

                <tr>
                  <td>${mandir}/man[1-9]</td>

                  <td>/usr/share/man</td>

                  <td>/usr/share/man/man[1-9]/{man pages}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>In addition to these standard <b class=
          "APPLICATION">configure</b> options the following options
          provided.</p>

          <div class="VARIABLELIST">
            <dl>
              <dt><var class="LITERAL">--disable-setuid</var></dt>

              <dd>
                <p>Install the executables without setuid ROOT
                permissions. Non-setuid clients and programs are
                inherently more secure than SETUID programs, and
                system administrators would be well advised to
                install them without SETUID root permissions.
                Please see <a href="#SETUID">Security
                Considerations</a> for more details about this
                option.</p>
              </dd>

              <dt><var class=
              "LITERAL">--enable-priv_ports</var></dt>

              <dd>
                <p>Require connections to the <b class=
                "APPLICATION">lpd</b> server to come from a
                privileged port (range 1-1023). By default <b
                class="APPLICATION">LPRng</b> will allow
                connections from any port. Please see <a href=
                "#SETUID">Security Considerations</a> for more
                details about this option.</p>
              </dd>

              <dt><var class=
              "LITERAL">--disable-force_localhost</var></dt>

              <dd>
                <p>The default <b class="APPLICATION">LPRng</b>
                configuration assumes that all printing will be
                done via a <b class="APPLICATION">lpd</b> print
                spooler running on the local host system. However,
                many larger sites prefer that all users do their
                printing via a few central servers, and do not run
                <b class="APPLICATION">lpd</b> servers on user
                systems. The <var class=
                "LITERAL">--disable-force_localhost</var>
                configuration sets the default value of the <var
                class="LITERAL">force_localhost</var> value to <var
                class="LITERAL">false</var>, by default allowing
                the <b class="APPLICATION">LPRng</b> clients to
                connect directly to <b class="APPLICATION">lpd</b>
                servers on remote hosts.</p>
              </dd>

              <dt><var class=
              "LITERAL">--disable-require_configfiles</var></dt>

              <dd>
                <p>By default, the <b class="APPLICATION">lpr</b>,
                <b class="APPLICATION">lpq</b>, <b class=
                "APPLICATION">lprm</b>, and <b class=
                "APPLICATION">lpc</b> clients require the <tt
                class="FILENAME">lpd.conf</tt> and <tt class=
                "FILENAME">printcap</tt> files to be present on the
                localhost. The <var class=
                "LITERAL">--disable-require_configfiles</var>
                literal removes this requirement.</p>
              </dd>

              <dt><var class="LITERAL">--enable-kerberos</var></dt>

              <dd>
                <p>Include support for Kerberos 5 authenticated
                transfers.</p>
              </dd>

              <dt><var class=
              "LITERAL">--enable-mit_kerberos4</var></dt>

              <dd>
                <p>Include support for MIT Kerberos 4 authenticated
                transfers.</p>
              </dd>

              <dt><var class=
              "LITERAL">--disable-kerberos_checks</var></dt>

              <dd>
                <p>Disable checks for kerberos support libraries,
                etc.</p>
              </dd>

              <dt><var class="LITERAL">--with-lpddir=DIR</var></dt>

              <dd>
                <p>lpd executable directory (default ${sbindir}).
                For historical configuration compatibility.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-filterdir=DIR</var></dt>

              <dd>
                <p>Filter directory (default
                ${libexecdir}/filters). For historical
                configuration compatibility.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-lpd_conf_path=PATH</var></dt>

              <dd>
                <p>Path of <tt class="FILENAME">lpd.conf</tt> file.
                For historical configuration compatibility.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-lpd_perms_path=PATH</var></dt>

              <dd>
                <p>Path of <tt class="FILENAME">lpd.perms</tt>
                file. For historical configuration
                compatibility.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-printcap_path=PATH</var></dt>

              <dd>
                <p>Path of <tt class="FILENAME">printcap</tt> file.
                For historical configuration compatibility.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ld_library_path=PATHLIST</var></dt>

              <dd>
                <p>Set the LD_LIBRARY_PATH environment variable of
                filters to this value.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-filter_path=PATHLIST</var></dt>

              <dd>
                <p>Set the PATH environment variable of filters to
                this value.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-userid=NAME</var></dt>

              <dd>
                <p>Run <b class="APPLICATION">LPRng</b> as this
                user, default daemon</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-groupid=NAME</var></dt>

              <dd>
                <p>Run <b class="APPLICATION">LPRng</b> as this
                group, default daemon</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-lockfile=PATH</var></dt>

              <dd>
                <p>The lockfile path. This will be expanded to
                PATH.server or PATH.port allowing multiple <b
                class="APPLICATION">LPRng</b> servers to run on a
                single host.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-filterdir=PATH</var></dt>

              <dd>
                <p>Location of the filters installed by <b class=
                "APPLICATION">LPRng</b>.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-done_jobs=N</var></dt>

              <dd>
                <p>retain status of last N done jobs.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-done_jobs_max_age=N</var></dt>

              <dd>
                <p>remove status of done jobs older than N
                seconds.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-chooser_routine=NAME</var></dt>

              <dd>
                <p>name of chooser routine provided by user</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-order_routine=NAME</var></dt>

              <dd>
                <p>name of order routine provided by user</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-user_objs=NAME</var></dt>

              <dd>
                <p>object file with routines provided by user</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-user_include=NAME</var></dt>

              <dd>
                <p>include file with templates for routines
                provided by user</p>
              </dd>

              <dt><var class="LITERAL">--disable-strip</var></dt>

              <dd>
                <p>Do not strip the executables before installing.
                For debugging and diagnostic purposes.</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-unixsocketpath=PATHNAME</var></dt>

              <dd>
                <p>the pathname of the UNIX socket (off or blank to
                disable)</p>
              </dd>

              <dt><var class="LITERAL">--disable-ssl</var></dt>

              <dd>
                <p>disable ssl support</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-openssl=DIR</var></dt>

              <dd>
                <p>root location for OpenSSL</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-openssl-inc</var></dt>

              <dd>
                <p>OpenSSL include files</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-openssl-lib</var></dt>

              <dd>
                <p>OpenSSL library files</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ssl_ca_file=FILE</var></dt>

              <dd>
                <p>ssl Certificate Authority CERT file (default
                ${sysconfdir}/lpd/ssl.ca/ca.crt)</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ssl_ca_key=KEY</var></dt>

              <dd>
                <p>ssl Certificate Authority private key file
                (default ${sysconfdir}/lpd/ssl.ca/ca.key)</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ssl_certs_dir=DIR</var></dt>

              <dd>
                <p>ssl Certificate Authority certs working
                directory (default
                ${sysconfdir}/lpd/ssl.certs/)</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ssl_server_cert=FILE</var></dt>

              <dd>
                <p>ssl server certificate file (default
                ${sysconfdir}/lpd/ssl.server/server.crt)</p>
              </dd>

              <dt><var class=
              "LITERAL">--with-ssl_server_password_file=FILE</var></dt>

              <dd>
                <p>ssl server private key in password file (default
                ${sysconfdir}/lpd/ssl.server/server.pwd)</p>
              </dd>
            </dl>
          </div>
          <br>
          <br>

          <p>It is recommended that you use one of the following
          configurations:</p>

          <ol type="1">
            <li>
              <p>If you already have a print spooling system
              installed and want to install <b class=
              "APPLICATION">LPRng</b> for testing purposes or as an
              alternative to the existing system and keep your
              existing print spooling system, use:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN869"></a>
<pre class="SCREEN">
    ./configure
    
    use defaults for file locations and permissions:
      /usr/local/{bin,sbin,libexec/filters,man}
    requires lpd to run on the local host
    executables installed setuid ROOT
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If you have manual pages in <tt class=
              "FILENAME">/usr/share/man</tt>, your existing print
              spooling system has executables in <tt class=
              "FILENAME">/usr/bin</tt> and <tt class=
              "FILENAME">/usr/sbin</tt>, and you want to replace
              your existing print spooling system, use:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN876"></a>
<pre class="SCREEN">
    ./configure --prefix=/usr --sysconfdir=/etc \
      --mandir=/usr/share/man
    
    executables and files in
       /usr/{bin,sbin,libexec/filters}
       /usr/share/man/man[0-9]
    requires lpd to run on the local host
    everything installed setuid ROOT
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If you have manual pages in <tt class=
              "FILENAME">/usr/share/man</tt> and allow jobs (by
              default) to be sent directly to the server host
              (lightweight operation), use:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN881"></a>
<pre class="SCREEN">
    ./configure --prefix=/usr --sysconfdir=/etc \
       --mandir=/usr/share/man --disable-force_localhost
    
    executables and files in
       /usr/{bin,sbin,libexec/filters}
       /usr/share/man/man[0-9]
    does not require lpd to run on the local host
    everything installed setuid ROOT
</pre>
              </div>
              <br>
              <br>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="REQUIRECONFIG">2.6. System and
          User Printcap, lpd.conf, and lpd.perms files</a></h2>

          <p>The system <tt class="FILENAME">printcap</tt> file
          contains the definitions of the print queues used by <b
          class="APPLICATION">LPRng</b>, and is located in the
          directory specified by the configuration <var class=
          "LITERAL">${sysconfdir}</var> value. For a complete
          description of the <tt class="FILENAME">printcap</tt>
          file see <a href="#PRINTCAPREF">Printcap Database</a>. If
          your system does not have an existing <tt class=
          "FILENAME">printcap</tt> file then a <span class=
          "emphasis"><i class="EMPHASIS">dummy</i></span> file
          similar to the following is installed by default:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN893"></a>
<pre class="SCREEN">
    # dummy printcap file
    lp:cm=Dummy Printcap Entry:
     :lp=/dev/null
     :sd=/var/spool/lpd/%P
</pre>
          </div>
          <br>
          <br>

          <p>In addition to the system <tt class=
          "FILENAME">printcap</tt> file, each user can have a <var
          class="LITERAL">${HOME}/.printcap</var> which contains
          printcap entries as well. The the user <tt class=
          "FILENAME">printcap</tt> file is in effect appended to
          the system printcap file, and values in the user printcap
          file override the system printcap file. However, in order
          to allow users to specify a default printer after reading
          the printcap file information the entries are sorted so
          that printcap entries defined by users come first.</p>

          <p>The <tt class="FILENAME">lpd.conf</tt> is located in
          the <var class="LITERAL">${sysconfdir}</var> directory
          and provides configuration settings for both the <b
          class="APPLICATION">LPRng</b> client and server programs.
          For a complete description of the <tt class=
          "FILENAME">lpd.conf</tt> file see <a href=
          "#CONFIGFILE">Configuration File, Defaults and
          Overrides</a>. During installation the <tt class=
          "FILENAME">${sysconfdir}/lpd.conf.template</tt> is
          created with the default <b class="APPLICATION">LPRng</b>
          information and if there is not an existing <tt class=
          "FILENAME">${sysconfdir}/lpd.conf</tt> file is copied to
          it.</p>

          <p>The <tt class="FILENAME">lpd.perms</tt> is located in
          the <var class="LITERAL">${sysconfdir}</var> directory
          and is only by <b class="APPLICATION">lpd</b> to
          determine user permissions for printing activities. For a
          complete description of the <tt class=
          "FILENAME">lpd.perms</tt> file see <a href=
          "#PERMSREF">Permissions and Authentication</a> for
          details. During installation the <tt class=
          "FILENAME">lpd.perms.template</tt> file is installed in
          the <tt class=
          "FILENAME">${sysconfdir}/lpd.perms.template</tt> and if
          there is not an existing <tt class=
          "FILENAME">lpd.perms</tt> file is copied to it.</p>

          <p>By default, the <b class="APPLICATION">LPRng</b>
          client programs <b class="APPLICATION">lpr</b>, <b class=
          "APPLICATION">lpq</b>, <b class="APPLICATION">lprm</b>,
          and <b class="APPLICATION">lprc</b> will require a <tt
          class="FILENAME">lpd.conf</tt> and <tt class=
          "FILENAME">printcap</tt> file to be installed on the
          local host. You can relax this requirement by setting
          using the <var class=
          "LITERAL">--disable-require_configfile</var>
          configuration option. You can also create empty files to
          satisfy the program requirements.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN926">2.7. Checking System
          Installation with <b class=
          "APPLICATION">checkpc</b></a></h2>

          <p>The <b class="APPLICATION">checkpc</b> program is used
          to make sure that the spool directories and files used by
          <b class="APPLICATION">LPRng</b> have the correct
          permissions and are in place. By default, <b class=
          "APPLICATION">checkpc</b> will check permissions and
          report if there are any problems. You should run this as
          <var class="LITERAL">root</var>. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN934"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {2} #</samp> <kbd class=
"USERINPUT">checkpc</kbd>
    Warning - No configuration file '/etc/lpd.conf'
    Warning - No lpd only printcap file found in '/etc/lpd_printcap'
    Warning -  ** cannot open '/var/run/lpd.printer' - 'Permission denied'
    Warning -  bad directory - /var/spool/lpd/lp
    Warning -   Printer 'lp' spool dir '/var/spool/lpd/lp' needs fixing
</pre>
          </div>
          <br>
          <br>

          <p>In the above example, <b class=
          "APPLICATION">checkpc</b> has discovered that the <tt
          class="FILENAME">lpd.conf</tt> file is missing. This is a
          serious problem and indicates that the software may be
          incorrectly installed.</p>

          <p>The <var class="LITERAL">lpd only printcap</var>
          message is usually of concern to administrators who wish
          to use some of <b class="APPLICATION">LPRng</b>'s more
          exotic configuration options. It is possible to have
          separate <tt class="FILENAME">printcap</tt> files for
          client and server programs. This is useful when <tt
          class="FILENAME">printcap</tt> files get extremely large
          and cuts down substantially on system management
          problems.</p>

          <p>The <var class="LITERAL">permission denied</var>
          message for <tt class=
          "FILENAME">/var/run/lpd.printer</tt> is serious, as the
          <b class="APPLICATION">lpd</b> server uses this as a lock
          file.</p>

          <p>The <var class="LITERAL">bad directory</var> message
          about the spool directory is usually caused by wrong
          permissions or a missing directory.</p>

          <p>The <tt class="COMMAND">checkpc -f</tt> (fix) option
          causes <b class="APPLICATION">checkpc</b> to take action
          to rectify errors. The <tt class="COMMAND">checkpc -f
          -V</tt> (verbose) option causes the fixup activity to be
          displayed a well:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN956"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {3} #</samp> <kbd class=
"USERINPUT">checkpc -f -V</kbd>
    Checking for configuration files '/etc/lpd.conf'
      found '/usr/local/etc/lpd.conf', mod 0100644
    Checking for printcap files '/etc/printcap'
      found '/usr/local/etc/printcap', mod 0100644
    Checking for lpd only printcap files '/etc/lpd_printcap'
     DaemonUID 1, DaemonGID 1
    Using Config file '/etc/lpd.conf'
    LPD lockfile '/var/run/lpd.printer'
     Checking directory: '/var/run'
       directory '/var'
       directory '/var/run'
      checking '/var/run/lpd.printer' file
    
    Checking printer 'lp'
     Checking directory: '/var/spool/lp'
       directory '/var'
       directory '/var/spool'
       directory '/var/spool/lp'
      file 'control.lp', zero length file unchanged in 1 hours
      file 'status.lp', zero length file unchanged in 1 hours
      file 'status', zero length file unchanged in 1 hours
      file 'log', zero length file unchanged in 1 hours
      file 'acct', zero length file unchanged in 1 hours
      checking 'control.lp' file
      checking 'status.lp' file
      checking 'status' file
      cleaning 'status' file, 0K bytes: no truncation
      checking 'log' file
      cleaning 'log' file, 0K bytes: no truncation
      checking 'acct' file
      cleaning 'acct' file, 0K bytes: no truncation
</pre>
          </div>
          <br>
          <br>

          <p><b class="APPLICATION">checkpc</b> will create the
          spool directories and any missing files, and fix the
          permissions of existing files.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN962">2.8. Compilation and
          Install</a></h2>

          <p>Once you have decided on the configuration you want
          and understand what files need to be installed, then you
          are ready to do the install. It is extremely simple to
          extract the files, configure, compile and install the
          software:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN965"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {4} %</samp> <kbd class=
"USERINPUT">gunzip -c LPRng-&lt;version&gt;.tgz | tar xvf -</kbd>
    <samp class="PROMPT">h4: {5} %</samp> <kbd class=
"USERINPUT">cd LPRng-&lt;version&gt;</kbd>
    <samp class="PROMPT">h4: {6} %</samp> <kbd class=
"USERINPUT">./configure  [ ... configuration options ]</kbd>
    <samp class="PROMPT">h4: {7} %</samp> <kbd class=
"USERINPUT">make clean all</kbd>
    <samp class="PROMPT">h4: {8} %</samp> <kbd class=
"USERINPUT">su   # you must do the following commands as root</kbd>
    <samp class="PROMPT">h4: {9} #</samp> <kbd class=
"USERINPUT">make install</kbd>
    <samp class="PROMPT">h4: {10} #</samp> <kbd class=
"USERINPUT"># if checkpc did not run, do the next command</kbd>
    <samp class="PROMPT">h4: {11} #</samp> <kbd class=
"USERINPUT"># make sure checkpc and lpq are in your paths</kbd>
    <samp class="PROMPT">h4: {12} #</samp> <kbd class=
"USERINPUT"># if using CSH, use 'rehash' as well</kbd>
    <samp class="PROMPT">h4: {13} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
    <samp class="PROMPT">h4: {14} #</samp> <kbd class=
"USERINPUT"># check to see if the server is running</kbd>
    <samp class="PROMPT">h4: {15} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>During installation you may get an error message
          indicating that the <b class="APPLICATION">lpd</b> file
          could not be installed or the <b class=
          "APPLICATION">lpd</b> server could not be started. If
          this is the case, then carry out the appropriate steps in
          <a href="#UPDATE">Updating Print Spooler Software and
          Startup Scripts</a> to remove the existing print spooling
          software and then try to reinstall <b class=
          "APPLICATION">LPRng</b>. You should also to check the <a
          href="#SYSTEMSPECIFIC">System Specific Notes</a> section
          for any system specific installation requirements.</p>

          <p>While the <b class="APPLICATION">LPRng</b>
          installation scripts try hard to set up the <b class=
          "APPLICATION">lpd</b> server in place, you will still
          need to reboot your host and make sure that the various
          printing facilities are working correctly after
          reboot.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN1000">2.9. Installation
          Problems</a></h2>

          <p>Read the notes for your OS in section <a href=
          "#SYSTEMSPECIFIC">System-dependent notes</a> for specific
          installation help (if any).</p>

          <p>The following is a list of commonly encountered
          problems and their solution. If these do not solve your
          problem, then send mail to the <a href=
          "#MAILLIST">lprng@lprng.com</a> mailing list. You will
          have to subscribe to the list in order to post to the
          list.</p>

          <ol type="1">
            <li>
              <p><b class="APPLICATION">Make</b> complains about a
              malformed <tt class="FILENAME">make</tt> or <tt
              class="FILENAME">Makefile</tt> file, illegal syntax
              in the file, or illegal entries in the file. You are
              most likely not running GNU Make. You <span class=
              "emphasis"><i class="EMPHASIS">must</i></span> use
              GNU <b class="APPLICATION">make</b> or you should be
              a Unix Wizard able to master the mysteries of
              converting GNU Makefiles to your local system <b
              class="APPLICATION">make</b>. It is easier to simply
              install GNU <b class="APPLICATION">make</b>.</p>
            </li>

            <li>
              <p>The C Compiler complains about missing files or
              has a large number of errors. Use <b class=
              "APPLICATION">gcc</b> instead of your vendor's C
              compiler.</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1019"></a>
<pre class="SCREEN">
    configure --with-cc=gcc
</pre>
              </div>
              <br>
              <br>

              <p>If there are messages about missing system files,
              then you most likely have an incomplete set of system
              <tt class="FILENAME">include</tt> files, or the <tt
              class="FILENAME">include</tt> do not properly
              reference other required include files, or the
              include files are located in an <span class=
              "emphasis"><i class="EMPHASIS">unusual</i></span>
              location. If you are using <b class=
              "APPLICATION">gcc</b> then make sure that the <b
              class="APPLICATION">gcc</b> was carried out correctly
              on your system. The easiest way to assure this is to
              recompile and reinstall the <b class=
              "APPLICATION">gcc</b> compiler.</p>
            </li>

            <li>
              <p>If you have checked your compiler installation and
              are still missing libraries or files then the <tt
              class="FILENAME">include</tt> files may be in <tt
              class="FILENAME">/usr/local/include</tt> and
              libraries may be in <tt class=
              "FILENAME">/usr/local/include</tt> and these
              directories may not searched or used by the compiler
              by default. This can be fixed by using the <var
              class="LITERAL">--with-cppopts=</var> and <var class=
              "LITERAL">--with-ldopts=</var> configure options.</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1035"></a>
<pre class="SCREEN">
    configure \
      --with-cppopts="-I/usr/local/include -I/usr/include/kerberosIV" \
      --with-ldopts="-L/usr/local/lib -L/usr/lib/kerberosIV"
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>The software compiles but will not run on the
              system. Make sure that you have followed your system
              specific rules for compiling and installing <var
              class="LITERAL">setuid ROOT</var> programs on your
              system. You may need to statically link your
              executables.</p>
            </li>

            <li>
              <p>The software was compiled on one system and copied
              to another system, but will not run on the other
              system. Try compiling the software on the target
              system. If it compiles and runs, then you most likely
              have an issue with libraries or Operating System
              Versions.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>After you have installed the LPRng software and
          rebooted your system, do the following commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1043"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {16} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@astart
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>If you do not get status displayed, or you get some
          other error message, then the following are a series of
          tests can use to check that <b class=
          "APPLICATION">LPRng</b> is installed correctly.</p>

          <p>First we will run <b class="APPLICATION">lpd</b> in
          the <span class="emphasis"><i class=
          "EMPHASIS">foreground</i></span> and are used to make
          sure that our system configuration is correct. You will
          need <var class="LITERAL">root</var> permissions to do
          the following steps. Stop the running currently running
          <b class="APPLICATION">lpd</b> process. Next, run <b
          class="APPLICATION">lpd</b> in foreground mode:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1055"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {17} #</samp> <kbd class=
"USERINPUT">ps -aux | grep lpd</kbd> 
    daemon   240  0.0  0.0  1292  0  ??  IWs  -     0:00.00 lpd: lpd Waiting
    <samp class="PROMPT">h4: {18} #</samp> <kbd class=
"USERINPUT">kill 240</kbd>
    <samp class="PROMPT">h4: {19} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
    <samp class="PROMPT">h4: {20} #</samp> <kbd class=
"USERINPUT">/usr/local/bin/lpd -F -D1</kbd>
    Fatal error - Another print spooler is using TCP printer port
</pre>
          </div>
          <br>
          <br>

          <p>If you get the above error message, then you have
          either not terminated the running <b class=
          "APPLICATION">lpd</b> server, there is another process
          using TCP/IP port 515, or you are not starting the <b
          class="APPLICATION">lpd</b> server as ROOT. See the <a
          href="#SYSTEMSPECIFIC">System Specific Notes</a> for
          details on how to resolve these issues.</p>

          <p>Correct the problem and then restart the server. You
          should see the output indicated below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1070"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {21} #</samp> <kbd class=
"USERINPUT">/usr/local/bin/lpd -F -D1</kbd>
    1999-04-05-14:35:14.023 astart27 [2667] Waiting  lpd: LOOP START
    1999-04-05-14:35:14.024 astart27 [2667] Waiting  Get_max_servers: \
       getrlimit returns 256
    1999-04-05-14:35:14.024 astart27 [2667] Waiting  Get_max_servers: \
       returning 128
    1999-04-05-14:35:14.025 astart27 [2667] Waiting  lpd: \
       max_servers 128, active 0
    1999-04-05-14:35:14.025 astart27 [2667] Waiting  lpd: \
       starting select timeout 'yes', 600 sec
</pre>
          </div>
          <br>
          <br>

          <p>Now from another window do the following commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1075"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {22} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@astart
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>At this point your <b class="APPLICATION">LPRng</b>
          software has been installed and tested. See the <a href=
          "#UPDATE">Updating Print Spooler Software and Startup
          Scripts</a> for details on how to automatically start <b
          class="APPLICATION">lpd</b> at boot time.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="UPDATE">2.10. Updating Print
          Spooler Software and Startup Scripts</a></h2>

          <p>If you are replacing your existing print spooling
          spooling system, you must shut down and remove the
          existing print spooler software before installing the <b
          class="APPLICATION">LPRng</b> software. This process is
          fairly system dependent, and requires a small amount of
          system expertise.</p>

          <p>To assist in this process the <b class=
          "APPLICATION">LPRng</b> installation has a set of <var
          class="LITERAL">preinstall</var>, <var class=
          "LITERAL">postinstall</var>, <var class=
          "LITERAL">preremove</var>, and <var class=
          "LITERAL">postremove</var> scripts in the distribution
          that may be suitable for your local system use. If these
          fail to work during the system installation, you will
          need to carry out the steps described here by hand.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN1093">2.10.1. SunOS,
            Linux, and BSD Derived Systems</a></h3>

            <p>The <var class="LITERAL">SunOS</var>, <var class=
            "LITERAL">Linux</var>, and <var class=
            "LITERAL">BSD</var> derived systems such as <var class=
            "LITERAL">BSDi</var>, <var class=
            "LITERAL">FreeBSD</var>, <var class=
            "LITERAL">OpenBSD</var>, and others use a version of
            the <span class="emphasis"><i class=
            "EMPHASIS">legacy</i></span> or <span class=
            "emphasis"><i class="EMPHASIS">vintage</i></span> <b
            class="APPLICATION">lpd</b> print server and the <b
            class="APPLICATION">lpr</b>, <b class=
            "APPLICATION">lprm</b>, <b class="APPLICATION">lpq</b>,
            and <b class="APPLICATION">lpc</b> client programs. By
            convention, most of the printing related programs are
            in the <tt class="FILENAME">/usr/bin</tt>, <tt class=
            "FILENAME">/usr/sbin</tt>, <tt class=
            "FILENAME">/usr/libexec</tt>, and <tt class=
            "FILENAME">/usr/ucb</tt> directories.</p>

            <p>The <b class="APPLICATION">lpd</b> print spooler is
            started by either the <tt class="COMMAND">rc</tt>
            startup script or by a <span class="emphasis"><i class=
            "EMPHASIS">startup script</i></span> file in the <tt
            class="FILENAME">/etc/rc.d/init.d</tt> or <tt class=
            "FILENAME">/etc/init.d</tt> directory. You can first
            locate the startup commands as follows.</p>

            <ol type="1">
              <li>
                <p>Use the <span class="CITEREFENTRY"><span class=
                "REFENTRYTITLE">find</span>(1)</span> utility to
                search the <tt class="FILENAME">/etc</tt> directory
                for the file that contains the startup command.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN1126"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {23} #</samp> <kbd class=
"USERINPUT">cd /etc</kbd>
    <samp class="PROMPT">h4: {24} #</samp> <kbd class=
"USERINPUT">find . -type f -exec grep -l lpd {} \; -print</kbd>
    ./rc.local
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Examine each of the files found find the one
                that starts the <b class="APPLICATION">lpd</b>
                print spooler. You can simply comment out the
                command or change it to start the <b class=
                "APPLICATION">LPRng</b> <b class=
                "APPLICATION">lpd</b> print server.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN1137"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {25} #</samp> <kbd class=
"USERINPUT">more /etc/rc.local</kbd>
    if [ -f /etc/printcap  -a -f /usr/libexec/lpd ] ; then
      /usr/libexec/lpd ;
    fi
    
    --- change this to
    if [ -f /etc/printcap  -a -f /usr/sbin/lpd ] ; then
      /usr/sbin/lpd ;
    fi
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>If you have an existing <tt class=
                "FILENAME">printcap</tt> file, then you should
                either copy this to the location used by <b class=
                "APPLICATION">LPRng</b> or make a symbolic link to
                it.</p>
              </li>
            </ol>
            <br>
            <br>

            <p>Next we kill the currently running <b class=
            "APPLICATION">lpd</b> process.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1147"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {26} #</samp> <kbd class=
"USERINPUT">ps -auxw |grep lpd</kbd>
    papowell 23932  0.0  0.3  224  184  p3  S+  10:40AM  0:00.01 grep lpd
    daemon  17763  0.0  0.2  448  120  ??  IWs  29Mar99  0:01.35 (lpd)
    <samp class="PROMPT">h4: {27} %</samp> <kbd class=
"USERINPUT">kill 135</kbd>
    <samp class="PROMPT">h4: {28} %</samp> <kbd class=
"USERINPUT">kill 135</kbd>
    135: No such process
</pre>
            </div>
            <br>
            <br>

            <p>Next, you should remove or rename the existing print
            system executables. The following example shows how to
            use the <b class="APPLICATION">find</b> utility to
            track down candidates.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1157"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {29} #</samp> <kbd class=
"USERINPUT">find /usr -type f -name lp\*  -print &gt;/tmp/candidates</kbd>
    <samp class="PROMPT">h4: {30} #</samp> <kbd class=
"USERINPUT">find /sbin -type f -name lp\*  -print &gt;&gt;/tmp/candidates</kbd>
    <samp class="PROMPT">h4: {31} #</samp> <kbd class=
"USERINPUT">cat /tmp/candidates</kbd>
    /usr/bin/lpunlock
    /usr/bin/lpqall.faces
    /usr/bin/lpq             &lt;---- old
    /usr/bin/lpr             &lt;---- old
    /usr/bin/lprm            &lt;---- old
    /usr/bin/lptest
    /usr/doc/samba-1.9.18p10/examples/printer-accounting/lp-acct
    /usr/man/man1/lpq.1
    /usr/man/man1/lpr.1
    /usr/man/man1/lprm.1
    /usr/man/man1/lptest.1
    /usr/man/man4/lp.4
    /usr/man/man8/lpc.8
    /usr/man/man8/lpd.8
    /usr/sbin/lpc            &lt;--- old
    /usr/sbin/lpd            &lt;--- old
    /usr/sbin/lpf            &lt;--- old
    <samp class="PROMPT">h4: {32} #</samp> <kbd class=
"USERINPUT">mv /usr/bin/lpq  /usr/bin/lpq.old</kbd>
    <samp class="PROMPT">h4: {33} #</samp> <kbd class=
"USERINPUT">mv /usr/bin/lpr  /usr/bin/lpr.old</kbd>
    <samp class="PROMPT">h4: {34} #</samp> <kbd class=
"USERINPUT">mv /usr/bin/lprm /usr/bin/lprm.old</kbd>
    <samp class="PROMPT">h4: {35} #</samp> <kbd class=
"USERINPUT">mv /usr/sbin/lpc /usr/sbin/lpc.old</kbd>
    <samp class="PROMPT">h4: {36} #</samp> <kbd class=
"USERINPUT">mv /usr/sbin/lpd /usr/sbin/lpd.old</kbd>
    <samp class="PROMPT">h4: {37} #</samp> <kbd class=
"USERINPUT">mv /usr/sbin/lpf /usr/sbin/lpf.old</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>After all this, you should now run <tt class=
            "COMMAND">checkpc -f</tt> (as root) to make sure that
            the <b class="APPLICATION">LPRng</b> configuration is
            present and correctly set up, and then start <b class=
            "APPLICATION">lpd</b> by hand. You should try to use <b
            class="APPLICATION">lpq</b> to see if the spool queues
            are present and set up correctly and the system is
            functional.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1183"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {38} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
    <samp class="PROMPT">h4: {39} #</samp> <kbd class=
"USERINPUT">lpd</kbd>
    <samp class="PROMPT">h4: {40} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lw4@h2  'Hp : LaserWriter'
     Queue: no printable jobs in queue
     Status: job 'root@h2+884' removed at 11:27:25.864
     Filter_status: done at 11:27:25.766
    <samp class="PROMPT">h4: {41} #</samp> <kbd class=
"USERINPUT">lpr /etc/motd</kbd>
    <samp class="PROMPT">h4: {42} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lw4@h2  'Hp : LaserWriter'
     Queue: no printable jobs in queue
     Status: job 'root@h2+888' removed at 11:27:25.864
     Filter_status: done at 11:33:17.020
</pre>
            </div>
            <br>
            <br>

            <p>Finally, you should reboot your machine and make
            sure that the <b class="APPLICATION">lpd</b> print
            server starts correctly.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="SOLARISINSTALL">2.10.2.
            Solaris, HP-UX, and other SysVR4 Derived
            Systems</a></h3>

            <p>The original SysVR4 (System V, Release 4) software
            did not have any support for RFC1179 network printing
            (Berkeley <b class="APPLICATION">lpd</b>). Support for
            this was added in a wide variety of different ways.
            There are a wide range of different ways that this was
            done, but most are based on the following system or
            process structure.</p>

            <p>The <var class="LITERAL">lpsched</var> process (<tt
            class="FILENAME">/usr/lib/lp/lpsched/</tt>) process
            performs many of the functions of the <b class=
            "APPLICATION">LPRng</b> and BSD <b class=
            "APPLICATION">lpd</b> server. This process is
            responsible for overseeing job printing and starting
            processes for handling the print queues on the local
            host. This process must be shut down and the running
            print spooling servers terminated before <b class=
            "APPLICATION">LPRng</b> can be correctly installed.
            While there is no simple and reliable method of
            shutting down a running <var class=
            "LITERAL">lpsched</var> process and the associated
            network services, it is simple to <span class=
            "emphasis"><i class="EMPHASIS">prevent</i></span> the
            process from being started.</p>

            <p>The <tt class="FILENAME">preinstall.solaris</tt>
            script is a file in the <b class=
            "APPLICATION">LPRng</b> distribution that contains most
            of the commands needed to remove the Solaris System V
            printing software. These are explained in detail in the
            sections below. The procedures outlined below can be
            used on other SystemVR4 systems.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1212"></a>
<pre class="SCREEN">
    #!/bin/sh
    # This is an effort to automate the setup
    #  needed to install the <b class=
"APPLICATION">LPRng</b> software on the
    #  Solaris OS.  This is effectively a one way path.
    #  You are warned.
    PATH=/etc:/usr/etc:/usr/bin:/bin:/sbin:/usr/sbin:$PATH
    # remove the init.d entry and links
    for i in /etc/rc*.d/*lp ; do
        b=`basename $i`;
        d=`dirname $i`;
        mv $i $d/UNUSED.$b.UNUSED
    done
    # rename files
    renameit () {
        for i in $* ; do
            if [ -f $i -a '!' -f $i.old ] ; then
                echo "renaming $i $i.old";
                mv $i $i.old
            fi
        done
    }
    renameit /usr/bin/lp /usr/bin/lpstat /usr/sbin/lpadmin \
      /usr/sbin/lpfilter /usr/sbin/lpforms /usr/sbin/lpmove \
      /usr/sbin/lpshut /usr/sbin/lpsystem /usr/sbin/lpusers \
      /usr/ucb/lpc /usr/ucb/lpq /usr/ucb/lpr /usr/ucb/lprm \
      /usr/ucb/lptest /usr/lib/lp/lpsched /usr/lib/lp/lpNet
    # remove the cron entry
    if [ -f /var/spool/cron/crontabs/lp ] ; then
        mv /var/spool/cron/crontabs/lp \
           /var/spool/cron/UNUSED.crontabs.lp
    fi
    # comment out inetd.conf entry
    if egrep '^printer' /etc/inetd.conf &gt;/dev/null 2&gt;&amp; ; then
        mv /etc/inetd.conf /etc/inetd.conf.bak
        sed -e 's/^printer/# printer/' &lt;/etc/inetd.conf.bak \
           &gt;/etc/inetd.conf
    fi
    # remove the nlsadmin entry
    nlsadmin -r lpd tcp
    nlsadmin -r lp tcp
    echo REBOOT SYSTEM and then install LPRng
</pre>
            </div>
            <br>
            <br>

            <p>First, you will need to remove the <tt class=
            "FILENAME">/etc/rc</tt> startup files in the <tt class=
            "FILENAME">/etc/rc*.d</tt> directories that start the
            <var class="LITERAL">lpsched</var> process; see the
            <var class="LITERAL">init</var> program man page for
            details. You can find these files by using:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1220"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {43} #</samp> <kbd class=
"USERINPUT">cd /</kbd>
    <samp class="PROMPT">h4: {44} #</samp> <kbd class=
"USERINPUT">find . -type f -exec grep -l lpsched {} \; -print &gt;/tmp/files</kbd>
    <samp class="PROMPT">h4: {45} #</samp> <kbd class=
"USERINPUT">cat /tmp/files</kbd>
    /etc/rc0.d/K20lp
    /etc/rc2.d/K20lp
    /etc/rc2.d/S80lp
    /etc/init.d/lp
    <samp class="PROMPT">h4: {46} #</samp> <kbd class=
"USERINPUT">ls -l ` cat /tmp/files `</kbd>
    lrwxrwxr-x 1 root bin 1 Dec 29 23:39 /etc/rc0.d/K20lp -&gt; ../../init.d/lp
    lrwxrwxr-x 1 root bin 1 Dec 29 23:39 /etc/rc2.d/K20lp -&gt; ../../init.d/lp
    lrwxrwxr-x 1 root bin 1 Dec 29 23:39 /etc/rc2.d/S80lp -&gt; ../../init.d/lp
    -rwxr--r-- 5 root sys 460 Sep 1 1998 /etc/rcS.d/K39lp
</pre>
            </div>
            <br>
            <br>

            <p>You can remove these files, or simply comment out
            all of the executable commands in the <tt class=
            "FILENAME">/etc/init.d/lp</tt> file. Next, find all of
            the printing related commands and rename them. For
            example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1232"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {47} #</samp> <kbd class=
"USERINPUT">find /usr -type f -name lp\* -print &gt;/etc/printingfiles</kbd>
    <samp class="PROMPT">h4: {48} #</samp> <kbd class=
"USERINPUT">cat /tmp/printingfiles</kbd>
    /usr/bin/lp
    /usr/bin/lpstat
    /usr/lib/lp/bin/lp.cat
    /usr/lib/lp/bin/lp.set
    /usr/lib/lp/bin/lp.tell
    /usr/lib/lp/lpNet
    /usr/lib/lp/lpsched
    /usr/lib/lp/lpdata
    /usr/sbin/lpadmin
    /usr/sbin/lpfilter
    /usr/sbin/lpforms
    /usr/sbin/lpmove
    /usr/sbin/lpshut
    /usr/sbin/lpsystem
    /usr/sbin/lpusers
    /usr/ucb/lpc
    /usr/ucb/lpq
    /usr/ucb/lpr
    /usr/ucb/lprm
    /usr/ucb/lptest
    <samp class="PROMPT">h4: {49} #</samp> <kbd class=
"USERINPUT">vi /tmp/printingfiles  # remove ones you want to save</kbd>
    <samp class="PROMPT">h4: {50} #</samp> <kbd class=
"USERINPUT">for i in ` cat /tmp/printingfiles ` ; do</kbd>
    <samp class="PROMPT">&gt;</samp> <kbd class=
"USERINPUT"> if [ -f $i -a '!' -f $i.old ] ; then  mv $i $i.old ; fi;</kbd>
    <samp class="PROMPT">&gt;</samp> <kbd class=
"USERINPUT">done</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>On some systems there may be a <tt class=
            "COMMAND">cron</tt> file <tt class=
            "FILENAME">/var/spool/cron/crontabs/lp</tt> which is
            used to to periodically update and roll over error
            logs. You may want to remove this file or comment out
            its contents.</p>

            <p>Check the <tt class="FILENAME">/etc/inetd.conf</tt>
            file for a line like the one below and comment it out.
            This line is not present on all systems.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1251"></a>
<pre class="SCREEN">
    printer stream tcp nowait root /usr/lib/print/in.lpd in.lpd
</pre>
            </div>
            <br>
            <br>

            <p>Use <tt class="COMMAND">nlsadmin</tt> to force the
            <var class="LITERAL">TCP/IP listener</var> to release
            the port, as illustrated below. This may not be present
            on all system.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1256"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {51} #</samp> <kbd class=
"USERINPUT">nlsadmin -v tcp</kbd>
    lpd  \x00020203000000000000000000000000  ENABLED  \
      NORPC  root  NOMODULES  /var/spool/lp/fifos/listenBSD  #
    0  \x00020ACE000000000000000000000000  ENABLED    \
      NORPC  root  NOMODULES  /usr/lib/saf/nlps_server  #
    lp  NOADDR  ENABLED  NORPC  root  NOMODULES \
      /var/spool/lp/fifos/listenS5  #
    <samp class="PROMPT">h4: {52} #</samp> <kbd class=
"USERINPUT">nlsadmin -r lpd tcp</kbd>
    <samp class="PROMPT">h4: {53} #</samp> <kbd class=
"USERINPUT">nlsadmin -r lp tcp</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>Run <tt class="COMMAND">pmadm -l</tt> as shown
            below.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1266"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h2.private: {2} #</samp> <kbd class=
"USERINPUT">pmadm -l</kbd>
    PMTAG    PMTYPE   SVCTAG   FLGS ID    &lt;PMSPECIFIC&gt;
    zsmon    ttymon   ttya     u    root  /dev/term/a I - /usr/bin/login ...
    zsmon    ttymon   ttyb     u    root  /dev/term/b I - /usr/bin/login ...
</pre>
            </div>
            If you see <tt class="COMMAND">zsmon</tt> entries for
            SystemV <tt class="COMMAND">lpsched</tt> support, then
            use <tt class="COMMAND">pmadm -r</tt> to remove them.
            These may not be present on all system. See the <tt
            class="COMMAND">pmadm</tt> man page for details on the
            <var class="LITERAL">-r</var> literal.<br>
            <br>

            <p>You must now <tt class="COMMAND">reboot</tt> the
            host.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1277"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {54} #</samp> <kbd class=
"USERINPUT">shutdown -y "Whooga! Whooga! Dive! Dive! System going down."</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>When the system reboots, make sure that there is no
            process listening on port 515 (printer port) by
            using:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1282"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {55} #</samp> <kbd class=
"USERINPUT">telnet localhost 515</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>If you can connect, then there is a problem beyond
            the scope of these instructions.</p>

            <p>Compile and/or install the <b class=
            "APPLICATION">LPRng</b> software. Make sure that the <b
            class="APPLICATION">LPRng</b> startup files have been
            installed correctly in <tt class=
            "FILENAME">/etc/init.d/lprng</tt> and that the symbolic
            links to the file have been made correctly. The <b
            class="APPLICATION">LPRng</b> startup file will usually
            have the following contents and you should use the same
            filename formats that the <b class="APPLICATION">lp</b>
            startup files had for the links to the <tt class=
            "FILENAME">/etc/init.d/lprng</tt> startup file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN1294"></a>
<pre class="SCREEN">
    LPD_PATH=/usr/sbin/lpd
    SHOWALL=-e
    case "$1" in
      start)
            # Start daemons.
            /bin/echo "Starting lpd: \c"
            ${LPD_PATH}
            /bin/echo ""
            ;;
      stop)
            # Stop daemons.
            /bin/echo "Shutting down lpd: \c"
            kill -INT `ps ${SHOWALL} \
               | awk '/lpd/{ print $1;}'` &gt;/dev/null 2&gt;&amp;1
            /bin/echo " server stopped";
            ;;
      *)
            echo "Usage: $0 {start|stop}"
            exit 1
            ;;
    esac
</pre>
            </div>
            Start the <b class="APPLICATION">lpd</b> server and
            then test it: 

            <div class="INFORMALEXAMPLE">
              <a name="AEN1297"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {56} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
    <samp class="PROMPT">h4: {57} #</samp> <kbd class=
"USERINPUT">/usr/sbin/lpd (or /usr/local/sbin/lpd)</kbd>
    <samp class="PROMPT">h4: {58} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp
     Queue: no printable jobs in queue
</pre>
            </div>
            <br>
            <br>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPSIMULATION">2.11. Emulation
          for UNIX SystemV <b class="APPLICATION">lp</b> and <b
          class="APPLICATION">lpstat</b></a></h2>

          <p>Many utilities in the UNIX System V environment
          require the <b class="APPLICATION">lp</b>, <b class=
          "APPLICATION">lpstat</b>, and <b class=
          "APPLICATION">cancel</b> programs. It is almost
          impossible to modify these utilities, as many are <span
          class="emphasis"><i class="EMPHASIS">vintage</i></span>
          software which is unsupported or which would be too
          costly to update. In order to support these applications
          <b class="APPLICATION">LPRng</b> emulates the <b class=
          "APPLICATION">lp</b>, <b class="APPLICATION">lpstat</b>,
          and <b class="APPLICATION">clean</b> programs. See the <b
          class="APPLICATION">LPRng</b> man pages for <b class=
          "APPLICATION">lp</b>, <b class="APPLICATION">lpstat</b>,
          and <b class="APPLICATION">cancel</b> in the <b class=
          "APPLICATION">LPRng</b> distribution for details and
          compatibility.</p>

          <p>The <b class="APPLICATION">LPRng</b> <b class=
          "APPLICATION">lpstat</b> emulator accepts the <b class=
          "APPLICATION">lpstat</b> command line options returns
          status in a format that is close to the one that common
          <b class="APPLICATION">lpstat</b> implementations return.
          Unfortunately, due to the wide variety of different
          modifications and vendor versions of <b class=
          "APPLICATION">lpstat</b> there are slight differences
          between the this status and the status returned by the
          original <b class="APPLICATION">lpstat</b>. If this is
          the case, then there is little to do but to modify the
          source code for <b class="APPLICATION">lpstat</b> and
          compile a version that implements the required
          format.</p>

          <p>If the <b class="APPLICATION">lpr</b> program is
          invoked with the name <b class="APPLICATION">lp</b>, it
          will simulate the <b class="APPLICATION">lp</b> options.
          This can be done by making a symbolic link to the <b
          class="APPLICATION">lpr</b> program or by making a copy
          of the <b class="APPLICATION">lpr</b> program with the
          name <b class="APPLICATION">lp</b>.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1338"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {59} #</samp> <kbd class=
"USERINPUT">cd /usr/bin</kbd>
    <samp class="PROMPT">h4: {60} #</samp> <kbd class=
"USERINPUT">ln -s lpr lp</kbd>
    <samp class="PROMPT">h4: {61} #</samp> <kbd class=
"USERINPUT">lp /tmp/hi</kbd>
    request id is root@h4+489
</pre>
          </div>
          <br>
          <br>

          <p>Finally, if the <b class="APPLICATION">lprm</b>
          program is invoked with the name <b class=
          "APPLICATION">cancel</b> it will simulate the <b class=
          "APPLICATION">cancel</b> command. This can be done by
          making a symbolic link to the <b class=
          "APPLICATION">lprm</b> program or by making a copy of the
          <b class="APPLICATION">lprm</b> program with the name <b
          class="APPLICATION">cancel</b>.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1353"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {62} #</samp> <kbd class=
"USERINPUT">cd /usr/bin</kbd>
    <samp class="PROMPT">h4: {63} #</samp> <kbd class=
"USERINPUT">ln -s lprm cancel</kbd>
    <samp class="PROMPT">h4: {64} #</samp> <kbd class=
"USERINPUT">cancel 489</kbd>
    cancel 513
    Printer lp@h9:
      checking perms 'root@h9+513'
      dequeued 'root@h9+513'
</pre>
          </div>
          <br>
          <br>

          <p>Many <span class="emphasis"><i class=
          "EMPHASIS">vintage</i></span> or <span class=
          "emphasis"><i class="EMPHASIS">legacy</i></span>
          applications have fully qualified paths to the <b class=
          "APPLICATION">lp</b> and <b class=
          "APPLICATION">lpstat</b> executables, and it may be
          necessary to make additional symbolic links or copies of
          the <b class="APPLICATION">LPRng</b> executables to
          satisfy their pathname requirements.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1367"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {65} #</samp> <kbd class=
"USERINPUT">ln -s /usr/bin/lpr /usr/ucb/lpr</kbd>
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SMB">2.12. SAMBA and <b class=
          "APPLICATION">LPRng</b></a></h2>

          <p>The SMB network protocol is used by many Microsoft
          Operating Systems to implement file and printer sharing.
          SAMBA is a UNIX package that implements the SMB protocol
          and provides a simple and easy way to import and export
          file systems and printer facilities. The web site for
          SAMBA is <a href="http://www.samba.org" target=
          "_top">http://www.samba.org</a>. The SAMBA code is
          extremely easy to install and the <acronym class=
          "ACRONYM">SWAT</acronym> (Samba Web Administration Tool)
          makes configuration almost trivial.</p>

          <p>See the SAMBA <tt class=
          "FILENAME">doc/text/Printing.txt</tt> and related
          documentation for details on printing. In the <tt class=
          "FILENAME">samba.conf</tt> file <var class=
          "LITERAL">[global]</var> section or in the SWAT page for
          printing configuration you need to specify the that you
          want to have Samba handle printing, the <var class=
          "LITERAL">print</var>, <b class="APPLICATION">lpq</b>,
          and <b class="APPLICATION">lprm</b> commands to be used
          when a user prints a job, asks for status, or removes a
          job, and a temporary directory to hold print jobs when
          they are submitted. The following is a simple example of
          to set up printing for authenticated users.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1384"></a>
<pre class="SCREEN">
    [printers]
        path = /var/spool/lpd/samba
        #  ---  do not use the Samba default path = /tmp
        print ok = yes
        printing = lprng
        load printers = yes
        guest ok = no
        printcap name = /etc/printcap
        print command =      /usr/bin/lpr  -P%p -r %s
        lpq command   =      /usr/bin/lpq  -P%p
        lprm command  =      /usr/bin/lprm -P%p %j
        lppause command =    /usr/sbin/lpc hold %p %j
        lpresume command =   /usr/sbin/lpc release %p %j
        queuepause command = /usr/sbin/lpc  stop %p
        queueresume command = /usr/sbin/lpc start %p
</pre>
          </div>
          <br>
          <br>

          <ol type="1">
            <li>
              <p>Samba will make a copy of the files to be printed
              in the directory specified by <var class=
              "LITERAL">path</var>. If the print operation fails
              then sometimes the print file is left in the
              directory.</p>
            </li>

            <li>
              <p>The directory should have the same ownership and
              permissions as <tt class="FILENAME">/tmp</tt>, i.e.-
              owner and group <var class="LITERAL">root</var> and
              <var class="LITERAL">bin</var>, with <var class=
              "LITERAL">01777</var> permissions, where <var class=
              "LITERAL">01000</var> is the sticky bit.</p>

              <p>A directory whose `sticky bit' is set becomes an
              append-only directory, or, more accurately, a
              directory in which the deletion of files is re-
              stricted. A file in a sticky directory may only be
              removed or renamed by a user if the user has write
              permission for the directory and the user is the
              owner of the file, the owner of the directory, or the
              super-user. This feature is usefully applied to
              directories such as /tmp which must be publicly
              writable but should deny users the license to
              arbitrarily delete or rename each others' files.</p>
            </li>

            <li>
              <p>The directory should be examined periodically and
              files older then a day should be removed. The
              following command can be used to do this, and should
              be put in a file that is periodically (one a day)
              executed by the <b class="APPLICATION">cron</b>
              facility:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1401"></a>
<pre class="SCREEN">
    find /var/spool/lpd/samba -type f -mtime 2d -exec rm -f {} \;
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>You must specify the print method as <var class=
              "LITERAL">printing = lprng</var>. This will allow
              Samba to parse the <b class="APPLICATION">LPRng</b>
              <b class="APPLICATION">lpq</b> status format
              correctly.</p>
            </li>

            <li>
              <p>You must put all of the printers which Samba has
              access to in the <tt class="FILENAME">printcap</tt>
              file. Your Samba server may support reading the
              printcap file by using a program. In this case the
              printcap file entry can be one of the following:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1411"></a>
<pre class="SCREEN">
    [printers]
      #
        printcap name = |/usr/local/libexec/filters/getpc
      # or
        printcap name = |/usr/bin/lpc client all 
    
    #!/bin/sh
    # getpc program
    /usr/bin/lpq -as | /bin/sed -e 's/[@:].*//p'
   
</pre>
              </div>
              <br>
              <br>

              <p>The <var class="LITERAL">lpc client all</var>
              command will generate the printcap entries for all of
              the printers. This was done to support Samba and
              other printer gateway systems. You can also use a
              simple script to modify the output of the printer
              status command as shown in the example.</p>
            </li>

            <li>
              <p>Samba can be configured to allow guests or
              non-authenticated users to spool print jobs.
              Unfortunately, by default <b class=
              "APPLICATION">lpr</b> will mark the jobs as submitted
              by the Samba server, not the remote users. To solve
              this problem, the <tt class="COMMAND">lpr
              -U%U@%M</tt> option causes <b class=
              "APPLICATION">lpr</b> to mark the jobs as submitted
              by user <var class="LITERAL">%U</var> on host <var
              class="LITERAL">%M</var>, instead of the Samba server
              process. The use of this option is restricted to root
              and a set of userids listed in the <a href=
              "#ALLOWUSERSETTING">allow_user_setting</a>
              configuration option. If the userid of the submitter
              is not in this list, then the option is quietly
              ignored. The <tt class="COMMAND">-U%U@M</tt> can also
              be used with the other LPRng commands as well. For
              example:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1424"></a>
<pre class="SCREEN">
    [printers]
        guest ok = yes
        print command =       /usr/bin/lpr  -U%U@%M -P%p -r %s
        lpq command   =       /usr/bin/lpq  -U%U@%M -P%p
        lprm command  =       /usr/bin/lprm -U%U@%M -P%p %j
        lppause command =     /usr/sbin/lpc -U%U@%M hold %p %j
        lpresume command =    /usr/sbin/lpc -U%U@%M release %p %j
        queuepause command =  /usr/sbin/lpc -U%U@%M stop %p
        queueresume command = /usr/sbin/lpc -U%U@%M start %p
</pre>
              </div>
              <br>
              <br>
            </li>
          </ol>

          <p>When Samba gets a request for print queue status, it
          runs the <var class="LITERAL">lpq command</var> program
          and then parses the output of this command.
          Unfortunately, different versions of Samba have different
          ways of parsing the output - some are more flexible than
          others.</p>

          <p>&gt;</p>

          <p>One of the problems that might occur is when the <b
          class="APPLICATION">LPRng</b> <var class=
          "LITERAL">done_jobs</var> feature is enabled. This causes
          that status of the last few jobs to be retained so that
          users can see what happened to their jobs. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1432"></a>
<pre class="SCREEN">
    h110: {588} % lpq
    Printer: t1@h110 'Test Printer 1'
     Queue: no printable jobs in queue
     Server: no server active
     Status: job 'papowell@h110+336' saved at 14:42:54.607
     Filter_status: FILTER DONE
     Rank   Owner/ID         Class Job Files    Size Time
    done   papowell@h110+336   A   336 /tmp/hi     3 14:42:53
</pre>
          </div>
          <br>
          <br>

          <p>In this example, the <var class="LITERAL">done</var>
          job will have its status displayed by the lpq command.
          However, this may confuse Samba, and it may report odd or
          unusual status for your jobs. If the <b class=
          "APPLICATION">lpq</b> command reports that your job has
          completed but Samba reports that it is printing or is
          stopped, then you should disable the <var class=
          "LITERAL">done_jobs</var> option in the printcap
          entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1438"></a>
<pre class="SCREEN">
    lp:
      :done_jobs=0
      :...
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SETUID">2.13. Security
          Concerns</a></h2>

          <p>While the <b class="APPLICATION">LPRng</b> software
          has been written with security as the primary goal there
          is always the problem with undetected errors in the <b
          class="APPLICATION">LPRng</b> software that when
          exploited could compromise system security. The most
          serious concern is that of gaining ROOT (UID 0)
          permissions.</p>

          <p>The simplest way to handle this problem is to not
          install LPRng with <var class="LITERAL">setuid ROOT</var>
          permissions. Client programs will be able to connect to
          the <b class="APPLICATION">lpd</b> server. Since the <b
          class="APPLICATION">lpd</b> server is started by the
          system startup script with effective UID root, it is the
          only program in this suite that will have an privileged
          user id.</p>

          <p>A more radical step is to run the <b class=
          "APPLICATION">lpd</b> server as a non-privileged user
          entirely. However, the RFC1179 protocol specifies that
          the <b class="APPLICATION">lpd</b> TCP/IP port is 515 and
          <b class="APPLICATION">lpd</b> requires root permissions
          to open and bind to port 515. The <b class=
          "APPLICATION">lpd</b> server can use the <code class=
          "FUNCTION">setuid()</code> system call after binding to
          this port do drop ROOT capabilities. However, in order to
          fully compatible with RFC1179, <b class=
          "APPLICATION">lpd</b> must originate connections from a
          <span class="emphasis"><i class=
          "EMPHASIS">reserved</i></span> port in the range 721-731,
          although in practice port 1-1023 seems to be
          acceptable.</p>

          <p>If inter-operability with non-<b class=
          "APPLICATION">LPRng</b> print spoolers is not desired,
          then it is <span class="emphasis"><i class=
          "EMPHASIS">trivial</i></span> to configure <b class=
          "APPLICATION">LPRng</b> to use a non-privileged port by
          using the <tt class="FILENAME">lpd.conf</tt> file. For
          example, in the <tt class="FILENAME">/etc/lpd.conf</tt>
          file, you only need to change the indicated lines:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1463"></a>
<pre class="SCREEN">
    # Purpose: lpd port
    #   default lpd_port=printer
    lpd_port=2000
    # or lpd_port=localhost%2000
</pre>
          </div>
          The <var class="LITERAL">lpd_port</var> specifies the
          (optional) IP address and port to which the <b class=
          "APPLICATION">lpd</b> server binds and to which the
          clients will connect. <b class="APPLICATION">LPRng</b>
          applications will connect to port 2000 to transfer jobs
          and ask for status. You can also use this facility to
          establish a <span class="emphasis"><i class=
          "EMPHASIS">private</i></span> set of print spoolers which
          can be used for testing See <a href="#TESTING">Testing
          and Diagnostic Facilities</a> for more details.<br>
          <br>

          <p>Some <span class="emphasis"><i class=
          "EMPHASIS">legacy</i></span> print filters are not <span
          class="emphasis"><i class=
          "EMPHASIS">meta-char-escape</i></span> proof. For
          example, suppose that a user decided to spool a job as
          follows:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1473"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {66} #</samp> <kbd class=
"USERINPUT">lpr "-J`;rm -rf /;`" /tmp/a</kbd>
</pre>
          </div>
          This would create a job file with the line: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN1477"></a>
<pre class="SCREEN">
    J`rm -rf /;`
</pre>
          </div>
          and gets passed to a print filter as 

          <div class="INFORMALEXAMPLE">
            <a name="AEN1479"></a>
<pre class="SCREEN">
    /usr/local/printfilter  -J`rm -rf /;`
</pre>
          </div>
          The observant reader will observe that the above line may
          have the most hideous consequences if it is processed by
          a shell. For this reason the <b class=
          "APPLICATION">LPRng</b> software takes extreme
          precautions and <span class="emphasis"><i class=
          "EMPHASIS">sanitizes</i></span> control file contents and
          file names so that they do not contain any control or
          metacharacters.<br>
          <br>

          <p>Finally, you can use a Unix socket (i.e. - FIFO) for
          connections to the server on the localhost, and disable
          the <b class="APPLICATION">lpd</b> listening socket by
          setting the <var class="LITERAL">lpd_listen_port</var>
          value to <var class="LITERAL">off</var>.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="SYSTEMSPECIFIC"></a>Chapter 3. System Specific
        Notes</h1>

        <p>The following are a set of suggestions and
        recommendations for specific systems.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SOLARIS">3.1. Solaris</a></h2>

          <p>The Sun Microsystems Solaris printing system is
          derived from the System V UNIX system. Please see the <a
          href="#SOLARISINSTALL">Solaris, HP, and SysVR4 Derived
          Systems</a> installation information for a detailed
          description of how to install <b class=
          "APPLICATION">LPRng</b> and remove the Solaris Print
          Services.</p>

          <p>If you want to simply forward jobs from a Solaris
          system to a BSD print spooling system you can use the
          following commands to create a printer. Check your
          specific system references and man pages for options:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1496"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {67} #</samp> <kbd class=
"USERINPUT">lpsystem -t bsd servername</kbd>   # add server
    <samp class="PROMPT">h4: {68} #</samp> <kbd class=
"USERINPUT">lpadmin -p pr -s servername -T unknown -I any</kbd> # set up printer
    <samp class="PROMPT">h4: {69} #</samp> <kbd class=
"USERINPUT">accept pr</kbd>   # enable queueing
    <samp class="PROMPT">h4: {70} #</samp> <kbd class=
"USERINPUT">enable pr</kbd>   # enable printing
    <samp class="PROMPT">h4: {71} #</samp> <kbd class=
"USERINPUT">lpstat -t</kbd>   # show status
    scheduler is running
    system for pr: servername
    lp accepting requests since Mon Aug  6 12:00:00 PST 2000
    Printer: pr@servername  'Hp : Laserwriter' (printing disabled)
     Queue: 1 printable job
     Rank  Owner/ID            Class Job Files            Size Time
    1      papowell@h4+207       A   207 h4.023205           3 18:24:54
</pre>
          </div>
          <br>
          <br>

          <p>The above commands will create the necessary
          directories and files for the printer. If you want to use
          the <var class="LITERAL">lp -o option</var> syntax to
          pass options to the LPRng print spooler you will have to
          enable this by hand. The <tt class=
          "FILENAME">/etc/printers.conf</tt> (this may be in some
          other directory besides <tt class="FILENAME">/etc</tt>)
          needs to be modified so that it allows options to be
          passed using the Solaris convention, which is to put them
          on the <var class="LITERAL">S</var> or <var class=
          "LITERAL">O</var> line of the control file. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1514"></a>
<pre class="SCREEN">
    #
    # The preferred method of modifying this file is through the use of
    # lpset(1M) or fncreate_printer(1M)
    #
    pr:bsdaddr=servername,pr,Solaris:
    _default:use=pr:
</pre>
          </div>
          <br>
          <br>

          <p>The <var class=
          "LITERAL">bsdaddr=host,printer[,Solaris]</var> indicates
          that the entry is for a remote RFC1179 printer on server
          <var class="LITERAL">host</var> with name <var class=
          "LITERAL">printer</var>. The <var class=
          "LITERAL">Solaris</var> option indicates that the Solars
          extensions to the RFC1179 protocol are to be used.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LINUX">3.2. Linux</a></h2>

          <p>There is no universal way to install <b class=
          "APPLICATION">LPRng</b> cleanly on all of the different
          Linux systems. The major difficulty is the fragmentation
          in the various libraries, location of files, and system
          dependencies. If the <b class="APPLICATION">LPRng</b>
          installation procedure does not install the software
          correctly, please use the following remedial steps.</p>

          <ol type="1">
            <li>
              <p>Check the <b class="APPLICATION">LPRng</b> web
              site <a href="http://www.lprng.com" target=
              "_top">http://www.lprng.com</a> and see if there is a
              Linux Release RPM or other binary distribution for
              your version of Linux. If not, then you will have to
              do a source install.</p>
            </li>

            <li>
              <p>Obtain the source distribution and follow the
              instructions outlined in other sections to compile
              and install the software. Use the following
              configuration options which correspond to Linux:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1533"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {72} #</samp> <kbd class=
"USERINPUT">./configure --prefix=/usr \
  --sysconfdir=/etc --mandir=/usr/share/man</kbd>
    <samp class="PROMPT">h4: {73} #</samp> <kbd class=
"USERINPUT">make clean all install</kbd>
    <samp class="PROMPT">h4: {74} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>You may need to modify your existing printcap file
              by adding the <var class="OPTION">:bkf</var> flag as
              shown below, or replace the entries with other
              filters.</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN1544"></a>
<pre class="SCREEN">
    lp:\
      :if=/usr/local/libexec/lpr/hplaserjet3:\
      :bkf:\     # added to the printcap by hand
      :...
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>Test the system by printing a file. If this does
              not work, then you will have to determine if the
              problem is in the print spooling software or in the
              filter. See the section on <b class=
              "APPLICATION">ifhp</b> for directions on how to
              replace the vendor supplied filters with <b class=
              "APPLICATION">ifhp</b>.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AIX">3.3. AIX</a></h2>

          <p>This information was supplied by <a href=
          "mailto:nitschke@math.unihamburg.de" target="_top">Dirk
          Nitschke</a>, as of August 1997, and describes how to
          install the <b class="APPLICATION">LPRng</b> package on a
          workstation running AIX 4.1.x and possibly 3.x.x as well.
          Dirk would be interested in any comments or
          corrections.</p>

          <p>Printing on AIX systems is different. AIX provides a
          general queueing facility and printing is only one way to
          use it. You submit a print job to a print queue using one
          of the commands <tt class="COMMAND">qprt</tt> or <tt
          class="COMMAND">enq</tt>. You can use the BSD or System V
          printing commands <b class="APPLICATION">lpr</b> or <b
          class="APPLICATION">lp</b>, too. The <tt class=
          "COMMAND">qdaemon</tt> watches all (general) queues and
          knows how to handle your job. A (general) queue is
          defined in the file <tt class=
          "FILENAME">/etc/qconfig</tt>. The format of this file is
          different from the <tt class="FILENAME">printcap</tt>
          format.</p>

          <p>OK, how to replace the AIX printing system? There is
          no group <var class="LITERAL">daemon</var> on AIX.
          Therefore you have to change the default group for file
          ownership and process permissions or create a <var class=
          "LITERAL">daemon</var> user and group. We decided to use
          the <var class="LITERAL">printq</var> group; on
          reflection it would have been easier to have created a
          <var class="LITERAL">daemon</var> group. The user <var
          class="LITERAL">daemon</var> exists on AIX but we have
          chosen <b class="APPLICATION">lpd</b> as the user who
          runs <b class="APPLICATION">lpd</b> and all filters and
          owns the spooling directories. You can change the values
          for <var class="LITERAL">group</var> and <var class=
          "LITERAL">user</var> in your <tt class=
          "FILENAME">lpd.conf</tt> file or in the sources <tt
          class="FILENAME">src/common/vars.c</tt>. This is an
          example for <tt class="FILENAME">lpd.conf</tt>:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1576"></a>
<pre class="SCREEN">
    # Purpose: group to run SUID ROOT programs
    #   default group=daemon
    group=printq
    # Purpose: server user for SUID purposes
    #   default user=daemon
    user=lpd
</pre>
          </div>
          Compile and install the <b class="APPLICATION">LPRng</b>
          package. Create your <tt class="FILENAME">printcap</tt>,
          spooling directories, accounting and logfiles and so on.
          Don't forget to use <a href="#CHECKPC">checkpc</a> to
          make sure that all the permissions are set correctly and
          the necessary files are created.<br>
          <br>

          <p>Then stop all print queues defined on your
          workstation. Use</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1582"></a>
<pre class="SCREEN">
    # chque -q queuename -a "up = FALSE"
</pre>
          </div>
          for this (yes, blanks around <var class="LITERAL">=</var>
          are needed).<br>
          <br>

          <p>If you have local printers attached to your system you
          will have an <b class="APPLICATION">lpd</b> running. Stop
          this daemon using SMIT (Print Spooling, Manage Print
          Server, Stop the Print Server Subsystem). Choosing <span
          class="emphasis"><i class="EMPHASIS">both</i></span> also
          removes <b class="APPLICATION">lpd</b> from <tt class=
          "FILENAME">/etc/inittab</tt>. Maybe it's faster to do
          this by hand:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1590"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {75} #</samp> <kbd class=
"USERINPUT">topsrc -p'pid of /usr/sbin/lpd'</kbd>
    <samp class="PROMPT">h4: {76} #</samp> <kbd class=
"USERINPUT">rmitab "lpd"</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>Now delete all print queues managed by <var class=
          "LITERAL">qdaemon</var> defined on your system. You can
          use <tt class="COMMAND">SMIT</tt> for this or the
          commands <tt class="COMMAND">{mk,ch,rm}que</tt>, <tt
          class="COMMAND">{mk,ch,rm}quedev</tt>, <tt class=
          "COMMAND">{mk,ch,rm}virprt</tt>. The <tt class=
          "COMMAND">SMIT</tt> fast path is <tt class="COMMAND">smit
          rmpq</tt>.</p>

          <p>To start the new <b class="APPLICATION">lpd</b> at
          system startup you have to add an entry to <tt class=
          "FILENAME">/etc/inittab</tt>:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1607"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {77} #</samp> <kbd class=
"USERINPUT">mkitab "lpd:2:once:/full/path/lpd"</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>Some work has to be done if have have a local printer
          attached to your workstation. You have to create a device
          file like <tt class="FILENAME">/dev/lp0</tt>. The <tt
          class="COMMAND">SMIT</tt> fast path for this is <tt
          class="COMMAND">smit mkdev</tt>. Choose <var class=
          "LITERAL">Printer/Plotter</var>, then <var class=
          "LITERAL">Printer/Plotter Devices</var>, then <var class=
          "LITERAL">Add a Printer/Plotter</var>. To create a
          parallel printer device select the following:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1618"></a>
<pre class="SCREEN">
    Plotter type:              opp Other parallel printer
    Printer/Plotter Interface: parallel
    Parent Adapter:            ppa0 Available
</pre>
          </div>
          Now define the characteristics of the device: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN1620"></a>
<pre class="SCREEN">
    Port Number: p
</pre>
          </div>
          Option <var class="LITERAL">p</var> is for parallel. Go
          to the field: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN1623"></a>
<pre class="SCREEN">
    Send all characters to printer UNMODIFIED   no
</pre>
          </div>
          <br>
          <br>

          <p>and select <var class="LITERAL">yes</var>! We have had
          a lot of trouble with <var class="LITERAL">no</var>. This
          is very important! Expect erroneous output if you choose
          <var class="LITERAL">no</var>. If you have already
          created a device file, change the characteristics! SMIT's
          fast path is <tt class="COMMAND">smit chdev</tt>.</p>

          <p>Finally remove all AIX printing commands like <b
          class="APPLICATION">qprt</b>, <b class=
          "APPLICATION">lp</b>, <b class="APPLICATION">cancel</b>,
          <b class="APPLICATION">lpq</b>, and <b class=
          "APPLICATION">lprm</b>. You will find a lot of them in
          <tt class="FILENAME">/usr/bin</tt>. Do not remove <b
          class="APPLICATION">enq</b> and friends if you want to
          use the general queueing facility.</p>

          <p>Now you can start your new <b class=
          "APPLICATION">lpd</b>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="APPLETALK">3.4. AppleTalk
          Support</a></h2>

          <p>Netatalk is used to communicate from TCP/IP to
          AppleTalk printers and vice versa. The Netatalk
          distribution FAQ is at: <a href=
          "http://www.umich.edu/~rsug/netatalk" target=
          "_top">http://www.umich.edu/~rsug/netatalk</a>. Also, The
          University of Melbourne web site <a href=
          "http://www.cs.mu.oz.au/appletalk/" target=
          "_top">http://www.cs.mu.oz.au/appletalk/</a> has
          additional tutorial and installation information. In
          addition, Anders Brownworth's Web page <a href=
          "http://thehamptons.com/anders/netatalk/" target=
          "_top">http://thehamptons.com/anders/netatalk/</a> has a
          useful collection of information for Linux users.</p>

          <p>The University of Michigan doesn't seem to be doing
          anything more for <b class="APPLICATION">netatalk</b>,
          and Adrian Sun has continued development. You'll find his
          updates at <a href=
          "ftp://ftp.cobaltnet.com/pub/users/asun/testing/" target=
          "_top">ftp://ftp.cobaltnet.com/pub/users/asun/testing/</a>
          He has improved <b class="APPLICATION">netatalk</b>
          considerably over the last UMich version. Documentation
          on <b class="APPLICATION">netatalk</b> is, unfortunately,
          almost non-existent.</p>

          <p>There are a couple of very active mail lists for
          Netatalk: <a href="mailto:netatalk-admins@umich.edu"
          target="_top">netatalk-admins@umich.edu</a> and <a href=
          "mailto:linux-atalk@netspace.org" target=
          "_top">linux-atalk@netspace.org</a>.</p>

          <p>After you have installed and gotten <b class=
          "APPLICATION">netatalk</b> working you can use the
          following AppleTalk configuration file to print from a
          Macintosh to an <b class="APPLICATION">LPRng</b>
          printer.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1657"></a>
<pre class="SCREEN">
    Your 32 Character Printer Name:\
            :pr=|/your/path/to/lpr -Pprintername:\
            :op=username.for.printing:\
            :pd=/your/path/to/ppd/files/yourprinter.ppd:
    
    Examples:
    
    Student Printers:\
            :pr=|/usr/bin/lpr -Pstudent:\
            :op=root:\
            :pd=/var/spool/lpd/student/HP4000.PPD:
    HP 2500c:\
            :pr=|/usr/bin/lpr -Php2500c:\
            :op=root:\
            :pd=/var/spool/lpd/hp2500c/HP2500.PPD:
</pre>
          </div>
          <br>
          <br>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="TUTORIAL"></a>Chapter 4. Print Spooling
        Tutorial</h1>

        <p>A print spooler is a program that accepts <span class=
        "emphasis"><i class="EMPHASIS">print jobs</i></span> (which
        are usually one or more files) from a program or network
        interface, stores them in a <span class="emphasis"><i
        class="EMPHASIS">spool queue</i></span>, and then sends
        them to a printer or another print spooler. Usually there
        are facilities to submit jobs, check on the current job
        status, remove jobs from spool queues, and perform
        administrative functions such as starting or stopping
        printing.</p>

        <p>A print spooler is a client/server application. The
        client programs are used to submit jobs to the print
        spooler program which performs the actual printing
        operations. In order to carry out these operations, the
        server may need to use other programs to convert print job
        files into a format acceptable to a printer, or perform
        various accounting or administrative functions.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="OVERVIEW">4.1.
          Overview</a></h2>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1668"></a>
<pre class="SCREEN">
    +---------+    +-----+    +-----+     +--------+    +---------+
    | program | -&gt; | lpr | -&gt; | lpd |  -&gt; | filter | -&gt; | printer |
    +---------+    +-----+  * +-----+     +--------+    +---------+
                      *    *     |
                   printcap      V
                              +-----+     +--------+    +---------+
                              | lpd |  -&gt; | filter | -&gt; | printer |
                              +-----+     +--------+    +---------+
    
                               Figure 1
</pre>
          </div>
          <br>
          <br>

          <p>Figure 1 shows the flow of data between the individual
          components of the <b class="APPLICATION">LPRng</b> print
          spooling system. A program (or user) will use the <b
          class="APPLICATION">lpr</b> program to send a file to the
          <b class="APPLICATION">lpd</b> server over a TCP/IP
          connection. The <b class="APPLICATION">lpd</b> server
          will store the file temporarily in a spool queue
          directory. The information needed by the <b class=
          "APPLICATION">lpr</b> and <b class="APPLICATION">lpd</b>
          programs to carry out this activity is stored in the <tt
          class="FILENAME">printcap</tt> (usually called the <tt
          class="FILENAME">/etc/printcap</tt>) database file.</p>

          <p>The <b class="APPLICATION">lpd</b> server sorts the
          queue entries and determines the print order. It will
          select a job to be printed, open a connection to the
          printer, and then use a <span class="emphasis"><i class=
          "EMPHASIS">filter</i></span> program to convert the file
          contents into a format suitable for the printer. If the
          file does not need conversion, then the <b class=
          "APPLICATION">lpd</b> server will send the file directly
          to the printer.</p>

          <p>The <b class="APPLICATION">lpd</b> server can also
          <span class="emphasis"><i class=
          "EMPHASIS">forward</i></span> jobs to another print
          server over a network connection, optionally sending them
          through a filter as well. The destination server can in
          turn forward the job or send it to a printer.</p>

          <p>The protocol or commands used to do this job forward
          and transfer are specified by <a href=
          "#RFC1179REF">RFC1179</a>. This protocol specifies how
          the <b class="APPLICATION">lpr</b> client program sends a
          job to the <b class="APPLICATION">lpd</b> server, as well
          as how the <b class="APPLICATION">lpd</b> server forwards
          jobs to another server. In addition to job submission,
          RFC1179 specifies commands to obtain queue status, to
          remove jobs from the queue, and to start and stop print
          queues.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SAMPLEPRINTCAP">4.2. Sample
          Printcap Entry</a></h2>

          <p>As described in the <a href="#OVERVIEW">Print Spooling
          Overview</a>, the information in the <tt class=
          "FILENAME">printcap</tt> database is used control
          printing operations. While there is no RFC specifying its
          format or content, there is a strong <span class=
          "emphasis"><i class="EMPHASIS">de facto</i></span>
          standard for its format. For a complete description of
          the <tt class="FILENAME">printcap</tt> database see <a
          href="#PRINTCAPREF">Printcap Database</a>. For a list of
          all of the <tt class="FILENAME">printcap</tt> and
          configuration options see <a href="#OPTIONINDEX">Index To
          All The Configuration and Printcap Options</a>.</p>

          <p>Here is a sample printcap suitable for use by the <b
          class="APPLICATION">LPRng</b> clients:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1703"></a>
<pre class="SCREEN">
    LPRng use :lp for destination (device and spool queue)
       lp:lp=lp@h4.private
       lpreal:lp=/dev/lp0
    
    Vintage BSD uses :rp:rm for spooler queue and :lp for device
      lp:rp=lp:rm=h4.private
      lpdev:lp=/dev/lp0
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">:lp=lp@h4.private</var>
          printcap entry tells the <span class="emphasis"><i class=
          "EMPHASIS">client</i></span> programs that jobs for the
          <b class="APPLICATION">lp</b> printer or print queue are
          sent to the <b class="APPLICATION">lp</b> print queue
          queue on host <tt class="FILENAME">h4.private</tt>. This
          can also be specified using the The <span class=
          "emphasis"><i class="EMPHASIS">legacy</i></span> BSD <var
          class="LITERAL">:rp</var> and <var class=
          "LITERAL">:rm</var>. The <var class=
          "LITERAL">:rp=</var><span class="emphasis"><i class=
          "EMPHASIS">queue</i></span> option specifies the <span
          class="emphasis"><i class="EMPHASIS">print
          queue</i></span> <var class="LITERAL">:rm=</var><span
          class="emphasis"><i class="EMPHASIS">host</i></span>
          option specifies the host. When both <var class=
          "LITERAL">lp</var> and <var class="LITERAL">:rp:rm</var>
          are present the <var class="LITERAL">:lp</var> option has
          precedence.</p>

          <p>On the printserver the following is a sample printcap
          entry suitable for the <b class="APPLICATION">lpd</b>
          server:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1724"></a>
<pre class="SCREEN">
    lp:
      :lp=/dev/lp0
      :sd=/var/spool/lpd/%P
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">:sd=</var><span class=
          "emphasis"><i class="EMPHASIS">directory</i></span>
          option (spool queue directory) specifies the directory
          where print jobs will be placed. The <var class=
          "LITERAL">%P</var> will be replaced with the name of the
          spool queue. The <var class="LITERAL">:lp</var> literal
          is now the path to the output device the <b class=
          "APPLICATION">lpd</b> server will use to print the job.
          The <var class="LITERAL">:filter</var> literal specifies
          the filter program to use to process the job before
          sending to the output device.</p>

          <p>Here is another example of a printcap entry using the
          <var class="LITERAL">%P</var> notation:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1735"></a>
<pre class="SCREEN">
    lp:lp=%P@h4.private
</pre>
          </div>
          This entry will cause all jobs sent to the <var class=
          "LITERAL">lp</var> spool queue to be sent to the <var
          class="LITERAL">lp</var> queue on <var class=
          "LITERAL">server</var>. <var class="LITERAL">%X</var>
          strings in the printcap entries are expanded as shown: 

          <div class="INFORMALTABLE">
            <a name="AEN1741"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Key</th>

                  <th>Replaced By</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td><var class="LITERAL">%P</var></td>

                  <td>printcap entry primary name (printer)</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%Q</var></td>

                  <td>queue requested</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%h</var></td>

                  <td>short host name (host)</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%H</var></td>

                  <td>fully qualified host name
                  (host.dns.whatever)</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%R</var></td>

                  <td>remote printer (rp value)</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%M</var></td>

                  <td>remote host (rm value)</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">%D</var></td>

                  <td>date in YYYY-MM-DD format</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="TUTORIALCONFIG">4.3. Setting
          Up the Tutorial Configuration</a></h2>

          <p>The previous section has given a very high level view
          of printing operations and shown a sample of some
          printcap files. In order to do experiment with these
          LPRng facilities, we will need to be able to modify the
          <tt class="FILENAME">printcap</tt> information and try
          various system configurations.</p>

          <p>We will use a series of simple printcap entries during
          this tutorial. We will assume that the <b class=
          "APPLICATION">LPRng</b> system is using the <tt class=
          "FILENAME">/etc/printcap</tt> file. If your system is
          configured to use another one, then you can make a
          symbolic link from <tt class=
          "FILENAME">/etc/printcap</tt> or you can simply use your
          default <tt class="FILENAME">printcap</tt> file.</p>

          <p>Save the existing <tt class="FILENAME">printcap</tt>
          file and then create a new printcap file with the
          contents as shown below. You will need to have ROOT
          (superuser) permissions to change the file and perform
          some of the maintenance operations.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1787"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {78} #</samp> <kbd class=
"USERINPUT">cd /etc</kbd> 
    <samp class="PROMPT">h4: {79} #</samp> <kbd class=
"USERINPUT">mv printcap printcap.orig</kbd>
    <samp class="PROMPT">h4: {80} #</samp> <kbd class=
"USERINPUT">vi printcap</kbd>
    <kbd class="USERINPUT">#  printcap file contents:</kbd>
    <kbd class="USERINPUT">lp:sd=/var/spool/lpd/%P</kbd>
    <kbd class="USERINPUT"> :force_localhost</kbd>
    <kbd class="USERINPUT"> :lp=/tmp/lp</kbd>
    <kbd class="USERINPUT">lp2:sd=/var/spool/lpd/%P</kbd>
    <kbd class="USERINPUT"> :force_localhost</kbd>
    <kbd class="USERINPUT"> :lp=/tmp/lp2</kbd>
    <samp class="PROMPT">h4: {81} #</samp> <kbd class=
"USERINPUT">#  set permissions so everybody can read file</kbd>
    <samp class="PROMPT">h4: {82} #</samp> <kbd class=
"USERINPUT">chmod 666 printcap</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>We save the original <tt class=
          "FILENAME">printcap</tt> file and create a new one. We
          give the file world writable permissions so that later we
          can modify this file without needing to have root
          permissions. The <tt class="FILENAME">printcap</tt> file
          has two entries: <var class="LITERAL">lp</var> and <var
          class="LITERAL">lp2</var>. Each print queue on the server
          needs a spool file to hold print jobs, jobs, and the <var
          class="LITERAL">:sd</var> value specifies its location.
          The <var class="LITERAL">%P</var> value is replaced with
          the name of the printer when it is used. In classical BSD
          operation each host has an <b class="APPLICATION">lpd</b>
          print spooler running on the local host (we use localhost
          in this manual for simplicity). Files were copied to
          spool directories on the localhost and then then print
          spooler would send them to the destination, which could
          be another print spooler. This meant that each localhost
          machine had to have a print spooler and spool queue
          directory structure. Management of this becomes very
          difficult in large organizations. The <var class=
          "LITERAL">force_localhost</var> forces this mode of
          operation and means that the <b class=
          "APPLICATION">lpd</b> server and clients must run on the
          same host.</p>

          <p>We use files for the output devices (<var class=
          "LITERAL">:lp=</var>) so that we can see easily view the
          output (and also to save trees). We will also need to
          have some simple test files. Create the files using the
          following commands.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1818"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {83} #</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {84} #</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp2</kbd>
    <samp class="PROMPT">h4: {85} #</samp> <kbd class=
"USERINPUT">chmod 666  /tmp/lp /tmp/lp2</kbd>
    <samp class="PROMPT">h4: {86} #</samp> <kbd class=
"USERINPUT">echo hi &gt;/tmp/hi</kbd>
    <samp class="PROMPT">h4: {87} #</samp> <kbd class=
"USERINPUT">echo there &gt;/tmp/there</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>We will use a <span class="emphasis"><i class=
          "EMPHASIS">dummy</i></span> <tt class=
          "FILENAME">lpd.perms</tt> file that allows all users to
          do anything. This is useful for testing, but dangerous in
          a working environment.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1833"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {88} #</samp> <kbd class=
"USERINPUT">#  we modify the lpd.perms to allow an ordinary user to control</kbd>
    <samp class="PROMPT">h4: {89} #</samp> <kbd class=
"USERINPUT">mv lpd.perms lpd.perms.orig</kbd>
    <samp class="PROMPT">h4: {90} #</samp> <kbd class=
"USERINPUT">echo "DEFAULT ACCEPT" &gt;lpd.perms</kbd>
    <samp class="PROMPT">h4: {91} #</samp> <kbd class=
"USERINPUT">chmod 666 lpd.perms</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>Finally we run <tt class="COMMAND">checkpc</tt> to
          make sure that our printcap is correct and to create the
          necessary spool directories:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1845"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {92} #</samp> <kbd class=
"USERINPUT">checkpc -f -V</kbd>
    Checking printer 'lp'
     Checking directory: '/var/spool/lp'
       directory '/var'
       directory '/var/spool'
       directory '/var/spool/lp'
     Warning -   changing ownership '/var/spool/lp' to 1/1
       checking 'control.lp' file
       checking 'status.lp' file
       checking 'status' file
       cleaning 'status' file, 0K bytes: no truncation
       checking 'log' file
       cleaning 'log' file, 0K bytes: no truncation
       checking 'acct' file
       cleaning 'acct' file, 0K bytes: no truncation
    Checking printer 'lp2'
      Checking directory: '/var/spool/lp2'
        directory '/var'
      ....
    <samp class="PROMPT">h4: {93} #</samp> <kbd class=
"USERINPUT">lpc reread</kbd>
    <samp class="PROMPT">h4: {94} #</samp> <kbd class=
"USERINPUT">lpd</kbd>
    <samp class="PROMPT">h4: {95} #</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
       Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p><a href="#CHECKPC"><b class=
          "APPLICATION">Checkpc</b></a> performs consistency checks
          on the printcap file and spool queue entries. The <tt
          class="COMMAND">checkpc -f</tt> (fix) option will change
          permissions and create directories and can only be
          executed by ROOT. <a href="#CHECKPC"><b class=
          "APPLICATION">Checkpc</b></a> has other functions as well
          - you can view printcap information, see default
          configuration values, and remove junk files from spool
          queues with it.</p>

          <p>The <tt class="COMMAND">lpc reread</tt> command sends
          a request to the <b class="APPLICATION">lpd</b> server to
          reread the configuration and printcap information. The <b
          class="APPLICATION">lpd</b> command is added as insurance
          in case your <b class="APPLICATION">lpd</b> server is not
          running. The <tt class="COMMAND">exit</tt> command
          restores ordinary user privileges, and the <b class=
          "APPLICATION">lpq</b> command is used to check that the
          server is running. Finally, we check to see that the <tt
          class="COMMAND">lpc reread</tt> command is accepted from
          an ordinary user.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="RESTORING">4.4. Restoring
          Original Configuration</a></h2>

          <p>To restore the original configuration, you simply need
          to restore the original <tt class=
          "FILENAME">printcap</tt> and <tt class=
          "FILENAME">lpd.perms</tt> file and then restart the <b
          class="APPLICATION">lpd</b> server. These operations
          require ROOT permissions.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1875"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {96} #</samp> <kbd class=
"USERINPUT">su</kbd>
    <samp class="PROMPT">h4: {97} #</samp> <kbd class=
"USERINPUT">cd /etc    OR    cd /usr/local/etc</kbd>
    <samp class="PROMPT">h4: {98} #</samp> <kbd class=
"USERINPUT">mv printcap.orig printcap</kbd>
    <samp class="PROMPT">h4: {99} #</samp> <kbd class=
"USERINPUT">mv lpd.perms.orig lpd.perms</kbd>
    <samp class="PROMPT">h4: {100} #</samp> <kbd class=
"USERINPUT">checkpc -f</kbd>
    <samp class="PROMPT">h4: {101} #</samp> <kbd class=
"USERINPUT">lpc reread</kbd>
    <samp class="PROMPT">h4: {102} #</samp> <kbd class=
"USERINPUT">rm -rf /var/spool/lpd/lp /var/spool/lpd/lp2</kbd>
    <samp class="PROMPT">h4: {103} #</samp> <kbd class=
"USERINPUT">rm -f /tmp/lp /tmp/lp2</kbd>
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTINGANDCHECKING">4.5.
          Printing a File and Checking Status</a></h2>

          <p>Try the following commands. The commands appear after
          the prompt, and sample output that you might see is
          shown.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1896"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {104} %</samp> <kbd class=
"USERINPUT">lpr -V /tmp/hi</kbd>
    Version LPRng-3.6.14
    sending job 'papowell@h4+238' to lp@localhost
    connecting to 'localhost', attempt 1
    connected to 'localhost'
    requesting printer lp@localhost
    sending control file 'cfA238h4.private' to lp@localhost
    completed sending 'cfA238h4.private' to lp@localhost
    sending data file 'dfA238h4.private' to lp@localhost
    completed sending 'dfA238h4.private' to lp@localhost
    done job 'papowell@h4+238' transfer to lp@localhost
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpr -V</tt> (Verbose) option
          causes <b class="APPLICATION">lpr</b> to print status
          output. As you can see from the above lines, it first
          tries to connect to the <b class="APPLICATION">lpd</b>
          server on host <var class="LITERAL">localhost</var>, then
          sends a print request (which is accepted), then sends a
          <span class="emphasis"><i class=
          "EMPHASIS">control</i></span> file containing information
          about the job and a <span class="emphasis"><i class=
          "EMPHASIS">data</i></span> file or files which are copies
          of the files to be printed.</p>

          <p>If you check the <tt class="FILENAME">/tmp/lp</tt>
          file and you will find that a copy of <tt class=
          "FILENAME">/tmp/hi</tt> has been written to it. By
          default, the <b class="APPLICATION">lpd</b> print spooler
          acts as a store and forward system, accepting files to be
          printed, holding them in the print queue, and then
          forwarding them to the destination system or output
          device.</p>

          <p>You can use the <b class="APPLICATION">lpq</b> command
          to view the status of the print job.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1913"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {105} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+238' removed at 09:39:03.256
</pre>
          </div>
          <br>
          <br>

          <p>If you want to see more status information, use <tt
          class="COMMAND">lpq -l</tt>, <tt class="COMMAND">lpq
          -ll</tt>, or even <tt class="COMMAND">lpq -L</tt>. The
          <var class="LITERAL">-L</var> provides al<var class=
          "LITERAL">L</var> the status.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1923"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {106} %</samp> <kbd class=
"USERINPUT">lpq -l</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: lp@h4.private: job 'papowell@h4+238' printed at 09:39:03.112
     Status: job 'papowell@h4+238' removed at 09:39:03.256
    <samp class="PROMPT">h4: {107} %</samp> <kbd class=
"USERINPUT">lpq -ll</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: finished 'papowell@h4+238', status 'JSUCC' at 09:39:03.108
     Status: subserver pid 8240 exit status 'JSUCC' at 09:39:03.110
     Status: lp@h4.private: job 'papowell@h4+238' printed at 09:39:03.112
     Status: job 'papowell@h4+238' removed at 09:39:03.256
    <samp class="PROMPT">h4: {108} %</samp> <kbd class=
"USERINPUT">lpq -L</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: subserver pid 8240 starting at 09:39:03.105
     Status: accounting at start at 09:39:03.105
     Status: opening device '/tmp/lp' at 09:39:03.105
     Status: printing job 'papowell@h4+238' at 09:39:03.106
     Status: no banner at 09:39:03.107
     Status: printing data file 'dfA238h4.private', size 3 at 09:39:03.107
     Status: printing done 'papowell@h4+238' at 09:39:03.107
     Status: accounting at end at 09:39:03.108
     Status: finished 'papowell@h4+238', status 'JSUCC' at 09:39:03.108
     Status: subserver pid 8240 exit status 'JSUCC' at 09:39:03.110
     Status: lp@h4.private: job 'papowell@h4+238' printed at 09:39:03.112
     Status: job 'papowell@h4+238' removed at 09:39:03.256
</pre>
          </div>
          <br>
          <br>

          <p>There are different status formats available as well.
          The <tt class="COMMAND">lpq -s</tt> (summary) produces a
          single line of status per spool queue, while the <tt
          class="COMMAND">lpq -v</tt> (verbose) produces output
          that is very suitable for processing with programs such
          as <b class="APPLICATION">Perl</b> or <b class=
          "APPLICATION">awk</b>:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1936"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {109} %</samp> <kbd class=
"USERINPUT">lpq -s</kbd>
    lp@h4  0 jobs
    <samp class="PROMPT">h4: {110} %</samp> <kbd class=
"USERINPUT">lpq -v</kbd>
    Printer: lp@h4
     Printing: no
     Aborted: no
     Spooling: no
     Queue: no printable jobs in queue
     SPOOLCONTROL=
     Status: subserver pid 8240 starting at 09:39:03.105
     Status: accounting at start at 09:39:03.105
     Status: opening device '/tmp/lp' at 09:39:03.105
     Status: printing job 'papowell@h4+238' at 09:39:03.106
     Status: no banner at 09:39:03.107
     Status: printing data file 'dfA238h4.private', size 3 at 09:39:03.107
     Status: printing done 'papowell@h4+238' at 09:39:03.107
     Status: accounting at end at 09:39:03.108
     Status: finished 'papowell@h4+238', status 'JSUCC' at 09:39:03.108
     Status: subserver pid 8240 exit status 'JSUCC' at 09:39:03.110
     Status: lp@h4.private: job 'papowell@h4+238' printed at 09:39:03.112
     Status: job 'papowell@h4+238' removed at 09:39:03.256
</pre>
          </div>
          <br>
          <br>

          <p>If you check the <tt class="FILENAME">/tmp/lp</tt>
          file and you will find that a copy of <tt class=
          "FILENAME">/tmp/hi</tt> has been written to it. By
          default, the <b class="APPLICATION">lpd</b> print spooler
          acts as a store and forward system, accepting files to be
          printed, holding them in the print queue, and then
          forwarding them to the destination system or output
          device.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SELECTINGPRINTQUEUE">4.6.
          Selecting the Print Queue</a></h2>

          <p>In the previous section we used the default print
          queue. How does <b class="APPLICATION">LPRng</b>
          determine what print queue to use? First, you can
          explicitly specify the printer using the <tt class=
          "COMMAND">lpq -Pprintqueue</tt> option and the <tt class=
          "COMMAND">lpq -a</tt> or <tt class="COMMAND">lpq
          -Pall</tt> to select all print queues:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1953"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {111} %</samp> <kbd class=
"USERINPUT">lpq -Plp</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {112} %</samp> <kbd class=
"USERINPUT">lpq -Plp2</kbd>
    Printer: lp2@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {113} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
    Printer: lp2@h4
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>You can combine the <tt class="COMMAND">lpq -a</tt>
          with the <tt class="COMMAND">lpq -s</tt> option for a
          summary listing:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1964"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {114} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
    Printer: lp2@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {115} %</samp> <kbd class=
"USERINPUT">lpq -s -a</kbd>
    lp@h4  0 jobs
    lp2@h4  0 jobs
</pre>
          </div>
          <br>
          <br>

          <p>There is another way to explicitly specify the
          printqueues listed by <tt class="COMMAND">lpq -a</tt>;
          see the <a href="#ALLPC"><var class="LITERAL">all</var>
          Printcap Entry</a> for details.</p>

          <p>Users can set their default printer by using the <var
          class="ENVAR">PRINTER</var> (highest priority), <var
          class="ENVAR">LPDEST</var> (next), <var class=
          "ENVAR">NPRINTER</var> (next), and <var class=
          "ENVAR">NGPRINTER</var> (lowest priority), environment
          variables. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1979"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {116} %</samp> <kbd class=
"USERINPUT">setenv PRINTER lp2</kbd>
    <samp class="PROMPT">h4: {117} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp2@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {118} %</samp> <kbd class=
"USERINPUT">unsetenv PRINTER</kbd>
    <samp class="PROMPT">h4: {119} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>If the printer is not specified on the command line or
          by the environment variables, then the first printer in
          the printcap database will be used and then the default
          printer in the configuration database, and finally the
          compile time default. <a href="#PRINTERINFO">Printer and
          Server Information</a> for details.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CONTROLLINGPRINTQUEUE">4.7.
          Controlling the Print Queue</a></h2>

          <p>The <b class="APPLICATION">lpc</b> command is used to
          examine and control the print server operation. The <tt
          class="COMMAND">lpc status</tt> command displays the
          administrative status of a print queue. The <b class=
          "APPLICATION">lpd</b> program caches status and job
          information in order to improve performance. The <tt
          class="COMMAND">lpc flush</tt> command will flush the
          cached information and cause the server to regenerate it.
          The <tt class="COMMAND">lpc enable</tt> and <tt class=
          "COMMAND">lpc disable</tt> commands enable or disable
          spooling to the print queue, and the <tt class=
          "COMMAND">lpc stop</tt> and <tt class="COMMAND">lpc
          start</tt> commands stop and start printing (or
          transfers) of jobs in the print queue.</p>

          <p>Let's look at the status displayed when we use these
          commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2003"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {120} %</samp> <kbd class=
"USERINPUT">lpc status</kbd>
     Printer  Printing Spooling Jobs Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    0   none    none
    <samp class="PROMPT">h4: {121} %</samp> <kbd class=
"USERINPUT">lpc status all</kbd>
     Printer  Printing Spooling Jobs Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    0    none    none
    lp2@h4     enabled  enabled    0    none    none
    <samp class="PROMPT">h4: {122} %</samp> <kbd class=
"USERINPUT">lpc</kbd>
    lpc&gt;status
     Printer  Printing Spooling Jobs Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    0    none    none
    lpc&gt;status all
     Printer  Printing Spooling Jobs Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    0    none    none
    lp2@h4     enabled  enabled    0    none    none
    lpc&gt;quit
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpc</b> command can be used
          in command line or interactive mode as shown above. When
          used with no parameters it will run in interactive mode,
          reading one or more commands from its standard input
          (<acronym class="ACRONYM">STDIN</acronym>). The <tt
          class="COMMAND">lpc status</tt> command shows the
          administrative status of the select print queue. The <var
          class="LITERAL">all</var> queue name selects all print
          queues for display. As shown in the above example, both
          print queues have printing and spooling enabled and there
          are no jobs in the print queue. The <span class=
          "emphasis"><i class="EMPHASIS">Server</i></span> and
          <span class="emphasis"><i class=
          "EMPHASIS">Subserver</i></span> information shows if
          there is a process which is printing jobs, and its helper
          process that does the actual communication with the
          printer.</p>

          <p>It might be puzzling at first why <b class=
          "APPLICATION">LPRng</b> uses two processes for this
          operation, but the reason is very simple. Many operating
          system implementations have <span class="emphasis"><i
          class="EMPHASIS">memory leaks</i></span> that cause the
          actual process size to grow as it runs. This is
          especially true if a large number of databases such as
          the password, Domain Name Server, or other system
          database is consulted frequently with different queries.
          Since this is usually done quite a lot by the process
          which deals with the actual printing, the printing
          process would soon grow very large and then die when it
          could no longer obtain more memory. The <span class=
          "emphasis"><i class="EMPHASIS">Server</i></span> process
          will fork or create a child process <span class=
          "emphasis"><i class="EMPHASIS">Subserver</i></span>
          process that is responsible for the printing of a single
          job. When the job printing has been completed, the <span
          class="emphasis"><i class="EMPHASIS">Subserver</i></span>
          process will exit and the <span class="emphasis"><i
          class="EMPHASIS">Server</i></span> process will then
          create another child until there are no more jobs to be
          printed. The <span class="emphasis"><i class=
          "EMPHASIS">Redirect</i></span> and <span class=
          "emphasis"><i class="EMPHASIS">Debug</i></span> fields
          will be discussed in later sections.</p>

          <p>Now let's use the basic spool queue control
          commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2028"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {123} %</samp> <kbd class=
"USERINPUT">lpc disable</kbd>
    Printer: lp@h4
    lp@h4.private: disabled
    <samp class="PROMPT">h4: {124} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (spooling disabled)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {125} %</samp> <kbd class=
"USERINPUT">lpc enable</kbd>
    Printer: lp@h4
    lp@h4.private: enabled
    <samp class="PROMPT">h4: {126} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {127} %</samp> <kbd class=
"USERINPUT">lpc stop</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    <samp class="PROMPT">h4: {128} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {129} %</samp> <kbd class=
"USERINPUT">lpc start</kbd>
    Printer: lp@h4
    lp@h4.private: started
    <samp class="PROMPT">h4: {130} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>As we can see, the <b class="APPLICATION">lpc</b>
          command also reports on the status of the print queue.
          Let's see what happens when we print to a stopped
          queue:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2048"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {131} %</samp> <kbd class=
"USERINPUT">lpc stop</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    <samp class="PROMPT">h4: {132} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {133} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi /tmp/there</kbd>
    <samp class="PROMPT">h4: {134} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 2 printable jobs
     Server: no server active
     Rank   Owner/ID               Class Job Files            Size Time
    1      papowell@h4+17920         A 17920 /tmp/hi             3 18:14:22
    2      papowell@h4+17922         A 17922 /tmp/hi,/tmp/there  9 18:14:30
    <samp class="PROMPT">h4: {135} %</samp> <kbd class=
"USERINPUT">lpc status</kbd>
     Printer  Printing Spooling Jobs  Server Subserver Redirect Status/(Debug)
    lp@h4     disabled  enabled    2    none    none
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpc</b> status shows that
          we have two jobs spooled. The <span class="emphasis"><i
          class="EMPHASIS">Rank</i></span> field shows the order,
          the <tt class="FILENAME">Owner/ID</tt> shows the unique
          job ID that is assigned to the job and the <span class=
          "emphasis"><i class="EMPHASIS">Class</i></span> field is
          the job class (this may be changed with the <tt class=
          "COMMAND">lpr -C class</tt> option). The <span class=
          "emphasis"><i class="EMPHASIS">Job</i></span> field shows
          the <span class="emphasis"><i class="EMPHASIS">job
          number</i></span> assigned to this job in this particular
          spool queue. While the <acronym class=
          "ACRONYM">ID</acronym> value never changes as a job moves
          through the <b class="APPLICATION">LPRng</b> system, the
          <span class="emphasis"><i class="EMPHASIS">job
          number</i></span> is specific to a particular spool queue
          and may change if a job is <span class="emphasis"><i
          class="EMPHASIS">forwarded</i></span> to another spool
          queue that has a job with the same job number. The <span
          class="emphasis"><i class="EMPHASIS">Size</i></span>
          field is the total number of printable bytes in the job,
          and the <span class="emphasis"><i class=
          "EMPHASIS">Time</i></span> field shows the timestamp
          associated with the job.</p>

          <p>Now let's start the print queue and watch what
          happens.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2075"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {136} %</samp> <kbd class=
"USERINPUT">lpc start</kbd>
    Printer: lp@h4
    lp@h4.private: started
    <samp class="PROMPT">h4: {137} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: 2 printable jobs
     Server: pid 17928 active
     Unspooler: pid 17929 active
     Status: opening device '/tmp/lp' at 18:14:43.921
     Rank   Owner/ID             Class Job Files            Size Time
    active papowell@h4+17920       A 17920 /tmp/hi             3 18:14:22
    2      papowell@h4+17922       A 17922 /tmp/hi,/tmp/there  9 18:14:30
    <samp class="PROMPT">h4: {138} %</samp> <kbd class=
"USERINPUT">lpq -ll</kbd>
    Printer: lp@h4
     Queue: 2 printable jobs
     Server: pid 17928 active
     Unspooler: pid 17929 active
     Status: printing job 'papowell@h4+17920' at 18:14:43.921
     Status: no banner at 18:14:43.921
     Status: printing data file 'dfA017920h4.private', size 57 at 18:14:43.922
     Rank   Owner/ID             Class Job Files            Size Time
    active papowell@h4+17920       A 17920 /tmp/hi             3 18:14:22
    2      papowell@h4+17922       A 17922 /tmp/hi,/tmp/there  9 18:14:30
</pre>
          </div>
          <br>
          <br>

          <p>The <span class="emphasis"><i class=
          "EMPHASIS">Rank</i></span> value of the first job has
          been changed to <var class="LITERAL">active</var> and
          there is new <span class="emphasis"><i class=
          "EMPHASIS">Status</i></span> information. If we use <tt
          class="COMMAND">lpq -ll</tt> we can see the times that
          the various print operations are carried out, and details
          of their success or failure.</p>

          <p>We can also use the <b class="APPLICATION">lpc</b>
          command to see the status of a particular job. We can
          select jobs by the user name, the ID, or the job number.
          For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2090"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {139} %</samp> <kbd class=
"USERINPUT">lpc stop</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    <samp class="PROMPT">h4: {140} %</samp> <kbd class=
"USERINPUT">echo hi |lpr</kbd>
    <samp class="PROMPT">h4: {141} %</samp> <kbd class=
"USERINPUT">echo there | lpr</kbd>
    <samp class="PROMPT">h4: {142} %</samp> <kbd class=
"USERINPUT">echo test |lpr</kbd>
    <samp class="PROMPT">h4: {143} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 3 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID            Class Job Files           Size Time
    1      papowell@h4+17959      A 17959 (stdin)            3 18:23:24
    2      papowell@h4+17962      A 17962 (stdin)            6 18:23:30
    3      papowell@h4+17970      A 17970 (stdin)            5 18:23:35
    <samp class="PROMPT">h4: {144} %</samp> <kbd class=
"USERINPUT">lpq 17970</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 3 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID            Class Job Files           Size Time
    3      papowell@h4+17970      A 17970 (stdin)            5 18:23:35
    <samp class="PROMPT">h4: {145} %</samp> <kbd class=
"USERINPUT">lpq papowell</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 3 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID            Class Job Files           Size Time
    1      papowell@h4+17959      A 17959 (stdin)            3 18:23:24
    2      papowell@h4+17962      A 17962 (stdin)            6 18:23:30
    3      papowell@h4+17970      A 17970 (stdin)            5 18:23:35
    <samp class="PROMPT">h4: {146} %</samp> <kbd class=
"USERINPUT">lpq -s 17970</kbd>
    lp@h4  1 jobs
    <samp class="PROMPT">h4: {147} %</samp> <kbd class=
"USERINPUT">lpq -s papowell</kbd>
    lp@h4  3 jobs
    <samp class="PROMPT">h4: {148} %</samp> <kbd class=
"USERINPUT">lpq -s nobody</kbd>
    lp@h4  0 jobs
</pre>
          </div>
          <br>
          <br>

          <p>We use <tt class="COMMAND">lpq -Pqueuename</tt> to
          select a specific print queue and <tt class="COMMAND">lpq
          -a</tt> or <tt class="COMMAND">lpq -Pall</tt> to select
          all queues:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2116"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {149} %</samp> <kbd class=
"USERINPUT">lpc -a stop</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    Printer: lp2@h4
    lp2@h4.private: stopped
    <samp class="PROMPT">h4: {150} %</samp> <kbd class=
"USERINPUT">lpc -Pall start</kbd>
    Printer: lp@h4
    lp@h4.private: started
    Printer: lp2@h4
    lp2@h4.private: started
</pre>
          </div>
          <br>
          <br>

          <p>You can use the <b class="APPLICATION">lpc</b> command
          in <span class="emphasis"><i class=
          "EMPHASIS">interactive</i></span> mode:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2125"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {151} %</samp> <kbd class=
"USERINPUT">lpc</kbd>
    lpc&gt;status
     Printer  Printing Spooling Jobs  Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    3    17990   17993
    lpc&gt;status all
     Printer  Printing Spooling Jobs  Server Subserver Redirect Status/(Debug)
    lp@h4      enabled  enabled    3    17990   17993
    lp2@h4     enabled  enabled    3    none    none
    lpc&gt;stop lp
    Printer: lp@h4
    lp@h4.private: stopped
    lpc&gt;start lp
    Printer: lp@h4
    lp@h4.private: started
    lpc&gt;quit
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpc topq</tt> command can be
          used to put a job (or jobs) at the head of the spool
          queue. This command is very useful when some job requires
          priority service. You can select the job by using the job
          number or the job ID.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2131"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {152} %</samp> <kbd class=
"USERINPUT">lpc topq lp 17970</kbd>
    Printer: lp@h4
    lp: selected 'papowell@h4+17970'
    lp@h4.private: started
    <samp class="PROMPT">h4: {153} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: 3 printable jobs
     Server: pid 17999 active
     Rank   Owner/ID          Class Job Files      Size Time
    active papowell@h4+17970    A 17970 (stdin)      5 18:23:35
    1      papowell@h4+17959    A 17959 (stdin)      3 18:23:24
    2      papowell@h4+17962    A 17962 (stdin)      6 18:23:30
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBREMOVAL">4.8. Job
          Removal</a></h2>

          <p>Occasionally we print a file and then change our mind
          and want to cancel the job. The <b class=
          "APPLICATION">lprm</b> command allows us to do this.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2141"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {154} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 3 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID          Class Job Files      Size Time
    1      papowell@h4+17959    A 17959 (stdin)       3 18:23:24
    2      papowell@h4+17962    A 17962 (stdin)       6 18:23:30
    3      papowell@h4+17970    A 17970 (stdin)       5 18:23:35
    <samp class="PROMPT">h4: {155} %</samp> <kbd class=
"USERINPUT">lprm</kbd>
    Printer lp@h4:
      checking perms 'papowell@h4+17959'
      dequeued 'papowell@h4+17959'
    <samp class="PROMPT">h4: {156} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 2 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID          Class Job Files      Size Time
    1      papowell@h4+17962    A 17962 (stdin)       6 18:23:30
    2      papowell@h4+17970    A 17970 (stdin)       5 18:23:35
    <samp class="PROMPT">h4: {157} %</samp> <kbd class=
"USERINPUT">lprm 17970</kbd>
    Printer lp@h4:
      checking perms 'papowell@h4+17970'
      dequeued 'papowell@h4+17970'
    <samp class="PROMPT">h4: {158} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID          Class Job Files     Size Time
    1      papowell@h4+17962    A 17962 (stdin)      6 18:23:30
</pre>
          </div>
          <br>
          <br>

          <p>By default, the <b class="APPLICATION">lprm</b>
          command removes the first job in the queue that the user
          has permission to remove. Also, as shown in the example,
          you can remove a job by specifying the job ID or the job
          number. If you specify a user name, you remove <var
          class="LITERAL">all</var> of the user's jobs. This can be
          dangerous:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2156"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {159} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 3 printable jobs
     Server: no server active
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
     Rank   Owner/ID          Class Job Files     Size Time
    1      papowell@h4+17962    A 17962 (stdin)      6 18:23:30
    2      papowell@h4+18499    A 18499 /tmp/hi      3 18:56:00
    3      papowell@h4+18501    A 18501 /tmp/there   6 18:56:02
    <samp class="PROMPT">h4: {160} %</samp> <kbd class=
"USERINPUT">lprm papowell</kbd>
    Printer lp@h4:
      checking perms 'papowell@h4+17962'
      dequeued 'papowell@h4+17962'
      checking perms 'papowell@h4+18499'
      dequeued 'papowell@h4+18499'
      checking perms 'papowell@h4+18501'
      dequeued 'papowell@h4+18501'
    <samp class="PROMPT">h4: {161} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+17922' removed at 18:15:13.981
</pre>
          </div>
          <br>
          <br>

          <p>The special user <var class="LITERAL">all</var>
          matches all jobs in a print queue. Clearly you should be
          careful not to specify <tt class="COMMAND">lprm all</tt>
          by accident. Even more dangerous is the following
          command:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2167"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {162} %</samp> <kbd class=
"USERINPUT">lprm -a all</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>As you might surmise, this removes <var class=
          "LITERAL">all</var> print jobs in <var class=
          "LITERAL">all</var> queues, which is an excellent way to
          purge print queues of all jobs.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTJOBFILTERS">4.9. Print
          Job Filters</a></h2>

          <p>A printer usually understands one or more <span class=
          "emphasis"><i class="EMPHASIS">Print Job
          Languages</i></span>. Files sent to this printer must be
          in one of these languages and have the appropriate <span
          class="emphasis"><i class="EMPHASIS">job
          format</i></span>. The most common Print Job Languages
          are <a href="#POSTSCRIPT">PostScript</a> and <a href=
          "#PCL">PCL</a>. Text files are PCL with no special PCL
          control sequences.</p>

          <p>In order for a printer to reliably print a job it
          needs to be reset to a known configuration and then at
          the end of job having it flush all of the output to the
          printing device. This is done by sending it <span class=
          "emphasis"><i class="EMPHASIS">start of job</i></span>
          and <span class="emphasis"><i class="EMPHASIS">end of
          job</i></span> commands. These commands differ from
          printer to printer and depend on the print job language
          as well. Some <span class="emphasis"><i class=
          "EMPHASIS">vintage</i></span> line printers also have a
          set of proprietary <span class="emphasis"><i class=
          "EMPHASIS">escape sequences</i></span> that are used to
          set up margins, form size, and other printing
          characteristics. Usually a <span class="emphasis"><i
          class="EMPHASIS">setup string</i></span> with these
          escape sequences must be sent to the printer before a
          file can be printed.</p>

          <p>When sending a job to the printer the print spooler
          will first process the job using a <span class=
          "emphasis"><i class="EMPHASIS">print job
          filter</i></span> or <span class="emphasis"><i class=
          "EMPHASIS">filter</i></span> program. This program reads
          the job file and then produces output in the format
          required for the printer.</p>

          <p>When a print job is created the files in the print job
          are assigned a <span class="emphasis"><i class=
          "EMPHASIS">format</i></span>. This format was meant as a
          guide to the print spooler and was to be used to select
          the filter program for the files in the job. The format
          was a lower case letter; the <var class="LITERAL">f</var>
          is the de<var class="LITERAL">f</var>ault format and
          indicates normal processing and the <var class=
          "LITERAL">l</var> format indicates a literal or binary
          file. Job files that are flagged as having literal or
          binary format are usually passed directly to the printer
          or have at the most a minimal amount of processing. See
          <a href="#PRINTJOBFORMATS">Print Job Formats</a> for more
          information about formats and their use with filters.</p>

          <p>There are two ways to specify filters: the default
          <var class="LITERAL">:filter=...</var> option and the
          more specific <var class="LITERAL">Xf=...</var> option.
          The <var class="LITERAL">X</var> is a lower case letter
          corresponding to a format. Here is a sample printcap
          entry with a filter specification:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2200"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :filter=/usr/local/lib/filters/ifhp
      :rf=/usr/local/lib/filters/rfilter
</pre>
          </div>
          All jobs with formats other than <var class=
          "LITERAL">r</var> will be processed using the <var class=
          "LITERAL">ifhp</var> program while the jobs with the <var
          class="LITERAL">r</var> format will be processed using
          the <var class="LITERAL">rfilter</var> program.<br>
          <br>

          <p>We will set up a very simple filter and use it to
          demonstrate how filtering is done by the <b class=
          "APPLICATION">lpd</b> print spooler. First, set up the
          <tt class="FILENAME">/tmp/testf</tt> file as shown
          below.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2209"></a>
<pre class="SCREEN">
    #!/bin/sh
    # /tmp/testf - test filter for LPRng
    PATH=/bin:/usr/bin; export PATH
    echo TESTF $0 "$@" &gt;&amp;2
    echo TESTF $0 "$@"
    echo ENV
    set
    echo LEADER
    /bin/cat
    echo TRAILER
    exit 0
</pre>
          </div>
          <br>
          <br>

          <p>Let us carefully examine the script line by line. The
          first couple of lines are <span class="emphasis"><i
          class="EMPHASIS">boilerplate</i></span>. You should <span
          class="emphasis"><i class="EMPHASIS">always</i></span>
          set the <var class="ENVAR">PATH</var> value in a filter
          script or use full pathnames for executable programs.
          This is a good practice as it ensures that only the
          specified directories will be searched for commands.</p>

          <p>The next lines echo the command line arguments to file
          descriptor 2 (<acronym class="ACRONYM">STDERR</acronym>)
          and to <acronym class="ACRONYM">STDOUT</acronym>. We will
          soon see how this information is displayed by the <b
          class="APPLICATION">LPRng</b> software. We then use the
          <tt class="COMMAND">set</tt> command to list the shell
          variables to <acronym class="ACRONYM">STDOUT</acronym>,
          print <acronym class="ACRONYM">LEADER</acronym> to
          <acronym class="ACRONYM">STDOUT</acronym>, copy <acronym
          class="ACRONYM">STDIN</acronym> to <acronym class=
          "ACRONYM">STDOUT</acronym>, and print <acronym class=
          "ACRONYM">TRAILER</acronym> to <acronym class=
          "ACRONYM">STDOUT</acronym>. We exit with a zero result
          code.</p>

          <p>We can test our script, with the results shown
          below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2228"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {163} %</samp> <kbd class=
"USERINPUT">chmod 755 /tmp/testf</kbd>
    <samp class="PROMPT">h4: {164} %</samp> <kbd class=
"USERINPUT">echo hi |/tmp/testf -a1</kbd>
    TESTF /tmp/testf -a1
    TESTF /tmp/testf -a1
    ENV
    USER=papowell
    HOSTNAME=h4
    ...
    PATH=/bin:/usr/bin
    LEADER
    hi
    TRAILER
</pre>
          </div>
          <br>
          <br>

          <p>Let's now use this filter. Edit the <var class=
          "LITERAL">lp</var> printcap entry so it has contents
          indicated below, use <tt class="COMMAND">checkpc -f</tt>
          to check the printcap, and then use <tt class=
          "COMMAND">lpc reread</tt> to restart the <b class=
          "APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2239"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter=/tmp/testf
</pre>
          </div>
          <br>
          <br>

          <p>Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2243"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {165} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {166} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {167} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: lp@h4.private: job 'papowell@h4+26593' printed at 21:37:21.312
     Status: job 'papowell@h4+26593' removed at 21:37:21.323
     Status: subserver pid 26683 starting at 21:39:21.908
     Status: accounting at start at 21:39:21.908
     Status: opening device '/tmp/lp' at 21:39:21.909
     Status: printing job 'papowell@h4+26681' at 21:39:21.909
     Status: no banner at 21:39:21.909
     Status: printing data file 'dfA026681h4.private', size 3, \
        IF filter 'testf' at 21:39:21.909
     Status: IF filter msg - 'TESTF /tmp/testf -Apapowell@h4+26681 \
         -CA -D2000-04 -11-21:39:21.877 -Ff -Hh4.private -J/tmp/hi \
          -Lpapowell -Plp -Qlp -aacct -b3 -d/var/tmp/LPD/lp \
          -edfA026681h4.private -f/tmp/hi -hh4.private -j026681 \
          -kcfA026681h4.private -l66 -npapowell -sstatus \
          -t2000-04-11-21:39:21.000 -w80 -x0 -y0 acct' \
           at 21:39:21.914
     Status: IF filter finished at 21:39:22.070
     Status: printing done 'papowell@h4+26681' at 21:39:22.070
     Status: accounting at end at 21:39:22.070
     Status: finished 'papowell@h4+26681', status 'JSUCC' at 21:39:22.070
     Status: subserver pid 26683 exit status 'JSUCC' at 21:39:22.072
     Status: lp@h4.private: job 'papowell@h4+26681' printed at 21:39:22.072
     Status: job 'papowell@h4+26681' removed at 21:39:22.085
    <samp class="PROMPT">h4: {168} %</samp> <kbd class=
"USERINPUT">more /tmp/lp</kbd>
    TESTF /tmp/testf -Apapowell@h4+26681 -CA -D2000-04-11-21:39:21.877 \
     -Ff -Hh4.private -J/tmp/hi -Lpapowell -Plp -Qlp -aacct -b3 \
     -d/var/tmp/LPD/lp -edfA026681h4.private -f/tmp/hi -hh4.private \
     -j026681 -kcfA026681h4.private -l66 -npapowell -sstatus \
     -t2000-04-11-21:39:21.000 -w80 -x0 -y0 acct
    ENV
    USER=papowell
    LD_LIBRARY_PATH=/lib:/usr/lib:/usr/5lib:/usr/ucblib
    HOME=/home/papowell
    PRINTCAP_ENTRY=lp
     :force_localhost
     :filter=/tmp/testf
     :lp=/var/tmp/lp
     :sd=/var/tmp/LPD/lp
    
    PS1=$
    OPTIND=1
    PS2=&gt;
    SPOOL_DIR=/var/tmp/LPD/lp
    LOGNAME=papowell
    
    CONTROL=Hh4.private
     Ppapowell
     J/tmp/hi
     CA
     Lpapowell
     Apapowell@h4+15850
     D2000-04-26-18:13:55.505
     Qlp
     N/tmp/hi
     fdfA015850h4.private
     UdfA015850h4.private
    
    PATH=/bin:/usr/bin
    SHELL=/bin/sh
    LOGDIR=/home/papowell
    IFS=
    PRINTER=lp
    LEADER
    test Test
    TRAILER
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">cp</tt> command clears out the
          <tt class="FILENAME">/tmp/lp</tt> file we are using as a
          dummy output device. The <tt class="COMMAND">lpr</tt>
          command prints the <tt class="FILENAME">/tmp/hi</tt> file
          and the <tt class="COMMAND">lpq -llll</tt> command shows
          the status information. The status information now
          contains the line that the <tt class="COMMAND">testf</tt>
          script wrote to <acronym class=
          "ACRONYM">STDERR</acronym>. The <b class=
          "APPLICATION">lpd</b> server captures filter <acronym
          class="ACRONYM">STDERR</acronym> messages and puts it
          them in the spool queue status file.</p>

          <p>As we see from the lpq status, <b class=
          "APPLICATION">lpd</b> passes a large number of command
          line options to our filter. These options and their
          meanings are discussed in detail in <a href=
          "#FILTEROPTIONS">Filter Command Line Options and
          Environment Variables</a>. We will discuss these in more
          detail in the next section.</p>

          <p>If we look at the <tt class="FILENAME">/tmp/lp</tt>
          file, we see the command line options and values of the
          shell variables. For a full discussion of the environment
          variables passed to a filter see <a href=
          "#FILTEROPTIONS">Filter Command Line Options and
          Environment Variables</a>. The more interesting
          environment variables include the <var class=
          "ENVAR">PRINTCAP_ENTRY</var> variable, which is a copy of
          the printcap entry for this printer, and the <var class=
          "ENVAR">CONTROL</var> variable, which is a copy of the
          control file for the the print job.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="CONTROLFILES">4.9.1. Control
            Files and Filter Options</a></h3>

            <p>When you submit a print job the <b class=
            "APPLICATION">lpd</b> print spooler stores it in the
            spool queue as two or more files: a <span class=
            "emphasis"><i class="EMPHASIS">control</i></span> file
            that contains information about the job and the <span
            class="emphasis"><i class="EMPHASIS">data</i></span>
            files that contain the information to be printed. Here
            is sample control file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2277"></a>
<pre class="SCREEN">
    Hh4.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Apapowell@h4+15850
    D2000-04-26-18:13:55.505
    Qlp
    N/tmp/hi
    fdfA015850h4.private
    UdfA015850h4.private
</pre>
            </div>
            <br>
            <br>

            <p>Lines starting with upper case letters contain job
            information such as the user who submitted the job.
            Lines starting with lower case letters indicate the
            data file to be printed and the corresponding format.
            For full details about the exact format of the control
            file see <a href="#JOBFILES">Job Files</a>.</p>

            <p><a href="#FILTEROPTIONSTABLE">Table 4-1</a> shows
            the correspondence between lines in the control file
            and <b class="APPLICATION">lpr</b> command line
            options. The <var class="LITERAL">N</var> values are
            the names of the files that are printed. The <var
            class="LITERAL">U</var> indicates a data file is in a
            job and is present to meet RCF1179 and <span class=
            "emphasis"><i class="EMPHASIS">vintage</i></span> print
            spooler requirements.</p>

            <div class="TABLE">
              <a name="FILTEROPTIONSTABLE"></a>

              <p><b>Table 4-1. Filter Options</b></p>

              <table border="1" frame="border" rules="all" class=
              "CALSTABLE">
                <col>
                <col>
                <col>

                <thead>
                  <tr>
                    <th>Control File</th>

                    <th>Filter Option</th>

                    <th>Purpose or Value</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td>&nbsp;</td>

                    <td><var class="LITERAL">-P</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Printer</i></span></td>

                    <td>Print queue name - printcap
                    information</td>
                  </tr>

                  <tr>
                    <td><span class="emphasis"><i class=
                    "EMPHASIS">H</i></span></td>

                    <td><var class="LITERAL">-H</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Host</i></span></td>

                    <td>Host Name</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">P</var></td>

                    <td><var class="LITERAL">-n</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">User</i></span></td>

                    <td>User Login Name of job originator</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">J</var></td>

                    <td><var class="LITERAL">-J</var><span class=
                    "emphasis"><i class="EMPHASIS">Job
                    name</i></span></td>

                    <td>lpr -J option or file name</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">C</var></td>

                    <td><var class="LITERAL">-C</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Class</i></span></td>

                    <td>Print class (lpr -C option)</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">L</var></td>

                    <td><var class="LITERAL">-L</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Banner</i></span></td>

                    <td>Banner page request</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">A</var></td>

                    <td><var class="LITERAL">-A</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Jobid</i></span></td>

                    <td>Job Id</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">D</var></td>

                    <td><var class="LITERAL">-D</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Date</i></span></td>

                    <td>Date or time information</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">Q</var></td>

                    <td><var class="LITERAL">-Q</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Queue</i></span></td>

                    <td>Original Print queue job was sent to</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">N</var></td>

                    <td><var class="LITERAL">-N</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">Filename</i></span></td>

                    <td>Filename</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">f,l,p,...</var></td>

                    <td><var class="LITERAL">-F</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">f</i></span></td>

                    <td>Datafile format</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">U</var></td>

                    <td>&nbsp;</td>

                    <td>Datafile (historical)</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p>When a print filter processes these jobs the values
            in the control file are passed on the command line as
            options starting with upper case letters:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2378"></a>
<pre class="SCREEN">
    /tmp/testf -Apapowell@h4+26681 -CA \
       -D2000-04-11-21:39:21.877 -Ff -Hh4.private ....
</pre>
            </div>
            Sometimes we want to pass only a small subset of these
            command line options to a filter or provide them in a
            specific order in order to be compatible with <span
            class="emphasis"><i class="EMPHASIS">legacy</i></span>
            print filters. <b class="APPLICATION">LPRng</b>
            provides several different ways to do this and we will
            explore how to control command line options.<br>
            <br>

            <p>If the filter entry starts with <var class=
            "LITERAL">-$</var>, this suppresses the automatic
            addition of command line options; we can then add our
            own options to the command line. Modify the printcap
            entry to have the following form:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2384"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter= -$ /tmp/testf '$P' $0P -X$-P ${lp} G\072 or \:
</pre>
            </div>
            <br>
            <br>

            <p>Lets print our <tt class="FILENAME">/tmp/hi</tt>
            test file and then look at the <b class=
            "APPLICATION">lpq</b> status:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2389"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {169} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {170} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {171} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ....
     Status: IF filter msg - 'TESTF /tmp/testf -Plp -P lp -Xlp \
        -Ylp /tmp/lp G: or :' at 01:20:21.560
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">-$</var> suppresses the
            adding the default literals to the filter command line.
            You can pass specific options using <var class=
            "LITERAL">$X</var>; if the option has a non-null value
            then it will be expanded in the following format:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2400"></a>
<pre class="SCREEN">
    Option    Value Expansion
    $X        -X&lt;value&gt;
    $'X       -X'&lt;value&gt;'
    $0X       -X '&lt;value&gt;'
    $-X       &lt;value&gt;
    $'-X      '&lt;value&gt;'
    ${X}      control file X option value
    $'{X}     control file X option value (in quotes)
    ${name}   printcap option value if value nonzero length
    $'{name}  printcap option value if value nonzero length in quotes
    \nnn      single printable character
    $*        all options in control file expanded using $X
</pre>
            </div>
            <br>
            <br>

            <p>Command line options can be grouped and passed as a
            single argument by enclosing them in single or double
            quotes. You should be aware that <b class=
            "APPLICATION">LPRng</b> has an <span class=
            "emphasis"><i class="EMPHASIS">extremely</i></span>
            primitive way of handling quotes. When the <tt class=
            "COMMAND">/bin/sh -c</tt> parameter is not used, the
            the command line is broken on spaces and each unit is
            passed as an individual argument. If the first
            character after a space is a quote (single or double),
            the next quote is found, and then entire element is
            then used as a single parameter. Substitution of <var
            class="LITERAL">$X</var> parameters is then done. As a
            special case, when you have a <var class=
            "LITERAL">$0X</var>, this causes a split and all of the
            string previous and including the <var class=
            "LITERAL">-X</var> flag is passed as a single option
            and all of the option value and following are passed as
            another option. If the result of the expansion is a
            zero length parameter then it is removed from the
            parameter list. When the <tt class="COMMAND">/bin/sh
            -c</tt> is used the command line is not broken, and all
            non-empty option values are enclosed in single
            quotes.</p>

            <p>The <var class="LITERAL">${name}</var> option is
            used to pass a printcap option value. For example, you
            can pass the value of the printcap option <var class=
            "LITERAL">form</var> as shown below. You can experiment
            with this by using the <tt class=
            "FILENAME">/tmp/testf</tt> filter and printcap shown
            below.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2414"></a>
<pre class="SCREEN">
    printcap:
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter=/tmp/testf -F ${form}
      :form=payroll
    
    <samp class="PROMPT">h4: {172} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {173} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {174} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ...
     Status: IF filter msg - 'TESTF /tmp/testf -F payroll' at 09:55:31.276
     ...
</pre>
            </div>
            <br>
            <br>

            <p>If we have a <span class="emphasis"><i class=
            "EMPHASIS">legacy</i></span> print filter that was
            originally written for the <acronym class=
            "ACRONYM">BSD</acronym> print spooler, then we may find
            that it requires a small number of command line options
            in a very specific order. We can use the <var class=
            "LITERAL">:bkf</var> (BSD Kompatible Filter or
            BacKwards compatible Filter) flag to pass suitable
            options. Modify the printcap entry to have the
            following form:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2426"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter=/tmp/testf
      :bk
</pre>
            </div>
            <br>
            <br>

            <p>Lets print our <tt class="FILENAME">/tmp/hi</tt>
            test file and then look at the <b class=
            "APPLICATION">lpq</b> status:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2431"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {175} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {176} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {177} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ....
     Status: IF filter msg - 'TESTF /tmp/testf -Plp -w80 -l66 \
        -x0 -y0 -Ff -Lpapowell -J/tmp/hi -CA -n papowell \
        -h h4.private acct' at 08:07:46.583
</pre>
            </div>
            <br>
            <br>

            <p>Finally, there are times when we would like the
            print filter to be a simple shell command or to chain
            several programs together in a simple pipeline. While
            this is possible using a print filter, you can also do
            this in the filter specification. If your filter
            specification starts with a parenthesis (<var class=
            "LITERAL">(</var>) or contains the IO redirection for
            pipeto (<var class="LITERAL">|</var>), input
            redirection (<var class="LITERAL">&lt;</var>), or
            output redirection (<var class="LITERAL">&gt;</var>)
            then the <b class="APPLICATION">lpd</b> server will use
            the <var class="LITERAL">:shell</var> configuration
            option value (default <tt class=
            "FILENAME">/bin/sh</tt>) and execute it using:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2447"></a>
<pre class="SCREEN">
    ${shell} -c "( ${if} )"
</pre>
            </div>
            <br>
            <br>

            <p>If this is done, then no command line options are
            added to the command. However, expansion of <var class=
            "LITERAL">$X</var> parameters are still done. Modify
            the printcap entry to have the following form:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2451"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter=(echo "PREAMBLE"; /tmp/testf; echo "APPENDIX")
</pre>
            </div>
            <br>
            <br>

            <p>Lets print our <tt class="FILENAME">/tmp/hi</tt>
            test file and then look at the <b class=
            "APPLICATION">lpq</b> status:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2456"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {178} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {179} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {180} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ....
     Status: printing data file 'dfA018881h4.private', size 3, \
       IF filter 'echo' at 09:22:11.476
     Status: IF filter msg - 'TESTF /tmp/testf' at 09:22:11.510
     Status: IF filter finished at 09:22:11.514
</pre>
            </div>
            <br>
            <br>

            <p>If we examine the <tt class="FILENAME">/tmp/lp</tt>
            file we find:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2466"></a>
<pre class="SCREEN">
    PREAMBLE
    TESTF /tmp/testf
    ENV
    USER=papowell
    LD_LIBRARY_PATH=/lib:/usr/lib:/usr/5lib:/usr/ucblib
    ...
    PRINTER=lp
    LEADER
    hi
    TRAILER
    APPENDIX
</pre>
            </div>
            <br>
            <br>

            <p>As we expected, no options were passed on the
            command line. If the printcap is modified to have the
            following contents, then you will see:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2469"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :filter=(echo "PREAMBLE"; /tmp/testf $*; echo "APPENDIX")
    
    <samp class="PROMPT">h4: {181} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {182} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ....
     Status: IF filter msg - 'TESTF /tmp/testf -Apapowell@h4+18941 \
       -CA -D2000-04-29-09:27:30.700 -Ff -Hh4.private -J/tmp/hi \
       -Lpapowell -Plp -Qlp -aacct -b3 -d/var/tmp/LPD/lp \
       -edfA018941h4.private -f/tmp/hi -hh4.private -j018941 \
       -kcfA018941h4.private -l66 -npapowell -sstatus \
       -t2000-04-29-09:27:30.864 -w80 -x0 -y0 acct' at 09:27:30.879
</pre>
            </div>
            <br>
            <br>

            <p>Using the shell invocation is especially useful when
            you may have a parameter that has an empty string
            value, and need to pass this as a command line
            parameter. Modify the <tt class=
            "FILENAME">/tmp/testf</tt> filter, the printcap, and
            execute the following commands:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2477"></a>
<pre class="SCREEN">
    printcap:
      lp:sd=/var/spool/lpd/%P
        :force_localhost
        :lp=/tmp/lp
        :filter=( /tmp/testf -F '${form}' )
        :form=
    
    #!/bin/sh
    # /tmp/testf - test filter for LPRng
    PATH=/bin:/usr/bin; export PATH
    echo TESTF $0 "$@" &gt;&amp;2
    echo TESTF $0 "$@"
    while test $# -gt 0 ; do
      echo "PARM '$1'";
      shift;
    done
    echo LEADER
    /bin/cat
    echo TRAILER
    exit 0
    
    <samp class="PROMPT">h4: {183} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {184} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {185} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4
     ...
     Status: IF filter msg - 'TESTF /tmp/testf -F' at 09:59:27.365
    
    <samp class="PROMPT">h4: {186} %</samp> <kbd class=
"USERINPUT">more /tmp/lp</kbd>
    TESTF /tmp/testf -F
    PARM '-F'
    PARM ''
    LEADER
    hi
    TRAILER
</pre>
            </div>
            <br>
            <br>

            <p>As you can see, there are <span class="emphasis"><i
            class="EMPHASIS">empty</i></span> parameters passed to
            the filter. This is due to the combination of the <var
            class="LITERAL">$'{form}</var> and using the <var
            class="LITERAL">:filter=(...)</var> form.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name=
            "FILTERENVIRONMENTVARS">4.9.2. Filter Environment
            Variables</a></h3>

            <p>In this section we will look further at the
            environment variables passed to the filter. We printed
            the shell variable values for the filter at the start
            of the file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2494"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {187} %</samp> <kbd class=
"USERINPUT">cat /tmp/lp</kbd>
    /tmp/testf -Plp -P lp -Xlp -Ylp /tmp/lp G:' at 01:20:21.560
    ENV
    CONTROL=Hh4.private
     Ppapowell
     J/tmp/hi
     CA
     Lpapowell
     Apapowell@h4+105
     D2000-04-12-15:27:26.662
     Qlp
     N/tmp/hi
     fdfA105h4.private
     UdfA105h4.private
    HOME=/home/daemon
    LD_LIBRARY_PATH=/lib:/usr/lib:/usr/5lib:/usr/ucblib
    LOGDIR=/home/daemon
    LOGNAME=daemon
    OPTIND=1
    PATH=/bin:/usr/bin:/usr/local/bin
    PRINTCAP_ENTRY=lp
     :force_localhost
     :filter=/tmp/testf
     :lp=/tmp/lp
     :sd=/tmp/LPD/lp
    PRINTER=lp
    PS1=$
    PS2=&gt;
    SHELL=/bin/sh
    SPOOL_DIR=/tmp/LPD/lp
    USER=daemon
    
    LEADER
    hi
    TRAILER
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="ENVAR">HOME</var>, <var class=
            "ENVAR">USER</var>, <var class="ENVAR">SHELL</var>,
            <var class="ENVAR">PS1</var>, and <var class=
            "ENVAR">PS2</var> variables are usually set by the
            shell, and are reflect the information for the <acronym
            class="ACRONYM">UID</acronym> of the user running the
            shell.</p>

            <p>The <var class="ENVAR">PATH</var> and <var class=
            "LITERAL">LP_LIBRARY_PATH</var> are set by the <b
            class="APPLICATION">lpd</b> server to values specified
            in the printcap or configuration information. It is
            recommended that users set these to site specific
            values if the defaults are not suitable for their
            sites.</p>

            <p>The <b class="APPLICATION">lpd</b> server sets the
            <var class="LITERAL">PRINTER</var>, <var class=
            "LITERAL">PRINTCAP_ENTRY</var>, and <var class=
            "LITERAL">CONTROL</var> environment variables to the
            printer name, printcap entry, and control file for the
            print job. This information is very useful to filters
            that must make decisions based on values passed to the
            print server in the control file and which use
            parameters in the printcap entry to control their
            actions.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name=
            "USINGCOMMANDLINEANDPRINTCAP">4.9.3. Using Command Line
            and Printcap Options In Filters</a></h3>

            <p>One of the problems commonly encountered problem in
            writing a filter is getting the command line values.
            The UNIX POSIX Standard provides a C Language <code
            class="FUNCTION">getopt</code> function that can be
            used for command line options, and some, but not all
            shell implementations have a corresponding shell <code
            class="FUNCTION">getopt</code> function. Also, many
            times it would be useful to get the values of the
            printcap options. These could be used to specify
            options or operations that are not easily done by
            passing command lines.</p>

            <ul>
              <li>
                <p>Observe that all the command line options are
                single letters. If we set the shell variables to
                the corresponding option value, then we could
                access them by using <var class="LITERAL">$x</var>,
                where <var class="LITERAL">x</var> is the option
                letter. There is an exception to this rule, which
                is the <var class="LITERAL">-c</var> command line
                literal, which for various historical and
                compatibility reasons does not take a value. But if
                it is present, we might as well assign it the value
                <var class="LITERAL">1</var>.</p>
              </li>

              <li>
                <p>Observe that by convention all printcap options
                have lowercase names of two or more letters, and
                that all environment variables have all upper case
                letters. If we set shell variables with the
                corresponding printcap entry values, then we can
                access them using <var class=
                "LITERAL">$literal</var>. If we need to create a
                local shell variable for use, we can use <var
                class="LITERAL">mIxEd</var> case and not have a
                conflict.</p>
              </li>
            </ul>
            <br>
            <br>

            <p>The <var class="LITERAL">decode_args_with_sh</var>
            script which is in the <acronym class=
            "ACRONYM">UTILS</acronym> directory of the <b class=
            "APPLICATION">LPRng</b> distribution follows these
            conventions and sets the appropriate shell variables.
            We have also include a bit of code that will extract
            the control file control line values and put them into
            variables as well.</p>

            <p>Save the current <tt class=
            "FILENAME">/tmp/testf</tt> filter file in <tt class=
            "FILENAME">/tmp/testf.old</tt> and replace it with the
            following:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2537"></a>
<pre class="SCREEN">
    #!/bin/sh
    # this is an example of how to use /bin/sh and LPRng
    # to get the command line and printcap option values
    # and set shell variables from them
    #  Note that we use a couple of variables
    #PATH=/bin:/usr/bin
    Args=""
    vAr=""
    vAlue=""
    vAls=""
    iI=""
    Tf=""
    Debug=1
    if -n $Debug ; then
        set &gt;/tmp/before
    fi
    Args="$@"
    if -n $Debug ; then
        echo "$@" &gt;&gt;/tmp/before
    fi
    while expr "$1" : '-.*' &gt;/dev/null ; do
      vAr=`expr "$1" : '-\(.\).*'`;
      vAlue=`expr "$1" : '-.\(.*\)`;
      case "$vAr" in
        - ) break;;
        c ) c=1;;
        [a-zA-Z] )
          if test "X$vAlue" = "X" ; then shift; vAlue=$1; fi;
          eval $vAr='$vAlue';
          #setvar $vAr "$vAlue"
          ;;
      esac;
      shift;
    done
    
    # set shell variables to the printcap options
    #  flag   -&gt;  flag=1
    #  flag@  -&gt;  flag=0
    #  option=value -&gt;  option='value'
    #
    setpcvals () {
        while test "$#" -gt 0 ; do
          iI=$1
          if expr "$iI" : " *\:" &gt;/dev/null ; then
            vAr=`expr "$iI" : " *\:\([^=][^=]*\)=.*"`;
            vAlue=`expr "$iI" : " *\:[^=][^=]*=\(.*\)"`;
            if test "X$vAr" = "X" ; then
              vAr=`expr "$iI" : " *:\(.*\)@"`;
              vAlue=0;
            fi
            if test "X$vAr" = "X" ; then
              vAr=`expr "$iI" : " *:\(.*\)"`;
              vAlue=1;
            fi
            if test "X$vAr" != "X" ; then
              eval $vAr='$vAlue';
              #setvar $vAr "$vAlue"
            fi
          else
            vAr=`expr "$iI" : " *\([^|][^|]*\).*"`;
            if test "X$vAr" != "X" ; then
              eval Printer="$vAr"
            fi
          fi;
          shift
        done
    }
    
    # set shell variables to the printcap options
    #  flag   -&gt;  flag=1
    #  flag@  -&gt;  flag=0
    #  option=value -&gt;  option='value'
    #
    setcontrolvals () {
        while test "$#" -gt 0 ; do
          iI=$1
          vAr=`expr "$iI" : " *\([A-Z]\).*"`;
          vAlue=`expr "$iI" : " *[A-Z]\(.*\)"`;
          if test "X$vAr" != "X" ; then
            eval $vAr='$vAlue';
            #setvar $vAr "$vAlue";
          fi;
          shift
        done
    }
    
    Tf=$IFS
    IFS="
    "
    setpcvals $PRINTCAP_ENTRY
    setcontrolvals $CONTROL
    IFS=$Tf
    
    #
    # restore argument list
    set -- $Args
    Args=""
    vAr=""
    vAlue=""
    vAls=""
    iI=""
    Tf=""
    
    if test -n "$Debug" ; then
        set &gt;/tmp/after
        echo "$@" &gt;&gt;/tmp/after
        diff /tmp/before /tmp/after
    fi
    /bin/cat
    exit 0
</pre>
            </div>
            <br>
            <br>

            <p>Lets print our <tt class="FILENAME">/tmp/hi</tt>
            test file and then look at the results in <tt class=
            "FILENAME">/tmp/lp</tt>:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2542"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {188} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {189} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {190} %</samp> <kbd class=
"USERINPUT">more /tmp/lp</kbd>
    0a1
    &gt; e=dfA021771h4.private
    2a4,6
    &gt; l=66
    &gt; s=status
    &gt; L=papowell
    10a15,17
    &gt; j=021771
    &gt; C=A
    &gt; J=/tmp/hi
    12a20
    &gt; a=acct
    ...
    33a58
    &gt; Printer=lp
    ...
    hi
</pre>
            </div>
            <br>
            <br>

            <p>As we see from the output, shell variables have the
            values of our command line and printcap options. It is
            left as an exercise for the reader to add the necessary
            <var class="LITERAL">export</var> statements to cause
            these values to be exported to subshells. It is <span
            class="emphasis"><i class="EMPHASIS">not</i></span>
            recommended that a wholesale export of the shell
            variables be done, but only selected ones.</p>

            <p>The paranoid and security minded reader will see
            some possible security problem with this script. The
            <var class="LITERAL">eval $vAr='$vAlue'</var> command
            sets the value of the shell variable <var class=
            "LITERAL">$vAr</var> to the value <var class=
            "LITERAL">$vAlue</var>. The <var class=
            "LITERAL">$vAr</var> variable is always taken from
            either a single letter or is the name of an option in
            the printcap file. Clearly the printcap file must not
            be modifiable by users, and should have the same
            security considerations as any other system
            configuration file. The values of the <var class=
            "LITERAL">$vAlue</var> are taken directly from the
            control file, whose contents are under the control of
            the originator of the print job request.</p>

            <p>For this reason <b class="APPLICATION">LPRng</b>
            takes the rather brutal step of <span class=
            "emphasis"><i class="EMPHASIS">sanitizing</i></span>
            the control file. Only alphanumerics or a character in
            the list <var class="LITERAL">@/:()=,+-%_</var> are
            used in the control file; all others replaced by the
            underscore (<var class="LITERAL">_</var>) character. In
            addition, all filters are run as the <b class=
            "APPLICATION">lpd</b> user specified in the <tt class=
            "FILENAME">lpd.conf</tt> configuration file.</p>

            <p>The following is an example of how to extract the
            same information in Perl:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2567"></a>
<pre class="SCREEN">
    #!/usr/bin/perl
    eval 'exec /usr/bin/perl -S $0 ${1+"$@"}'
        if $running_under_some_shell;
                # this emulates #! processing on NIH machines.
                # (remove #! line above if indigestible)
    
    use Getopt::Std;
    my(%args,%options);
    # get the arguments
    getopt(
        "a:b:cd:e:f:g:h:i:j:l:m:n:o:p:q:r:s:t:u:v:w:x:y:z:" .
        "A:B:C:D:E:F:G:H:I:J:L:M:N:O:P:Q:R:S:T:U:V:W:X:Y:Z:",
        \%args );
    
    # set :key=value  -&gt; $option{$key}=$value
    # set :key@       -&gt; $option{$key}="0"
    # set :key        -&gt; $option{$key}="1"
     map {
        if( m/^\s*:([^=]+)=(.*)/ ){
         $options{$1}=$2;
        } elsif( m/^\s*:([^=]+)\@$/ ){
         $options{$1}="0";
        } elsif( m/^\s*:([^=]+)/ ){
         $options{$1}="1";
        } elsif( m/^\s*([^|]+)/ ){
         $options{"Printer"}=$1;
        }
     } split( "\n", $ENV{'PRINTCAP_ENTRY'});
    
    # get the control file entries
     map {
        if( m/^\s*([A-Z])(.*)/ ){
         $options{$1}=$2;
        } elsif( m/^\s*([a-z])/ ){
         $options{'Format'}=$1;
        }
     } split( "\n", $ENV{'CONTROL'});
</pre>
            </div>
            <br>
            <br>

            <p>The Perl <var class="LITERAL">Getopt::Std</var>
            routine parses the command line options and puts their
            values in the <var class="LITERAL">%args</var> hash
            variable where they can be accessed using <var class=
            "LITERAL">$args{'x'}</var>. Similarly, the <var class=
            "LITERAL">map</var> and <var class=
            "LITERAL">split</var> functions process the
            PRINTCAP_ENTRY and CONTROL environment variable and set
            <var class="LITERAL">%options</var> with the printcap
            entry options and the values from the control file. The
            <code class="FUNCTION">map</code> function could be
            replaced by a <code class="FUNCTION">foreach</code>
            loop, but this is Perl: <span class="emphasis"><i
            class="EMPHASIS">There is more than one way to do
            it</i></span> and no tutorial would be complete without
            at least one mind stretching example that has the
            reader reaching for the reference manual.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="FILTEREXITCODES">4.9.4.
            Filter Exit Codes</a></h3>

            <p>The <b class="APPLICATION">lpd</b> server uses the
            exit code of the filter to determine if the filter was
            successful or unsuccessful. The <a href=
            "#EXITCODES">Filter Exit Codes</a> section discusses
            these values in detail, but here are the most
            important:</p>

            <div class="VARIABLELIST">
              <dl>
                <dt>0 - JSUCC</dt>

                <dd>
                  <p>A JSUCC exit code indicates that the filter
                  was successful in doing its work.</p>
                </dd>

                <dt>1 - JFAIL</dt>

                <dd>
                  <p>A JFAIL exit code indicates that the filter
                  was unsuccessful in doing its work, possibly due
                  to a transient condition such as out of paper,
                  printer jam, etc., but an additional attempt
                  might be successful. Usually the <b class=
                  "APPLICATION">lpd</b> server will try at most <a
                  href="#ABNORMALTERM">send_try</a> attempts before
                  giving up.</p>
                </dd>

                <dt>2 - JABORT</dt>

                <dd>
                  <p>A JABORT exit code indicates that the filter
                  was unsuccessful in doing its work and has
                  detected a condition that would make it
                  impossible to print the job. In addition, the
                  printer may require administrative attention, and
                  the print queue operation may need to be
                  suspended until the problem is rectified.</p>
                </dd>

                <dt>3 - JREMOVE</dt>

                <dd>
                  <p>The JREMOVE exit code will cause the job to be
                  removed from the print queue.</p>
                </dd>

                <dt>6 - JHOLD</dt>

                <dd>
                  <p>The JHOLD exit code will cause the job to be
                  temporarily prevented from printing until release
                  by the <tt class="COMMAND">lpc release</tt>
                  command.</p>
                </dd>

                <dt>Other Values</dt>

                <dd>
                  <p>Usually any other value, including exit due to
                  a signal, is treated as a JABORT exit, and the
                  same action is taken.</p>
                </dd>
              </dl>
            </div>
            <br>
            <br>

            <p>It should be obvious that the filter exit code is
            very important, and that care needs to be taken to
            return the correct value.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name=
            "JOBFORMATSANDFILTERSELECTION">4.9.5. Job Formats and
            Filter Selection</a></h3>

            <p>In the previous sections we discussed how a print
            filter was executed and how it could be used. Now we
            will look at how the <b class="APPLICATION">lpd</b>
            spooler chooses a print filter program. Let us
            re-examine our example print job control file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2617"></a>
<pre class="SCREEN">
    Hh4.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Apapowell@h4+105
    D2000-04-12-15:27:26.662
    Qlp
    N/tmp/hi
    fdfA105h4.private
    UdfA105h4.private
</pre>
            </div>
            <br>
            <br>

            <p>Each data file for a print job has a name with the
            format <var class="LITERAL">df</var><span class=
            "emphasis"><i class="EMPHASIS">X</i></span>nnn<tt
            class="FILENAME">h4.private</tt>. The <var class=
            "LITERAL">df</var> is used to indicate that the file is
            a <span class="emphasis"><i class="EMPHASIS">data
            file</i></span>, and the remainder is a unique name for
            the file in the job. The <var class="LITERAL">X</var>
            part of the name must be an upper or lower case letter,
            setting a limit of 52 different files in a single print
            job.</p>

            <p>The <tt class="FILENAME">fdfA105h4.private</tt> line
            in the control file specifies that we are to print the
            job using the filter for the <var class=
            "LITERAL">f</var> format; the file printing information
            consists of the format assigned to the file and the
            name of the file. In the legacy BSD print spoolers,
            this format was used to select the print filter to be
            used. <b class="APPLICATION">LPRng</b> has expanded
            this by providing a <span class="emphasis"><i class=
            "EMPHASIS">default</i></span> filter specification.</p>

            <div class="TABLE">
              <a name="JOBFORMAT"></a>

              <p><b>Table 4-2. Job Formats and Filter
              Selection</b></p>

              <table border="1" frame="border" rules="all" class=
              "CALSTABLE">
                <col>
                <col>
                <col>

                <thead>
                  <tr>
                    <th><b class="APPLICATION">lpr</b> command line
                    option</th>

                    <th>Control File Line</th>

                    <th>Printcap Option For Filter</th>

                    <th>Filter Command Line</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td>(default)</td>

                    <td>fdfAnnn</td>

                    <td>:if=/path</td>

                    <td>/path -Ff ...</td>
                  </tr>

                  <tr>
                    <td>-b or -l</td>

                    <td>ldfAnnn</td>

                    <td>:if=/path</td>

                    <td>/path ... -Ff -c</td>
                  </tr>

                  <tr>
                    <td>-p</td>

                    <td>pdfAnnn</td>

                    <td>:if=/path</td>

                    <td>pr | format f filter</td>
                  </tr>

                  <tr>
                    <td>-c, -d, -n, -r, -t, -v, -FX</td>

                    <td>XdfAnnn</td>

                    <td>:Xf=/path ...</td>

                    <td>/path -FX</td>
                  </tr>

                  <tr>
                    <td>any format</td>

                    <td>XdfAnnn</td>

                    <td>:filter=/path ...</td>

                    <td>/path -FX</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p><a href="#JOBFORMAT">Table 4-2</a> shows the rather
            baroque relationship between the format options
            specified by the <b class="APPLICATION">lpr</b> command
            and the way that <b class="APPLICATION">lpd</b> uses
            them. The reason for this complexity lies in the
            various implementations and variations that occurred
            during the development and deployment of the original
            BSD print spooling software.</p>

            <p>Here is the complete, arcane, and baroque set of
            rules that are used to select and print filters. The
            de<var class="LITERAL">f</var>ault format used by <b
            class="APPLICATION">lpr</b> is <var class=
            "LITERAL">f</var>; unless some other format is
            specified this is used. The <tt class="COMMAND">lpr
            -b</tt> and <tt class="COMMAND">lpr -l</tt> (<var
            class="LITERAL">b</var>inary and <var class=
            "LITERAL">l</var>iteral literals) are a request to <b
            class="APPLICATION">lpd</b> to do as little processing
            as possible of this file before printing it. <b class=
            "APPLICATION">Lpd</b> use the <var class=
            "LITERAL">:if</var> filter for formats <var class=
            "LITERAL">f</var> and <var class="LITERAL">l</var>; the
            <var class="LITERAL">l</var> literal causes the the
            <var class="LITERAL">-c</var> filter command line flag
            to be used as well. The <tt class="COMMAND">lpr</tt>
            <var class="LITERAL">-c</var>, <var class=
            "LITERAL">-d</var>, <var class="LITERAL">-n</var>, <var
            class="LITERAL">-r</var>, <var class=
            "LITERAL">-t</var>, and <var class="LITERAL">-v</var>
            options cause the corresponding format to be used, and
            for <b class="APPLICATION">lpd</b> to use the filter
            specified by the printcap option <var class=
            "LITERAL">:Xf</var>, where <var class="LITERAL">X</var>
            is the specified format.</p>

            <p>The <tt class="COMMAND">lpr -p</tt> (<var class=
            "LITERAL">p</var>retty-print literal) selects <var
            class="LITERAL">p</var> format, and <b class=
            "APPLICATION">lpd</b> is supposed to use the program
            specified by the <var class="LITERAL">:pr</var>
            printcap option to format the file and then process the
            output of this program according to format <var class=
            "LITERAL">f</var>. Unpredictable results may occur
            using this facility.</p>

            <p>the <tt class="COMMAND">lpr -FX</tt> allows you to
            explicitly specify format <var class="LITERAL">X</var>
            where <var class="LITERAL">X</var> is a lower case
            letter, and <b class="APPLICATION">lpd</b> will use the
            filter specified by printcap option <var class=
            "LITERAL">:Xf</var>, where <var class="LITERAL">X</var>
            is the specified format. If there is no <var class=
            "LITERAL">:Xf</var> printcap literal value then the
            printcap <var class="LITERAL">:filter</var> literal
            value will be used as the filter, and if this is
            undefined then the file will be passed without
            processing through to the printing device.</p>

            <p>If a filter is not specified for the format then the
            default filter specified by <var class=
            "LITERAL">:filter=/path</var> filter is used, and if
            there is no default, then the output is sent directly
            to the output device.</p>

            <p>If the <var class="LITERAL">:fx=</var><span class=
            "emphasis"><i class="EMPHASIS">formats</i></span> is
            present in a printcap entry, it specifies the formats
            that are allowed. For example, <var class=
            "LITERAL">:fx=lfv</var> would allow only formats <var
            class="LITERAL">l</var>, <var class="LITERAL">f</var>,
            and <var class="LITERAL">v</var> to be used on a
            particular spool queue.</p>

            <p>Some <var class="LITERAL">Xf</var> options have
            pre-assigned meanings and cannot be used for filter
            selection.</p>

            <div class="INFORMALTABLE">
              <a name="AEN2723"></a>

              <table border="1" class="CALSTABLE">
                <col>
                <col>

                <thead>
                  <tr>
                    <th>Printcap Option</th>

                    <th>Purpose</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td>Printcap Option</td>

                    <td>Purpose</td>
                  </tr>

                  <tr>
                    <td>:af=/path</td>

                    <td>Accounting File</td>
                  </tr>

                  <tr>
                    <td>:ff=formfeed</td>

                    <td>Form Feed String</td>
                  </tr>

                  <tr>
                    <td>:if=/path</td>

                    <td>filter (l,b,p,f formats)</td>
                  </tr>

                  <tr>
                    <td>:filter=/path</td>

                    <td>Default filter</td>
                  </tr>

                  <tr>
                    <td>:lf=/path</td>

                    <td>Log file</td>
                  </tr>

                  <tr>
                    <td>:of=/path</td>

                    <td>OF filter</td>
                  </tr>

                  <tr>
                    <td>:sf</td>

                    <td>suppress form feed between job files</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p>The <var class="LITERAL">:of</var> filter is a
            special case and is used for banner printing and
            accounting purposes. See <a href="#OFDETAILS">OF
            Filter</a> for details.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBFILEFORMATCONVERSION">4.10.
          Job File Format Conversion with Filters</a></h2>

          <p>One of the major problems that face new users to UNIX
          printing is when they have a printer that has a
          proprietary print job format such as the HP DeskJet
          series of printers. The solution to this problem is quite
          simple: generate your output in PostScript, and then use
          the <a href="#GHOSTSCRIPT">GhostScript</a> program to
          convert the GhostScript output to a format compatible
          with your printer.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN2761"></a>
<pre class="SCREEN">
    lp:filter=/usr/local/lib/filters/myfilter:...
    
    /tmp/myfilter:
    
    #!/bin/sh
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
        -sOutputFile=- - &amp;&amp; exit 0
    exit 2
</pre>
          </div>
          <br>
          <br>

          <p>This simple <span class="emphasis"><i class=
          "EMPHASIS">tutorial</i></span> example suffers from some
          serious problems. If you accidentally send a
          non-PostScript file to the printer GhostScript will
          detect this and exit with an error message but only after
          trying to interpret the input file as PostScript. If the
          input file was a text file, this can result in literally
          thousands of error messages and hundreds of pages of
          useless output.</p>

          <p>In order to make a more robust filter we need to meet
          the following minimum requirements:</p>

          <ol type="1">
            <li>
              <p>The file type should be determined, and only files
              that are PostScript should be passed to
              GhostScript.</p>
            </li>

            <li>
              <p>We may have some conversion routines that can
              convert files into PostScript files and then we can
              send them to GhostScript for raster conversion.</p>
            </li>

            <li>
              <p>If we cannot convert a file, then we should simply
              terminate the printing and cause the spooler to
              remove the job.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>The <b class="APPLICATION">ifhp</b> Print Filter
          program is a companion to the <b class=
          "APPLICATION">LPRng</b> software and does this type of
          operation. If you are using Linux, then you may find the
          <span class="emphasis"><i class="EMPHASIS">RedHat Print
          Filters</i></span> (<a href="http://www.debian.org"
          target="_top">http://www.debian.org</a>) installed and in
          use on your system. The <span class="emphasis"><i class=
          "EMPHASIS">magicfilter</i></span> developed by H. Peter
          Anvin <a href="http://www.debian.org" target=
          "_top">http://www.debian.org</a> is distributed with
          Debian Linux. The <b class="APPLICATION">apsfilter</b> by
          Andreas Klemm <a href=
          "http://www.freebsd.org/~andreas/index.html" target=
          "_top">http://www.freebsd.org/~andreas/index.html</a> is
          also widely used, although now most of its functionality
          is directly available in <b class=
          "APPLICATION">LPRng</b>. Finally, the <b class=
          "APPLICATION">a2ps</b> (Ascii to PostScript) converter by
          <a href="demaille@inf.enst.fr" target="_top">Akim
          Demaille</a> and <a href="santana@st.com" target=
          "_top">Miguel Santana</a> is available from <a href=
          "www-inf.enst.fr/~demaille/a2ps" target=
          "_top">www-inf.enst.fr/~demaille/a2ps</a>. This package
          provides a very nice set of facilities for massaging,
          mangling, bending, twisting, and being downright nasty
          with text or other files.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN2787">4.10.1. Simple
            Filter with File Format Detection</a></h3>

            <p>Since this is a tutorial, we will demonstrate a
            simple way to make your own <span class="emphasis"><i
            class="EMPHASIS">multi-format</i></span> print filter,
            and provide insight into how more complex filters
            work.</p>

            <p>The <a href="#FILEPROG">file</a> utility developed
            by Ian F. Darwin uses a database of file signatures to
            determine what the contents of a file are. For
            example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2793"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {191} %</samp> <kbd class=
"USERINPUT">cd /tmp</kbd>
    <samp class="PROMPT">h4: {192} %</samp> <kbd class=
"USERINPUT">echo hi &gt;hi</kbd>
    <samp class="PROMPT">h4: {193} %</samp> <kbd class=
"USERINPUT">gzip -c hi &gt;hi.gz</kbd>
    <samp class="PROMPT">h4: {194} %</samp> <kbd class=
"USERINPUT">echo "%!PS-Adobe-3.0" &gt;test.ps</kbd>
    <samp class="PROMPT">h4: {195} %</samp> <kbd class=
"USERINPUT">gzip -c test.ps &gt;test.ps.gz</kbd>
    <samp class="PROMPT">h4: {196} %</samp> <kbd class=
"USERINPUT">file hi hi.gz test.ps test.ps.gz</kbd>
    hi:        ASCII text
    hi.gz:     gzip compressed data, deflated
    test.ps:   PostScript document text conforming at level 3.0
    test.ps.gz: gzip compressed data, deflated
    <samp class="PROMPT">h4: {197} %</samp> <kbd class=
"USERINPUT">file - &lt;test.ps</kbd>
    standard input: PostScript document text conforming at level 3.0
</pre>
            </div>
            <br>
            <br>

            <p>If we are given a file, we can now use <b class=
            "APPLICATION">file</b> to recognize the file type and
            if the file type is suitable for our printer we can
            send it to the printer, otherwise we can reject it. The
            following is a simple yet very powerful shell script
            that does this.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2811"></a>
<pre class="SCREEN">
    #!/bin/sh
    # set up converters
    gs="/usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
        -sOutputFile=/dev/fd/3 - 3&gt;&amp;1 1&gt;&amp;2"
    a2ps="/usr/local/bin/a2ps -q -B -1 -M Letter --borders=no -o-"
    decompress=""
    # get the file type
    type=`file - | tr A-Z a-z | sed -e 's/  */_/g'`;
    echo TYPE $type &gt;&amp;2
    case "$type" in
      *gzip_compressed* ) decompress="gunzip -c |" compressed="compressed" ;;
    esac
    
    # we need to rewind the file
    perl -e "seek STDIN, 0, 0;"
    
    if test "X$decompress" != "X" ; then
        type=`$decompress head | file - | tr A-Z a-z | sed -e 's/  */_/g'`;
        echo COMPRESSED TYPE $type &gt;&amp;2
        # we need to rewind the file
        perl -e "seek STDIN, 0, 0;"
    fi
    case "$type" in
      *postscript* ) process="$gs" ;;
      *text* )       process="$a2ps | $gs" ;;
      * )
        echo "Cannot print type $compressed '$type'" &gt;&amp;2
        # exit with JREMOVE status
        exit 3
        ;;
    esac
    # in real life, replace 'echo' with 'exec'
    echo "$decompress $process"
    # exit with JABORT if this fails
    exit 2
</pre>
            </div>
            <br>
            <br>

            <p>Copy this to the <tt class=
            "FILENAME">/tmp/majik</tt> file, and give it <var
            class="LITERAL">0755</var> (executable) permissions.
            Here is an example of the output of the script:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2816"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {198} %</samp> <kbd class=
"USERINPUT">/tmp/majik &lt;test.ps.gz</kbd>
    TYPE standard_input:_gzip_compressed_data,_deflated...
    COMPRESSED TYPE standard_input:_postscript_document_level_3.0
    gunzip -c | /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
       -sOutputFile=/dev/fd/3 - 3&gt;&amp;1 1&gt;&amp;2
    <samp class="PROMPT">h4: {199} %</samp> <kbd class=
"USERINPUT">/tmp/majik &lt;/tmp/hi</kbd>
    TYPE standard_input:_ascii_text
     /usr/local/bin/a2ps -q -B -1 -M Letter --borders=no -o- \
      | /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
       -sOutputFile=/dev/fd/3 - 3&gt;&amp;1 1&gt;&amp;2
</pre>
            </div>
            <br>
            <br>

            <p>The first part of the script sets up a standard set
            of commands that we will use in the various
            conversions. A full blown package for conversion would
            use a database or setup file to get these values. We
            then use the <b class="APPLICATION">file</b> utility to
            determine the input file type. The output of the <b
            class="APPLICATION">file</b> utility is translated to
            lower case and multiple blanks and tabs are
            removed.</p>

            <p>We use a simple shell <var class=
            "LITERAL">case</var> statement to determine if we have
            a compressed file and get a decompression program to
            use. We reapply the <b class="APPLICATION">file</b>
            utility to the decompressed file (if it was compressed)
            and get the file type.</p>

            <p>Finally we use another <var class=
            "LITERAL">case</var> statement to get the output
            converter and then we run the command. For tutorial
            purposes, we use an <tt class="COMMAND">echo</tt>
            rather than an <tt class="COMMAND">exec</tt> so we can
            see the actual command, rather than the output.</p>

            <p>Just for completeness, here is <b class=
            "APPLICATION">majikperl</b>:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2834"></a>
<pre class="SCREEN">
    #!/usr/bin/perl
    eval 'exec /usr/bin/perl -S $0 ${1+"$@"}'
        if $running_under_some_shell;
                # this emulates #! processing on NIH machines.
                # (remove #! line above if indigestible)
    my($gs) = "/usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
        -sOutputFile=/dev/fd/3 - 3&gt;&amp;1 1&gt;&amp;2";
    my($a2ps)="/usr/local/bin/a2ps -q -B -1 -M Letter --borders=no -o-";
    
    my($decompress,$compressed,$process,$type);
    $decompress=$compressed=$process=$type="";
    
    # get the file type
    $type = ` file - `;
    $type =~ tr /A-Z/a-z/;
    $type =~ s/\s+/_/g;
    print STDERR "TYPE $type\n";
    ($decompress,$compressed) = ("gunzip -c |", "gzipped")
      if( $type =~ /gzip_compressed/ );
    print STDERR "decompress $decompress\n";
    unless( seek STDIN, 0, 0 ){
        print "seek STDIN failed - $!\n"; exit 2; }
    if( $decompress ne "" ){
        $type = ` $decompress file - `;
        $type =~ tr /A-Z/a-z/;
        $type =~ s/\s+/_/g;
        print STDERR "COMPRESSED TYPE $type\n";
        unless( seek STDIN, 0, 0 ){
            print "seek STDIN failed - $!\n"; exit 2; }
    }
    $_ = $type;
    if( /postscript/ ){
        $process="$gs";
    } elsif( /_text_/ ){
        $process="$a2ps | $gs" ;;
    } else {
        print STDERR "Cannot print $compressed '$type'" &gt;&amp;2;
        # JREMOVE
        exit 3;
    }
    exec "$decompress $process";
    print "exec failed - $!\n";
    exit 2;
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN2836">4.10.2. The <b
            class="APPLICATION">ifhp</b> Filter</a></h3>

            <p>The <a href="#SECFTP">ifhp</a> Print Filter is the
            companion print filter supplied with <b class=
            "APPLICATION">LPRng</b> and is normally installed
            together with the <b class="APPLICATION">LPRng</b>
            software. <b class="APPLICATION">Ifhp</b> supports a
            wide range of PostScript, PCL, text, and raster
            printers, and can be configured to support almost any
            type of printer with a stream based interface. It
            provides diagnostic and error information as well as
            accounting information. It recognizes a wide range of
            file types by using the <b class="APPLICATION">file</b>
            utility and the pattern matching technique demonstrated
            in the previous section, and can do selective
            conversions from one format to others.</p>

            <p>The <a href="#POSTSCRIPT">PostScript</a> and <a
            href="#PCL">PCL</a> printer job languages are supported
            by most printer manufacturers. However, in order to
            have a job printed correctly the following steps must
            be taken.</p>

            <ol type="1">
              <li>
                <p>The printer must be put into a known <span
                class="emphasis"><i class=
                "EMPHASIS">initial</i></span> state by sending it
                the appropriate reset strings or performing a
                correct set of IO operations.</p>
              </li>

              <li>
                <p>If accounting is being done, then the printer
                accounting information must be obtained and
                recorded. See <a href=
                "#ACCOUNTINGREF">Accounting</a> for more
                information about <b class="APPLICATION">LPRng</b>
                support for accounting.</p>
              </li>

              <li>
                <p>The file to be printed must be checked to see if
                it is compatible with the printer, and if not, a
                format conversion program invoked to convert it to
                the required format.</p>
              </li>

              <li>
                <p>If the user selects a set of printer specific
                options such as landscape mode, duplex printing,
                multiple copies, or special paper, the appropriate
                commands must be sent to the printer to select
                these options.</p>
              </li>

              <li>
                <p>The file must be transferred to the printer and
                the printer is monitored for any error
                conditions.</p>
              </li>

              <li>
                <p>Any required end of job commands are sent to the
                printer, and the printer monitored for error
                conditions while the job finishes printing.</p>
              </li>

              <li>
                <p>If accounting is being done, the printer
                accounting information such as page count and time
                used must be obtained and recorded. See <a href=
                "#ACCOUNTINGREF">Accounting</a> for more
                information about <b class="APPLICATION">LPRng</b>
                support for accounting.</p>
              </li>
            </ol>
            <br>
            <br>

            <p>The <b class="APPLICATION">ifhp</b> filter uses the
            <tt class="FILENAME">ifhp.conf</tt> configuration file
            to determine the actions and commands appropriate for
            various models of printers. See the <b class=
            "APPLICATION">ifhp</b> documentation for details about
            the format and contents of this file. This file
            contains entries for a large number of PostScript, PJL,
            and other printers. The default printer used by <b
            class="APPLICATION">ifhp</b> is the HP LaserJet 4M Plus
            which supports PostScript, PCL, and PJL. The commands
            and formats used by this printer is compatible with a
            large number of other HP printers.</p>

            <p>We will demonstrate how to add the <b class=
            "APPLICATION">ifhp</b> filter to your printcap entry.
            Find the path to the <b class="APPLICATION">ifhp</b>
            filter using the <b class="APPLICATION">find</b>
            command as we did in the previous exercise. Modify the
            printcap as shown below and use <tt class="COMMAND">lpc
            lpd</tt> to restart <b class="APPLICATION">lpd</b>.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2879"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      :ifhp=model=default
      # modify the path to ifhp appropriately
      :filter=/usr/local/libexec/filters/ifhp
</pre>
            </div>
            <br>
            <br>

            <p>Now print the <tt class="FILENAME">/tmp/hi</tt> and
            then display <tt class="FILENAME">/tmp/lp</tt> using a
            text editor such as <b class="APPLICATION">vi</b> or <b
            class="APPLICATION">emacs</b> that shows control
            characters:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2886"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {200} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {201} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {202} %</samp> <kbd class=
"USERINPUT">vi /tmp/lp</kbd>
    ^[%-12345X@PJL
    @PJL JOB NAME = "PID 405" DISPLAY = "papowell"
    @PJL RDYMSG DISPLAY = "papowell"
    @PJL USTATUSOFF
    @PJL USTATUS JOB = ON
    @PJL USTATUS DEVICE = ON
    @PJL USTATUS PAGE = ON
    @PJL USTATUS TIMED = 10
    @PJL ENTER LANGUAGE = PCL
    ^]E^]&amp;^]&amp;k2G^]&amp;s0C^]&amp;l0O^]9^](s0P^](s10.00H^](s4099Thi
    ^]E^]%-12345X@PJL
    @PJL RDYMSG DISPLAY = "papowell"
    @PJL EOJ NAME = "PID 405"
    @PJL USTATUSOFF
    @PJL USTATUS JOB = ON
    @PJL USTATUS DEVICE = ON
    @PJL USTATUS PAGE = ON
    @PJL USTATUS TIMED = 10
    @PJL RDYMSG DISPLAY = ""
    ^[%-12345X
</pre>
            </div>
            <br>
            <br>

            <p>The output now contains all of the control sequences
            and setup codes needed to print a text file on the
            default printer. The <var class=
            "LITERAL">:ifhp=model=default</var> printcap entry is
            used by <b class="APPLICATION">ifhp</b> to get the
            information it needs to perform its operation. The
            following options are commonly provided in the <var
            class="LITERAL">:ifhp=</var> option to configure the <b
            class="APPLICATION">ifhp</b> filter.</p>

            <div class="TABLE">
              <a name="IFHPOPTS"></a>

              <p><b>Table 4-3. :ifhp= Options</b></p>

              <table border="1" frame="border" rules="all" class=
              "CALSTABLE">
                <col>
                <col>

                <thead>
                  <tr>
                    <th>Option</th>

                    <th>Purpose</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td><var class="LITERAL">model=</var><span
                    class="emphasis"><i class=
                    "EMPHASIS">name</i></span></td>

                    <td>Use <span class="emphasis"><i class=
                    "EMPHASIS">name</i></span> entry in <var class=
                    "LITERAL">ifhp.conf</var></td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">status</var> or <var
                    class="LITERAL">status@</var></td>

                    <td>Printer does or does not provide status
                    information</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">sync</var>, <var
                    class="LITERAL">sync@</var>, <var class=
                    "LITERAL">sync=</var><span class="emphasis"><i
                    class="EMPHASIS">(ps|pjl)</i></span> </td>

                    <td>Printer does or does not indicate ready to
                    operate at start of job, or use PostScript or
                    PJL code sequence to determine if printer is
                    ready.</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">pagecount</var>, <var
                    class="LITERAL">pagecount@</var>, <var class=
                    "LITERAL">pagecount=</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">(ps|pjl)</i></span> </td>

                    <td>Printer does or does not have pagecount
                    support, or use PostScript or PJL code sequence
                    to determine pagecount.</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">waitend</var>, <var
                    class="LITERAL">waitend@</var>, <var class=
                    "LITERAL">waitend=</var><span class=
                    "emphasis"><i class=
                    "EMPHASIS">(ps|pjl)</i></span> </td>

                    <td>Wait or do not wait for end of job, or send
                    PostScript or PJL code sequence to have printer
                    report end of job.</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p>The <var class="LITERAL">model=</var><span class=
            "emphasis"><i class="EMPHASIS">name</i></span> entry is
            used to specify the configuration entry in the <var
            class="LITERAL">ifhp.conf</var> file to be used by <b
            class="APPLICATION">ifhp</b>. This entry usually has
            all of the specific information needed by the <b class=
            "APPLICATION">ifhp</b> filter.</p>

            <p>The <var class="LITERAL">status</var> option is the
            most common option usually provided in a printcap
            entry. This option is needed when the communication
            with the printer is <span class="emphasis"><i class=
            "EMPHASIS">write-only</i></span> and no status
            information will be returned. If a printer normally
            supports returning status information then the <var
            class="LITERAL">ifhp.conf</var> configuration entry
            will indicate this and the <b class=
            "APPLICATION">ifhp</b> filter will try to get status.
            When no status is returned it will either terminate
            operation after a timeout or sit in an endless loop
            waiting for status. By specifying <var class=
            "LITERAL">status@</var> you will suppress getting
            status. This also has the effect of doing <var class=
            "LITERAL">sync@</var>, <var class=
            "LITERAL">pagecount@</var>, and <var class=
            "LITERAL">waitend@</var></p>

            <p>The <var class="LITERAL">sync</var> option is used
            to cause <b class="APPLICATION">ifhp</b> to wait for an
            <span class="emphasis"><i class="EMPHASIS">end of
            job</i></span> indication from the printer before
            starting the next job. This is usually done in order to
            make sure that all jobs have been flushed from a
            printer before starting another job. If you specify
            <var class="LITERAL">sync@</var> then you may get
            slightly faster startup but at the expense of losing
            the ends of previous print jobs.</p>

            <p>The <var class="LITERAL">pagecount</var> option is
            used to cause <b class="APPLICATION">ifhp</b> to get
            the value of a hardware pagecounter from the printer.
            If your printer supports such an item then the <var
            class="LITERAL">ifhp.conf</var> configuration option
            usually indicates this. However, it takes a small
            amount of time to get the pagecounter information from
            the printer and you may not need it. Use <var class=
            "LITERAL">sync@</var> if you do not want page
            counts.</p>

            <p>Finally, <var class="LITERAL">waitend</var> option
            is used to cause <b class="APPLICATION">ifhp</b> to
            wait for an <span class="emphasis"><i class=
            "EMPHASIS">end of job</i></span> indication from the
            printer before exiting. If you specify <var class=
            "LITERAL">waitend@</var> then the filter will exit
            immediately after sending the job, but you will
            possibly lose any error information or status reports
            from the printer.</p>

            <p>For a complete list of all of the <b class=
            "APPLICATION">ifhp</b> options please see the IFHP
            documentation.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JAGGIES">4.10.3. The Jaggies
            - LF to CR-LF Conversion With lpf</a></h3>

            <p>When printing to vintage hard copy devices or to
            printers that support a <span class="emphasis"><i
            class="EMPHASIS">text</i></span> mode, many UNIX users
            discover that their output suffers from a case of the
            jaggies.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2977"></a>
<pre class="SCREEN">
    Input file:
    
      This is
      a nice day
    
    Output:
    
      This is
             a nice day
</pre>
            </div>
            <br>
            <br>

            <p>UNIX systems terminate lines with a single <acronym
            class="ACRONYM">NL</acronym> (new line) character. This
            causes the printer to move down one line on the
            printing page but does not change its horizontal
            position and print the next character at the left
            margin. This is done by using the <acronym class=
            "ACRONYM">CR</acronym> (carriage return) character. You
            need to convert the single <acronym class=
            "ACRONYM">NL</acronym> to a <var class=
            "LITERAL">CR-LF</var> combination and the <b class=
            "APPLICATION">lpf</b> filter supplied with <b class=
            "APPLICATION">LPRng</b> does this.</p>

            <p>First, locate the <b class="APPLICATION">lpf</b>
            filter. You can find it by using the command:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2988"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h9: {160} %</samp> <kbd class=
"USERINPUT">find /usr/ -type f -name lpf -print</kbd>
    /usr/libexec/lpr/lpf
</pre>
            </div>
            <br>
            <br>

            <p>We will first see what the output is like without <b
            class="APPLICATION">lpf</b>, and then see what it does.
            Modify the <b class="APPLICATION">lp</b> printcap entry
            as shown below and then use <tt class="COMMAND">lpc
            restart</tt> to restart the <b class=
            "APPLICATION">lpd</b> server.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN2997"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
</pre>
            </div>
            <br>
            <br>

            <p>Print a file and view the output using the following
            commands. If you do not have the <b class=
            "APPLICATION">od</b> (octal dump) program, try using <b
            class="APPLICATION">hexdump</b> or some other
            appropriate program that displays the numerical
            contents of the file.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3002"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {203} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {204} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {205} %</samp> <kbd class=
"USERINPUT">od -bc /tmp/lp</kbd>
    0000000  150 151 012
               h   i  \n
    0000003
</pre>
            </div>
            <br>
            <br>

            <p>Now we will use the <b class="APPLICATION">lpf</b>
            filter. Modify the printcap as shown below and use <tt
            class="COMMAND">lpc reread</tt> to cause <b class=
            "APPLICATION">lpd</b> to reread the configuration
            information.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3014"></a>
<pre class="SCREEN">
    lp:sd=/var/spool/lpd/%P
      :force_localhost
      :lp=/tmp/lp
      # modify the path to lpf appropriately
      :filter=/usr/local/libexec/filters/lpf
</pre>
            </div>
            <br>
            <br>

            <p>Now reprint the file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3017"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {206} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/lp</kbd>
    <samp class="PROMPT">h4: {207} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {208} %</samp> <kbd class=
"USERINPUT">od -bc /tmp/lp</kbd>
    od -bc /tmp/lp
    0000000  150 151 015 012
               h   i  \r  \n
    0000004
</pre>
            </div>
            <br>
            <br>

            <p>As you see, <b class="APPLICATION">lpf</b> changes
            the <var class="LITERAL">LF</var> to a <var class=
            "LITERAL">CR-LF</var> sequence.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3029">4.10.4. Store and
            Forward Spool Queues</a></h3>

            <p>Up to now we have assumed that associated with each
            spool queue is a hardware printing device. When a job
            is sent to the spool queue the <b class=
            "APPLICATION">lpd</b> server will take actions to
            filter it and then send it to the printing device.</p>

            <p>However, we can also have <span class="emphasis"><i
            class="EMPHASIS">store and forward</i></span> spool
            queues. These queue act to simply buffer jobs and then
            forward them to another spooler. The following printcap
            entry shows how you can specify a store and forward
            queue.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3035"></a>
<pre class="SCREEN">
    # store and forward using classical BSD :rm:rp
    lp:rp=pr:rm=host
      :sd=/var/spool/lpd/%P
      :server
    # store and forward using <b class=
"APPLICATION">LPRng</b> lp=pr@host
    lp:lp=pr@host
      :sd=/var/spool/lpd/%P
      :server
</pre>
            </div>
            <br>
            <br>

            <p>The legacy <var class="LITERAL">:rp</var> (remote
            printer) and <var class="LITERAL">:rm</var> (remote
            host) format can be used to specify the print queue and
            destination host for jobs sent to this queue. The <b
            class="APPLICATION">LPRng</b> <var class=
            "LITERAL">:lp=pr@host</var> format serves the same
            function, and has precedence over the <var class=
            "LITERAL">:rm:rp</var> form.</p>

            <p>Edit the printcap file so it has contents indicated
            below, use <tt class="COMMAND">checkpc -f</tt> to check
            the printcap, and then use <tt class="COMMAND">lpc
            reread</tt> to restart the <b class=
            "APPLICATION">lpd</b> server.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3048"></a>
<pre class="SCREEN">
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :lp=lp2@localhost
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
            </div>
            Execute the following commands to print the <tt class=
            "FILENAME">/tmp/hi</tt> file and observe the results: 

            <div class="INFORMALEXAMPLE">
              <a name="AEN3051"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {209} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {210} %</samp> <kbd class=
"USERINPUT">lpq -lll</kbd>
    Printer: lp@h4 (dest lp2@localhost)
     Queue: no printable jobs in queue
     Status: sending control file 'cfA029h4.private' \
        to lp2@localhost at 09:39:57.719
     Status: completed sending 'cfA029h4.private' \
        to lp2@localhost at 09:39:57.724
     Status: sending data file 'dfA029h4.private' \
        to lp2@localhost at 09:39:57.727
     Status: completed sending 'dfA029h4.private' \
        to lp2@localhost at 09:39:57.925
     Status: done job 'papowell@h4+29' transfer \
        to lp2@localhost at 09:39:57.926
     Status: subserver pid 29031 exit status 'JSUCC' at 09:39:57.953
     Status: lp@h4.private: job 'papowell@h4+29' printed at 09:39:57.961
     Status: job 'papowell@h4+29' removed at 09:39:57.993
    Printer: lp2@h4
     Queue: no printable jobs in queue
     Status: no banner at 09:39:58.054
     Status: printing data file 'dfA029h4.private', size 3 at 09:39:58.054
     Status: printing done 'papowell@h4+29' at 09:39:58.054
     Status: accounting at end at 09:39:58.054
     Status: finished 'papowell@h4+29', status 'JSUCC' at 09:39:58.054
     Status: subserver pid 29033 exit status 'JSUCC' at 09:39:58.056
     Status: lp2@h4.private: job 'papowell@h4+29' printed at 09:39:58.056
     Status: job 'papowell@h4+29' removed at 09:39:58.069
</pre>
            </div>
            <br>
            <br>

            <p>As we see from the status, our job was sent to the
            <var class="LITERAL">lp</var> spool queue first. It was
            store there and then the <b class="APPLICATION">lpd</b>
            server transferred it to the <var class=
            "LITERAL">lp2</var> spool queue, where it was printed
            to the file <tt class="FILENAME">/tmp/lp2</tt>.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3062">4.10.5. Filtering
            Job Files In Transit</a></h3>

            <p>One of the major problems with store and forward
            operation is that the destination spool queue may not
            actually be a spool queue - it can be a printer. Many
            network printers provide an RFC1179 compatible network
            interface and act, for job forwarding purposes, like a
            host running a limited capability BSD print
            spooler.</p>

            <p>By adding a filter to the printcap information we
            can modify the format of a job file so that it is
            compatible with the destination printer.</p>

            <p>Edit the printcap and <tt class=
            "FILENAME">/tmp/testf</tt> files so they have the
            contents indicated below, give <tt class=
            "FILENAME">/tmp/testf</tt> executable permissions, use
            <tt class="COMMAND">checkpc -f</tt> to check the
            printcap, and then use <tt class="COMMAND">lpc
            reread</tt> to restart the <b class=
            "APPLICATION">lpd</b> server.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3072"></a>
<pre class="SCREEN">
    # set /tmp/testf to contain the following
    #   and chmod 755 /tmp/testf
    #!/bin/sh
    echo TESTF $0 $@
    /bin/cat
    exit 0
    
    # printcap
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :lp=lp2@localhost
      :filter=/tmp/testf
      :bq_format=ffl
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
            </div>
            Execute the following commands to print the <tt class=
            "FILENAME">/tmp/hi</tt> file and observe the results: 

            <div class="INFORMALEXAMPLE">
              <a name="AEN3075"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {211} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {212} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    <samp class="PROMPT">h4: {213} %</samp> <kbd class=
"USERINPUT">lpq -llll</kbd>
    Printer: lp@h4 (dest lp2@localhost)
     Queue: no printable jobs in queue
     Status: no banner at 09:55:53.681
     Status: printing data file 'dfA086h4.private', size 3, \
        IF filter 'testf' at 09:55:53.683
     Status: IF filter finished at 09:55:53.713
     Status: printing done 'papowell@h4+86' at 09:55:53.714
     Status: sending job 'papowell@h4+86' to lp2@localhost at 09:55:53.734
     Status: connecting to 'localhost', attempt 1 at 09:55:53.735
     Status: connected to 'localhost' at 09:55:53.739
     Status: requesting printer lp2@localhost at 09:55:53.740
     Status: sending control file 'cfA086h4.private' 
          to lp2@localhost at 09:55:53.752
     Status: completed sending 'cfA086h4.private' 
          to lp2@localhost at 09:55:53.757
     Status: sending data file 'dfA086h4.private' 
          to lp2@localhost at 09:55:53.758
     Status: completed sending 'dfA086h4.private' 
          to lp2@localhost at 09:55:53.939
     Status: done job 'papowell@h4+86' transfer 
          to lp2@localhost at 09:55:53.940
     Status: subserver pid 29088 exit status 'JSUCC' at 09:55:53.980
     Status: lp@h4.private: job 'papowell@h4+86' printed at 09:55:53.983
     Status: job 'papowell@h4+86' removed at 09:55:53.998
    Printer: lp2@h4
     Queue: no printable jobs in queue
     Status: subserver pid 29092 starting at 09:55:54.005
     Status: accounting at start at 09:55:54.005
     Status: opening device '/tmp/lp2' at 09:55:54.005
     Status: printing job 'papowell@h4+86' at 09:55:54.005
     Status: no banner at 09:55:54.006
     Status: printing data file 'dfA086h4.private', size 298 at 09:55:54.006
     Status: printing done 'papowell@h4+86' at 09:55:54.006
     Status: accounting at end at 09:55:54.006
     Status: finished 'papowell@h4+86', status 'JSUCC' at 09:55:54.006
     Status: subserver pid 29092 exit status 'JSUCC' at 09:55:54.008
     Status: lp2@h4.private: job 'papowell@h4+86' printed at 09:55:54.008
     Status: job 'papowell@h4+86' removed at 09:55:54.020
</pre>
            </div>
            <br>
            <br>

            <p>We have displayed a bit more status information so
            that we can see what the actions the <var class=
            "LITERAL">lp</var> queue carries out. It first <span
            class="emphasis"><i class=
            "EMPHASIS">processes</i></span> the job data file using
            the <b class="APPLICATION">testf</b> filter and puts
            the results in a temporary file. Then it sends the
            contents of the temporary file to the <var class=
            "LITERAL">lp2</var> queue. The <var class=
            "LITERAL">lp2</var> queue receives the converted job
            file and then prints it to the <tt class=
            "FILENAME">/tmp/lp2</tt> file in turn.</p>

            <p>By default, each file in a job is processed by a
            print file and the processed output is then sent to the
            destintion as individual job files, each with the
            format specified by the value of the <var class=
            "LITERAL">bq_format</var> (default <var class=
            "LITERAL">f</var>) option. The <var class=
            "LITERAL">bq_format</var> option has the format <var
            class="LITERAL">iOiO...d</var>; each <var class=
            "LITERAL">i</var> is the original format and the
            corresponding <var class="LITERAL">O</var> is the
            output format. If there is an odd number of characters
            then the last unmatched character is used as the
            default format, otherwise no translation is done. For
            example, <var class="LITERAL">flrfl</var> will cause
            the <var class="LITERAL">f</var> format to be mapped to
            <var class="LITERAL">l</var>, <var class=
            "LITERAL">r</var> to <var class="LITERAL">f</var>, and
            any others to <var class="LITERAL">l</var>.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3103">4.11. Printcap
          Basics</a></h2>

          <p>In the previous sections we have used simple printcap
          entries to define how to set up filters and pass
          parameters to them. We will now examine the printcap
          database in more detail.</p>

          <p>The <b class="APPLICATION">LPRng</b> server and client
          software gets their configuration information from:</p>

          <ul>
            <li>
              <p>Compile time settings which set the default values
              for the configuration information.</p>
            </li>

            <li>
              <p>A <tt class="FILENAME">lpd.conf</tt> file that
              contains values that override the compile time
              defaults. This information can effect the behavior of
              the <b class="APPLICATION">lpd</b> server and
              clients.</p>
            </li>

            <li>
              <p>Printcap entries which have configuration
              information for individual print queues. The
              information in the printcap entries for the queue
              override the <tt class="FILENAME">lpd.conf</tt> and
              compile time defaults. The system printcap file is
              read first, followed by the user printcap file.</p>
            </li>

            <li>
              <p>Command line and environment variable values.
              These can be used to override or select particular
              configuration information or to select one of a set
              of options for use.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>Each print queue or printer has a name which is used
          to look up the printcap information for the printer. The
          <tt class="FILENAME">/etc/printcap</tt> file is the
          default location for the printcap information, although
          it can also be obtained from database servers, or
          generated by programs. See the <a href="#SECNIS">Using
          Programs To Get Printcap Information</a> section for
          details.</p>

          <p>We will use a more complex printcap file to explore
          how <b class="APPLICATION">LPRng</b> gets the printcap
          information. Put the following lines in the <tt class=
          "FILENAME">/etc/printcap</tt> file:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3126"></a>
<pre class="SCREEN">
    # client entry
    lp:tc=.client
    lp2:tc=.client
    .client:
      :lp=%P@localhost
      :force_localhost
    
    lp:server
      :cm=The Main Print Queue
      :lp=/tmp/lp
      :tc=.common
    
    lp2:server
      :cm=The Second Print Queue
      :lp=/tmp/lp2
      :tc=.common
    
    .common:
      :sd=/var/spool/lpd/%P
      :mx=0
</pre>
          </div>
          The <tt class="COMMAND">lpc client</tt> command is very
          useful to see how <b class="APPLICATION">LPRng</b> uses
          this printcap information: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN3130"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {214} %</samp> <kbd class=
"USERINPUT">lpc client</kbd>
    Config
    <samp class="PROMPT">h4: {215} %</samp> <kbd class=
"USERINPUT">lpc client all</kbd>
    Config
     :lpd_port=2000
     :printcap_path=/var/tmp/LPD/printcap
    
    Names
     :.client=.client
     :.common=.common
     :lp=lp
     :lp2=lp2
     :main=lp
    
    All
     :lp
     :lp2
    
    Printcap Information
    lp|main
     :force_localhost
     :lp=lp@localhost
    lp2
     :force_localhost
     :lp=lp2@localhost
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpc client all</tt> command
          shows all of the configuration and printcap information,
          and is the handiest one for system debugging and
          diagnostics. The <span class="emphasis"><i class=
          "EMPHASIS">Name</i></span> information is the names of
          the printcap entries that have been found in the database
          and is listed in sorted order. The <span class=
          "emphasis"><i class="EMPHASIS">All</i></span> are entries
          that correspond to actual queues or printers and are
          listed in the order that they appear in the printcap or
          according to an order specified by the system
          administrator. (See the <a href="#ALLPC"><var class=
          "LITERAL">all</var> Printcap Entry</a> for details.)</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3142">4.11.1. Printcap
            Processing Format</a></h3>

            <p>Queue or printer names must start with an
            alphanumeric character, and contain only alphanumerics,
            hyphens (<var class="LITERAL">-</var>) and underscores
            (<var class="LITERAL">_</var>). To avoid known and
            nasty problems with sending and receiving print jobs
            from case sensitive and case insensitive systems, <b
            class="APPLICATION">LPRng</b> brutally lowercases all
            printcap entry names and printer names.</p>

            <p>The printcap file is processed by reading it line by
            line and composing the individual printcap entries.
            Each entry has an name and one or more aliases. The
            entries in the printcap assign values to options. These
            can have the format:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3149"></a>
<pre class="SCREEN">
    option=string value \n with escapes
    flag         # equivalent to flag=1
    flag@        # equivalent to flag=0
    option#value # equivalent to option=value
</pre>
            </div>
            <br>
            <br>

            <p>An option will have the last value that occurs in
            the printcap entry.</p>

            <p>Our example shows the use of the <var class=
            "LITERAL">tc</var> (<span class="emphasis"><i class=
            "EMPHASIS">t</i></span>ermcap in<span class=
            "emphasis"><i class="EMPHASIS">c</i></span>lude)
            facility. The <var class="LITERAL">:tc</var> value is a
            list of printcap entries that should be prefixed to the
            <span class="emphasis"><i class=
            "EMPHASIS">start</i></span> of the printcap entry in
            which it appears. This allows options to be set in the
            printcap entry which will override the values in the
            <var class="LITERAL">:tc</var> included entry. For
            convenience, the options are displayed in sorted
            order.</p>

            <p>The <b class="APPLICATION">LPRng</b> clients and <b
            class="APPLICATION">lpd</b> server may require a
            different set of options for the same spool queue. The
            clients require options whose values tell the clients
            how the contact the <b class="APPLICATION">lpd</b>
            server and transfer a print job or query to it. The <b
            class="APPLICATION">lpd</b> server needs options that
            tell it how to either print a job or forward it to
            another <b class="APPLICATION">lpd</b> server. The <var
            class="LITERAL">:client</var> or <var class=
            "LITERAL">:server</var> option marks a printcap entry
            as for client or <b class="APPLICATION">lpd</b> server
            use only; unmarked entries are used by both server and
            client. The <tt class="COMMAND">lpc client</tt> command
            shows the printcap information that the <b class=
            "APPLICATION">LPRng</b> clients would use. For example,
            here is what the <b class="APPLICATION">lpd</b> server
            would use:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3171"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {216} %</samp> <kbd class=
"USERINPUT">lpc server all</kbd>
    Config
     :lpd_port=2000
     :printcap_path=/var/tmp/LPD/printcap
    
    Names
     :.client=.client
     :.common=.common
     :lp=lp
     :lp2=lp2
     :main=lp
    
    All
     :lp
     :lp2
    
    Printcap Information
    lp|main
     :cm=The Main Print Queue
     :force_localhost
     :lp=/tmp/lp
     :mx=0
     :sd=/var/spool/lpd/%P
     :server
    lp2
     :cm=The Second Print Queue
     :force_localhost
     :lp=/tmp/lp2
     :mx=0
     :sd=/var/spool/lpd/%P
     :server
</pre>
            </div>
            <br>
            <br>

            <p>When we select the <var class="LITERAL">server</var>
            printcap information, we see that the <var class=
            "LITERAL">:sd</var> option has been added, and the <var
            class="LITERAL">:lp</var> replaced with new values.</p>

            <p>We can use the <var class="LITERAL">:oh</var> (<var
            class="LITERAL">o</var>n this <var class=
            "LITERAL">h</var>ost) option to mark printcap entries
            for use by a selected set of hosts. For example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3183"></a>
<pre class="SCREEN">
    lp:oh=10.0.0.0/255.255.255.0,*.private,!10.0.0.10
      :lp=%P@10.0.0.10
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">:oh</var> option takes a
            list of IP addresses and masks or glob patterns, and
            applies these to the IP addresses or list of Fully
            Qualified Domain Names for the current host. If there
            is a for at least one IP address or pattern in the list
            match then the entry is used. An exclamation mark (<var
            class="LITERAL">!</var>) inverts the sense of the
            match, and the entry is used if the match fails.</p>

            <p>Finally, we can use the <var class=
            "LITERAL">wildcard</var> facility to cause a default
            printcap entry to be used:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3190"></a>
<pre class="SCREEN">
    lp|*:cm=Wildcard Alias - %P=lp, %Q=wanted
      :lp=%P@10.0.0.10
    *:cm=Wildcard Name- %P=wanted, %Q=wanted
      :lp=%P@10.0.0.10
</pre>
            </div>
            <br>
            <br>

            <p>The <b class="APPLICATION">LPRng</b> software first
            searches the printcap information for an exact match.
            If none is found then it searches for the first
            wildcard entry that matches the printer name. If the
            wildcard is used as an alias, then the printcap entry
            is simply selected for use, with the printer name and
            queue name selected as shown above. We can also use
            partial matching as well:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3194"></a>
<pre class="SCREEN">
    lp|lp_*
      :lp=%P@10.0.0.10
    qt|qt_*
      :lp=%P@10.0.0.12
</pre>
            </div>
            <br>
            <br>

            <p>In the example above the first entry matches <var
            class="LITERAL">lp</var> and all printer names starting
            with <var class="LITERAL">lp_</var>, while the second
            entry matches <var class="LITERAL">qt</var> and all
            printer names starting with <var class=
            "LITERAL">qt_</var>. This can be useful when setting up
            a family of spool queues as discussed in later
            sections.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3201">4.11.2. Printcap
            Information From Programs and Databases</a></h3>

            <p>There many administrators store system information
            on a database server and having programs or utilities
            get their configuration information from this server.
            The use of the database allows easier system
            administration and also centralizes the administration.
            Rather than build in the various types of database
            access, the LPRng software allows the use of programs
            to obtain printcap information. This not only allows
            any type of database to be used, but also removes any
            legal or license restrictions on the redistribution of
            the actual software.</p>

            <p>We will use very simple example to show how you can
            use a program to get printcap information. First, you
            must configure the <b class="APPLICATION">LPRng</b>
            software to use a program to get the filter
            information. This is done by setting a value in the <tt
            class="FILENAME">lpc.conf</tt> file (usually <tt class=
            "FILENAME">/etc/lpd.conf</tt> or <tt class=
            "FILENAME">/usr/local/etc/lpd.conf</tt>). Copy your <tt
            class="FILENAME">lpd.conf</tt> file to <tt class=
            "FILENAME">lpd.conf.bak</tt> and then add the following
            line to the end of the file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3211"></a>
<pre class="SCREEN">
    printcap_path=|/tmp/getpc
    
    <samp class="PROMPT">h4: {217} %</samp> <kbd class=
"USERINPUT">cd /etc</kbd>
    <samp class="PROMPT">h4: {218} %</samp> <kbd class=
"USERINPUT">cp lpd.conf lpd.conf.bak</kbd>
    <samp class="PROMPT">h4: {219} %</samp> <kbd class=
"USERINPUT">echo 'printcap_path=|/tmp/getpc' &gt;&gt;lpd.conf</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>Next, edit the <tt class="FILENAME">/tmp/getpc</tt>
            file and set its values as shown below.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3221"></a>
<pre class="SCREEN">
    set /tmp/getpc:
    
      #!/bin/sh
      # /tmp/getpc
      echo PROG $0 "$@" &gt;&gt;/tmp/trace
      cat &gt;&gt;/tmp/trace
      cat &lt;&lt;EOF
      lp:lp=test@host
      EOF
      exit 0
    
    <samp class="PROMPT">h4: {220} %</samp> <kbd class=
"USERINPUT">chmod 755 /tmp/getpc</kbd>
    <samp class="PROMPT">h4: {221} %</samp> <kbd class=
"USERINPUT">echo testing | /tmp/getpc -aoption</kbd>
    lp:lp=test@host
    <samp class="PROMPT">h4: {222} %</samp> <kbd class=
"USERINPUT">cat /tmp/trace</kbd>
    PROG /tmp/getpc -aoption
    testing
</pre>
            </div>
            <br>
            <br>

            <p>After you have tested the <b class=
            "APPLICATION">getpc</b> script, use the <tt class=
            "COMMAND">lpc client all</tt> command:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3232"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {223} %</samp> <kbd class=
"USERINPUT">lpc client all</kbd>
    Config
     :lockfile=/var/tmp/LPD/lpd
     :lpd_port=2000
     :printcap_path=|/tmp/getpc
    
    Names
     :lp=lp
    
    All
     :lp
    
    Printcap Information
    lp
     :lp=test@host
    <samp class="PROMPT">h4: {224} %</samp> <kbd class=
"USERINPUT">cat /tmp/trace</kbd>
    <samp class="PROMPT">h4: {225} %</samp> <kbd class=
"USERINPUT">cat /tmp/trace</kbd>
    PROG /tmp/getpc -Pall -aacct -l66 -sstatus \
      -t2000-05-05-08:40:51.000 -w80 -x0 -y0 acct
    all
    PROG /tmp/getpc -Pall -aacct -l66 -sstatus \
      -t2000-05-05-08:40:51.000 -w80 -x0 -y0 acct
    *
</pre>
            </div>
            <br>
            <br>

            <p>As seen from the <tt class=
            "FILENAME">/tmp/trace</tt> file, the <tt class=
            "COMMAND">getpc</tt> program is invoked with the
            standard filter parameters. The <var class=
            "LITERAL">-P</var> command line literal is set to the
            name of the printcap entry and the name of the entry is
            written to the filter's <acronym class=
            "ACRONYM">STDIN</acronym>. If the entry is not found,
            then the wildcard printcap entry will be requested. The
            <var class="LITERAL">-P</var> literal is <span class=
            "emphasis"><i class="EMPHASIS">not</i></span> set to
            <var class="LITERAL">*</var>, as this has the
            possibility of opening a security loophole when a shell
            script parses the filter's command line options.</p>

            <p>You restore the original <tt class=
            "FILENAME">lpd.conf</tt> file to restore the system to
            normal operation.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3250"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {226} %</samp> <kbd class=
"USERINPUT">cd /etc</kbd>
    <samp class="PROMPT">h4: {227} %</samp> <kbd class=
"USERINPUT">cp lpd.conf.bak lpd.conf</kbd>
</pre>
            </div>
            <br>
            <br>

            <p>When using the program method to return information,
            special consideration should be given to the <var
            class="LITERAL">all</var> request. If there is not an
            explicit <var class="LITERAL">all</var> entry, then the
            program should take appropriate steps to enumerate the
            values in the database, or report that there is a
            missing <var class="LITERAL">all</var> entry to the
            appropriate administrative authority.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3260">4.11.3. User
            Printcap Information</a></h3>

            <p>In addition to the system printcap, each user can
            define a private printcap file that will be read after
            the system printcap. Users can define <b class=
            "APPLICATION">LPRng</b> client entries and can augment
            the system printcap information.</p>

            <p>By default, <tt class=
            "FILENAME">${HOME}/.printcap</tt> is the the user
            printcap file. Here is a simple example of a user
            printcap file.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3266"></a>
<pre class="SCREEN">
    # remote printer - default
    lp:lp=raw@localhost
      :ifhp=model=laserjet4
      :filter=/usr/local/libexec/filters/ifhp
    # direct connection to printer over TCP/IP connection
    lp:lp=10.0.0.5%9100
      :direct
      :ifhp=model=phaser
      :filter=/usr/local/libexec/filters/ifhp
</pre>
            </div>

            <p>The two examples show how a simple printer
            definition can be created. The first example shows how
            to create a simple way to send a file directly to a
            remote print queue after passing it through a filter.
            This is usually called <span class="emphasis"><i class=
            "EMPHASIS">client side</i></span> filtering.</p>

            <p>The second example is more interesting. Here we do
            the same thing, but we open a connection to the remote
            port on a host and send the print job. We do not spool
            the print job but send it directly. This is called
            <span class="emphasis"><i class="EMPHASIS">lightweight
            lpr</i></span> printing.</p>

            <p>While the user printcap file is read after the
            system printcap file, the order of printcap entries is
            modified so that any entries that appeared in the user
            printcap file will appear before entries in the system
            printcap file. This allows users to modify the order in
            which printer entries are displayed.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3273">4.12. Banner Printing
          and the OF filter</a></h2>

          <p>Banner or header pages can be printed at the
          beginning, end, or both at the beginning or end. The
          following flags control how and where banners are
          printed. These flags are listed in order of
          precedence.</p>

          <div class="VARIABLELIST">
            <dl>
              <dt><var class="LITERAL">:sh</var></dt>

              <dd>
                <p>Suppress all banner printing or header pages.
                This prevents any banners from being generated by
                the <b class="APPLICATION">lpd</b> print spooler
                and if present in a client printcap entry, will
                cause <b class="APPLICATION">lpr</b> not to put any
                banner printing information in the control file.
                Even if this flag is not present, then <b class=
                "APPLICATION">LPRng</b> will not print a banner
                unless a banner printing program is specified with
                the <var class="LITERAL">:bp,</var> <var class=
                "LITERAL">:bs</var>, <var class=
                "LITERAL">:be</var>, or <var class=
                "LITERAL">:sb</var> option.</p>
              </dd>

              <dt><var class="LITERAL">:ab</var></dt>

              <dd>
                <p>Print a banner or header page, even if the user
                has not requested one. The <var class=
                "LITERAL">:sh</var> option has precedence over the
                <var class="LITERAL">:ab</var> option.</p>
              </dd>

              <dt><var class="LITERAL">:hl</var></dt>

              <dd>
                <p>The banner (header) is at the end (last page) of
                the job.</p>
              </dd>

              <dt><var class="LITERAL">:bs=/...</var> and <var
              class="LITERAL">:be=/...</var> and</dt>

              <dd>
                <p>The <var class="LITERAL">:bs</var> and <var
                class="LITERAL">:be</var> options specify that a
                banner page is to be generated at the start and end
                of the job respectively, using indicated filter
                program. If the <var class="LITERAL">:hl</var> flag
                has been set, only the <var class=
                "LITERAL">:be</var> will be used.</p>
              </dd>

              <dt><var class="LITERAL">:bp=</var>...</dt>

              <dd>
                <p>If there is no <var class="LITERAL">:bs</var> or
                <var class="LITERAL">:be</var> value when printing
                a banner at the start or end of the job
                respectively, then use the indicated filter program
                to generate a banner.</p>
              </dd>

              <dt><var class="LITERAL">:sb</var> and <var class=
              "LITERAL">:bl=....</var></dt>

              <dd>
                <p>If there is no program specified to generate the
                banner and the <var class="LITERAL">:sb</var> flag
                is set, send the <var class="LITERAL">:bl</var>
                (banner line) string to the printer.</p>
              </dd>

              <dt><var class="LITERAL">:of=filter</var></dt>

              <dd>
                <p>A filter used to process banners and other
                non-job file information.</p>
              </dd>

              <dt><var class=
              "LITERAL">:suspend_of_filter</var></dt>

              <dd>
                <p>Controls whether the <var class=
                "LITERAL">:of</var> filter is suspended or has its
                input terminated.</p>
              </dd>
            </dl>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">pclbanner</b>, <b class=
          "APPLICATION">psbanner</b>, and <b class=
          "APPLICATION">lpbanner</b> programs are part of the <b
          class="APPLICATION">LPRng</b> distribution and are
          usually installed in the same location as the <b class=
          "APPLICATION">LPRng</b> supported filters. They produce a
          PCL, PostScript, or text banner respectively.</p>

          <p>The OF filter (<var class="LITERAL">:of=/path</var>)
          is used to process banner pages and to do any necessary
          setup to initialize the printer to handle banner pages.
          This filter has the following unusual behavior:</p>

          <ul>
            <li>
              <p>It must be explicitly specified in the printcap
              file. It is not run by default.</p>

              <p>If specified, it is started at the beginning of
              job printing and stays present throughout the entire
              job printing session.</p>
            </li>

            <li>
              <p>When printing individual files, the <var class=
              "LITERAL">:of</var> filter is sent a special <span
              class="emphasis"><i class="EMPHASIS">suspend
              yourself</i></span> two character string, <var class=
              "LITERAL">\031\001</var>. This will cause the <var
              class="LITERAL">:of</var> filter to send itself a
              <acronym class="ACRONYM">SIGSUSP</acronym> (suspend)
              signal.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:of</var> filter is
              restarted when any information not part of a print
              job file, such as the initialization string (<var
              class="LITERAL">:ld</var> option), termination string
              (<var class="LITERAL">:ld</var> option), or form
              feeds at start (<var class="LITERAL">:fo</var>), end
              (<var class="LITERAL">:fq</var>), and between job
              files (<var class="LITERAL">:ff_separator</var>), and
              when banners are generated by the <var class=
              "LITERAL">:bp</var>, <var class="LITERAL">:bs</var>,
              <var class="LITERAL">:be</var>, or <var class=
              "LITERAL">:sb</var> option and need to be sent to the
              printer.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>This rather baroque behavior is mostly historical in
          origin, and is very much embedded in the existing
          documentation and methodologies of the BSD print spooling
          system. Originally, when a printer port was opened, a
          special device initialization string was sent by the
          printer port device driver; this usually resulted in an
          extra page of paper being ejected by the printer. By
          opening the device once and then keeping it open, the
          print spooler would avoid the wasted paper. The reason
          for suspending the <var class="LITERAL">:of</var> filter
          was simply to save the overhead of creating an extra
          processes.</p>

          <p>Unfortunately, the <var class="LITERAL">:of</var>
          filter suspension behavior is now a problem rather than a
          benefit. For example, for many devices to finish printing
          a page correctly the filter must be closed in order for
          it to flush buffers and for the low level drivers to
          properly finish. In order to provide this functionality,
          the <var class="LITERAL">suspend_of_filter@</var> flag
          can be used. This will cause the <b class=
          "APPLICATION">lpd</b> server to close the <var class=
          "LITERAL">:of</var> filters input, rather than sending it
          the suspend string, and to restart a new <var class=
          "LITERAL">:of</var> filter process when necessary.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3376">4.13. Printing from
          <b class="APPLICATION">lpr</b> Directly To A
          Device</a></h2>

          <p>While the most reliable way to print is to send jobs
          to a print spooler, sometimes it is desirable to print
          directly to a printer. This method is supported by the
          special <var class="LITERAL">:direct</var> printcap flag
          or the <b class="APPLICATION">lpr</b> <var class=
          "LITERAL">-Y</var> command line flag. The following shows
          the effects of this flag:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3383"></a>
<pre class="SCREEN">
    lpr -Y -Phost%port file1 file2 ...
    Eqivalent to:
      ( for i in file1 file2 ... ; do
        $filter $i
      done ) | tcpip_connection( host%port)
    
    lpr -Y -P/dev/lp file1 file2 ...
    Eqivalent to:
      ( for i in file1 file2 ... ; do
        $filter $i
      done ) &gt;&gt;/dev/lp
    
    lpr -Y -P '|/program' file1 file2 ...
    Eqivalent to:
      ( for i in file1 file2 ... ; do
        $filter $i
      done ) | /program
</pre>
          </div>

          <p>The above examples show how we can use the command
          line options to send files directly to a printer. You can
          also create a printcap that will do the same:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3386"></a>
<pre class="SCREEN">
    lp:direct:lp=/tmp/a:remote_support=R
    Command:
      lpr -Plp file1 file2 ...
    Equivalent to:
    lpr -P/tmp/a -Y file1 file2 ...
    
    Example:
    <samp class="PROMPT">h4: {228} %</samp> <kbd class=
"USERINPUT">lp -P/tmp/a /tmp/hi</kbd>
    <samp class="PROMPT">h4: {229} %</samp> <kbd class=
"USERINPUT">cat /tmp/a /tmp/hi</kbd>
    hi
    <samp class="PROMPT">h4: {230} %</samp> <kbd class=
"USERINPUT">lp -Plp /tmp/hi</kbd>
    <samp class="PROMPT">h4: {231} %</samp> <kbd class=
"USERINPUT">cat /tmp/a /tmp/hi</kbd>
    hi
    hi
</pre>
          </div>

          <p>The <b class="APPLICATION">lpr</b> <var class=
          "LITERAL">-X filter</var> option allows us to specify a
          user filter on the command line. We will use a simple
          example to show how this capability could be used in
          practice. Create the <tt class="FILENAME">/tmp/pass</tt>
          file with the following contents, and give it executable
          permissions as shown below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3400"></a>
<pre class="SCREEN">
    #!/bin/sh
    # /tmp/pass file
    echo LEADER
    cat
    echo TRAILER
    exit 0
</pre>
          </div>
          <br>
          <br>

          <p>Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3404"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {232} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/a</kbd>
    <samp class="PROMPT">h4: {233} %</samp> <kbd class=
"USERINPUT">lpr -P/tmp/a -X /tmp/pass /tmp/hi</kbd>
    <samp class="PROMPT">h4: {234} %</samp> <kbd class=
"USERINPUT">cat /tmp/a</kbd>
    LEADER
    hi
    TRAILER
</pre>
          </div>
          <br>
          <br>

          <p>As we see from the example, our filter has processed
          the input file and added the <var class=
          "LITERAL">LEADER</var> and <var class=
          "LITERAL">TRAILER</var> strings. In practice, the actual
          processing of the input job would be far more elaborate,
          and may do such things as incorporate files or other
          material available only on the local system. We can also
          use a printcap entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3415"></a>
<pre class="SCREEN">
    lp:direct:lp=/tmp/a:filter=/tmp/pass
    
    <samp class="PROMPT">h4: {235} %</samp> <kbd class=
"USERINPUT">cp /dev/null /tmp/a</kbd>
    <samp class="PROMPT">h4: {236} %</samp> <kbd class=
"USERINPUT">lpr -Plp /tmp/hi</kbd>
    <samp class="PROMPT">h4: {237} %</samp> <kbd class=
"USERINPUT">cat /tmp/a</kbd>
    LEADER
    hi
    TRAILER
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3423">4.14. Moving Jobs
          From Queue to Queue and Redirecting Queues</a></h2>

          <p>The <tt class="COMMAND">lpc move</tt> command is used
          to move jobs in one queue to another queue on an
          individual basis, while the <tt class="COMMAND">lpc
          redirect</tt> command redirects all incoming jobs to a
          new queue. Edit the printcap file so it has contents
          indicated below, use <tt class="COMMAND">checkpc -f</tt>
          to check the printcap, and then use <tt class=
          "COMMAND">lpc reread</tt> to restart the <b class=
          "APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3431"></a>
<pre class="SCREEN">
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :lp=lp2@localhost
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
          </div>
          Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN3434"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {238} %</samp> <kbd class=
"USERINPUT">lpc stop lp lp2</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    Printer: lp2@h4
    lp2@h4.private: stopped
    <samp class="PROMPT">h4: {239} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {240} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID           Class Job Files      Size Time
    1      papowell@h4+659       A   659 /tmp/hi       3 08:04:03
    Printer: lp2@h4  (printing disabled)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {241} %</samp> <kbd class=
"USERINPUT">lpc move lp papowell lp2</kbd>
    Printer: lp@h4
    lp: selected 'papowell@h4+659'
    lp@h4.private: move done
    <samp class="PROMPT">h4: {242} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+659' removed at 08:19:24.962
    Printer: lp2@h4  (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID           Class Job Files       Size Time
    1      papowell@h4+659       A   659 /tmp/hi        3 08:19:24
</pre>
          </div>
          <br>
          <br>

          <p>We first stop the queues so that the jobs will remain
          in them. We then use the <tt class="COMMAND">lpc move
          fromqueue id toqueue</tt> command to select a job in the
          <span class="emphasis"><i class=
          "EMPHASIS">fromqueue</i></span> and move it to the <span
          class="emphasis"><i class="EMPHASIS">toqueue</i></span>.
          A list of job numbers, job IDs, or glob patterns to match
          job IDs can be used to select the job.</p>

          <p>The <tt class="COMMAND">lpc redirect fromqueue
          toqueue</tt> will cause all incoming jobs to be
          redirected to the specified queue. You can execute the
          following commands and observe the results.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3452"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {243} %</samp> <kbd class=
"USERINPUT">lpc redirect lp lp2</kbd>
    Printer: lp@h4
    forwarding to 'lp2'
    lp@h4.private: redirected
    <samp class="PROMPT">h4: {244} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4  (printing disabled) (redirect lp2)
     Queue: no printable jobs in queue
    Printer: lp2@h4  (printing disabled)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {245} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {246} %</samp> <kbd class=
"USERINPUT">lpq -a</kbd>
    Printer: lp@h4  (printing disabled) (redirect lp2)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+935' removed at 09:08:21.410
    Printer: lp2@h4  (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+935       A   935 /tmp/hi         3 09:08:21
</pre>
          </div>
          <br>
          <br>

          <p>To turn redirection off, use <tt class="COMMAND">lpc
          redirect queue off</tt> as shown in the example
          below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3464"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {247} %</samp> <kbd class=
"USERINPUT">lpc redirect lp off</kbd>
    Printer: lp@h4
    forwarding off
    <samp class="PROMPT">h4: {248} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+935' removed at 09:08:21.410
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3470">4.15. Print Job
          Classes, User Requested Job Priority, and Form
          Support</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> software allows
          users to assign a class name to print jobs using the <tt
          class="COMMAND">lpr -Cname</tt> option. This causes the
          <b class="APPLICATION">lpr</b> command to put the line
          <var class="LITERAL">Cname</var> in the control file. By
          default, the (upper cased) first letter of the class name
          is used to assign a user requested priority to the job,
          with <var class="LITERAL">A</var> being the default
          lowest priority and <var class="LITERAL">Z</var> being
          the highest.</p>

          <p>The <var class=
          "LITERAL">ignore_requested_user_priority</var> printcap
          option can be used to ignore the user requested priority
          and jobs will be printed in the normal first-in first-out
          order.</p>

          <p><b class="APPLICATION">LPRng</b> also makes use of the
          class information to do form support and restrict
          printing to a specific set of classes. By default the job
          class information is ignored, but the <tt class=
          "COMMAND">lpc class</tt> command can be used to specify
          one or more classes (actually glob patterns) to be
          printed. This facility can be used to do support printing
          of jobs that require a specific form setup. Here is a
          simple example of how to use this facility.</p>

          <p>Edit the printcap file so it has contents indicated
          below, use <tt class="COMMAND">checkpc -f</tt> to check
          the printcap, and then use <tt class="COMMAND">lpc
          reread</tt> to restart the <b class="APPLICATION">lpd</b>
          server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3488"></a>
<pre class="SCREEN">
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :lp=lp2@localhost
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
          </div>
          Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN3491"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {249} %</samp> <kbd class=
"USERINPUT">lpc class lp red</kbd>
    Printer: lp@h4
    classes printed 'red'
    lp@h4.private: class updated
    <samp class="PROMPT">h4: {250} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (classes red)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {251} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {252} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (classes red)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    holdclass papowell@h4+82     A    82 /tmp/hi         3 09:29:52
    <samp class="PROMPT">h4: {253} %</samp> <kbd class=
"USERINPUT">lpr -Cred /tmp/hi</kbd>
    <samp class="PROMPT">h4: {254} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (classes red)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Status: job 'papowell@h4+89' removed at 09:30:13.569
     Rank   Owner/ID           Class Job Files        Size Time
    holdclass papowell@h4+82     A    82 /tmp/hi         3 09:29:52
</pre>
          </div>
          <br>
          <br>

          <p>As seen in the example, we set the queue class to <var
          class="LITERAL">red</var>, and then sent a (default)
          class <var class="LITERAL">A</var> job to the printer. It
          was not printed, and is listed with <var class=
          "LITERAL">holdclass</var> status. We sent another job
          which was immediately printed.</p>

          <p>We can change the print queue class at any time, and
          then new class will then control what jobs are printed.
          To disable the class selection, use the <tt class=
          "COMMAND">lpc class queue off</tt> command.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3511"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {255} %</samp> <kbd class=
"USERINPUT">lpc class lp off</kbd>
    Printer: lp@h4
    all classes printed
    lp@h4.private: class updated
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3515">4.16. Holding and
          Releasing Jobs</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> software has a
          wide range of facilities to hold or temporarily prevent
          jobs from printing. Jobs can be individually held or all
          jobs submitted to a queue can be held until released by
          an operator. Some administrators use the <tt class=
          "COMMAND">holdall</tt> facility and a <b class=
          "APPLICATION">cron</b> script to cause jobs to be printed
          at specific times. The <tt class="COMMAND">lpc
          holdall</tt> command causes all jobs submitted to a queue
          to be held until released with the <tt class=
          "COMMAND">lpc release</tt> command. The <tt class=
          "COMMAND">lpc noholdall</tt> command disables the <tt
          class="COMMAND">holdall</tt> operation.</p>

          <p>Edit the printcap file so it has contents indicated
          below, use <tt class="COMMAND">checkpc -f</tt> to check
          the printcap, and then use <tt class="COMMAND">lpc
          reread</tt> to restart the <b class="APPLICATION">lpd</b>
          server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3529"></a>
<pre class="SCREEN">
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :lp=lp2@localhost
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
          </div>
          <br>
          <br>

          <p>Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3533"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {256} %</samp> <kbd class=
"USERINPUT">lpc holdall lp</kbd>
    Printer: lp@h4
    lp@h4.private: holdall on
    <samp class="PROMPT">h4: {257} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (holdall)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {258} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {259} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (holdall)
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    hold   papowell@h4+213       A   213 /tmp/hi         3 09:45:05
    <samp class="PROMPT">h4: {260} %</samp> <kbd class=
"USERINPUT">lpc release lp 213</kbd>
    Printer: lp@h4
    lp: selected 'papowell@h4+213'
    lp@h4.private: started
    <samp class="PROMPT">h4: {261} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (holdall)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+213' removed at 09:45:22.570
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpc holdall</tt> command
          causes all jobs to be held. We spool a job, and then use
          the <tt class="COMMAND">lpc release</tt> command to
          release the selected job. We disable the <tt class=
          "COMMAND">holdall</tt> operation using the <tt class=
          "COMMAND">lpc noholdall</tt> command.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3552"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {262} %</samp> <kbd class=
"USERINPUT">lpc noholdall lp</kbd>
    Printer: lp@h4
    lp@h4.private: holdall off
</pre>
          </div>
          <br>
          <br>

          <p>You can also use the <tt class="COMMAND">lpc hold</tt>
          command to select individual jobs in a spool queue to be
          held. This command is useful if there is a set of jobs
          which require special handling or printing at a later
          date. The following example shows how this command is
          used. We use the <tt class="COMMAND">lpc stop</tt> and
          <tt class="COMMAND">lpc start</tt> commands to simulate
          the normal delays in print spooling operations.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3560"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {263} %</samp> <kbd class=
"USERINPUT">lpc stop lp</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    <samp class="PROMPT">h4: {264} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+495' removed at 10:10:50.629
    <samp class="PROMPT">h4: {265} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {266} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {267} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 2 printable jobs
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+459       A   459 /tmp/hi         3 10:40:32
    2      papowell@h4+461       A   461 /tmp/hi         3 10:40:34
    <samp class="PROMPT">h4: {268} %</samp> <kbd class=
"USERINPUT">lpc hold lp 459</kbd>
    Printer: lp@h4
    lp: selected 'papowell@h4+459'
    lp@h4.private: updated
    <samp class="PROMPT">h4: {269} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (printing disabled)
     Queue: 1 printable job
     Holding: 1 held jobs in queue
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+461       A   461 /tmp/hi         3 10:40:34
    hold   papowell@h4+459       A   459 /tmp/hi         3 10:40:32
</pre>
          </div>
          <br>
          <br>

          <p>In the next example we show how to use the <tt class=
          "COMMAND">lpc hold</tt> command to select and hold an
          individual job. Then we start the queue and see what
          happens:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3578"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {270} %</samp> <kbd class=
"USERINPUT">lpc start</kbd>
    Printer: lp@h4
    lp@h4.private: started
    <samp class="PROMPT">h4: {271} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Holding: 1 held jobs in queue
     Server: no server active
     Status: job 'papowell@h4+461' removed at 10:41:24.873
     Rank   Owner/ID           Class Job Files        Size Time
    hold   papowell@h4+459       A   459 /tmp/hi         3 10:40:32
    <samp class="PROMPT">h4: {272} %</samp> <kbd class=
"USERINPUT">lpc release lp 459</kbd>
    Printer: lp@h4
    lp: selected 'papowell@h4+459'
    lp@h4.private: started
    <samp class="PROMPT">h4: {273} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+459' removed at 10:41:39.457
</pre>
          </div>
          <br>
          <br>

          <p>As we see, the held job is not printed until we
          release it, and then is processed normally.</p>

          <p>The printcap <var class="LITERAL">:ah</var> (autohold)
          option has the same effect as the <tt class="COMMAND">lpc
          holdall</tt> command but its actions cannot be disabled
          by the <tt class="COMMAND">lpc noholdall</tt>
          command.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3593">4.17. Load Balance
          Queues and Printer Pools</a></h2>

          <p>A Load Balance Queue provides a way to use multiple
          printers for a single print queue. All jobs are normally
          sent to the main or load balance queue which then
          dispatches the jobs to <span class="emphasis"><i class=
          "EMPHASIS">server</i></span> queues or printers that do
          the actual printing as they become available. You can
          also send jobs to the individual server printers if they
          have special processing or setups required for a
          particular job. Because all of the server printers are
          shared by the load balance queue, they are said to be in
          a <span class="emphasis"><i class="EMPHASIS">printer
          pool</i></span>.</p>

          <p>Edit the printcap file so it have the contents
          indicated below, create the <tt class=
          "FILENAME">/tmp/lp2</tt> and <tt class=
          "FILENAME">/tmp/lp3</tt> files with <var class=
          "LITERAL">0777</var> permissions, use <tt class=
          "COMMAND">checkpc -f</tt> to check the printcap, and then
          use <tt class="COMMAND">lpc reread</tt> to restart the <b
          class="APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3605"></a>
<pre class="SCREEN">
    # printcap
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :sv=lp2,lp3
    lp2:force_localhost
    lp2:server
      :ss=lp
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
    lp3:force_localhost
    lp3:server
      :ss=lp
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">:sv=...</var> option flags
          the queue as a load balance queue and lists the queues
          that are used for load balancing. The <var class=
          "LITERAL">:ss=...</var> option flags the queue as a
          server for a load balance queue and specifies the name of
          the load balance queue. When a job is sent to the load
          balance queue the <b class="APPLICATION">lpd</b> server
          checks to see which server queues are available and then
          the first one to become available.</p>

          <p>Execute the following commands to print the <tt class=
          "FILENAME">/tmp/hi</tt> file and observe the results:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3613"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {274} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (subservers lp2, lp3)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+42' removed at 07:29:57.924
    Server Printer: lp2@h4  (serving lp)
     Queue: no printable jobs in queue
    Server Printer: lp3@h4  (serving lp)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {275} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {276} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (subservers lp2, lp3)
     Queue: 1 printable job
     Server: pid 4063 active
     Status: waiting for subserver to finish at 07:31:08.074
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+62        A    62 /tmp/hi         3 07:31:07
    Server Printer: lp2@h4  (serving lp)
     Queue: no printable jobs in queue
    Server Printer: lp3@h4  (serving lp)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {277} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (subservers lp2, lp3)
     Queue: no printable jobs in queue
     Status: no more jobs to process in load balance queue at 07:31:12.317
    Server Printer: lp2@h4  (serving lp)
     Queue: no printable jobs in queue
    Server Printer: lp3@h4  (serving lp)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+62' removed at 07:31:10.311
</pre>
          </div>
          <br>
          <br>

          <p>The first <b class="APPLICATION">lpq</b> command shows
          how the status is displayed for a load balance queue -
          the queue and its server queues are shown as well. Next,
          we use <b class="APPLICATION">lpr</b> to print a job (job
          id <var class="LITERAL">papowell@h4+62</var>). We then
          use a couple of <b class="APPLICATION">lpq</b> commands
          to see how the job is first sent to the <var class=
          "LITERAL">lp</var> queue, which then forwards it to the
          <var class="LITERAL">lp3</var> queue, which then
          processes it and removes it. (For purposes of
          demonstration we have artificially slowed down the
          operation of the load balance queue so that the jobs will
          remain in the queue for sufficient time for us to display
          their status.) We can send another job to the load
          balance queue:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3630"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {278} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {279} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4  (subservers lp2, lp3)
     Queue: no printable jobs in queue
     Status: no more jobs to process in load balance queue at 07:37:17.953
    Server Printer: lp2@h4  (serving lp)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+89' removed at 07:37:15.936
    Server Printer: lp3@h4  (serving lp)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+81' removed at 07:36:40.116
</pre>
          </div>
          <br>
          <br>

          <p>This time we see that the job was put in <var class=
          "LITERAL">lp2</var>. The normal load balance queue
          operation is to use the server queues in round robin
          order.</p>

          <p>While this simple configuration is suitable for a
          large number of configurations, there are situations
          where server queue must be chosen <span class=
          "emphasis"><i class="EMPHASIS">dynamically</i></span>.
          For example, if the server queues are actually
          transferring jobs to remote clients then as soon as the
          job is sent to the remote client the queue appears empty
          and available for use. To correctly check to see if the
          queue is available, the status of the remote queue or
          destination of the server queue must be checked.</p>

          <p>To handle this situation, a <var class=
          "LITERAL">:chooser</var> program or filter can be used.
          When the load balance queue is trying to decide where to
          send a job, it first checks the server queues to see if
          they are enabled for printing. If a <var class=
          "LITERAL">:chooser</var> program is specified in the load
          balance queue printcap entry, then it is started with the
          normal filter options and environment variables,
          supplemented as discussed below. The <var class=
          "LITERAL">:chooser</var> program will read a list of
          candidate queues from its <acronym class=
          "ACRONYM">STDIN</acronym>, write the chosen one to its
          <acronym class="ACRONYM">STDOUT</acronym>, and then exit.
          The <b class="APPLICATION">lpd</b> server checks the <var
          class="LITERAL">:chooser</var> exit code - if it is zero
          (successful) then the chosen queue is used otherwise the
          exit code is used for the result value of processing the
          job. This allows the chooser process to not only control
          the destination of the job but also to hold, remove, or
          abort the job handling process. If the <var class=
          "LITERAL">:chooser</var> does not specify a queue, then
          the job is skipped and another job is chosen.</p>

          <p>One side effect of the using a chooser program is that
          while there are jobs that can be processed in the queue
          the <b class="APPLICATION">lpd</b> server needs to
          periodically check to see if a server queue has become
          available. If it did this continually then a very high
          load would be put on the system. Instead, the <var class=
          "LITERAL">chooser_interval</var> option specifies a
          maximum time in seconds (default 10 seconds) between the
          times that the <b class="APPLICATION">lpd</b> server
          checks to see if there is an available server.</p>

          <p>Edit the printcap file so it have the contents
          indicated below, create the <tt class=
          "FILENAME">/tmp/lp2</tt> and <tt class=
          "FILENAME">/tmp/lp3</tt> files with <var class=
          "LITERAL">0777</var> permissions. Then create the <tt
          class="FILENAME">/tmp/chooser.script</tt> with the
          contents indicated below, and give it <var class=
          "LITERAL">0755</var> (executable) permissions. Make sure
          that the path to the <b class="APPLICATION">head</b>
          program used in <tt class="FILENAME">chooser.script</tt>
          is correct. Use <tt class="COMMAND">checkpc -f</tt> to
          check the printcap, and then use <tt class="COMMAND">lpc
          reread</tt> to restart the <b class="APPLICATION">lpd</b>
          server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3664"></a>
<pre class="SCREEN">
    # printcap
    lp:force_localhost
    lp:server
      :sd=/var/spool/lpd/%P
      :sv=lp2,lp3
      :chooser=/tmp/chooser.script
    lp2:force_localhost
    lp2:server
      :ss=lp
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
    lp3:force_localhost
    lp3:server
      :ss=lp
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
    
    # /tmp/chooser.script
    
    #!/bin/sh
    echo CHOOSER $0 $@ &gt;&gt;/tmp/chooser
    set &gt;&gt;/tmp/chooser
    /usr/bin/head -1
    exit 0
</pre>
          </div>
          <br>
          <br>

          <p>Now run the following commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3667"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {280} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {281} %</samp> <kbd class=
"USERINPUT">lpq -lll</kbd>
    Printer: lp@h4  (subservers lp2, lp3)
     Queue: no printable jobs in queue
     Status: CHOOSER selected 'lp3' at 14:02:50.605
     Status: transferring 'papowell@h4+178' 
          to subserver 'lp3' at 14:02:50.614
     Status: transfer 'papowell@h4+178' 
          to subserver 'lp3' finished at 14:02:50.624
     Status: job 'papowell@h4+178' removed at 14:02:50.632
     Status: starting subserver 'lp3' at 14:02:50.632
     Status: waiting for server queue process to exit at 14:02:50.651
     Status: subserver pid 10182 exit status 'JSUCC' at 14:02:52.872
     Status: no more jobs to process in load balance queue at 14:02:52.879
    Server Printer: lp2@h4  (serving lp)
     Queue: no printable jobs in queue
    Server Printer: lp3@h4  (serving lp)
     Queue: no printable jobs in queue
     Status: waiting for subserver to exit at 14:02:50.748
     Status: subserver pid 10183 starting at 14:02:50.820
     Status: accounting at start at 14:02:50.821
     Status: opening device '/tmp/lp3' at 14:02:50.833
     Status: printing job 'papowell@h4+178' at 14:02:50.834
     Status: processing 'dfA178h4.private', size 3, format 'f', \
          IF filter 'none - passthrough' at 14:02:50.838
     Status: printing finished at 14:02:50.839
     Status: accounting at end at 14:02:50.839
     Status: finished 'papowell@h4+178', status 'JSUCC' at 14:02:50.841
     Status: subserver pid 10183 exit status 'JSUCC' at 14:02:50.843
     Status: lp3@h4.private: job 'papowell@h4+178' printed at 14:02:50.856
     Status: job 'papowell@h4+178' removed at 14:02:50.871
</pre>
          </div>
          <br>
          <br>

          <p>As you see from the example above, the <acronym class=
          "ACRONYM">CHOOSER</acronym> selected <var class=
          "LITERAL">lp3</var> for use. Let us look at the <tt
          class="FILENAME">/tmp/chooser</tt> file and see how the
          <tt class="FILENAME">chooser.script</tt> program was
          run:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3678"></a>
<pre class="SCREEN">
    CHOOSER -Apapowell@h4+113 -CA -D2000-06-01-14:02:13.313 -Hh4.private \
       -J/tmp/hi -Lpapowell -Plp -Qlp -aacct -b3 -d/var/tmp/LPD/lp \
       -hh4.private -j113 -kcfA113h4.private -l66 -npapowell -sstatus \
       -t2000-06-01-14:02:13.379 -w80 -x0 -y0 acct
    USER=papowell
    LD_LIBRARY_PATH=/lib:/usr/lib:/usr/5lib:/usr/ucblib
    HOME=/home/papowell
    PRINTCAP_ENTRY=lp
     :chooser=/var/tmp/LPD/chooser
     :lp=/tmp/lp
     :sd=/var/tmp/LPD/lp
     :server
     :sv=lp2,lp3
    
    lp2=change=0x0
     done_time=0x1
     held=0x0
     move=0x0
     printable=0x0
     printer=lp2
     printing_aborted=0x0
     printing_disabled=0x0
     queue_control_file=control.lp2
     server=0
     spooldir=/var/tmp/LPD/lp2
    lp3=change=0x0
     done_time=0x2
     held=0x0
     move=0x0
     printable=0x0
     printer=lp3
     printing_aborted=0x0
     printing_disabled=0x0
     queue_control_file=control.lp3
     server=0
     spooldir=/var/tmp/LPD/lp3
    PS1=$
    OPTIND=1
    PS2=&gt;
    SPOOL_DIR=/var/tmp/LPD/lp
    LOGNAME=papowell
    CONTROL=Hh4.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Apapowell@h4+113
    D2000-06-01-14:02:13.313
    Qlp
    N/tmp/hi
    fdfA113h4.private
    UdfA113h4.private
</pre>
          </div>
          <br>
          <br>

          <p>As you can see, the program is invoked with the same
          options as a normal filter. In addition, the printcap
          information for each server queue is passed in an
          environment variable with the name of the server queue.
          This means that if there is information needed by the
          chooser program to test for the availability of hardware,
          etc., this can be placed in the printcap information.</p>

          <p>One of the limitations of using the <var class=
          "LITERAL">:chooser</var> program is that you may have a
          high overhead associated with running the program. The <b
          class="APPLICATION">LPRng</b> software provides support
          for linking in a user provided routine that does the same
          thing as the <var class="LITERAL">:chooser</var> program.
          This routine has the following API or interface:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3685"></a>
<pre class="SCREEN">
    Printcap Option: chooser_routine
       chooser_routine@  - default - do not use chooser routine
       chooser_routine   - use chooser routine
    
    Configuration:
       configure --with-chooser_routine=name --with-user_objs=objectfile.o
          defines the CHOOSER_ROUTINE compilation option to name
          includes the objectfile.o in the library.
    
    extern int CHOOSER_ROUTINE( struct line_list *servers,
        struct line_list *available, int *use_subserver );
      servers:    all subserver queues for this load balance queue
      available:  subserver queues to choose from
      use_subserver: chosen subserver queue
      RETURNS:
         0 - use the 'use_subserver' value as index into servers
             list for server to use
         != 0 - set job status to value returned.
</pre>
          </div>
          <br>
          <br>

          <p>See the <tt class=
          "FILENAME">LPRng/src/common/lpd_jobs.c</tt> and <tt
          class="FILENAME">LPRng/src/common/user_objs.c</tt> files
          for details of the servers, available, and user_subserver
          parameters. The <tt class="FILENAME">user_objs.c</tt>
          file provides a simple template that can be used as a
          starting point for a more complex routine. You should
          modify the code in the <tt class=
          "FILENAME">user_objs.c</tt> file and then use the
          configure options shown above to cause the <tt class=
          "FILENAME">user_objs.c</tt> file to be compiled and
          linked into the <b class="APPLICATION">LPRng</b>
          executables.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3694">4.18. Routing Jobs To
          Print Queues</a></h2>

          <p>A <span class="emphasis"><i class="EMPHASIS">routing
          queue</i></span> is similar in concept to a load balance
          queue in that it transfers a job to a (different) print
          queue, but the job destination is chosen at the time the
          job is submitted to the queue rather than at the time the
          job is removed from the queue. A routing queue can modify
          the job control file, multiple copies of the same job can
          be sent to the same or different printers, and the job
          can be held, rejected, or processed immediately.</p>

          <p>Edit the printcap file so it have the contents
          indicated below, create the <tt class=
          "FILENAME">/tmp/lp2</tt> and <tt class=
          "FILENAME">/tmp/lp3</tt> files with <var class=
          "LITERAL">0777</var> permissions. Create the <tt class=
          "FILENAME">/tmp/router.script</tt> with the contents
          indicated below, and give it <var class=
          "LITERAL">0755</var> (executable) permissions. Use <tt
          class="COMMAND">checkpc -f</tt> to check the printcap,
          and then use <tt class="COMMAND">lpc reread</tt> to
          restart the <b class="APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3707"></a>
<pre class="SCREEN">
    # printcap
    lp:force_localhost
    lp:server
      :lp=/dev/null
      :sd=/var/spool/lpd/%P
      :router=/tmp/router.script
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
    lp3:force_localhost
    lp3:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
    
    # /tmp/router.script
    
    #!/bin/sh
    /bin/cat &lt;&lt;EOF
    dest lp2
    copies 2
    Cred
    end
    dest lp3
    end
    EOF
    exit 0
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="FILENAME">router.script</tt> will write
          the routing information to its <acronym class=
          "ACRONYM">STDOUT</acronym>. For our example, we want the
          destination <var class="LITERAL">lp2</var> to get two
          copies of the job and we want to change the class to <var
          class="LITERAL">red</var>. Now run the following
          commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3714"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {282} %</samp> <kbd class=
"USERINPUT">lpc stop all</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    Printer: lp2@h4
    lp2@h4.private: stopped
    Printer: lp3@h4
    lp3@h4.private: stopped
    <samp class="PROMPT">h4: {283} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4 (dest lp@localhost) (printing disabled) (dest lp2, lp3)
     Queue: no printable jobs in queue
    Printer: lp2@h4  (printing disabled)
     Queue: no printable jobs in queue
    Printer: lp3@h4  (printing disabled)
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {284} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {285} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4 (dest lp@localhost) (printing disabled) (dest lp2, lp3)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+235       A   235 /tmp/hi         3 16:14:22
     -          papowell@h4+235.1       -&gt;lp2 &lt;cpy 0/2&gt;
     -          papowell@h4+235.2       -&gt;lp3
    Printer: lp2@h4  (printing disabled)
     Queue: no printable jobs in queue
    Printer: lp3@h4  (printing disabled)
     Queue: no printable jobs in queue
</pre>
          </div>
          <br>
          <br>

          <p>The status reported for the spooled job indicates that
          the job is routed to <var class="LITERAL">lp2</var>, and
          that two copies will be sent. The <var class=
          "LITERAL">:destinations</var> option in the printcap
          entry causes <b class="APPLICATION">lpq</b> to display
          the contents of the specified queues. Now execute the
          following commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3728"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {286} %</samp> <kbd class=
"USERINPUT">lpc start</kbd>
    Printer: lp@h4
    lp@h4.private: started
    <samp class="PROMPT">h4: {287} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4 (dest lp@localhost) (destinations lp2, lp3)
     Queue: no printable jobs in queue
     Status: job 'papowell@h4+235' removed at 16:14:37.491
    Printer: lp2@h4  (printing disabled)
     Queue: 2 printable jobs
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+235.1C1   A   235 /tmp/hi         3 16:14:36
    2      papowell@h4+235.1C2   A   236 /tmp/hi         3 16:14:37
    Printer: lp3@h4  (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Rank   Owner/ID           Class Job Files        Size Time
    1      papowell@h4+235.2     A   237 /tmp/hi         3 16:14:37
    <samp class="PROMPT">h4: {288} %</samp> <kbd class=
"USERINPUT">more /var/spool/lpd/lp2/cfA235*</kbd>
    Hh4.private
    Ppapowell
    J/tmp/hi
    Cred
    Lpapowell
    Apapowell@h4+235.1C1
    D2000-06-01-16:03:25.237
    Qlp
    N/tmp/hi
    fdfA235h4.private
    UdfA235h4.private
</pre>
          </div>
          <br>
          <br>

          <p>As you can see, two copies of the job has been
          transferred to <var class="LITERAL">lp2</var> and one to
          <var class="LITERAL">lp3</var>, each with a different job
          number, If we examine the control file for the jobs in
          the <var class="LITERAL">lp2</var> spool queue, we will
          find that the <var class="LITERAL">C</var> or class
          information has been changed to <var class=
          "LITERAL">red</var>.</p>

          <p>For details about all of the capabilities of the
          routing filter, see <a href="#DESTINATIONS">Dynamic
          Routing</a>. Here is a summary of the information that
          the routing filter can put into the routing file.</p>

          <div class="VARIABLELIST">
            <dl>
              <dt>dest queue</dt>

              <dd>
                <p>Route this job to <var class=
                "LITERAL">queue</var>. The <var class=
                "LITERAL">queue@host</var> form will transfer the
                job to the queue on the named host.</p>
              </dd>

              <dt>copies N</dt>

              <dd>
                <p>Send N copies of this job to the
                destination.</p>
              </dd>

              <dt>priority C</dt>

              <dd>
                <p>Set the job priority letter to <var class=
                "LITERAL">C</var>, where C is a single upper case
                letter.</p>
              </dd>

              <dt>Cvalue</dt>

              <dd>
                <p>Set the control file line starting with <var
                class="LITERAL">C</var> to <var class=
                "LITERAL">Cvalue</var>.</p>
              </dd>
            </dl>
          </div>
          <br>
          <br>

          <p>The exit status of the routing filter controls how the
          job will be processed. If the exit code is JSUCC (0),
          then the job will be processed normally, JHOLD will hold
          the job until released, JREMOVE will remove the job, and
          so forth.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3767">4.19. Job Options and
          the Z Control File Entry</a></h2>

          <p>Many printers have special capabilities such as
          printing in landscape mode, duplex printing, binding, or
          stapling. These capabilities are usually invoked or
          enabled by the print spooler sending special printer
          control commands to the printer based on values it finds
          in the control file. The <b class="APPLICATION">LPRng</b>
          print spooler uses the <var class="LITERAL">Z</var> line
          in the control file to specify these options, while other
          print spoolers such as the Sun Microsystems Solaris <b
          class="APPLICATION">lp</b> system pass them on the <var
          class="LITERAL">S</var> line.</p>

          <p>Job formatting options are specified using the <tt
          class="COMMAND">lpr -Z</tt> option. The <b class=
          "APPLICATION">lpr</b> program concatenates the <var
          class="LITERAL">-Z</var> options and puts them in the
          control file as a single <var class="LITERAL">Z</var>
          line. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3779"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {289} %</samp> <kbd class=
"USERINPUT">lpc stop</kbd>
    Printer: lp@h4
    lp@h4.private: stopped
    <samp class="PROMPT">h4: {290} %</samp> <kbd class=
"USERINPUT">lpr -Zthis -Zthat /tmp/hi</kbd>
    <samp class="PROMPT">h4: {291} %</samp> <kbd class=
"USERINPUT">cat /var/spool/lp/cf*</kbd>
    Hh4.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Zthis,that
    Apapowell@h4+115
    D2000-05-05-10:05:41.351
    Qlp
    N/tmp/hi
    fdfA115h4.private
    UdfA115h4.private
</pre>
          </div>
          <br>
          <br>

          <p>As we see, the <var class="LITERAL">Z</var> options
          have been put into the control file on the <var class=
          "LITERAL">Z</var> line. The <var class="LITERAL">Z</var>
          option values are passed to filters on the command line
          as the <var class="LITERAL">-Z</var> command line option.
          These values are used by the <b class=
          "APPLICATION">ifhp</b> filter to determine what control
          commands to send to the printer and how to format the
          print job output. Because each printer is different and
          supports a different set of capabilities it is impossible
          to have a set of job options supported across all
          printers. The following are supported by the <b class=
          "APPLICATION">ifhp</b> configuration where possible. Many
          of these options rely on the printer supporting
          PostScript or having the appropriate PCL commands to do
          the indicated operation.</p>

          <ul>
            <li>
              <p>-Zlandscape -Zportrait - select landscape or
              portrait orientation.</p>
            </li>

            <li>
              <p>-Zduplex -Zsimplex - select duplex (both sides of
              a page) or simplex (single side of a page)
              printing.</p>
            </li>

            <li>
              <p>-Zletter -Zlegal -Zledger -Za4 -Za5 -Zenvelope
              -Ztransparency - select a paper size</p>
            </li>

            <li>
              <p>-Zinupper -Zinmiddle -Zinlower - select input
              media from the appropriate input tray</p>
            </li>

            <li>
              <p>-Zmanual - select input from the manual feed</p>
            </li>
          </ul>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3805">4.19.1. Setting Job
            Options Using the Printcap</a></h3>

            <p>An alternative to this method of using <b class=
            "APPLICATION">lpr</b> and the <var class=
            "LITERAL">-Z</var> option is to define a set of spool
            queues which will put the necessary options into the
            job control file. This can be done by the <b class=
            "APPLICATION">lpr</b> program when the job is
            generated, or by the <b class="APPLICATION">lpd</b>
            spooler when the job is processed. The The options
            specified by the <var class="LITERAL">:prefix_z</var>,
            <var class="LITERAL">:append_z</var>, and <var class=
            "LITERAL">:delete_z</var> are prefixed, appended, or
            deleted from the current set of <var class=
            "LITERAL">Z</var> control file options by the <b class=
            "APPLICATION">lpr</b> program when the job is submitted
            and they are specified in the printcap for the queue,
            or by the <b class="APPLICATION">lpd</b> spooler when
            the job is submitted to the queue. We can use this
            capapbility to configure print queues to a desired set
            of <var class="LITERAL">Z</var> options into the
            control file. For example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3819"></a>
<pre class="SCREEN">
    landscape:lp=%P@server
    landscape:server:tc=.common
      :lp=raw@server:append_z=landscape:delete_z=portrait
    raw:server:tc=.common:lp=....
      :filter=/usr/local/libexec/filters/ifhp
    .common:sd=/var/spool/lpd/%P
</pre>
            </div>
            <br>
            <br>

            <p>When a job is sent to the <var class=
            "LITERAL">landscape</var> queue, the control file <var
            class="LITERAL">Z</var> line will have the <var class=
            "LITERAL">portrait</var> option removed and the <var
            class="LITERAL">landscape</var> option appended. The
            <var class="LITERAL">:delete_z</var> values are glob
            patterns and options that match are removed from the
            option list. Options are assumed to be separated by
            commas or semicolons in the option list.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3827">4.19.2. Converting
            SystemV Options to LPRng Options</a></h3>

            <p>On some SystemV <b class="APPLICATION">lp</b> print
            spoolers, the <tt class="COMMAND">lp -o option</tt>,
            puts the option information into the control file <var
            class="LITERAL">S</var> line, and on other systems on
            the puts the option information into the control file
            <var class="LITERAL">O</var> line. To convert these
            options to <b class="APPLICATION">LPRng</b> <var class=
            "LITERAL">Z</var> options use the <var class=
            "LITERAL">:prefix_option_to_option=from,from...
            to</var> facility to prefix the <span class=
            "emphasis"><i class="EMPHASIS">from</i></span> control
            file lines to the <span class="emphasis"><i class=
            "EMPHASIS">to</i></span> control file line. For
            example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3839"></a>
<pre class="SCREEN">
    # System V to LPRng - S and O to Z options
    convert:server:tc=.common
      :lp=raw@server:prefix_option_to_option=S,O Z
    # LPRng to System V O options
    convert:server:tc=.common
        :lp=raw@server:prefix_option_to_option=Z O
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN3841">4.19.3. Selecting a
            Single Option - Muliple Queues</a></h3>

            <p>Here is an example of how you can set up queues that
            will append the appropriate <var class=
            "LITERAL">Z</var> option to select landscape mode, do
            duplex printing, or select legal or ledger size
            paper:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3845"></a>
<pre class="SCREEN">
    landscape:lp=%P@server
    landscape:server:tc=.common
        :lp=raw@server:append_z=landscape
    duplex:lp=%P@server
    duplex:server:tc=.common
        :lp=raw@server:append_z=duplex
    ledger:lp=%P@server
    ledger:server:tc=.common
        :lp=raw@server:append_z=ledger
    legal:lp=%P@server
    legal:server:tc=.common
        :lp=raw@server:append_z=legal
    raw:server:tc=.common:lp=....
      :filter=/usr/local/libexec/filters/ifhp
    .common:sd=/var/spool/lpd/%P
</pre>
            </div>
            <br>
            <br>

            <p>The problem with this method is that for each option
            we need to define a queue whose only purpose is to
            append the appropriate option and then forward this to
            the main print queue.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name=
            "INCOMINGCONTROLFILTER">4.19.4. Selecting Multiple
            Options - Single Queue</a></h3>

            <p>In the previous section, we showed how to set up a
            queue that would append a single option to the control
            file <var class="LITERAL">Z</var> line. If we want to
            have combinations of option options specified by the
            printer name then we will have to create a large number
            of queues each with a different set of options and each
            appending a different set of values. The problem
            becomes compounded when we have many printers, each of
            which requires these options.</p>

            <p>The solution to this problem originated with the <b
            class="APPLICATION">apsfilter</b> program written by
            Andreas Klemm and Thomas Bueschgens. They made the
            observeration that if we know the name of the print
            queue then we can use this name to select options for
            the printer. The <b class="APPLICATION">LPRng</b>
            provides this functionality by using wildcard queues
            and <span class="emphasis"><i class=
            "EMPHASIS">editing</i></span> or <span class=
            "emphasis"><i class="EMPHASIS">filtering</i></span> the
            control file when the job is submitted to the spool
            queue.</p>

            <p>The <var class=
            "LITERAL">incoming_control_filter=/path</var> option
            specifies a filter that processes the incoming job
            control file. It should be used to update and/or modify
            information on the option lines of the control files of
            incoming jobs. It reads the control file on its
            <acronym class="ACRONYM">STDIN</acronym>, writes the
            new control file on its <acronym class=
            "ACRONYM">STDOUT</acronym>, and then exits. A 0 exit
            code value causes normal processing of the job, <var
            class="LITERAL">JHOLD</var> will hold the job, and any
            other value will cause the job to be discarded.</p>

            <p>The following shows how we can set up a single queue
            that will allow various combinations of options to be
            selected by the format of the queue name:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3863"></a>
<pre class="SCREEN">
    # for clients
    pr|pr_*:lp=%Q@server
    # for server
    pr|pr_*:server
      :tc=.common:lp=....
      :incoming_control_filter=/usr/local/libexec/filters/update_z
      :filter=/usr/local/libexec/filters/ifhp
    .common:sd=/var/spool/lpd/%P
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">pr</var> and <var class=
            "LITERAL">pr_*</var> aliases will match printer <var
            class="LITERAL">pr</var> all print queue names starting
            with <var class="LITERAL">pr_</var>. We can then use
            various suffixes to select job options. The following
            filter program uses the <var class=
            "LITERAL">_landscape</var>, <var class=
            "LITERAL">_legal</var>, and <var class=
            "LITERAL">_ledger</var> suffixes to set the
            corresponding option in the <var class=
            "LITERAL">Z</var> file. This program and other are
            available in the <b class="APPLICATION">LPRng</b>
            distribution in the <tt class="FILENAME">UTILS</tt>
            directory. You should note that additional options can
            be specified as desired.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3876"></a>
<pre class="SCREEN">
    #
    #!/usr/bin/perl
    # update_z script:
    # Determine the options according to the format of the queue name
    #  Inspired by the psfilter code of Andreas Klemm
    #  and Thomas Bueschgens 
    # First, get command line arguments
    #
    use Getopt::Std;
    my(%args,$Q,$Zopts,@file);
    getopts(
    "A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q:R:S:T:U:V:W:X:Y:Z:" .
    "a:b:cd:e:f:g:h:i:j:k:l:m:n:o:p:q:r:s:t:u:v:w:x:y:z:",
    \%args );
    # read stdin
    @file = &lt;STDIN&gt;;
    $Zopts = "";
    # first use command line Queue name
    $Q = $args{"Q"};
    if( not $Q and (($Q) = grep(/^Q/,@file)) ){
       # next use control file Queue name
        chomp $Q if $Q;
    }
    # now we split up the name and use as parameters for Z options
    while( $Q =~ /_([^_]+)/g ){
        # you can add them or test and then add them
        if( $1 eq "landscape"
            or $1 eq "legal"
            or $1 eq "ledger" ){
            $Zopts .= ",$1"
        }
    }
    if( $Zopts ){
        # remove leading comma
        $Zopts = substr( $Zopts, 1 );
        #replace or prefix Z options
        if( not (grep { s/$/,$Zopts/ if /^Z/; } @file) ){
            print "Z" . $Zopts . "\n";
        }
    }
    print @file if( @file );
    exit 0
    
    Example Input Control file:
    
    ...
    Zover
    Qlp_landscape_ledger
    ...
    
    Modified output:
    
    ...
    Zover,landscape,ledger
    Qlp_landscape_ledger
    ...
</pre>
            </div>
            <br>
            <br>

            <p>The Perl script first uses the <code class=
            "FUNCTION">getopts</code> function to parse the command
            line options. If there is not a command line <var
            class="LITERAL">-Q</var> option then the control file
            <var class="LITERAL">Q</var> line is used after
            stripping the trailing newline. The queue name is then
            split up into parts separated by underscores (<var
            class="LITERAL">_</var>) and those used as option
            names. As shown in the example, the literal values are
            placed in the control file. You can also use the
            following code segment to translate short forms of
            options into longer ones:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN3883"></a>
<pre class="SCREEN">
    while( $Q =~ /_([^_]+)/g ){
        # you can add them or test and then add them
        Zopts .= ",landscape" if( $1 eq "ld" );
        Zopts .= ",ledger" if( $1 eq "11" );
        Zopts .= ",legal" if( $1 eq "15" );
        Zopts .= ",a4" if( $1 eq "a4" );
    }
</pre>
            </div>
            <br>
            <br>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3885">4.20. Interfacing to
          Non-LPRng Spoolers</a></h2>

          <p>Given the large number of defective RFC1179
          implementations that are currently in use, there will
          come a time when the administrator will discover that
          their printer with its built-in network interface, the
          non-UNIX based print spooler on a mainframe, or even a
          new print spooler on a new OS distribution will not
          accept jobs from the <b class="APPLICATION">LPRng</b>
          system. Usually this is caused by the presence, absence,
          or order of lines in the control file being sent to the
          remote system. To deal with this particular problem, the
          <var class="LITERAL">:bk</var>, <var class=
          "LITERAL">:control_file_line_order</var>, <var class=
          "LITERAL">:nline_after_file</var>, and <var class=
          "LITERAL">:control_filter</var> options are used.</p>

          <p>The <var class="LITERAL">:bk</var> (BSD Kompatibility)
          option causes the lpd server to remove all but an
          extremely small subset of lines from the control file,
          and to put the lines in the most commonly used order. In
          addition it will make the control and data files names
          extremely short and simple. This almost always solves
          compatibility problems when sending jobs to older <span
          class="emphasis"><i class="EMPHASIS">vintage</i></span>
          print spoolers or UNIX systems.</p>

          <p>If this does not solve the problem, then you can
          specify the allowed control file lines and their order
          using the <var class=
          "LITERAL">control_file_line_order=...</var> option. For
          example, <var class=
          "LITERAL">control_file_line_order=CJPMD</var> would allow
          only control file lines starting with <var class=
          "LITERAL">C</var>, <var class="LITERAL">J</var>, <var
          class="LITERAL">P</var>, <var class="LITERAL">M</var>,
          and <var class="LITERAL">D</var>, and this order in the
          control file. Note that this does not provide <span
          class="emphasis"><i class="EMPHASIS">missing</i></span>
          line values, it only controls line values that are
          present in the control file. You should also use the <var
          class="LITERAL">:bk</var> option as well.</p>

          <p>You might run into some <span class="emphasis"><i
          class="EMPHASIS">really</i></span> unusual
          implementations where the control file <var class=
          "LITERAL">N</var> (file name) information must come <span
          class="emphasis"><i class="EMPHASIS">after</i></span> the
          control file name. This is forced by the <var class=
          "LITERAL">:nline_after_file</var> option.</p>

          <p>If these horrible kludges do not solve your
          compatibility problems then we turn to the very large
          hammer and edit the control file. The very last step
          before transfering the control file to the remote server
          is to filter it using the <var class=
          "LITERAL">:control_filter=/path</var> program specified
          in the printcap. The <var class=
          "LITERAL">:control_filter</var> reads the control file
          from <acronym class="ACRONYM">STDIN</acronym> and writes
          the modified control file to <acronym class=
          "ACRONYM">STDOUT</acronym>. No consistency checking or
          validity checks are done on the new control file and the
          result is transferred directly to the remote system. If
          the <var class="LITERAL">:control_filter</var> exits with
          a 0 status, then the normal processing continues. Any
          other status will cause the transfer operation to be
          aborted and an error reported.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN3917">4.21. Debugging,
          Tracing, and Log Files</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> software was
          designed and written to provide as high a level of
          diagnostic information as possible. This was largely in
          part due to the problems with portability, coding errors,
          and other human frailties. Approximately 80% of the <b
          class="APPLICATION">LPRng</b> source code concerns itself
          with checking return values from system functions and
          producing error messages, debugging and tracing
          information, and various facilities used for regression
          testing and diagnosis.</p>

          <p>The approach used by <b class="APPLICATION">LPRng</b>
          is to produce <span class="emphasis"><i class=
          "EMPHASIS">trace</i></span> output for the <b class=
          "APPLICATION">LPRng</b> clients or <span class=
          "emphasis"><i class="EMPHASIS">log</i></span> files for
          the <b class="APPLICATION">lpd</b> server that show the
          various events or flow of information through the <b
          class="APPLICATION">LPRng</b> system. There are several
          classes or types of actions that can be traced, and
          various levels of trace information generated. The
          interface used to control these actions are the command
          line <var class="LITERAL">-D literals</var> flags and the
          <tt class="COMMAND">lpc debug</tt> command.</p>

          <p>First, we will look at how you can use the debugging
          facilities for the clients. Enter the following
          commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3932"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {292} %</samp> <kbd class=
"USERINPUT">lpr -D=</kbd>
    debug usage: -D [ num | key=num | key=str | flag | flag@ | flag+N ]*
      keys recognized: network[+N,@], database[+N,@], lpr[+N,@],
       lpc[+N,@], lprm[+N,@], lpq[+N,@], test=num, job=num, log[+N,@]
    <samp class="PROMPT">h4: {293} %</samp> <kbd class=
"USERINPUT">lpr -V /tmp/hi</kbd>
    LPRng-3.7.2, Copyright 1988-2000 Patrick Powell, &lt;papowell@lprng.com&gt;
    sending job 'papowell@h4+981' to lp@localhost
    connecting to 'localhost', attempt 1
    connected to 'localhost'
    requesting printer lp@localhost
    sending control file 'cfA981h4.private' to lp@localhost
    completed sending 'cfA981h4.private' to lp@localhost
    sending data file 'dfA981h4.private' to lp@localhost
    completed sending 'dfA981h4.private' to lp@localhost
    done job 'papowell@h4+981' transfer to lp@localhost
    <samp class="PROMPT">h4: {294} %</samp> <kbd class=
"USERINPUT">lpr -D1 /tmp/hi</kbd>
    09:38:08.707 h4 [13991] lpr  Get_printer: original printer '&lt;NULL&gt;'
    09:38:08.708 h4 [13991] lpr  Get_all_printcap_entries: starting
    09:38:08.708 h4 [13991] lpr  Select_pc_info: looking for 'all', depth 0
    09:38:08.708 h4 [13991] lpr  Select_pc_info: returning '&lt;NULL&gt;'
    09:38:08.708 h4 [13991] lpr  Select_pc_info: looking for '*', depth 0
    09:38:08.708 h4 [13991] lpr  Select_pc_info: returning '&lt;NULL&gt;'
    09:38:08.708 h4 [13991] lpr  Dump_line_list: Get_all_printcap_entries
    ...
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpr -D=</tt> causes the <b
          class="APPLICATION">lpr</b> (and other <b class=
          "APPLICATION">LPRng</b> programs) to show what debugging
          flags are available. The <tt class="COMMAND">lpr -V</tt>
          flag causes <b class="APPLICATION">lpr</b> to run in
          verbose mode and show its activities. Finally, we use <tt
          class="COMMAND">lpr -D1</tt> to enable the simplest level
          of debugging. This will produce a trace of the various
          activities that <b class="APPLICATION">lpr</b> carries
          out. Try <tt class="COMMAND">lpr -D2</tt>, <tt class=
          "COMMAND">lpr -D3</tt>, and so forth to see the
          increasing amount of detail that you get.</p>

          <p>The <span class="emphasis"><i class=
          "EMPHASIS">network</i></span> and <span class=
          "emphasis"><i class="EMPHASIS">database</i></span> debug
          flags turn on debugging for the network facilities and
          the database (<tt class="FILENAME">lpd.conf</tt>, <tt
          class="FILENAME">printcap</tt>, and <tt class=
          "FILENAME">lpd.perms</tt>) lookups. Lets see what <tt
          class="COMMAND">lpr -Dnetwork</tt> shows us:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3957"></a>
<pre class="SCREEN">
    C<samp class="PROMPT">h4: {295} %</samp> <kbd class=
"USERINPUT">lpr -Dnetwork /tmp/hi</kbd>
    lp: getconnection: START host localhost, timeout 10, connection_type 1
    lp: getconnection: fqdn found localhost.private, h_addr_list count 1
    lp: Link_dest_port_num: port 2000 = 2000
    lp: getconnection: sock 3, src ip 127.0.0.1, port 65209
    lp: getconnection: dest ip 127.0.0.1, port 2000
    lp: getconnection: connection to 'localhost' sock 3, errmsg 'No Error'
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^Blp
    ', count 4, ack 0x80447a0
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^B135 cfA276h4.private
    ', count 22, ack 0x8044370
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str 'Hh4.private
    Ppapowell
    J/tmp/hi
    CA
    Lpapowell
    Apapowell@h4+276
    D2000-06-02-09:44:52.369
    Qlp
    N/tmp/hi
    fdfA276h4.private
    UdfA276h4.private
    ', count 136, ack 0x8044370
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '^C3 dfA276h4.private
    ', count 20, ack 0x8044310
    lp: Link_send: final status NO ERROR
    lp: Link_send: host 'localhost' socket 3, timeout 6000
    lp: Link_send: str '', count 1, ack 0x8044310
    lp: Link_send: final status NO ERROR
</pre>
          </div>
          <br>
          <br>

          <p>As we see, we get a detailed exposition of the network
          connection and transfer steps. If you need or want more
          detail, try using <tt class="COMMAND">lpr
          -Dnetwork+2</tt> or <tt class="COMMAND">lpr
          -Dnetwork+3</tt>. You may want to try <tt class=
          "COMMAND">lpr -Ddatabase</tt> and observe the actions of
          the <b class="APPLICATION">lpr</b> program as it extracts
          information from the <tt class="FILENAME">lpd.conf</tt>
          and <tt class="FILENAME">printcap</tt> files. If you need
          or want more detail, try using <tt class="COMMAND">lpr
          -Ddatabase+2</tt> or <tt class="COMMAND">lpr
          -Ddatabase+3</tt>.</p>

          <p>If you need to trace the activities of the <b class=
          "APPLICATION">lpd</b> server, it becomes a little more
          complex. The lpd server has a single <span class=
          "emphasis"><i class="EMPHASIS">listening</i></span>
          process that forks and creates individual processes to
          handle incoming requests. Debug or diagnose the main
          process actions by using <tt class="COMMAND">lpd
          -D...</tt>. You may also want to use <tt class=
          "COMMAND">lpd -F</tt> to keep the server in the
          foreground so you can kill it off easily. Needless to
          say, you should also redirect the <acronym class=
          "ACRONYM">STDERR</acronym> and <acronym class=
          "ACRONYM">STDOUT</acronym> so that it goes to a file so
          that you can examine the voluminous records at your
          leisure. The following shows a typical main <b class=
          "APPLICATION">lpd</b> process debugging session using the
          C Shell.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN3978"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {296} %</samp> <kbd class=
"USERINPUT">lpd -F -D1 &gt;&amp;/tmp/logfile &amp;</kbd>
    [2] 14299
    <samp class="PROMPT">h4: {297} %</samp> <kbd class=
"USERINPUT">tail -f /tmp/logfile</kbd>
    2000-06-02-09:53:39.716 h4 [1200] Waiting Read_server_status: \
                             select status 1
    2000-06-02-09:53:39.716 h4 [1200] Waiting Read_server_status: \
                             read status 1
    2000-06-02-09:53:39.716 h4 [1200] Waiting Dump_line_list: \
        Read_server_status - input - 0x8047980, count 0, max 0, list 0x0
    2000-06-02-09:53:39.716 h4 [1200] Waiting Read_server_status: \
                             select status 0
    2000-06-02-09:53:39.716 h4 [1200] Waiting lpd: LOOP START
    2000-06-02-09:53:39.716 h4 [1200] Waiting Get_max_servers: \ 
                             getrlimit returns 64
    2000-06-02-09:53:39.716 h4 [1200] Waiting Get_max_servers: \
                             returning 32
    2000-06-02-09:53:39.716 h4 [1200] Waiting lpd: \
                             max_servers 32, active 0
    2000-06-02-09:53:39.716 h4 [1200] Waiting lpd: \
                             starting select timeout 'yes'
    
    ^C
    <samp class="PROMPT">h4: {298} %</samp> <kbd class=
"USERINPUT">jobs</kbd>
    [1]  - Running                lpd -F -D1 &gt;&amp; /tmp/logfile
    <samp class="PROMPT">h4: {299} %</samp> <kbd class=
"USERINPUT">kill %1</kbd>
</pre>
          </div>
          <br>
          <br>

          <p>We start the debugging session by running the <b
          class="APPLICATION">lpd</b> server in foreground mode.
          This causes it to send its output to <acronym class=
          "ACRONYM">STDOUT</acronym> and <acronym class=
          "ACRONYM">STDERR</acronym>. We redirect both of these to
          a file and put the <b class="APPLICATION">lpd</b> server
          in the background. Then we use <tt class="COMMAND">tail
          -f</tt> to read from the log file. Finally, we kill off
          the <b class="APPLICATION">lpd</b> server.</p>

          <p>This method is extremely difficult to use, as all of
          the output produced by the server and its subprocesses is
          sent to a single output file. If we want to debug the
          actions concerning a single queue, then we can use the
          queue <span class="emphasis"><i class="EMPHASIS">log
          file</i></span> and <tt class="COMMAND">lpc debug</tt>
          command instead. The following options control debugging
          of an individual print queue.</p>

          <div class="VARIABLELIST">
            <dl>
              <dt>lf=log</dt>

              <dd>
                <p>The log file for the queue. The queue server
                process will open this file and place debugging
                information into this file.</p>
              </dd>

              <dt>max_log_file_size=nnn</dt>

              <dd>
                <p>The maximum size of the log file in K bytes.
                When the queue server process first opens this file
                it will check to see if the file is larger than the
                maximum size. If it is, then it will truncate it. A
                zero (0) value suppress truncation.</p>
              </dd>

              <dt>min_log_file_size=nnn</dt>

              <dd>
                <p>When the log file is truncated only the the last
                nnn K bytes are retained.</p>
              </dd>

              <dt>db=options</dt>

              <dd>
                <p>These are debugging options for the spool queue.
                These options are permanent and cannot be changed
                by using the <tt class="COMMAND">lpc debug</tt>
                facility.</p>
              </dd>
            </dl>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpc debug</tt> command is used
          to set the debugging options in force for the spool
          queue. This is done by writing the debug options into the
          spool queue control file. Let us see how we can use this
          facility to trace the actions of printing a file.</p>

          <p>Edit the printcap file so it have the contents
          indicated below, create the <tt class=
          "FILENAME">/tmp/lp</tt> and <tt class=
          "FILENAME">/tmp/lp2</tt> files with <var class=
          "LITERAL">0777</var> permissions. Use <tt class=
          "COMMAND">checkpc -f</tt> to check the printcap, and then
          use <tt class="COMMAND">lpc reread</tt> to restart the <b
          class="APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4025"></a>
<pre class="SCREEN">
    # printcap
    lp:force_localhost
    lp:server
      :lp=/dev/null
      :sd=/var/spool/lpd/%P
      :lf=log
    lp2:force_localhost
    lp2:server
      :sd=/var/spool/lpd/%P
      :lp=/tmp/lp2
      :lf=log
</pre>
          </div>
          <br>
          <br>

          <p>Now execute the following commands:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4028"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {300} %</samp> <kbd class=
"USERINPUT">lpq</kbd>
    Printer: lp@h4
     Queue: no printable jobs in queue
    <samp class="PROMPT">h4: {301} %</samp> <kbd class=
"USERINPUT">lpc debug lp 1</kbd>
    Printer: lp@h4
    debugging override set to '1'
    lp@h4.private: updated
    <samp class="PROMPT">h4: {302} %</samp> <kbd class=
"USERINPUT">lpc status</kbd>
     Printer Printing Spooling Jobs Server Subserver Redirect Status/(Debug)
    lp@h4    enabled  enabled    0    none    none          (1)
    <samp class="PROMPT">h4: {303} %</samp> <kbd class=
"USERINPUT">lpr /tmp/hi</kbd>
    <samp class="PROMPT">h4: {304} %</samp> <kbd class=
"USERINPUT">more /var/spool/lpd/lp2/log</kbd>
    2000-06-02-10:10:50.589 h4 [1201] (Server) lp: \
       Update_spool_info: printer 'lp'
    2000-06-02-10:10:50.590 h4 [1201] (Server) lp: \
       Do_queue_jobs: printable 1, held 0, move 0
    2000-06-02-10:10:50.590 h4 [1201] (Server) lp: \
       Do_queue_jobs: after Scan_queue next fd 5
    2000-06-02-10:10:50.590 h4 [1201] (Server) lp: \
       Do_queue_jobs: MAIN LOOP
    2000-06-02-10:10:50.590 h4 [1201] (Server) lp: \
       Do_queue_jobs: Susr1 before scan 0
    2000-06-02-10:10:50.591 h4 [1201] (Server) lp: \
       Do_queue_jobs: chooser '&lt;NULL&gt;', chooser_routine 0
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpc debug</tt> command sets
          the debug level to 1. We can use the <tt class=
          "COMMAND">lpc status</tt> command to see what debug flags
          or actions are currently specified for the spool queue.
          We then send a job to the spool queue and examine the log
          file contents.</p>

          <p>Each line in the log file has a timestamp, the name of
          the host, the process id that produced it, and a heading
          that tells the action or activity that the process is
          performing, and the name of the print queue that is being
          processed and a trace message. By convention, the trace
          message lists the name of the routine that processed it
          and then the actual information. Some messages may extend
          over several lines, but each line has the standard header
          at the start of the line.</p>

          <p>The default debug or trace actions were designed to
          trace problems with printing, as these are the most
          common. However, you can also use the <b class=
          "APPLICATION">lpr</b>, <b class="APPLICATION">lpc</b>, <b
          class="APPLICATION">lprm</b>, or <b class=
          "APPLICATION">lpq</b> option to cause the <b class=
          "APPLICATION">lpd</b> server to trace the actions during
          the execution of an <b class="APPLICATION">lpr</b>, <b
          class="APPLICATION">lpc</b>, <b class=
          "APPLICATION">lprm</b>, or <b class="APPLICATION">lpq</b>
          request.</p>

          <p>The <span class="emphasis"><i class=
          "EMPHASIS">log</i></span> option is used to test various
          logging facilities and is usually not used for general
          purpose debugging.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="LPRNGCLIENTS"></a>Chapter 5. <b class=
        "APPLICATION">LPRng</b> Clients - lpr, lprm, lpq, lpc,
        lpstat</h1>

        <p>The <b class="APPLICATION">LPRng</b> software is a true
        set of client/server applications. The <b class=
        "APPLICATION">LPRng</b> clients, <b class=
        "APPLICATION">lpr</b>, <b class="APPLICATION">lpq</b>, <b
        class="APPLICATION">lprm</b>, and <b class=
        "APPLICATION">lpc</b> connect to a <b class=
        "APPLICATION">lpd</b> server using a TCP/IP connection.
        This means that you must have TCP/IP networking enabled on
        your workstation to use <b class=
        "APPLICATION">LPRng</b>.</p>

        <p>However, you do not need to have an external network
        connection to the Internet. For most single system users,
        the <b class="APPLICATION">lpd</b> server is running on the
        same workstation as the client program, and the clients
        will simply talk to the <var class=
        "LITERAL">localhost</var>.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTERINFO">5.1. Printer and
          Server Information</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="ENVAR">PRINTER</var>, <var class=
              "ENVAR">LPDEST</var>, <var class=
              "ENVAR">NPRINTER</var> <var class=
              "ENVAR">NGPRINTER</var> <span class="emphasis"><i
              class="EMPHASIS">Environment variables</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">force_localhost</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">force
              clients to send requests to localhost</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">require_explicit_q</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">require
              queue to be specified</i></span></p>
            </li>
          </ul>
          &#13;<br>
          <br>

          <p>When an <b class="APPLICATION">LPRng</b> client such
          as <b class="APPLICATION">lpr</b>, <b class=
          "APPLICATION">lpq</b>, <b class="APPLICATION">lprm</b>,
          or <b class="APPLICATION">lpc</b> needs to communicate
          with a print server, the only information they normally
          need is:</p>

          <ol type="1">
            <li>
              <p>The remote printer (<var class=
              "LITERAL">:rp</var>) value to be used in requests to
              the <b class="APPLICATION">lpd</b> print server. This
              is sometimes referred to as the <span class=
              "emphasis"><i class="EMPHASIS">printer</i></span> or
              <span class="emphasis"><i class="EMPHASIS">print
              queue</i></span> name.</p>
            </li>

            <li>
              <p>The remote server (<var class="LITERAL">:rm</var>)
              which is the The IP address or hostname of the <span
              class="emphasis"><i class="EMPHASIS">print
              server</i></span>.</p>
            </li>

            <li>
              <p>The original queue name specified by the user
              which may be used as part of the job information sent
              to the print server.</p>
            </li>
          </ol>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> has several ways to
          specify the <span class="emphasis"><i class=
          "EMPHASIS">printer queue</i></span> and <span class=
          "emphasis"><i class="EMPHASIS">server</i></span>
          information.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4113">5.2. Command Line
          -Pprinter@host</a></h2>

          <p>The <var class="LITERAL">-P printer@host</var> literal
          explicitly provides a printer and server value. This is
          equivalent to the printcap entry shown below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4117"></a>
<pre class="SCREEN">
    lpr -Plaser@10.0.0.1
      equivalent to printcap entry:
        laser:lp=laser@10.0.0.1
    lpq -Plp@myserver
      equivalent to printcap entry:
        lp:lp=lp@myserver
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4119">5.3. Command Line
          -Pprinter</a></h2>

          <p>Use the printcap entry with the name or alias <var
          class="LITERAL">printer</var> and use the information in
          that printcap entry. Example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4123"></a>
<pre class="SCREEN">
    lpr -Plp
      look up printcap entry for 'lp'
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4125">5.4. PRINTER, LPDEST,
          NPRINTER, and NGPRINTER Environment Variables</a></h2>

          <p>If no command line option is specified, the <b class=
          "APPLICATION">LPRng</b> clients will use the first
          defined <acronym class="ACRONYM">PRINTER</acronym>,
          <acronym class="ACRONYM">LPDEST</acronym>, <acronym
          class="ACRONYM">NPRINTER</acronym>, or <acronym class=
          "ACRONYM">NGPRINTER</acronym> environment variable value
          and will use the value as though specified as a <var
          class="LITERAL">-P$PRINTER</var> command line literal. If
          the value has the form <var class=
          "LITERAL">-Pprinter@host</var> the print queue will be
          <var class="LITERAL">printer</var> on server <var class=
          "LITERAL">host</var> and not consult the printcap
          database. If the value has the form <var class=
          "LITERAL">printer</var> then the printcap will be
          searched for a <var class="LITERAL">printer</var>
          printcap entry. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4139"></a>
<pre class="SCREEN">
    export PRINTER=laser@10.0.0.1; lpr
      equivalent to printcap entry:
        laser:lp=laser@10.0.0.1
    export PRINTER=pr; lpr
      look up printcap entry for 'lp'
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4141">5.5. Wildcard
          Printcap Entry</a></h2>

          <p>If you specify a printcap name or alias as <var class=
          "LITERAL">*</var> (wildcard), then if the <b class=
          "APPLICATION">LPRng</b> system cannot find a printcap
          with the exact name then the first matching wildcard will
          be used. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4146"></a>
<pre class="SCREEN">
    pr|*:rm=server
      lpr -Ppr2 will match, and result in a printcap entry
        pr|pr2:rm=server
    
    *|pr:rm=server
      lpr -Ppr2 will match, and result in a printcap entry
        pr2|pr:rm=server
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4148">5.6. First Printcap
          Entry</a></h2>

          <p>If you do not specify a printer on the command line or
          in the environment variables, and the <var class=
          "LITERAL">require_explicit_q</var> value is not set then
          <b class="APPLICATION">LPRng</b> will search the printcap
          and use the first valid printcap entry as the printer. It
          will use the first one found as the default.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="DEFAULTRMRP">5.7. Default
          Printer and Server Host</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class=
              "LITERAL">default_remotehost=</var><span class=
              "emphasis"><i class="EMPHASIS">default rm (remote
              host)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">default_printer=</var><span
              class="emphasis"><i class="EMPHASIS">default rp
              (remote printer)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>If the preceding steps do not yield a printer name and
          the <var class="LITERAL">require_explicit_q</var> flag is
          not set then the <var class=
          "LITERAL">default_printer</var> and <var class=
          "LITERAL">default_remote_host</var> values from the <tt
          class="FILENAME">lpd.conf</tt> configuration file will be
          used. If there is no configuration file, then the compile
          time defaults will be used.</p>

          <p>Using the fallback values is usually not a desirable
          event and may indicate that you have a misconfigured
          host, so the compile time defaults are usually set to
          <var class="LITERAL">missingprinter@localhost</var> to
          provide an annoying message for users.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="FORCELOCALHOST">5.8. Force
          Connection to Localhost</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">force_localhost</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">force
              localhost to be remote host</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The legacy BSD print spooler required an <b class=
          "APPLICATION">lpd</b> print server to be running on each
          host. During the initial stages of development and
          deployment, the default <b class="APPLICATION">LPRng</b>
          configuration and deployment was to always allow <span
          class="emphasis"><i class=
          "EMPHASIS">lightweight</i></span> operation, that is,
          clients would always connect to the remote host specified
          in the printcap.</p>

          <p>While this default was appropriate for experienced
          system administrators, novice administrators or those who
          had already configured print spooling systems and simply
          wanted to upgrade found themselves confused by this
          change. This problem resulted in over 700 postings to the
          <b class="APPLICATION">LPRng</b> mailing list in a five
          year period.</p>

          <p>This problem was solved by providing a <var class=
          "LITERAL">force_localhost</var> option in the
          configuration, and setting the default value to <var
          class="LITERAL">1</var> or <acronym class=
          "ACRONYM">TRUE</acronym>. When this option is <acronym
          class="ACRONYM">TRUE</acronym>, then all <b class=
          "APPLICATION">LPRng</b> clients will connect to the
          server on the localhost, <span class="emphasis"><i class=
          "EMPHASIS">unless</i></span> they use the <tt class=
          "COMMAND">lpr -Pserver@host</tt> command line form. If
          lightweight operation is wanted, the administrator can
          either compile the <b class="APPLICATION">LPRng</b>
          software with the appropriate value or can explicitly set
          the <var class="LITERAL">force_localhost@</var> flag.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4196"></a>
<pre class="SCREEN">
    # default:
    lp:lp=lp@10.0.0.1:...
      lpr -Plp -&gt;
        lp:lp=lp@localhost:...
      lpr -Plp@10.0.0.1 -&gt;
        lp:lp=lp@10.0.0.1  (no other options)
    
    lp:lp=lp@10.0.0.1:force_localhost@:...
      lpr -Plp -&gt;
        lp:lp=lp@10.0.0.1:...
    
    To disable at compile time:
      configure --disable-force_localhost
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="ALLOWUSERSETTING">5.9. User
          Identification</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class=
              "LITERAL">allow_user_setting=</var><span class=
              "emphasis"><i class="EMPHASIS">privileged
              users</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>When an client program sends a command to the <b
          class="APPLICATION">lpd</b> server it may need to provide
          the name of the user who is originating the request for
          service. This name is obtained by looking up the UID of
          the user running the client in the appropriate user
          information database; if the information is not found the
          UID is used instead. Also, the client machine hostname
          may also be needed. This is usually determined by using a
          DNS lookup and trying to determine if there is a
          canonical or Fully Qualified Domain Name for the host and
          using this.</p>

          <p>The <tt class="COMMAND">lpr -U name@host</tt> (and for
          <b class="APPLICATION">lpq</b>, <b class=
          "APPLICATION">lprm</b>, and <b class=
          "APPLICATION">lpc</b>) option allows privileged users to
          cause the client software to use the <var class=
          "LITERAL">name</var> value as the originator and <var
          class="LITERAL">host</var> as the machine name. This
          allows privileged users to <span class="emphasis"><i
          class="EMPHASIS">impersonate</i></span> other users. This
          is most useful for programs such as Samba and PCNFS,
          which need to act as proxies for users.</p>

          <p>By default, ROOT (UID 0) is the only user that can
          masquerade as another user. The <var class=
          "LITERAL">allow_user_setting=name,name...</var>
          configuration option can be used to specify a list of
          names or UIDs that can also perform masquerading. For
          example, if the Samba server was running as user <var
          class="LITERAL">samba</var>, then <var class=
          "LITERAL">allow_user_setting=samba</var> would allow it
          to specify the name of print job originator as a remote
          user, and the remote user would not need a login account
          on the system.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="LPR"></a>Chapter 6. <b class=
        "APPLICATION">lpr</b> - Job Spooler Program</h1>

        <p>The <b class="APPLICATION">lpr</b> client program is
        used to submit a job to a print spooler. It does this by
        collecting information about the job, putting it in a
        control file, and then sending the control file and files
        to be printed to the print server. The <b class=
        "APPLICATION">lpr</b> command line options are used to
        control or specify the values placed in the control file
        and how the job is to be transferred to the remote host. In
        addition, there are printcap or configuration level options
        that provide a further degree of administrative control
        over additional facilities. You can get the currently
        supported command line options by using the following
        command:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN4226"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {305} %</samp> <kbd class=
"USERINPUT">lpr -=</kbd>
    lpr: Illegal option '='
     usage summary: lpr [-Pprinter[@host]] [-A] [-B] [-Cclass] [-Fformat]
       [-Jinfo] [-(K|#)copies] [-Q] [-Raccountname]  [-Ttitle]
       [-Uuser[@host]] [-V] [-Zoptions] [-b] [-m mailaddr] [-h]
       [-i indent] [-l] [-w num ] [-r] [-Ddebugopt ] [ filenames ...  ]
     -A          - use authentication specified by AUTH environment variable
     -B          - filter job before sending
     -C class    - job class
     -D debugopt - debugging flags
     -F format   - job format
       -b,-l        - binary or literal format
        c,d,f,g,l,m,p,t,v are also format options
     -J info     - banner and job information
     -K copies, -# copies   - number of copies
     -P printer[@host] - printer on host
     -Q          - put 'queuename' in control file
     -Raccntname - accounting information
     -T title    - title for 'pr' (-p) formatting
     -U username - override user name (restricted)
     -V          - Verbose information during spooling
     -Z options  - options to pass to filter
     -h          - no header or banner page
     -i indent   - indentation
     -m mailaddr - mail final status to mailaddr
     -r          - remove files after spooling
     -w width    - width to use
     PRINTER, NPRINTER environment variables set default printer.
</pre>
        </div>
        <br>
        <br>

        <p>If you are interested in the exact details of the job
        transfer, control file, and data file formats, please see
        <a href="#RFC1179REF">RFC 1179 - Line Printer Daemon
        Protocol</a> for the exact details.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="DEFAULTFORMAT">6.1. Job Format
          Options</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">default_format=</var><span
              class="emphasis"><i class="EMPHASIS">default print
              job format (f)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">fx=</var><span class=
              "emphasis"><i class="EMPHASIS">supported formats for
              printing</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The legacy or vintage BSD print spooling system
          assigned each job a format. This format was used by the
          <b class="APPLICATION">lpd</b> server to select an
          appropriate filter program that would process the job and
          format it correctly for the printer. By convention, lower
          case letters were used to specify job formats.</p>

          <p>The <b class="APPLICATION">LPRng</b> <b class=
          "APPLICATION">lpr</b> client supports the legacy or
          vintage BSD formats, and also provides the <var class=
          "LITERAL">-Fx</var> literal to allow addition formats to
          be specified. If a format is specified the <var class=
          "LITERAL">default_format</var> value (usually <var class=
          "LITERAL">f</var>) is used. The <var class=
          "LITERAL">fx=...</var> option value is a list of the
          (lower case) characters corresponding to the formats
          allowed for a spool queue. For example, <var class=
          "LITERAL">fx=flv</var> would allow only jobs with format
          <var class="LITERAL">f</var>, <var class=
          "LITERAL">l</var>, or <var class="LITERAL">v</var> to be
          spooled to a queue. By default, all job formats are
          allowed.</p>

          <p>A couple of job formats that require special
          treatment: the <var class="LITERAL">b</var> (binary) and
          its alias the <var class="LITERAL">l</var> (literal)
          format, and the <var class="LITERAL">p</var> (pretty
          print) format. The <var class="LITERAL">-b</var> or <var
          class="LITERAL">-l</var> command line literal will select
          job format <var class="LITERAL">l</var> (literal) for the
          job. By default, jobs marked with <var class=
          "LITERAL">l</var> format are supposed to have a minimum
          amount of handling and passed directly to a printer. The
          <var class="LITERAL">p</var> (pretty print) format is
          just the opposite - these jobs are supposed to be pretty
          printed according to the various facilities available to
          the <b class="APPLICATION">lpd</b> print spooler.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4267">6.2. Job Pretty
          Printing, Banners, Priority, and Accounting</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">ab</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">always print
              banner</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sh</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">suppress header
              (banner)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The legacy or vintage BSD pretty printing facility
          support allowed users to specify the title (<var class=
          "LITERAL">-T title</var>), indentation (<var class=
          "LITERAL">-i indent</var>), width (<var class=
          "LITERAL">-i indent</var>) of output for pretty printing.
          These probably will not have any effect, but their values
          are placed in the control file and sent to the <b class=
          "APPLICATION">lpd</b> server.</p>

          <p>The job name (<var class="LITERAL">-J name</var>) and
          no banner page (<var class="LITERAL">-h</var>) literals
          also cause information to be placed in the control file.
          The <var class="LITERAL">-J</var> value is used to
          specify a job name on a banner page, and is placed in the
          control file. The <var class="LITERAL">-h</var> (no
          header) has the strange effect of <span class=
          "emphasis"><i class="EMPHASIS">not</i></span> putting
          <span class="emphasis"><i class="EMPHASIS">banner
          name</i></span> information in the control file.
          Apparently, if you do not have a name for your banner
          then no name will be sent.</p>

          <p>If the <var class="LITERAL">:sh</var> option is
          explicitly specified in a printcap entry for the <b
          class="APPLICATION">lpr</b> client, then it has the
          effect of the <var class="LITERAL">-h</var> literal.
          However, the <var class="LITERAL">:ab</var> (Always Print
          Banner) option can be used on the print server to always
          force a banner to be printed even if the user does not
          specify a banner.</p>

          <p>Finally, the <var class="LITERAL">-R</var> literal
          allows additional accounting information to be placed in
          the control file.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CLASSPRIORITY">6.3. Job Class
          and Priority</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class=
              "LITERAL">break_classname_priority_link</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">classname
              does not set priority</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">default_priority=</var><span
              class="emphasis"><i class="EMPHASIS">default
              priority</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">ignore_requested_user_priority</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">ignore
              requested user priority</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">-Cclass</var> information is
          used placed in the control file; the default class and
          priority is set by the <var class=
          "LITERAL">default_priority</var> option (default <var
          class="LITERAL">A</var>). The first letter of the class
          information is uppercased and then used as the job
          priority.</p>

          <p>The <var class=
          "LITERAL">break_classname_priority_link</var> option
          causes <b class="APPLICATION">lpr</b> to place class
          information in the control file but not to use it to set
          the job priority. This is usually used in institutions
          where users should not specify their priority. Finally,
          the <var class=
          "LITERAL">ignore_requested_user_priority</var> is
          actually used by <b class="APPLICATION">lpd</b> to ignore
          the priority requested by users.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBCOPIES">6.4. Job Copies and
          Job Size</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">mc=</var><span class=
              "emphasis"><i class="EMPHASIS">maximum number of
              copies</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">mx=</var><span class=
              "emphasis"><i class="EMPHASIS">maximum job size
              (Kbytes)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">:mc</var> (maximum number of
          copies) and <var class="LITERAL">:mx</var> (maximum job
          size) options are used by both the <b class=
          "APPLICATION">lpr</b> and <b class="APPLICATION">lpd</b>
          programs. The <tt class="COMMAND">lpr -Kn</tt> or <tt
          class="COMMAND">lpr -#n</tt> option sets the numbers of
          copies wanted to <var class="LITERAL">n</var>; if this is
          larger than the <var class="LITERAL">:mc</var> value then
          the <b class="APPLICATION">lpr</b> client will not print
          the job and the <b class="APPLICATION">lpd</b> server
          will discard the job with an error. The job size is the
          product of the number of copies and the sum of the
          individual file sizes. This is, in effect, the total
          number of bytes to be transferred to the printer. If the
          job size is larger than the <var class=
          "LITERAL">:mx</var> limit, then the <b class=
          "APPLICATION">lpr</b> client will not print the job and
          the <b class="APPLICATION">lpd</b> server will discard
          the job with an error.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBCOMPLETION">6.5. Job
          Completion Notification Requested</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">allow_user_logging</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">users can
              send status</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpr_bsd</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">lpr -m acts as
              legacy BSD flag</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpr -m mailaddr</tt> option
          will put the specified mailaddr value into the control
          file. How this is processed is left to the particular
          server implementation. See the <a href=
          "#ABNORMALTERM">Abnormal Termination</a> section for
          details.</p>

          <p><b class="APPLICATION">LPRng</b> extends the <tt
          class="COMMAND">lpr -m mailaddr</tt> to allow mail
          addresses of the form <var class=
          "LITERAL">host[%port][/(TCP|UPD)]</var>, and when the job
          is being transferred or printed the <b class=
          "APPLICATION">lpd</b> server to open a connection to the
          specified TCP/IP address and send job progress
          information. This is a security loophole and the <var
          class="LITERAL">allow_user_logging</var> flag must be
          present to allow this operation.</p>

          <p>The <var class="LITERAL">lpr_bsd</var> will cause the
          <tt class="COMMAND">lpr -m</tt> option not to take an
          argument, as in the BSD lpr, and will place the users
          name and host information in the control file as the
          destination for notification.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4373">6.6. Remove Files
          After Spooling</a></h2>

          <p>The <tt class="COMMAND">lpr -r</tt> option is
          extremely dangerous and has proven to be fatal to a large
          number of system administrators, so it should be used
          with caution. Unfortunately, it is used in a large number
          of shell scripts and by default in a vast number of
          programs so it is present in the <b class=
          "APPLICATION">LPRng</b> software.</p>

          <p>Its action is quite simple. After sending the print
          job to the spooler, it will try to unlink the original
          files. It will do the unlinking operation as the original
          user, but if the original user had permissions to remove,
          say, <tt class="FILENAME">/etc/password</tt>, then the
          file will be removed.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="APPEND-Z">6.7. The -Z
          Passthrough to Filter Options</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">append_z=</var><span class=
              "emphasis"><i class="EMPHASIS">Append values to Z
              options list</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">prefix_z=</var><span class=
              "emphasis"><i class="EMPHASIS">Prefix values to Z
              options list</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">remove_z=</var><span class=
              "emphasis"><i class="EMPHASIS">Remove values from Z
              options list</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">prefix_s_to_z</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Prefix
              control file S to Z information</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">prefix_s_to_z</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Prefix
              control file Z to S information</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>By convention all of the values specified with the <tt
          class="COMMAND">lpr -Z</tt> option are placed in the job
          control file and passed to the <b class=
          "APPLICATION">lpd</b> server, which turn passes them to
          the print filters. This allows users to pass options that
          are not part of the RFC1179 repetoire to filters.</p>

          <p>In addition to this simple method of providing
          options, we can have the <b class="APPLICATION">lpr</b>
          and <b class="APPLICATION">lpd</b> systems add options to
          the control file information. The <var class=
          "LITERAL">prefix_z</var> and <var class=
          "LITERAL">append_z</var> options allow us to put Z
          options at the start or end of the user provided list;
          the <var class="LITERAL">remove_z</var> removes specified
          options from the list.</p>

          <p>The <var class="LITERAL">prefix_s_to_z</var> and <var
          class="LITERAL">prefix_z_to_s</var> options are usually
          used by the <b class="APPLICATION">lpd</b> server, and
          provides a simple way to have the SystemV <tt class=
          "COMMAND">lp -o option</tt> values put into the <var
          class="LITERAL">Z</var> options value. This is very
          useful when existing SysV <b class="APPLICATION">lp</b>
          print spooling systems need to be interfaced to <b class=
          "APPLICATION">LPRng</b> and the options need to be
          handled in a meaningful manner. The <var class=
          "LITERAL">prefix_z_to_s</var> is similarly used when you
          want to forward jobs to a SysV spooling system and have
          the options passed correctly.</p>

          <p>If present in the printer configuration, the various
          requested actions are are done by the <b class=
          "APPLICATION">lpr</b> client, the <b class=
          "APPLICATION">lpd</b> server on job reception, and the <b
          class="APPLICATION">lpd</b> server again on job
          processing. This redundancy ensures that jobs which are
          sent to this queue, arrive at this queue, or are
          processed by this queue have the options set
          appropriately.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="QQ">6.8. Record Queue Name in
          Control File</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">qq</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Insert queue name into
              control file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">force_queuename=</var><span
              class="emphasis"><i class="EMPHASIS">Queuename to be
              used</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">:qq</var> use queuename
          option tells <b class="APPLICATION">LPRng</b> to record
          the queue name that a job was originally queued to in the
          control file as the <var class="LITERAL">Q</var>
          information. The <var class=
          "LITERAL">force_queuename=...</var> entry forces the
          queue name to be the specified value. For example, the
          following printcap entry and <b class=
          "APPLICATION">lpr</b> commands will result in a filter
          being passed the arguments shown below.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4444"></a>
<pre class="SCREEN">
    #printcap
      pr1_landscape|pr1_portrait|pr_raw
       :filter=/.../filter
       :lp=/dev/pr
       :qq
    
    lpr -Ppr1_landscape      lpr -Ppr1_portrait
      control file -
        Qpr1_landscape          Qpr1_portrait
    
    filter command line:
      ... -Qpr1_landscape     ... -Qpr1_portrait
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">force_queuename</var> can be
          used for force a specific value into the control file
          <var class="LITERAL">Q</var> information.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4449"></a>
<pre class="SCREEN">
    john|tom|frank
      :filter=/.../filter
      :lp=/dev/pr
      :force_queuename=office
    
    lpr -Pjohn
      control file -
       Qoffice
    
    filter command line:
      ... -Qoffice
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CHECKFORNONPRINTABLE">6.9.
          Check For Nonprintable File</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">check_for_nonprintable</var>
              FLAG <span class="emphasis"><i class="EMPHASIS"><b
              class="APPLICATION">lpr</b> checks for non-printable
              file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ml=</var><span class=
              "emphasis"><i class="EMPHASIS">minimum number of
              printable characters</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>By default <b class="APPLICATION">lpr</b> does not
          check files for for non-printable characters (i.e.,
          escape characters) at the start of the print file. You
          can set the <var class=
          "LITERAL">check_for_nonprintable</var> flag to cause it
          to do so. The <var class="LITERAL">:ml</var> value
          specifies the number of characters that are to be
          checked. Clearly, if it is 0, none will be checked.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPRBOUNCE">6.10. Job Filtering
          By LPR</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpr_bounce</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">lpr does
              filtering</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>Some users would like the advantages of the filtering
          and processing capabilities of a lpd daemon without
          running a <b class="APPLICATION">lpd</b> daemon on their
          system. By having the <b class="APPLICATION">lpr</b>
          program process the job by passing it through the various
          filters and then send the output of the filters as the
          print job you can get the desired effect.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4479"></a>
<pre class="SCREEN">
    # Simple example of an lpr_bounce entry
    bounce
      :lpr_bounce
      :lp=lp@remote
      :filter=/usr/local/bin/lpf
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">lpr_bounce</var> flag, if
          present in the printcap entry, will force <b class=
          "APPLICATION">lpr</b> to process the job using the
          specified filters and send the outputs of the filters to
          the remote printer for further processing.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="RG">6.11. Restrict Queue Use
          to Group Members</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">rg=</var><span class=
              "emphasis"><i class="EMPHASIS">Restricted group
              list</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">:rg</var> value specifies a
          list of groups. If this value is present use of a printer
          or operation is restricted to only users in a particular
          group. This check is done by both the <b class=
          "APPLICATION">lpr</b> client and the <b class=
          "APPLICATION">lpd</b> server if the option is
          present.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SAFECHARS">6.12. Fixing Bad
          Control Files and Metacharacters</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">safe_chars=</var><span class=
              "emphasis"><i class="EMPHASIS">additional safe
              characters for control file</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>RFC1179 defines a simple protocol and standard for
          print jobs to be interchanged between print spooling
          systems. Unfortunately, there were some major mistakes in
          not specifying the exact form that text would take when
          placed in the control file.</p>

          <p>By default, <b class="APPLICATION">LPRng</b> will
          brutally convert a non-conforming RFC1179 control file
          into one that is acceptable to most, if not all, existing
          RFC1179 implementations. In order to prevent problems
          with <b class="APPLICATION">LPRng</b> ruthlessly purges
          all characters but upper and lower case letters, spaces,
          tabs, and <var class="LITERAL">-_.@/:()=,+-%</var> from
          the control file, replacing suspicious characters with
          underscore (<var class="LITERAL">_</var>). In addition,
          <b class="APPLICATION">LPRng</b> will ruthlessly
          regenerate control file entries and data file names so
          that they are compliant with all known RFC1179
          implementations.</p>

          <p>For some installations, the default set of safe
          characters may be overly restrictive. For example, <span
          class="emphasis"><i class="EMPHASIS">vintage</i></span>
          software may generate files with <var class=
          "LITERAL">#</var> characters in the <var class=
          "LITERAL">J</var> line of the control file. The
          replacement of this character by underscore (<var class=
          "LITERAL">_</var>) may cause other applications which use
          the control file information to stop working. The <var
          class="LITERAL">:safe_chars</var> option allows the user
          to specify an additional set of safe characters in the
          <tt class="FILENAME">lpd.conf</tt> configuration
          file(s).</p>

          <p>For example, <var class="LITERAL">:safe_chars=#"</var>
          would allow the <var class="LITERAL">#</var> and <var
          class="LITERAL">"</var> characters to appear in the
          control file.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="MINFREE">6.13. Minimum Spool
          Queue Free Space</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">minfree=</var><span class=
              "emphasis"><i class="EMPHASIS">Size in
              Kbytes</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>If this value is non-zero, then the <b class=
          "APPLICATION">lpd</b> receiving server checks to see that
          there is the specified number of Kbytes of file space
          available before accepting a job. If there is not enough
          space then the job is rejected.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="FORCEFQDNHOSTNAME">6.14. FQDN
          Host Information</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">force_fqdn_hostname</var>
              FLAG <span class="emphasis"><i class=
              "EMPHASIS">Update control file with FQDN
              name</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">force_ipaddr_hostname</var>
              FLAG <span class="emphasis"><i class=
              "EMPHASIS">Update control file with IP address of
              remote host</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">use_shorthost</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">short
              control and data file names</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>Some <b class="APPLICATION">lpr</b> clients do not put
          a FQDN host name in their control file. The <var class=
          "LITERAL">force_fqdn_hostname</var> flag will cause <b
          class="APPLICATION">lpd</b> to put a FQDN host name in
          the control file. This option will assume that the domain
          is where the connection originated from.</p>

          <p>Similarly, the <var class=
          "LITERAL">force_ipaddr_hostname</var> flag will cause <b
          class="APPLICATION">lpd</b> to put a FQDN host name in
          the control file.</p>

          <p>Some systems cannot handle FQDN hostnames in control
          and data file formats. The <var class=
          "LITERAL">use_shorthost</var> option will send control
          and data files with very short names to the remote print
          server.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="LPQ"></a>Chapter 7. <b class=
        "APPLICATION">lpq</b> - Status Monitoring Program</h1>

        <p>The <b class="APPLICATION">lpq</b> program is the main
        method used to monitor queues. You can obtain the available
        options by using:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN4562"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {306} %</samp> <kbd class=
"USERINPUT">lpq -=</kbd>
    lpq: Illegal option '='
    usage: lpq [-aAclV] [-Ddebuglevel] [-Pprinter] [-tsleeptime]
      -a           - all printers
      -c           - clear screen before update
      -l           - increase (lengthen) detailed status information
                     additional l flags add more detail.
      -L           - maximum detailed status information
      -n linecount - linecount lines of detailed status information
      -Ddebuglevel - debug level
      -Pprinter    - specify printer
      -s           - short (summary) format
      -tsleeptime  - sleeptime between updates
      -V           - print version information
</pre>
        </div>
        <br>
        <br>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4566">7.1. <b class=
          "APPLICATION">lpq</b> Queue Selection (lpq -Pprinter, lpq
          -a)</a></h2>

          <p>If no queue is specified, then the default queue is
          used, with <var class="LITERAL">-Pprinter@host</var>
          causing a direct connection to the named host. The <var
          class="LITERAL">-a</var> literal selects all queues.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4572">7.2. <b class=
          "APPLICATION">lpq</b> Job Selection</a></h2>

          <p>Jobs are selected by providing a job number, or <var
          class="LITERAL">glob</var> pattern that is matched to the
          user name and and job identifier. If multiple patterns
          are provided each is applied in turn against the jobs in
          a queue until all have been tried. If any one of the
          patterns match then the job status is displayed.</p>

          <p>If no selection information is provided or the <var
          class="LITERAL">all</var> pattern is provided then all
          jobs in the queue are displayed.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4579">7.3. <b class=
          "APPLICATION">lpq</b> Short Format (lpq -s)</a></h2>

          <p>This is one line per spool queue:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4583"></a>
<pre class="SCREEN">
    % lpq -sa
    t1@astart110  (printing disabled) 1 job
    t2@astart110  (routed/bounce to t1@h10.private) 0 jobs
    t3@astart110  (forwarding to t3a@h10.private)
    t3a@astart110  (forwarding to t2@h10.private)
    t4@astart110  (subservers t5, t6)  0 jobs
    t5@astart110  (serving t4) 0 jobs
    t6@astart110  (serving t4) 0 jobs
</pre>
          </div>
          <br>
          <br>

          <p>Note that the name of the printer/host is first,
          followed by optional status information, followed by the
          number of jobs. Only printcap entries with spool queues
          have a jobs word in the last position. The <var class=
          "LITERAL">-a</var> literal forces status for all queues
          or the queues in the <var class="LITERAL">all</var>
          printcap entry to be returned.</p>

          <p>The <var class="LITERAL">stalled_time</var> (default
          120 seconds) printcap option can be used to set a time
          after which active jobs will be reported as stalled.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4590">7.4. <b class=
          "APPLICATION">lpq</b> Long Format (lpq, lpq -l, lpq
          -L)</a></h2>

          <p>This is the default status display. It is a nicely
          formatted, extremely verbose format that is suitable for
          humble human interpretation. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4594"></a>
<pre class="SCREEN">
    % lpq -a
    Printer: t1@astart110  'Test Printer 1' (printing disabled)
     Queue: 1 printable job
     Server: no server active
     Status: finished operations at 09:44:00
     Rank   Owner/ID            Class Job  Files         Size Time
    1       papowell@lprng110+202228663 A 10663 /tmp/hi     3 20:22:29
    Printer: t2@astart110  'Test Printer 2' (routed/bounce to t1@h10.private)
     Queue: no printable jobs in queue
     Status: finished operations at 16:30:08
    Printer: t3@astart110  (forwarding to t3a@h10.private)
    Printer: t3a@astart110  (forwarding to t2@h10.private)
    Printer: t4@astart110  (subservers t5, t6)
     Queue: no printable jobs in queue
     Status: finished operations at 09:44:06
    Server Printer: t5@astart110  (serving t4)
     Queue: no printable jobs in queue
     Status: finished operations at 09:44:06
    Server Printer: t6@astart110  (serving t4)
     Queue: no printable jobs in queue
     Status: finished operations at 09:10:00
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="COMMAND">lpq -l</tt> (longer
          information) option causes more of the status information
          to be printed. You can use increasing numbers of <tt
          class="COMMAND">lpq -l</tt> options ( <tt class=
          "COMMAND">lpq -ll</tt> also works) to get more status.
          Use <tt class="COMMAND">lpq -L</tt> for the maximum
          amount of status information.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4601">7.5. <b class=
          "APPLICATION">lpq</b> Verbose Format (lpq -v)</a></h2>

          <p>This uses an extension to the RFC1179 protocol, and is
          supported only by <b class="APPLICATION">LPRng</b>. The
          amount of information displayed is the brutal, and in
          effect does a total database dump of the LPD. This has
          been developed in order to provide diagnostic and status
          information for databases that need to keep track of job
          progress through a spool queue.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4606"></a>
<pre class="SCREEN">
    % lpq -v
    Printer: t1@astart110
     Comment: Test Printer 1
     Printing: no
     Spooling: yes
     Queue: 1 printable job
     Server: no server active
     Status: accounting at end 'papowell@lprng110+094352860' at 09:44:00
     Status: printing 'papowell@lprng110+094352860', \
                closing device at 09:44:00
     Status: printing 'papowell@lprng110+094352860', finished  at 09:44:00
     Status: subserver status 'JSUCC' for 'papowell@lprng110+094352860' \
                on attempt 1 at 09:44:00
     Status: finished operations at 09:44:00
     Job: papowell@lprng110+202228663 status= 1
     Job: papowell@lprng110+202228663 CONTROL=
     - Hh10.private
     - Ppapowell
     - J/tmp/hi
     - CA
     - Lpapowell
     - Apapowell@lprng110+202228663
     - Qt1
     - fdfA010663h10.private
     - N/tmp/hi
     - UdfA010663h10.private
     Job: papowell@lprng110+202228663 HOLDFILE=
     - active 0
     - done 0
     - hold 0
     - move 0
    ....
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="STALLEDTIME">7.6. Job Taking
          Too Long - Stalled</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">stalled_time=</var><span
              class="emphasis"><i class="EMPHASIS">seconds after
              which to report a stalled active job</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">stalled_time</var> option is
          actually used by the <b class="APPLICATION">lpd</b>
          server to report that a job has been active more than the
          indicated time with no change in state. This is useful
          for spotting things such a printers that are out of
          paper, and so forth.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4619">7.7. Configuring
          Format and Displayed Information</a></h2>

          <p>The following sections describe options that are used
          by the <b class="APPLICATION">lpd</b> server to control
          how it will return status information to a <b class=
          "APPLICATION">lpq</b> request.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="CLASSINSTATUS">7.7.1.
            Display Class Information</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">class_in_status</var> FLAG
                <span class="emphasis"><i class="EMPHASIS">show
                class name in status</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Setting the <var class=
            "LITERAL">class_in_status</var> option causes the class
            name rather than priority to be displayed in the status
            information.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="REVERSELPQFORMAT">7.7.2.
            Reverse Short and Long <b class="APPLICATION">lpq</b>
            Formats</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">reverse_lpq_format=</var>
                FLAG <span class="emphasis"><i class=
                "EMPHASIS">reverse <b class="APPLICATION">lpq</b>
                status format for specified remote
                systems</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Various Solaris and other System V implementations
            support an RFC1179 interface to remote printers.
            Unfortunately, there is a problem in that when they
            send a status request, the status format is reversed.
            That is, when LONG status format is wanted, they send
            SHORT, and vice versa.</p>

            <p>The <var class="LITERAL">reverse_lpq_format=</var>
            specifies a list of printers or IP addresses for which
            the <b class="APPLICATION">lpd</b> server will return
            LONG status when SHORT is requested, and vice versa.
            For example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN4648"></a>
<pre class="SCREEN">
    reverse_lpq_format=*.eng.com,130.192.0.0/16
</pre>
            </div>
            <br>
            <br>

            <p>will cause hosts whose Fully Qualified Domain Name
            (FQDN) ends in <tt class="FILENAME">eng.com</tt> or
            from subnet <var class="LITERAL">130.192.0.0</var> to
            have reversed status returned.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="SHORTSTATUS">7.7.3. Status
            Line Length and Line Count</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class=
                "LITERAL">return_short_status=</var><span class=
                "emphasis"><i class="EMPHASIS">return short <b
                class="APPLICATION">lpq</b> status for specified
                remote systems</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">short_status_length=</var><span class=
                "emphasis"><i class="EMPHASIS">short <b class=
                "APPLICATION">lpq</b> status length in
                lines</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>In order to be compatible with non-<b class=
            "APPLICATION">LPRng</b> client programs, some
            administrators would like <b class=
            "APPLICATION">lpd</b> to return a short or brief status
            to normal status queries.</p>

            <p>The <var class="LITERAL">return_short_status=</var>
            specifies a list of printers or IP addresses for which
            the <b class="APPLICATION">lpd</b> server will return
            an abbreviated status when LONG status is requested.
            For example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN4673"></a>
<pre class="SCREEN">
    return_short_status=*.eng.com,130.192.0.0/16
    short_status_length#3
</pre>
            </div>
            <br>
            <br>

            <p>will cause hosts whose Fully Qualified Domain Name
            (FQDN) ends in <tt class="FILENAME">eng.com</tt> or
            from subnet <var class="LITERAL">130.192.0.0</var> to
            get only 3 lines of detailed status returned.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="FORCELPQSTATUS">7.7.4. <b
            class="APPLICATION">lpq</b> Status Format Determined by
            Requesting Host Address</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class=
                "LITERAL">force_lpq_status=</var><span class=
                "emphasis"><i class="EMPHASIS">force <b class=
                "APPLICATION">lpq</b> status format for specified
                remote systems</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>In order to be compatible with non-<b class=
            "APPLICATION">LPRng</b> client programs which are
            totally unpredictable, this allows the administrator to
            specify the format for <b class="APPLICATION">lpq</b>
            status when requests arrive.</p>

            <p>The <var class="LITERAL">force_lpq_status=</var>
            specifies a list of formats and printers or IP
            addresses for which the <b class="APPLICATION">lpd</b>
            server will return status in the specified format. The
            entry has the format <var class=
            "LITERAL">KEY=list;KEY=list...</var> where <acronym
            class="ACRONYM">KEY</acronym> is <var class=
            "LITERAL">s</var> for short and <var class=
            "LITERAL">l</var> for long format, and list is a list
            of hosts or IP addresses. For example:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN4698"></a>
<pre class="SCREEN">
    force_lpq_status=s=pc*.eng.com,130.192.12.0/24,l=sun*.eng.com
</pre>
            </div>
            <br>
            <br>

            <p>will cause hosts whose Fully Qualified Domain Name
            (FQDN) matches <tt class="FILENAME">pc*eng.com</tt> or
            from subnet <var class="LITERAL">130.192.12.0</var> to
            get short status returned and hosts which match <tt
            class="FILENAME">sun*.eng.com</tt> get long status.</p>
          </div>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="LPRM"></a>Chapter 8. <b class=
        "APPLICATION">lprm</b> - Job Removal Program</h1>

        <p>The <b class="APPLICATION">lprm</b> program is used to
        remove jobs from a print queue. You can obtain the
        available options by using:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN4709"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {307} %</samp> <kbd class=
"USERINPUT">lprm -=</kbd>
    lprm: Illegal option '='
     usage: lprm [-A] [-a | -Pprinter] [-Ddebuglevel] (jobid|user|'all')*
      -a           - all printers
      -A           - use authentication
      -Pprinter    - printer (default PRINTER environment variable)
      -Uuser       - impersonate this user (root or privileged user only)
      -Ddebuglevel - debug level
      -V           - show version information
      user           removes user jobs
      all            removes all jobs
      jobid          removes job number jobid
     Example:
        'lprm -Plp 30' removes job 30 on printer lp
        'lprm -a'      removes all your jobs on all printers
        'lprm -a all'  removes all jobs on all printers
      Note: lprm removes only jobs for which you have removal permission
</pre>
        </div>
        <br>
        <br>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4713">8.1. <b class=
          "APPLICATION">lprm</b> Queue Selection (lprm -Pprinter,
          lprm -a)</a></h2>

          <p>If no queue is specified, then the default queue is
          used, with <var class="LITERAL">-Pprinter@host</var>
          causing a direct connection to the named host. The <var
          class="LITERAL">-a</var> literal selects all queues.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4719">8.2. <b class=
          "APPLICATION">lprm</b> Job Selection</a></h2>

          <p>Jobs are selected by providing a job number, or <var
          class="LITERAL">glob</var> pattern that is matched to the
          user name and and job identifier. If multiple patterns
          are provided each is applied in turn against the jobs in
          a queue until all have been tried. If any one of the
          patterns match then the job status is displayed.</p>

          <p>If no selection information is provided then the user
          name performing the request is used as the selection
          pattern, and only the first job that matches is
          removed.</p>

          <p>The <var class="LITERAL">all</var> pattern will match
          all jobs in the queue.</p>

          <p>The user must have permission to control the queue or
          to remove a selected job in order for job removal to
          succeed.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="LPC"></a>Chapter 9. <b class=
        "APPLICATION">lpc</b> - Administration Program</h1>

        <p>The <b class="APPLICATION">lpc</b> command is the main
        way that the <b class="APPLICATION">lpd</b> server is
        controlled. Here is the help information displayed by the
        command:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN4734"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {308} %</samp> <kbd class=
"USERINPUT">lpc -=</kbd>
    lpc: Illegal option '='
    usage: lpc [-Ddebuglevel][-Pprinter][-Shost][-Uusername][-V] [command]
     with no command, reads from stdin
      -Ddebuglevel - debug level
      -Pprinter    - printer or printer@host
      -Shost       - connect to lpd server on host
      -Uuser       - identify command as coming from user
      -V           - increase information verbosity
     commands:
     active  (printer[@host])        - check for active server
     abort   (printer[@host] | all)  - stop server
     class   printer[@host] (class | off) - show/set class printing
     disable (printer[@host] | all)  - disable queueing
     debug   (printer[@host] | all) debugparms - set debug level for printer
     down    (printer[@host] | all)  - disable printing and queueing
     enable  (printer[@host] | all)  - enable queueing
     hold    (printer[@host] | all) (name[@host] | job | all)* - hold job
     holdall (printer[@host] | all)  - hold all jobs on
     kill    (printer[@host] | all)  - stop and restart server
     lpd     (printer[@host]) - get LPD PID
     lpq     (printer[@host] | all) (name[@host] | job | all)*   - run <b
 class="APPLICATION">lpq</b>
     lprm    (printer[@host] | all) (name[@host]|host|job| all)* - run <b
 class="APPLICATION">lprm</b>
     msg printer message text- set status message
     move printer (user|jobid)* target - move jobs to new queue
     noholdall (printer[@host] | all)- hold all jobs off
     printcap(printer[@host] | all)  - report printcap values
     quit                            - exit LPC
     redirect(printer[@host] | all) (printer@host | off )*     - redirect jobs
     redo    (printer[@host] | all) (name[@host] | job | all)* - redo jobs
     release (printer[@host] | all) (name[@host] | job | all)* - release jobs
     reread  (printer[@host])        - LPD reread database information
     start   (printer[@host] | all)  - start printing
     status  (printer[@host] | all)  - status of printers
     stop    (printer[@host] | all)  - stop  printing
     topq    (printer[@host] | all) (name[@host] | job | all)*  - reorder job
     up      (printer[@host] | all) - enable printing and queueing
       diagnostic:
          defaultq               - show default queue for LPD server
          defaults               - show default configuration values
          client  (printer | all) - client config and printcap information
          server (printer | all) - server config and printcap
</pre>
        </div>
        <br>
        <br>

        <p>Most of the <b class="APPLICATION">lpc</b> command line
        options are common to all <a href="#LPRNGCLIENTS"><b class=
        "APPLICATION">LPRng</b> Clients</a>, with the exception of
        the <var class="LITERAL">-S server</var> literal. This
        option allows the <b class="APPLICATION">lpd</b> host to be
        explicitly specified.</p>

        <p>The <b class="APPLICATION">lpc</b> commands can be
        classified as <span class="emphasis"><i class=
        "EMPHASIS">informational</i></span>, <span class=
        "emphasis"><i class="EMPHASIS">queue management</i></span>,
        <span class="emphasis"><i class="EMPHASIS">problem
        management</i></span>, <span class="emphasis"><i class=
        "EMPHASIS">job scheduling</i></span>, and <span class=
        "emphasis"><i class="EMPHASIS">diagnostic</i></span>.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4753">9.1. Informational
          Commands - status, flush, active, reread</a></h2>

          <p>The <tt class="COMMAND">lpc status</tt> command
          displays the current status of various activities of
          interest to the system administrator. This information
          includes the process ID of the server and other
          processes.</p>

          <p>During normal operation, when requested for job status
          information the <b class="APPLICATION">lpd</b> server
          will create this information and then save it in a status
          cache. When successive requests for the same information
          arrive, the cache is checked to see if the information is
          already in the cache and there have been no status
          changes. If this is the case, the cached status
          information is used. The <tt class="COMMAND">lpc
          flush</tt> command will flush (delete) this cache
          information and cause the <b class="APPLICATION">lpd</b>
          server to regenerate it from the original job files.</p>

          <p>The <tt class="COMMAND">lpc active</tt> command
          connects to the print server and gets the Process ID of
          the <b class="APPLICATION">lpd</b> process. This is
          useful to determine if the <b class="APPLICATION">lpd</b>
          server is running on the print server.</p>

          <p>The <tt class="COMMAND">reread</tt> command connects
          to the <b class="APPLICATION">lpd</b> print server and
          requests that the server reread the <tt class=
          "FILENAME">printcap</tt>, <tt class=
          "FILENAME">lpd.conf</tt>, and <tt class=
          "FILENAME">lpd.perms</tt> database files.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4771">9.2. Queue Management
          - enable, disable, up, down</a></h2>

          <p>The <tt class="COMMAND">enable</tt> and <tt class=
          "COMMAND">disable</tt> commands enable and disable <span
          class="emphasis"><i class="EMPHASIS">queuing</i></span>
          or sending jobs to the print queue. The <tt class=
          "COMMAND">up</tt> command combines the <tt class=
          "COMMAND">enable</tt> and <tt class="COMMAND">start</tt>
          commands while the <tt class="COMMAND">down</tt> command
          combines the <tt class="COMMAND">disable</tt> and <tt
          class="COMMAND">stop</tt> commands.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4783">9.3. Printing
          Management - start, stop, up, down</a></h2>

          <p>These commands are used to start and stop printing.
          The <tt class="COMMAND">up</tt> combines <tt class=
          "COMMAND">start</tt> and <tt class="COMMAND">enable</tt>,
          while <tt class="COMMAND">down</tt> combines <tt class=
          "COMMAND">stop</tt> and <tt class=
          "COMMAND">disable</tt>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4792">9.4. Problem
          Management - abort, redo, kill</a></h2>

          <p>These commands are usually used when there is a
          problem printing a job. The <tt class=
          "COMMAND">abort</tt> command is used to kill off all
          printing activity associated with a job. It also has the
          side effect of stopping printing on the print queue. The
          <tt class="COMMAND">redo</tt> command will redo or
          attempt to reprint a job. The <tt class=
          "COMMAND">kill</tt> command combines the abort and redo
          command, and is useful when there are problems with the
          job currently being printed and it should be
          reprinted.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4798">9.5. Job Scheduling -
          topq, holdall, noholdall, hold, release</a></h2>

          <p>The <tt class="COMMAND">topq</tt> command effectively
          puts the select job or jobs at the top of the queue for
          printing.</p>

          <p>The <tt class="COMMAND">holdall</tt>, <tt class=
          "COMMAND">noholdall</tt>, and <tt class=
          "COMMAND">release</tt> commands implement a simple
          holding queue for jobs. By default, <tt class=
          "COMMAND">holdall</tt> is disabled. When the <tt class=
          "COMMAND">holdall</tt> command enables it, then jobs will
          remain in the spool queue until explicitly released with
          the <tt class="COMMAND">release</tt> command.</p>

          <p>The <tt class="COMMAND">hold</tt> command can also be
          used to hold individual jobs until released.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPCREDIRECT">9.6. Queue
          Management - class, redirect, move</a></h2>

          <p>The <tt class="COMMAND">class</tt> command is used to
          restrict printing to jobs whose class value, set using
          the <tt class="COMMAND">lpr -C class</tt> option, is in
          the class list or matches one of the classes. This allows
          the administrator to restrict printing. For more details
          and an example of its use, see Form Support.</p>

          <p>The <tt class="COMMAND">redirect</tt> command allows
          the administrator to accepts jobs at this queue and then
          to have them forwarded or redirected to another print
          queue. This is useful when a printer temporarily is
          unavailable.</p>

          <p>The <tt class="COMMAND">move</tt> command allows an
          individual job (or jobs) to be forwarded or redirected to
          another print queue.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="CHECKPC"></a>Chapter 10. <b class=
        "APPLICATION">checkpc</b> - Configuration Validation
        Utility</h1>

        <p>The <b class="APPLICATION">checkpc</b> (check printcap
        file) is one of the most useful utilities in the <b class=
        "APPLICATION">LPRng</b> package.</p>

        <p>It will read all the configuration files, printcap files
        and tests whether devices are set up correctly. Optionally,
        it will also set the permissions for spool directories and
        device files. Additionally, it will truncate the accounting
        and log files to a maximum size. Another use for <b class=
        "APPLICATION">checkpc</b> is to remove old entries from
        queue directories.</p>

        <p>For a new installation, you will want to run</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN4829"></a>
<pre class="SCREEN">
    checkpc -f -V
</pre>
        </div>
        to set the permissions right. The <var class=
        "LITERAL">-f</var> flag instructs the program to correct
        file permissions. If you don't run this as <var class=
        "LITERAL">ROOT</var>, you'll receive a warning about that
        fact and any <code class="FUNCTION">chown(2)</code> calls
        will (most likely) fail.<br>
        <br>

        <p>The program reports everything it changes. Since it
        isn't too clever about some things (visit the man page),
        you should keep an eye on the output, and run it again if
        needed. If it keeps failing, change the permissions
        yourself.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4835">10.1.
          Maintenance</a></h2>

          <p>Later, you will want to use <b class=
          "APPLICATION">checkpc</b> for the daily maintenance of
          your system. I have this line in user <var class=
          "LITERAL">lp</var>'s crontab:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4840"></a>
<pre class="SCREEN">
    32 5 * * * checkpc -t 10K -A3 -r &gt;/dev/null 2&gt;&amp;1
</pre>
          </div>
          This job will: 

          <ol type="1">
            <li>
              <p>truncate all log and accounting files to 10KB
              (<var class="LITERAL">-t 10K</var>). Actually, it
              will keep the last 10K from the file, starting on a
              complete line.</p>
            </li>

            <li>
              <p>remove all stale files older than three days (<var
              class="LITERAL">-A3 -r</var>).</p>
            </li>
          </ol>
          I'm redirecting output to <tt class=
          "FILENAME">/dev/null</tt>, because <b class=
          "APPLICATION">checkpc</b> is a little noisy to my taste.
          (But too noisy is better than too silent :)<br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4851">10.2. Printcap
          Information</a></h2>

          <p>You can use <tt class="COMMAND">checkpc -V -P</tt> to
          examine printcaps and tell you what they contain. This is
          identical to the <tt class="COMMAND">lpc server all</tt>
          operation, but with a higher level of verbosity.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="PRINTERCOMM"></a>Chapter 11. Printer
        Communication and Protocols</h1>

        <p>Common communication methods between a printer and a
        host system are network connections, parallel ports, or
        serial ports; while Fibre Channel, SCSI, USB, FireWire,
        InfraRed, and other interesting technologies have been
        used, they are either very specialized or not directly
        support by the <b class="APPLICATION">LPRng</b> software.
        In this section we will discuss Network, Parallel Port, and
        Serial Printers, as well as the different protocols and
        standards that apply to them.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="NETWORKPRINTER">11.1. Network
          Printers</a></h2>

          <p>The most flexible and highest throughput printer
          interface is via a network (TCP/IP) connection. Most high
          performance printers have a built in network interface,
          or you can attach them to a <span class="emphasis"><i
          class="EMPHASIS">printer server</i></span> box which
          provides a network interface. The network interface
          usually supports multiple network printing protocols. The
          most common are the LPD (RFC1179), Socket API, AppSocket,
          SMB, and Novell Netware interfaces. <b class=
          "APPLICATION">LPRng</b> directly supports the LPD
          (RFC1179) and Socket API interfaces, and you can use the
          <b class="APPLICATION">smbclient</b> program from the <a
          href="#SMB">Samba Software Package</a> for the SMB
          interface.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4867">11.2. RFC1179 (LPD)
          Connection</a></h2>

          <p>In this mode of operation the print server actually
          operates as a very limited BSD print spooler. These
          limitations include:</p>

          <ol type="1">
            <li>
              <p>No error messages or status capability</p>
            </li>

            <li>
              <p>Limited or very primitive banner printing. On some
              systems it may be <span class="emphasis"><i class=
              "EMPHASIS">impossible</i></span> to turn banner
              printing off.</p>
            </li>

            <li>
              <p>On most known print servers high connection
              activity caused by multiple systems attempting to get
              status or spool jobs may cause catastrophic failure
              of the printer.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>For the above reasons, using RFC1179 to transfer jobs
          to a printer should be regarded as the least desirable
          option. Please see <a href="#RFC1179REF">The RFC1189
          Protocol</a> for a detailed discussion of the RFC1179
          protocol.</p>

          <p>In order to use the RFC1179 transfer operation you
          must have a printcap entry for the printer that
          provides:</p>

          <ul>
            <li>
              <p>The IP address or name of the printer that can be
              resolved to an IP address</p>
            </li>

            <li>
              <p>The name of the spool queue. In practice, this is
              usually used only to determine which of several
              printer ports on the print server the job will be
              sent to, or what type of processing the print server
              will do. Most cards usually do not do any processing
              and simply pass the job through to the printer.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The following is an example of a simple printcap entry
          that can be used to send a job to a remote printer using
          the RFC1179 protocol:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4887"></a>
<pre class="SCREEN">
    # <b class="APPLICATION">LPRng</b> syntax
    # :lp value is 'where to print the job'
    lp:
      :lp=raw@10.0.0.1
    
    # OR Vintage BSD Print Spooler Syntax
    # (<b class="APPLICATION">LPRng</b> supports this as well)
    # :rp = remote printer, :rm = remote machine or host
    lp:
      :rp=raw:rm=10.0.0.1
</pre>
          </div>
          <br>
          <br>

          <p>If you wish to transfer jobs to a print spooler
          without using the full <b class="APPLICATION">LPRng</b>
          <b class="APPLICATION">lpr</b> program, the Perl <var
          class="LITERAL">lpr_in_perl</var> program in the <b
          class="APPLICATION">LPRng</b> Distribution <acronym
          class="ACRONYM">UTILS</acronym> directory can be used for
          testing and tutorial purposes.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SOCKETAPI">11.3. Socket
          API</a></h2>

          <p>The Socket API is a very flexible job transfer
          protocol. It is widely support by most Print Server
          manufacturers, with the Hewlett Packard JetDirect setting
          the <span class="emphasis"><i class="EMPHASIS">de
          facto</i></span> standard. The Socket API is extremely
          simple.</p>

          <ol type="1">
            <li>
              <p>The user establishes a connection to TCP/IP port
              on the Printer or Network Print spooler. The HP
              JetDirect uses port 9100 by default, but other ports
              are used as well. This connection may be refused if
              the printer is busy printing a job.</p>
            </li>

            <li>
              <p>When the network connection is established to a
              system which has an <span class="emphasis"><i class=
              "EMPHASIS">internal printer</i></span> or for which
              the Network Print Spooler is an integral part of the
              system, the printer usually flushes all internal
              buffers and readies itself to receive a new job.
              However, when you are using an external Print Server
              box, you may need to send specific initialization
              sequences to the printer to ensure that it is reset
              correctly and is ready to receive new jobs.</p>
            </li>

            <li>
              <p>When the connection is made, all bytes sent to the
              connection are either transferred to and external
              interface to directly to a <span class="emphasis"><i
              class="EMPHASIS">print buffer</i></span> used by the
              printer's Print Engine.</p>
            </li>

            <li>
              <p>The connection is bidirectional, and information
              sent to the external port by an external printer or
              error messages and status generated by the printer's
              Print Engine will be transferred over the data link
              to the user.</p>
            </li>

            <li>
              <p>The Network Print spooler will keep the connection
              open until it is closed by the user. During this
              period it may continue to report status or other
              information such as printer On Line, paper outages,
              and so forth.</p>
            </li>

            <li>
              <p>If the connection to the printer is <span class=
              "emphasis"><i class=
              "EMPHASIS">half-closed</i></span>, that is, the <code
              class="FUNCTION">shutdown()</code> network system
              call is used to indicate to the remote printer that
              no further data will be sent, then the printer may
              immediately terminate the network connection. This
              means that no further network or status messages will
              be sent to the user.</p>
            </li>

            <li>
              <p>If the connection is to a External Print Server,
              then usually the connection can be immediately
              re-established. It is the responsibility of the user
              to ensure that a the printer has finished its work
              before sending a new job.</p>
            </li>

            <li>
              <p>If the connection is to an internal Print Server,
              then usually the printer will not allow the
              connection to be made, or will refuse all data
              transfers on the connection until the printer
              finishes with the previous job and all internal
              buffers have been cleared.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>The following is a sample printcap showing how to use
          the Socket API:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4923"></a>
<pre class="SCREEN">
    lp:
      # make a socket connection to port 9100
      :lp=10.0.0.2%9100
</pre>
          </div>
          <br>
          <br>

          <p>You can use the <a href=
          "http://www.l0pht.com/~weld/netcat/" target=
          "_top">netcat</a> utility by Hobbit <code class=
          "EMAIL">&lt;<a href=
          "mailto:Hobbit@avian.org">Hobbit@avian.org</a>&gt;</code>
          to test that the Socket interface is available and
          working. If <tt class="FILENAME">ellipse.ps</tt> is a
          test file, then: The simplest and easiest way to print a
          file to a network printer appears</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4929"></a>
<pre class="SCREEN">
      nc printer.ip.addr 9100 &lt; file
    Example:
      nc 10.0.0.25 9100 &lt; ellipse.ps
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="APPSOCKET">11.4. AppSocket
          TCP/IP Protocol</a></h2>

          <p>The AppSocket interface is supported by Tektronix and
          some other printer vendors. It is similar to the Socket
          API, with a couple of significant differences.</p>

          <ol type="1">
            <li>
              <p>The printer has two ports for network connections:
              a TCP port 9100 for TCP/IP stream connections and a
              UDP port for UDP packet connections.</p>
            </li>

            <li>
              <p>When a 0 length UDP packet or a UDP packet
              containing only <tt class="FILENAME">CR/LF</tt> is
              sent to UDP port 9101, the printer will return a
              packet to the sender containing print status
              information. This information indicates the printers
              current status (busy, idle, printing) and any error
              conditions.</p>
            </li>

            <li>
              <p>The format, reliability, and repeatability of the
              UDP format and information is totally undocumented,
              and the UPD port facility should be regarded as, at
              best, an advisory function of the printer.</p>
            </li>

            <li>
              <p>To send a job to the printer, a connection to TCP
              port is made. This connection will be refused while
              the printer is busy or has a connection to another
              host.</p>
            </li>

            <li>
              <p>When the TCP connection is established, the
              information to be printed can be sent over the TCP
              connection. Bytes sent on this stream will be placed
              in the input buffer of the Print Engine and
              processed.</p>
            </li>

            <li>
              <p>An end of job (EOJ) sequence indication in the
              data stream will cause the printer to terminate the
              connection. This is different than the Socket API,
              where the printer will keep the connection open. This
              means that if the PostScript CTRL-D (end of job)
              character is sent in a job, then the connection will
              be terminated.</p>
            </li>

            <li>
              <p>Some models of printers modify this behavior
              slightly and will not terminate the connection, but
              will simply ignore any data following the EOJ
              indication.</p>
            </li>

            <li>
              <p>Some printers support bidirectional AppSocket
              communication, and while the connection is open will
              return error indications or status information.</p>
            </li>

            <li>
              <p>Once all the data has been received and the job
              has finished printing, the connection will be
              terminated by the printer.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>The <b class="APPLICATION">ifhp</b> filter, one of the
          helper programs for <b class="APPLICATION">LPRng</b>, is
          used with <b class="APPLICATION">LPRng</b> to provide
          AppSocket support. For details, please see the [<span
          class="CITATION">IFHP-HOWTO</span>] in the <a href=
          "http://www.private/" target="_top"><b class=
          "APPLICATION">ifhp</b> Distribution</a> and <a href=
          "#P450">Tektronix P450 and Family</a> for details. The
          following is a typical printcap entry for the AppSocket
          protocol. The actual network connection to the printer is
          made by the <b class="APPLICATION">ifhp</b> filter:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN4963"></a>
<pre class="SCREEN">
    lp:
      # <b class=
"APPLICATION">LPRng</b> opens a dummy connection for consistency
      :lp=/dev/null
      # we pass the ifhp filter options indicating that the
      # Tektronics printer will need the appsocket protocol
      # and to use port 35 at 10.0.0.1 to make the connection
      # The ifhp filter may open and close the connection several
      # times during the file transfer in order to ensure that
      # the printer handles the job correctly.
      :ifhp=model=tek,appsocket,dev=10.0.0.1%35
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECNETWORK">11.5. Network
          Print Server Boxes</a></h2>

          <p>A <span class="emphasis"><i class="EMPHASIS">network
          print server</i></span> is usually a box (external model)
          or card in a printer (internal model) which has a network
          connection to a TCP network and software to implement a
          LPD print server. If it is an external model, The
          parallel or serial port of the printer is connected to
          the box, and the print server may support multiple
          printers. If it is an internal model, the server is
          usually nothing more than a Network Interface Controller
          and a ROM containing software that the microprocessor in
          the printer uses.</p>

          <p>The print server may support multiple printing
          protocols, such as <a href="#RFC1179">RFC1179</a> (TCP/IP
          printing using the LPD print protocol), Novell Printer
          Protocols, SMB print protocols, and AppleTalk protocols.
          One of the observed problems with Network Print servers
          is that while they can usually support one protocol and
          one user at a time quite well, when you try to use
          multiple protocols and/or multiple users try to transfer
          print jobs to the printer, the printer may behave in a
          very odd manner. Usually this results in a printer
          failing to finish a job currently being printed, and
          unable to accept new jobs.</p>

          <p>Several of the newer models of print servers have
          Simple Network Management Protocol (SNMP) agents built
          into them, and can provide detailed information about
          their internal functions. By using a SNMP manager such as
          SunNetmanage or HP-Openview, you can monitor your network
          printers activities.</p>

          <p>I recommend that you use only a single protocol to
          send jobs to the printer. If you can, I also recommend
          that you use a print spooler and have only a single host
          system send a job to the printer.</p>

          <p>My best advice on connecting to network printers is
          not to use the the built-in LPD server, but to use the
          direct TCP/IP connection to the print engine. Usually
          this is done to particular TCP/IP port on the printer.
          For the HP JetDirect and other HP products, this is
          usually TCP port 9100.</p>

          <p>Once you have the direct connection, you can now use
          various filters to preprocess the print job, insert PJL
          and PCL commands, or convert text to PostScript or PCL
          for better print quality.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN4976">11.6. Network Print
          Server Configuration Information</a></h2>

          <p>The following is a list of print server manufacturers,
          models, and with hints on how to access these boxes with
          various protocols.</p>

          <div class="TABLE">
            <a name="NEWPS"></a>

            <p><b>Table 11-1. Network Print Server Configuration
            Information</b></p>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Manufacturer</th>

                  <th>Model</th>

                  <th>RFC1179 Port Name (rp=XXX)</th>

                  <th>Send to TCP port</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td><a href="http://www.cannon.com/" target=
                  "_top">Cannon Printer</a></td>

                  <td>Cannon 460 PS, no hard drive</td>

                  <td>xjdirect</td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Cannon 460 PS hard drive</td>

                  <td><var class="LITERAL">xjprint</var> - print
                  immediately,<var class="LITERAL">xjhold</var> -
                  print later</td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.digprod.com/" target=
                  "_top">Digital Products Inc.</a></td>

                  <td>NETPrint Print Server</td>

                  <td><var class="LITERAL">PORT</var><var class=
                  "LITERAL">n</var>, where <var class=
                  "LITERAL">n</var> is port on server</td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.efi.com/" target=
                  "_top">Electronics For Imaging Inc.</a></td>

                  <td>Fiery RIP i series</td>

                  <td><var class="LITERAL">normalq</var> or <var
                  class="LITERAL">urgentq</var></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Fiery RIP XJ series</td>

                  <td><var class="LITERAL">xjprint</var></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Fiery RIP XJ+ and SI series</td>

                  <td><var class="LITERAL">print_</var><var class=
                  "LITERAL">Model</var>, e.g. <var class=
                  "LITERAL">print_DocuColor</var></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Fiery models ZX2100, ZX3300, X2, X2e</td>

                  <td><var class="LITERAL">print</var></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.emulex.com/" target=
                  "_top">Emulex Corp.</a></td>

                  <td>NETJet/NETQue print server</td>

                  <td><acronym class=
                  "ACRONYM">PASSTHRU</acronym></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.extendsys.com/" target=
                  "_top">Extended Systems Inc.</a></td>

                  <td>ExtendNet Print Server</td>

                  <td><var class="LITERAL">Printer<var class=
                  "REPLACEABLE">n</var></var>, where <var class=
                  "LITERAL">n</var> is port on server</td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.hp.com/" target=
                  "_top">Hewlett-Packard</a></td>

                  <td>JetDirect interface card</td>

                  <td><var class="LITERAL">raw</var></td>

                  <td>9100</td>
                </tr>

                <tr>
                  <td><a href="http://www.hp.com/" target=
                  "_top">Hewlett-Packard</a></td>

                  <td>JetDirect Multiport Server</td>

                  <td><var class="LITERAL">port 1 - raw1, port 2 -
                  raw2, etc.</var></td>

                  <td>port 1 - 9100, port 2 - 9101, etc.</td>
                </tr>

                <tr>
                  <td><a href="http://www.i-data.com/" target=
                  "_top">I-Data</a></td>

                  <td>Easycom 10 Printserver</td>

                  <td><var class="LITERAL">par1</var> (parallel
                  port 1)</td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Easycom 100 Printserver</td>

                  <td><var class="LITERAL">LPDPRT1</var></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.printers.ibm.com/"
                  target="_top">IBM</a></td>

                  <td>Network Printer 12, 17, 24, and 24PS</td>

                  <td><acronym class="ACRONYM">PASS</acronym></td>

                  <td>- Unknown if supported -</td>
                </tr>

                <tr>
                  <td><a href="http://www.lantronix.com/" target=
                  "_top">Lantronix</a></td>

                  <td>EPS1, EPS2</td>

                  <td><var class="LITERAL">EPS_<var class=
                  "LITERAL">X_S1 (serial) port 1, EPS_X</var>_P1
                  (parallel) port 2</var>, etc.</td>

                  <td>3001 (port 1), 3002 (port 2), etc.</td>
                </tr>

                <tr>
                  <td><a href="http://www.qms.com/" target=
                  "_top">QMS</a></td>

                  <td>Various Models</td>

                  <td><acronym class="ACRONYM">RAW</acronym></td>

                  <td>35 (AppSocket)</td>
                </tr>

                <tr>
                  <td><a href="http://www.tek.com" target=
                  "_top">Tektronix</a></td>

                  <td>Tektronix printer network cards</td>

                  <td><acronym class="ACRONYM">PS</acronym>
                  (PostScript), <acronym class=
                  "ACRONYM">PCL</acronym> (PCL), or <acronym class=
                  "ACRONYM">AUTO</acronym>(Auto-selection between
                  PS, PCL, or HPGL). Not reliable.</td>

                  <td>9100 (AppSocket on some models)</td>
                </tr>

                <tr>
                  <td><a href="http://www.rosel.com" target=
                  "_top">Rose Electronics</a></td>

                  <td>Microserve Print Servers</td>

                  <td>lp</td>

                  <td>9100</td>
                </tr>

                <tr>
                  <td><a href="http://www.xerox.com/" target=
                  "_top">Xerox</a></td>

                  <td>Models 4505, 4510, 4517, 4520</td>

                  <td><acronym class=
                  "ACRONYM">PASSTHRU</acronym></td>

                  <td>2501 (AppSocket on some models)</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Model 4512</td>

                  <td><var class="LITERAL">PORT1</var></td>

                  <td>10001 (programmable)</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Model N17</td>

                  <td><acronym class="ACRONYM">RAW</acronym></td>

                  <td>9100</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Models N24 and N32</td>

                  <td><acronym class="ACRONYM">RAW</acronym></td>

                  <td>2000</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Models 4900, 4915, 4925, C55</td>

                  <td><acronym class="ACRONYM">PS</acronym></td>

                  <td>2000</td>
                </tr>

                <tr>
                  <td>&nbsp;</td>

                  <td>Document Centre DC220/230</td>

                  <td><var class="LITERAL">lp</var></td>

                  <td>- Unknown if supported -</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>All company, brand, and product names are properties
          of their respective owners.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5157">11.7. HP JetDirect
          Interface</a></h2>

          <p>The HP JetDirect Interface is one of the most widely
          used for network printers. For this reason it also has
          the most widely known set of problems. The user is
          strongly urged to upgrade to the latest version of
          firmware available for the unit. Problems with older
          versions of firmware include system lockups that require
          powerup level resets.</p>

          <p>Newer versions of the HP JetDirect Interface have a
          Web Browser based configuration system. After you have
          assigned an IP address to the printer you can connect to
          the configuration port and configure the printer using
          the browser. If you run into configuration problems then
          you will most likely need to use the Microsoft Windows
          based JetDirect Configuration Software to reset or
          reconfigure the printer.</p>

          <p>Older HPJetDirect cards can be configured only through
          through the front panel or through a set of network
          files. Here is a summary of the methods used from UNIX
          systems, or to use when you are desperate, to configure
          the printer.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5162">11.7.1. Resetting
            To Factory Defaults</a></h3>

            <p>Most internal HP JetDirect print servers can be
            reset to factory defaults (or cold-reset) by turning
            the printer off and holding down the <var class=
            "LITERAL">Online</var> or <var class="LITERAL">Go</var>
            button while turning the printer back on. The printer
            control panel display should read <var class=
            "LITERAL">Cold Reset</var>, <var class=
            "LITERAL">Restoring Factory Settings</var>, or
            something similar.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5169">11.7.2. Setting Up
            IP Networking and Address</a></h3>

            <p>You can set the network address from the front
            panel. Reset the printer, put it in offline mode. and
            then use the MENU, +-, SELECT keys as follows:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN5172"></a>
<pre class="SCREEN">
     MENU  -&gt; MIO MENU (use MENU to display MIO MENU)
     ITEM  -&gt; CFG NETWORK=NO*
     +     -&gt; CFG NETWORK=YES
     ENTER -&gt; CFG NETWORK=YES*
     ITEM  -&gt; TCP/IP=OFF* (use ITEM to display TCP/IP)
     +     -&gt; TCP/IP=ON
     ENTER -&gt; TCP/IP=ON*
     ITEM  -&gt; CFG TCP/IP=NO* (use ITEM to display TCP/IP)
     +     -&gt; CFG TCP/IP=YES
     ENTER -&gt; CFG TCP/IP=YES*
     ITEM  -&gt; BOOTP=NO*
         (Enable BOOTP if you want to - see below)
     ITEM  -&gt; IP BYTE 1=0*
         This is IP address MSB byte.
         Use +- keys to change value, and then ENTER to change
         Use ITEM keys to get IP BYTE=2,3,4
     ITEM  -&gt; SM BYTE 1=255*
          This is the subnet mask value
         Use +- keys to change value, and then ENTER to change
         Use ITEM keys to get IP BYTE=2,3,4
     ITEM  -&gt; LG BYTE 1=255*
         This is the Syslog server (LoGger) IP address
         Use +- keys to change value, and then ENTER to change
         Use ITEM keys to get IP BYTE=2,3,4
     ITEM  -&gt; GW BYTE 1=255*
         This is the subnet gateway (router) IP address
         Use +- keys to change value, and then ENTER to change
         Use ITEM keys to get IP BYTE=2,3,4
     ITEM  -&gt; TIMEOUT=90
          This is the connection timeout value.  It puts a limit
         on time between connections.  A value of 10 is reasonable.
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5174">11.7.3. BOOTP
            Information</a></h3>

            <p>If you have a bootp server, you can put this
            information in the bootptab file. To use this, you must
            enable the bootp option on the printer. The T144 option
            specifies a file to be read from the bootp server. This
            file is read by using the TFTP protocol, and you must
            have a TFTPD server enabled. Here is a sample bootptab
            entry.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN5177"></a>
<pre class="SCREEN">
    # Example /etc/bootptab: database for bootp server (/etc/bootpd).
    # Blank lines and lines beginning with '#' are ignored.
    #
    # Legend:
    #
    #       first field -- hostname
    #                       (may be full domain name)
    #
    #       hd -- home directory
    #       bf -- bootfile
    #       cs -- cookie servers
    #       ds -- domain name servers
    #       gw -- gateways
    #       ha -- hardware address
    #       ht -- hardware type
    #       im -- impress servers
    #       ip -- host IP address
    #       lg -- log servers
    #       lp -- LPR servers
    #       ns -- IEN-116 name servers
    #       rl -- resource location protocol servers
    #       sm -- subnet mask
    #       tc -- template host (points to similar host entry)
    #       to -- time offset (seconds)
    #       ts -- time servers
    #
    # Be careful about including backslashes where they're needed.
    # Weird (bad) things can happen when a backslash is omitted
    # where one is intended.
    #
    peripheral1:
    :hn:ht=ether:vm=rfc1048:
    :ha=08000903212F:
    :ip=190.40.101.22:
    :sm=255.255.255.0:
    :gw=190.40.101.1:
    :lg=190.40.101.3:
    :T144="hpnp/peripheral1.cfg":
</pre>
            </div>
            <br>
            <br>

            <p>If you are using the T144 option, you will need to
            create the configuration file. The sample configuration
            file from the HP Direct distribution is included
            below.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN5180"></a>
<pre class="SCREEN">
    #
    # Example HP Network Peripheral Interface configuration file
    #
    # Comments begin with '#' and end at the end of the line.
    # Blank lines are ignored.  Entries cannot span lines.
    
    # Name is the peripheral (or node) name.  It is displayed on the
    # peripheral's self-test page or configuration plot, and when sysName
    # is obtained through SNMP.  This name can be provided in the BOOTP
    # response or can be specified in the NPI configuration file to
    # prevent the BOOTP response from overflowing the packet.  The domain
    # portion of the name is not necessary because the peripheral does
    # not perform Domain Name System (DNS) searches.  Name is limited to
    # 64 characters.
    
    name: picasso
    
    # Location describes the physical location of the peripheral.  This
    # is the value used by the interface for the MIB-II sysLocation
    # object.  The default location is undefined.  Only printable ASCII
    # characters are allowed.  Maximum length is 64 characters.
    
    location: 1st floor, south wall
    
    # Contact is the name of the person who administers or services the
    # peripheral and may include how to contact this person.  It is
    # limited to 64 characters.  This is the value used by the interface
    # for the MIB-II sysContact object.  The default contact is undefined.
    # Only printable ASCII characters are allowed.  Maximum length is 64
    # characters.
    
    contact: Phil, ext 1234
    
    # The host access list contains the list of hosts or networks of
    # hosts that are allowed to connect to the peripheral.  The format
    # is "allow: netnum [mask]", where netnum is a network number or a
    # host IP address.  Mask is an address mask of bits to apply to the
    # network number and connecting host's IP address to verify access
    # to the peripheral.  The mask usually matches the network or subnet
    # mask, but this is not required.  If netnum is a host IP address,
    # the mask 255.255.255.255 can be omitted.  Up to ten access list
    # entries are permitted.
    
    # to allow all of network 10 to access the peripheral:
    allow: 10.0.0.0  255.0.0.0
    
    # to allow a single host without specifying the mask:
    allow: 15.1.2.3
    
    # Idle timeout is the time (in seconds) after which an idle
    # print data connection is closed.  A value of zero disables
    # the timeout mechanism.  The default timeout is 90 seconds.
    
    idle-timeout: 120
    
    # A community name is a password that allows SNMP access to MIB
    # values on the network peripheral.
    # Community names are not highly secure;
    # they are not encrypted across the network.  The get community name
    # determines which SNMP GetRequests are responded to.  By default,
    # the network peripheral responds to all GetRequests.  The get
    # community name is limited to 32 characters.
    
    #
    # For hpnpstat and hpnpadmin, the community name can be stored in
    # /usr/lib/hpnp/hpnpsnmp.
    
    get-community-name: blue
    
    # The set community name is similar to the get community name.  The
    # set community name determines which SNMP SetRequests are responded
    # to.  In addition, SetRequests are only honored if the sending host
    # is on the host access list.  By default, the network peripheral
    # does not respond to any SetRequests.  The set community name is
    # limited to 32 characters.
    #
    # The set community name can come from /usr/lib/hpnp/hpnpsnmp if it
    # is the same as the get community name.  We recommend that the set
    # community name be different from the get community name though.
    
    set-community-name: yellow
    
    # SNMP traps are asynchronous notifications of some event
    # that has occurred.
    # SNMP traps are useful only with network management software.
    # Traps are sent to specific hosts and include a trap community
    # name.  Up to four hosts can be sent SNMP traps.
    # The trap community name is limited to
    # 32 characters.  The default name is public.
    
    trap-community-name: red
    
    # The SNMP trap destination list specifies systems to which SNMP
    # traps are sent.  Up to four IP addresses are allowed.  If no
    # trap destinations are listed, traps are not sent.
    
    trap-dest: 15.1.2.3
    trap-dest: 15.2.3.4
    
    # The SNMP authentication trap parameter enables or disables the
    # sending of SNMP authentication traps.  Authentication traps indicate
    # that an SNMP request was received and the community name check
    # failed.  By default, the parameter is off.
    
    authentication-trap: on
    
    # The syslog-facility parameter sets the source facility identifier
    # that the card uses when issuing syslog messages.  Other facilities,
    # for example, include the kernel (LOG_KERN), the mail system
    # (LOG_MAIL), and the spooling system (LOG_LPR).  The card only allows
    # its syslog facility to be configured to one of the local user values
    # (LOG_LOCAL0 through LOG_LOCAL7).  The selectible option strings,
    # local0 through local7 (configured to LOG_LOCAL0 through LOG_LOCAL7,
    # respectively) are case insensitive.  The default syslog-facility
    # for the card is LOG_LPR.
    
    syslog-facility: local2
    
    # This parameter allows the card to treat hosts on other subnets as
    # if the hosts were on the card's subnet.  This parameter determines
    # the TCP Maximum Segment Size (MSS) advertised by the card to hosts
    # on other subnets and affects the card's initial receive-window
    # size.  The card will use a TCP MSS of 1460 bytes for local hosts,
    # and 536 bytes for a non-local host.  The default is off, that is,
    # the card will use the maximum packet sizes only on the card's
    # configured subnet.
    #
    # The configuration utility does not allow access to this parameter.
    # If you want to configure it, you must manually edit the NPI
    # configuration file and add it to the bottom of the entry for the
    # network peripheral.
    
    subnets-local: on
    
    # This parameter affects how the card handles TCP connection requests
    # from the host.  By default, the JetDirect MPS card will accept a
    # TCP connection even if the peripheral is off-line.  If this parameter
    # is set to "on", then the card will only accept a TCP connection
    # when the peripheral is on-line.
    
    old-idle-mode: off
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5182">11.7.4. Telnet
            Configuration</a></h3>

            <p>You can telnet to the JetDirect interface and use
            the command line mode. There is a very simple help
            facility available that you can invoke by entering <var
            class="LITERAL">?</var> at the prompt.</p>

            <p>Different versions of HP JetDirect cards have
            different commands. You will have to experiment to find
            out which ones are supported.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5187">11.7.5. Disabling
            Banner Page Generation</a></h3>

            <p>You can do this by making a telnet connection to the
            JetDirect interface and use the command line mode.
            There is a very simple help facility available that you
            can invoke by entering <var class="LITERAL">?</var> at
            the prompt.</p>

            <p>The configuration command <var class=
            "LITERAL">banner: 0</var> will disable banners. You may
            need to save the configuration after you have changed
            it and then do a power up reset of the printer to have
            it take effect.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5193">11.8. Problems With
          Network Print Servers</a></h2>

          <p>Most of the Network Print Servers are implemented
          using extremely simply software. The following is a list
          of some problems and what options the <b class=
          "APPLICATION">LPRng</b> software uses to handle them.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5197">11.8.1. Network
            Print Server Not Responding</a></h3>

            <p>Only a single TCP/IP connection is accepted at a
            time. This means that when one user is sending a job
            then the unit will not accept other connections. There
            is another side effect of this problem, which is that
            some implementations will accept a network connection
            but not read any data from the connection until the
            previous connection is finished.</p>

            <p>The deal with these problems the <var class=
            "LITERAL">connect_timeout</var>, <var class=
            "LITERAL">send_job_rw_timeout</var>, and <var class=
            "LITERAL">send_query_rw_timeout</var> are used to
            control job transfer and lpq status gathering. See <a
            href="#PRINTINGJOB">Printing Job Files</a> and <a href=
            "#OPENDEVICE">Opening the Output Device</a> for
            details.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5206">11.8.2. Network
            Print Server Does Not Handle LPQ, LPRM</a></h3>

            <p>Some Network Print Servers do not respond to <var
            class="LITERAL">lpq</var> or <var class=
            "LITERAL">lprm</var> queries correctly. The <var class=
            "LITERAL">remote_support</var> option can be used to
            solve this problem by specifying what operations the
            remote print server can handle:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN5212"></a>
<pre class="SCREEN">
    :remote_support=RMQVC
      R = lpr, M = lprmg, Q = lpq, V = lpq -v, C = lpc
      :remote_support=R  # printer only handles LPR
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN5214">11.8.3. Incomplete
            Job Transfers</a></h3>

            <p>This is the result of a defective or buggy TCP/IP
            stacks. A common problem is the habit that some Network
            Print Servers occaisionally discard data at the end of
            a print job when a network connection is <span class=
            "emphasis"><i class="EMPHASIS">half-closed</i></span>.
            A <span class="emphasis"><i class=
            "EMPHASIS">half-closed</i></span> connection is one
            where one end of the sending connection indicates that
            no further data will be sent. Unfortunately, the
            Network Print Server will then try to close the
            connection in the other direction. When this does not
            immediately succeed, it will terminate the network
            connection, discarding any unprinted data.</p>

            <p>The <var class="LITERAL">half_close</var> flag can
            be used to solve this problem. See <a href=
            "#NORMALTERM">Normal Termination</a> for more
            details.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN5222"></a>
<pre class="SCREEN">
    lp:lp=lp@remote        # shutdown(fd,WRITE) connection, wait for end
    lp:lp=lp@remote:half_close@    # close() connection and do not wait
</pre>
            </div>
            <br>
            <br>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5224">11.9. Printing to a
          SMB (MicroSoft) Printer</a></h2>

          <p>Microsoft use the SMB (Simple Message Block) protocol
          to transfer files and print jobs to hosts and printers.
          SMB can be used over TCP/IP, NetBEUI, IPX, and other
          lower level network protocols.</p>

          <p>Unfortunately, most printers do not provide detailed
          status or error reports when using the SMB protocol.
          There are a very large number of printers that have
          deficient SMB support that causes problems when used in a
          high traffic or high throughput environment.</p>

          <p>It is highly recommended that this protocol not be
          used unless there is no alternative.</p>

          <p>If you have a printer or a remote print spooler that
          supports SMB You can use the <a href="#SMB">SAMBA</a> <b
          class="APPLICATION">smbclient</b> program to send a print
          job to an SMB client. The following is a sample Shell
          Script script which you can use:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5232"></a>
<pre class="SCREEN">
    #!/bin/sh -x
    # This script is an input filter for printing on a unix machine. It
    # uses the smbclient program to print the file to the specified smb-based
    # server and service.
    # The 'smb' printcap entry below shows how to configure LPRng
    # for printing
    #
    # smb:
    #  :lp=|/usr/local/samba/smbprint
    #  :sd=/var/spool/smb:
    #  :filter= ... filter ...
    #
    # The /var/spool/smb/.config file should contain:
    #   server="PC_SERVER"
    #   service="PR_SHARENAME"
    #   password="PASSWORD"
    #
    # Set PC_SERVER to the server, PR_SHARENAME to the printer,
    # and PASSWORD to the password for this service.
    #
    # E.g.
    #   server=PAULS_PC
    #   service=CJET_371
    #   password=""
    #
    #
    config_file=.config
    if [ -f $config_file ] ; then
        eval `/bin/cat $config_file`
    fi
    #
    # NOTE You may wish to add the line `echo translate'
    # if you want automatic
    # CR/LF translation when printing.
    (
    #   echo translate
        echo "print -"
        /bin/cat
    ) | /usr/local/bin/smbclient "\\\\$server\\$service" \
       "$password" -U "$server" -N -P 1&gt;&amp;2
</pre>
          </div>
          <br>
          <br>

          <p>If the above script was in <tt class=
          "FILENAME">/usr/local/libexec/filters/smbprint</tt>, the
          printcap entry for this printer would be:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5236"></a>
<pre class="SCREEN">
    pauls_pc:
      :sd=/var/spool/lpd/%P
      # we filter the output
      :lp=|/usr/local/libexec/filters/smbprint
      # you can add filters if you want to do specific actions
      :ifhp=model=hp4
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5238">11.10. Printing to
          AppleTalk Printers</a></h2>

          <p>The <a href="#APPLETALK">netatalk</a> package comes
          with the <b class="APPLICATION">pap</b> program that can
          be used to transfer jobs using the AppleTalk protocol. A
          printcap entry for a network printer looks like the
          following:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5243"></a>
<pre class="SCREEN">
    atalk:
      :lp=| -$ /usr/local/atalk/bin/pap -e -p "npbname"
      :sd=/var/spool/lpd/atalk
      :ifhp=model=ps,status@
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">-$</var> suppress the
          addition of extra parameters to the <b class=
          "APPLICATION">pap</b> command line. The <b class=
          "APPLICATION">pap</b> program must be SETUID root and
          executable only by root or group <var class=
          "LITERAL">daemon</var>. This can be done by using the
          following script:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5250"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {309}</samp> <kbd class=
"USERINPUT">cd /usr/local/atalk/bin</kbd>
    <samp class="PROMPT">h4: {310}</samp> <kbd class=
"USERINPUT">chown root pap</kbd>
    <samp class="PROMPT">h4: {311}</samp> <kbd class=
"USERINPUT">chgrp daemon pap</kbd>
    <samp class="PROMPT">h4: {312}</samp> <kbd class=
"USERINPUT">chmod 550 pap</kbd>
    <samp class="PROMPT">h4: {313}</samp> <kbd class=
"USERINPUT">chmod s+u pap</kbd>
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5262">11.11. Parallel Port
          Printers</a></h2>

          <p>When installing a parallel port printer, there are
          three elements of concern: the physical hardware
          connection (cable and connectors), the IO device and
          Operating System support, and finally the print spooler
          support for the device.</p>

          <p>Originally most parallel port devices were strictly
          <span class="emphasis"><i class="EMPHASIS">write
          only</i></span> with a minimum amount of error
          information - only hardware signals for <span class=
          "emphasis"><i class="EMPHASIS">online</i></span>, <span
          class="emphasis"><i class="EMPHASIS">out of
          paper</i></span> and <span class="emphasis"><i class=
          "EMPHASIS">fault</i></span> were present. Due to the lack
          of any other way to interface devices to the Intel based
          PC platform, desperate hardware designers in search of a
          cheap (free?) way to interface their IO devices developed
          ways to manipulate the signals and do <span class=
          "emphasis"><i class="EMPHASIS">bidirectional</i></span>
          communication. Needless to say, no two companies
          developed the same methods, and no two companies were
          compatible with any other companies method.</p>

          <p>In 1994, the IEEE 1284 standard was first developed,.
          The following information is courtesy of Warp Nine
          Engineering, of San Diego, CA, from the <a href=
          "http://www.fapo.com/1284int.htm" target=
          "_top">http://www.fapo.com/1284int.htm</a> web page.</p>

          <p>When IBM introduced the PC, in 1981, the parallel
          printer port was included as an alternative to the slower
          serial port as a means for driving the latest high
          performance dot matrix printers. The parallel port had
          the capability to transfer 8 bits of data at time whereas
          the serial port transmitted one bit at a time. When the
          PC was introduced, dot matrix printers were the main
          peripheral that used the parallel port. As technology
          progressed and the need for greater external connectivity
          increased, the parallel port became the means by which
          you could connect higher performance peripherals. These
          peripherals now range from printer sharing devices,
          portable disk drives and tape backup to local area
          network adapters and CD ROM players.</p>

          <p>The problems faced by developers and customers of
          these peripherals fall into three categories. First,
          although the performance of the PC has increased
          dramatically, there has been virtually no change in the
          parallel port performance or architecture. The maximum
          data transfer rate achievable with this architecture is
          around 150 kilobytes per second and is extremely software
          intensive. Second, there is no standard for the
          electrical interface. This causes many problems when
          attempting to guarantee operation across various
          platforms. Finally, the lack of design standards forced a
          distance limitation of only 6 feet for external
          cables.</p>

          <p>In 1991 there was a meeting of printer manufacturers
          to start discussions on developing a new standard for the
          intelligent control of printers over a network. These
          manufacturers, which included Lexmark, IBM, Texas
          Instruments and others, formed the Network Printing
          Alliance. The NPA defined a set of parameters that, when
          implemented in the printer and host, will allow for the
          complete control of printer applications and jobs. While
          this work was in progress it became apparent that to
          fully implement this standard would require a high
          performance bi-directional connection to the PC. The
          usual means of connection, the ordinary PC parallel port,
          did not have the capabilities required to meet the full
          requirements or abilities of this standard.</p>

          <p>The NPA submitted a proposal to the IEEE for the
          creation of a committee to develop a new standard for a
          high speed bi-directional parallel port for the PC. It
          was a requirement that this new standard would remain
          fully compatible with the original parallel port software
          and peripherals, but would increase the data rate
          capability to greater than 1M bytes per second, both in
          and out of the computer. This committee became the IEEE
          1284 committee. The IEEE 1284 standard, "Standard
          Signaling Method for a Bi-directional Parallel Peripheral
          Interface for Personal Computers", was approved for final
          release in March of 1994.</p>

          <p>Even if your hardware has support for the IEEE 1284
          high speed bidirectional data transfers, your Operating
          System drivers must support it. Unfortunately, there is
          no universal agreement on the capabilities that should be
          provided by the low level printer port device drivers,
          and the method for supporting them. A good example of the
          problem of OS support and drivers is given by the Linux
          Parallel Port group, currently headed by Tim Waugh, and
          which is documented in the <a href=
          "http://people.redhat.com/twaugh/parport/" target=
          "_top">http://people.redhat.com/twaugh/parport/</a> and
          <a href=
          "http://people.redhat.com/twaugh/parport/html/parportguide.html"
           target=
          "_top">http://people.redhat.com/twaugh/parport/html/parportguide.html</a>
          web pages.</p>

          <p>Given this state of affairs, it should be no surprise
          that there is no support for bidirectional parallel port
          printers in <b class="APPLICATION">LPRng</b>. In fact, it
          turns out that there are severe problems with many Unix
          implementations that cause extreme headaches. These
          include:</p>

          <ul>
            <li>
              <p>While a parallel port may be opened Read/Write, a
              <code class="FUNCTION">read()</code> will either
              block indefinitely or cause a major system failure
              (crash).</p>
            </li>

            <li>
              <p>There is no buffering of data in the low level
              driver; that is, once a <code class=
              "FUNCTION">write()</code> starts, then the process
              will block until the data is written out. If the
              <code class="FUNCTION">write()</code> call is
              interrupted by a <span class="emphasis"><i class=
              "EMPHASIS">signal</i></span> and not immediately
              restarted, then the status returned by the <code
              class="FUNCTION">write()</code> may be an error
              indication (<var class="LITERAL">-1</var>) or the
              numbers of bytes that were actually written. If an
              error is returned, then an unknown number were
              written and the print job must be aborted.</p>
            </li>

            <li>
              <p>Many Operating systems do not implement a <code
              class="FUNCTION">select()</code> functionality for
              the parallel port, which means that it is difficult
              to do a multi-threaded implementation. Instead, a
              polling method must be used.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The good news is that on all known systems, if the
          parallel port device is opened exclusively for writing,
          and a blocking <code class="FUNCTION">write()</code> is
          used, and the <code class="FUNCTION">write()</code> is
          not interrupted, and there are no device errors, then
          data is delivered correctly to the device.</p>

          <p>In most UNIX systems the printer port has the name <tt
          class="FILENAME">/dev/lpt</tt>, <tt class=
          "FILENAME">/dev/prn</tt>, or something similar. On most
          systems the <b class="APPLICATION">dmesg</b> utility will
          print a list of IO devices found during system
          configuration. Use the following commands to get the
          information and scan for the device. You should also make
          sure that the printer device is available.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5303"></a>
<pre class="SCREEN">
    dmesg &gt;/tmp/a
    grep lp /tmp/a
    ls /dev/lp*
</pre>
          </div>
          <br>
          <br>

          <p>Gordon Haverland <code class="EMAIL">&lt;<a href=
          "mailto:haverlan@agric.gov.ab.ca">haverlan@agric.gov.ab.ca</a>&gt;</code>
          supplied this little script, that will assist with
          this:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5307"></a>
<pre class="SCREEN">
    #!/bin/sh
    #set -v -x              # uncomment for debugging
    PATH=/bin:/usr/bin
    printer=
    for printer in /dev/lp* ;
    do
        echo PRINTER TEST to $printer 1&gt;&amp;2
        for i in 1 2 3 4 5 6 7 8 9;
        do
            echo PRINTER $printer $i &gt; $printer;
        done
        echo -e \\r\\f &gt; $printer
    done
    exit 0;
</pre>
          </div>
          <br>
          <br>

          <p>If your printer is connected to the device name you
          provided, then you should get a page of something out. If
          the output suffers from the <span class="emphasis"><i
          class="EMPHASIS">staircase</i></span> effect, you will
          see the numbers marching across the page, otherwise the
          numbers will all be in a single column.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECSERIAL">11.12. Serial
          Printers</a></h2>

          <p>If your printer is attached by a serial line, then you
          may need to set the serial line characteristics before
          sending the job to the printer. Here are a set of
          guidelines to following when attaching a serial port
          printer to a serial line.</p>

          <p>1. Check to make sure that the line is not enabled for
          login. Logins are usually managed by the <b class=
          "APPLICATION">getty</b> (BSD) or <b class=
          "APPLICATION">ttymon</b> (Solaris, SystemV). Check your
          system documentation and make sure that these daemons are
          not managing the serial line.</p>

          <p>2. Check the permissions and ownership of the serial
          line. For the most easy testing, set the permissions to
          0666 (everybody can open for reading and writing). After
          you have made sure that you can send jobs to the printer,
          you might want to change the ownership of the serial line
          to the <b class="APPLICATION">lpd</b> server and change
          the permissions to 0600.</p>

          <p>3. Make sure that you can print a test file on the
          printer via the serial port. This may require setting the
          line characteristics and then sending a file to the
          printer. You should try to use 8 bit, no parity, with
          hardware flow control and no special character
          interpretation, and definitely no LF to CR/LF
          translation. The problem is that different versions of
          UNIX systems have different sets of stty(1) commands to
          do this. The following simple test script can help in
          this.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5320"></a>
<pre class="SCREEN">
    #!/bin/sh
    # 9600, no echo, no CR
    FLAGS= 9600 -raw -parenb cs8 crtscts
    DEV= /dev/tty01
    (stty $FLAGS; stty 1&gt;&amp;2; cat $1 ) &lt;$DEV &gt;$DEV
</pre>
          </div>
          <br>
          <br>

          <p>This shows using stty to set the flags, then to print
          the current settings, and then using cat a file to the
          output. If you attach a dumb terminal to the serial port,
          you can even use this script to ensure that input from
          the device is echoed to the output with the correct
          speed, parity, etc.</p>

          <p>Experience has shown that serially connected printers
          are the least reliable and lowest speed. Where possible,
          it is strongly recommended that they be attached to a
          <span class="emphasis"><i class="EMPHASIS">network print
          box</i></span> which will provide a Socket API interface
          and handle the low level network to serial port protocol
          conversions.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="PRINTCAPREF"></a>Chapter 12. Printcap
        Database</h1>

        <p>As described in the <a href="#OVERVIEW">Print Spooling
        Overview</a>, the heart of the <b class=
        "APPLICATION">LPRng</b> system is information in the <tt
        class="FILENAME">printcap</tt> file. The printcap
        information specifies:</p>

        <ol type="1">
          <li>
            <p>The print queues available to users.</p>
          </li>

          <li>
            <p>How client programs communicate with the <b class=
            "APPLICATION">lpc</b> print server.</p>
          </li>

          <li>
            <p>The configuration, location, and other information
            for each print queue on the print server.</p>
          </li>

          <li>
            <p>How the <b class="APPLICATION">lpd</b> server
            processes jobs in each print queue.</p>
          </li>
        </ol>
        <br>
        <br>

        <p>In order to explain a complex subject, we will start
        with a set of simple printer configurations, and explain
        the purpose and effect of each entry in the printcap.</p>

        <p>For details about individual printcap options, see the
        <span class="CITEREFENTRY"><span class=
        "REFENTRYTITLE">printcap</span>(5)</span> man page from the
        <b class="APPLICATION">LPRng</b> distribution, or use the
        <a href="#OPTIONINDEX">Index To All The Configuration and
        Printcap Options</a> to find a specific printcap option and
        its effects.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTCAPPARSE">12.1. The
          Printcap Parsing Rules</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">client</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">printcap entry
              valid only for client programs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">oh=</var><span class=
              "emphasis"><i class="EMPHASIS">hosts where printcap
              entry valid</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">server</var><span class=
              "emphasis"><i class="EMPHASIS">printcap entry valid
              only for lpd server</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">tc</var><span class=
              "emphasis"><i class="EMPHASIS">add named printcap
              entry contents</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>In this section, we will discuss the remaining tricky
          parts of the <b class="APPLICATION">LPRng</b> printcap
          database: combined client and server printcaps, host
          specific printcap entries, and the <var class=
          "LITERAL">tc</var> <span class="emphasis"><i class=
          "EMPHASIS">include</i></span> facility.</p>

          <p>The following is a complete description of how a
          printcap file is processed:</p>

          <ol type="1">
            <li>
              <p>When processing a printcap file, the <b class=
              "APPLICATION">LPRng</b> software reads and parses
              each entry individually. Leading whitespace is
              removed. Lines starting with <var class=
              "LITERAL">#</var> and blank lines are ignored.</p>
            </li>

            <li>
              <p>Lines ending with <var class="LITERAL">\</var>
              will have the <var class="LITERAL">\</var> discarded,
              and all lines of a printcap entry are joined by
              removing the line separators (<var class=
              "LITERAL">\n</var>) and replacing them with a
              space.</p>
            </li>

            <li>
              <p>The printcap entry is parsed, and the printcap
              name, aliases, and options are determined. Colons
              <var class="LITERAL">:</var> act as option
              separators, and leading and trailing whitespaces are
              removed.</p>
            </li>

            <li>
              <p>Options are sorted and except for the <var class=
              "LITERAL">tc=...</var> option only the last option
              setting is retained.</p>
            </li>

            <li>
              <p>If an option value requires a colon, then the <var
              class="LITERAL">\:</var> or <var class=
              "LITERAL">\072</var>, the same escaped character
              value as used in the C, Perl, tcl, and other
              programming languages, can be used.</p>
            </li>

            <li>
              <p>Client programs will discard a printcap entry with
              a <var class="LITERAL">server</var> option and server
              programs will discard a printcap entry with a <var
              class="LITERAL">client</var> options.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">oh</var> (<span class=
              "emphasis"><i class="EMPHASIS">o</i></span>n this
              <span class="emphasis"><i class=
              "EMPHASIS">h</i></span>ost) option specifies a list
              of IP addresses and mask pairs or glob strings which
              are used to determine if this printcap entry is valid
              for this host (see discussion below).</p>
            </li>

            <li>
              <p>After the above processing, if there is an
              existing termcap entry with the same name, the two
              sets of options are combined, with the last option
              setting retained except for the <var class=
              "LITERAL">tc</var> entries which are combined.</p>
            </li>

            <li>
              <p>When a printcap entry is actually used, the
              printcap entries listed by the <var class=
              "LITERAL">tc</var> include option are extracted and
              combined in order. This allows include entries to
              appear after the referring printcap entry. Then
              printcap options will be combined with the included
              ones. This has the effect that the options specified
              in the printcap entry will override the ones from the
              <var class="LITERAL">tc</var> included entries.</p>
            </li>

            <li>
              <p>Finally, each string printcap option with a <span
              class="emphasis"><i class="EMPHASIS">%X</i></span>
              value has <span class="emphasis"><i class=
              "EMPHASIS">%X</i></span> replaced by the following
              values. Unspecified values will not be modified.</p>

              <div class="INFORMALTABLE">
                <a name="AEN5414"></a>

                <table border="1" frame="border" rules="all" class=
                "CALSTABLE">
                  <col>
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Key</th>

                      <th>Value</th>

                      <th>Purpose</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td><var class="LITERAL">%P</var></td>

                      <td>printcap entry primary name</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%Q</var></td>

                      <td>queue requested</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%h</var></td>

                      <td>short host name (host)</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%H</var></td>

                      <td>fully qualified host name
                      (host.dns.whatever)</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%R</var></td>

                      <td>remote printer (rp value)</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%M</var></td>

                      <td>remote host (rm value)</td>

                      <td>&nbsp;</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">%D</var></td>

                      <td>date in YYYY-MM-DD format</td>

                      <td>&nbsp;</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>When parsing multiple printcap files, these are
              processed in order, and all of their printcap entries
              are combined according to the above procedures. The
              <var class="LITERAL">tc</var> resolution and <span
              class="emphasis"><i class="EMPHASIS">%X</i></span>
              expansion is done after all the files have been
              processed.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>The following examples show how to use the above rules
          to your advantage. You can combine both client and server
          printcap information in a single file as well as dividing
          a printcap entry into several parts. Here is an
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5455"></a>
<pre class="SCREEN">
    # seen by both client and server
    lp1:lp=lp@pr1:mx=100
    lp1:sd=/usr/local/spool/lp1:mx=0
    # seen only by client
    lp2:lp=lp@pr2:client
    # seen only by server
    lp2:lp=/dev/lp:server
</pre>
          </div>

          <ol type="1">
            <li>
              <p>Printcap entries with the same name are combined.
              The first printcap entry, <var class=
              "LITERAL">lp1</var>, the information is seen by both
              client and server. The next printcap entry, with the
              same name <var class="LITERAL">lp1</var>, will be
              combined with the first one. The order of options is
              important - the entries are scanned in order and an
              option will have the last value set. Thus, after
              having read both the <var class="LITERAL">lp1</var>
              printcap entries, both client and server will
              have:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN5463"></a>
<pre class="SCREEN">
    lp1:lp=lp@pr1
      :mx=0
      :sd=/usr/local/spool/lp1
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>The <var class="LITERAL">lp2</var> has a client
              and server version. This is recommended when complex
              printcaps on multiple hosts and servers are used.
              Thus, the <b class="APPLICATION">LPRng</b> clients
              will see:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN5469"></a>
<pre class="SCREEN">
    lp1
      :lp=lp@pr1
      :mx=0
      :sd=/usr/local/spool/lp1
    lp2
      :client
      :lp=lp@pr2
</pre>
              </div>
              and the server will see: 

              <div class="INFORMALEXAMPLE">
                <a name="AEN5471"></a>
<pre class="SCREEN">
    lp1
      :lp=lp@pr1
      :mx=0
      :sd=/usr/local/spool/lp1
    lp2
      :lp=/dev/lp
      :server
</pre>
              </div>
              <br>
              <br>
            </li>
          </ol>
          <br>
          <br>

          <p>If you have multiple printers of the same type whose
          configuration is almost identical, then you can define a
          set of <span class="emphasis"><i class=
          "EMPHASIS">tc</i></span> only printcap entries containing
          common information and use the <var class=
          "LITERAL">tc</var> include facility.</p>

          <p>Printcap entry names may start with period (<var
          class="LITERAL">.</var>), question mark (<var class=
          "LITERAL">?</var>), or exclamation mark (<var class=
          "LITERAL">!</var>), followed by one or more alphanumeric
          , underscore (<var class="LITERAL">_</var>) or hyphen
          (<var class="LITERAL">-</var>) characters. Queue or
          printer names start with an alphanumeric character.
          Printcap entries whose names do not start with an
          alphanumeric character can only be used as targets of the
          <var class="LITERAL">tc</var> include facility. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5483"></a>
<pre class="SCREEN">
    .hp:
      :sd=/usr/local/spool/%P
      :mx=0
    hp1:tc=.hp,.filter
      :lp=lp@10.0.0.1
    hp2:tc=.hp,.filter
      :lp=lp@10.0.0.2
    .filter
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>

          <ol type="1">
            <li>
              <p>The <tt class="FILENAME">.hp</tt> and <tt class=
              "FILENAME">.filter</tt> printcap entities are not
              spool queue definitions. After <var class=
              "LITERAL">tc</var> include processing is completed,
              the printcap information would resemble:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN5491"></a>
<pre class="SCREEN">
    hp1
      :lp=lp@10.0.0.1
      :filter=/usr/local/libexec/filters/ifhp
      :mx=0
      :sd=/usr/local/spool/%P
    hp2
      :lp=lp@10.0.0.2
      :filter=/usr/local/libexec/filters/ifhp
      :mx=0
      :sd=/usr/local/spool/%P
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>The <var class="LITERAL">%X</var> processing will
              replace <var class="LITERAL">%P</var> with the
              printcap name, so we would have:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN5497"></a>
<pre class="SCREEN">
    hp1
      :lp=lp@10.0.0.1
      :filter=/usr/local/libexec/filters/ifhp
      :mx=0
      :sd=/usr/local/spool/hp1
    hp2
      :lp=lp@10.0.0.2
      :filter=/usr/local/libexec/filters/ifhp
      :mx=0
      :sd=/usr/local/spool/hp2
</pre>
              </div>
              <br>
              <br>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SIMPLE">12.2. Simple Client
          Printcap Entry</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">client</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">client printcap
              entry</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lp=</var><span class=
              "emphasis"><i class="EMPHASIS">destination printer
              information</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rm=</var><span class=
              "emphasis"><i class="EMPHASIS">remote host
              (machine)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rp=</var><span class=
              "emphasis"><i class="EMPHASIS">remote
              printer</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>I'll use this simple example to explain the basics of
          the <b class="APPLICATION">LPRng</b> printcap format and
          introduce some of the <b class="APPLICATION">LPRng</b>
          network configuration options. Here is a simple printcap
          file used to provide client programs (<var class=
          "LITERAL">lpr, lprm,</var> etc) with <span class=
          "emphasis"><i class="EMPHASIS">remote printer</i></span>
          and <span class="emphasis"><i class=
          "EMPHASIS">server</i></span> information.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5525"></a>
<pre class="SCREEN">
    # printer lp1
    lp1|printer1
      :rm=localhost
    # printer lp2 with continuation
    lp2:\
      :lp=pr@10.0.0.1:client
    # printcap lp3, to printer pr, with overrides
    lp3:rp=pr:rm=hp.private
      :force_localhost@
    # Simplest possible printcap entry - defaults for everything
    lp4
</pre>
          </div>

          <ol type="1">
            <li>
              <p>Lines starting with a <var class="LITERAL">#</var>
              sign are comments, and all leading and trailing <span
              class="emphasis"><i class=
              "EMPHASIS">whitespace</i></span>, i.e. - spaces,
              tabs, etc, are ignored. Empty lines are ignored as
              well.</p>
            </li>

            <li>
              <p>A printcap entry starts with the printcap entry
              <span class="emphasis"><i class=
              "EMPHASIS">name</i></span>, followed by one or more
              <span class="emphasis"><i class=
              "EMPHASIS">aliases</i></span>, followed by one or
              more options. In the above example we have three
              printcap entries: <var class="LITERAL">lp1</var> with
              an alias <var class="LITERAL">printer1</var> and <var
              class="LITERAL">lp2</var>, <var class=
              "LITERAL">lp3</var>, and <var class=
              "LITERAL">lp4</var> with no aliases.</p>
            </li>

            <li>
              <p>Aliases start with the <var class=
              "LITERAL">|</var> character and options with the <var
              class="LITERAL">:</var> character; tabs and spaces
              before and after the <var class="LITERAL">|</var> or
              <var class="LITERAL">:</var> characters and at the
              start and end of lines are ignored. You can use
              backslash (<var class="LITERAL">\</var>) at the end
              of a line to create a multi-line value for an option.
              The backslash will cause the next line to be appended
              to the current line; watch out for comments and ends
              of printcap entries if you use this facility. As you
              can see from the example, there is no <var class=
              "LITERAL">Name</var> printcap entry - this is part of
              the <var class="LITERAL">cm</var> option on the
              previous line.</p>
            </li>

            <li>
              <p>Options take the form of a keyword/value pair,
              i.e.-</p>

              <p class="LITERALLAYOUT">:option=value<br>
              :option#value&nbsp;&nbsp;&nbsp;(legacy,&nbsp;not&nbsp;advised&nbsp;for&nbsp;new&nbsp;systems)<br>

              :option<br>
              :option@</p>
              <br>
              <br>
            </li>

            <li>
              <p>Option names are case insensitive, but option
              values are not. While <var class="LITERAL">Ts</var>
              and <var class="LITERAL">ts</var> are the same option
              name, <var class="LITERAL">ts=Testing</var> and <var
              class="LITERAL">ts=testing</var> have their case
              preserved. A string or integer value is specified by
              <var class="LITERAL">option=value</var> or <var
              class="LITERAL">option#value</var>.</p>
            </li>

            <li>
              <p>The use of the legacy <var class=
              "LITERAL">option#value</var> form is <acronym class=
              "ACRONYM">NOT</acronym> recommended as some
              preprocessors and database systems will treat <span
              class="emphasis"><i class="EMPHASIS">#</i></span> as
              the start of a comment and delete the remainder of
              the line. This has caused great consternation for
              sysadmins who wonder why their NIS distributed
              printcap entries have been mysteriously
              truncated.</p>
            </li>

            <li>
              <p>If you want to set a string option to <span class=
              "emphasis"><i class="EMPHASIS">empty</i></span>
              value, use <var class="LITERAL">option=</var>. The
              <var class="LITERAL">option</var> will set it to <var
              class="LITERAL">1</var>. If an option value contains
              a colon, then use the C (or Perl or Tck/Tk) string
              escape <var class="LITERAL">\072</var> to represent
              the value.</p>
            </li>

            <li>
              <p>Boolean options are set TRUE (1) if no value
              follows the keyword and FALSE (0) by appending a <var
              class="LITERAL">@</var>. For example <var class=
              "LITERAL">sh</var> will set <var class=
              "LITERAL">sh</var> to TRUE and <var class=
              "LITERAL">sh@</var> to FALSE.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>There may be multiple options on the same line,
          separated by colons.</p>

          <p>Now let's examine the first printcap entry in detail.
          It is reproduced here for convenience:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5581"></a>
<pre class="SCREEN">
    # printer lp1
    lp1|printer1
      :rm=localhost
</pre>
          </div>

          <ol type="1">
            <li>
              <p>We start with a comment, followed by the printcap
              entry name and and alias. Aliases are useful when you
              want to refer to a single printer or print queue by
              different names. This can be useful in advanced
              printcap and print queue setups. By default, the
              remote printer name is the printcap entry name.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">rm</var> (remote machine
              or host) option specifies the name or IP address of
              the <b class="APPLICATION">lpd</b> host running <b
              class="APPLICATION">lpd</b>. In this example the
              remote host is <var class="LITERAL">localhost</var>
              or the machine that the client is running on and we
              assume that the <b class="APPLICATION">lpd</b> server
              is running on the localhost. Thus, we would
              communicate with printer <var class=
              "LITERAL">lp1@localhost</var>.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Let's look at the next printcap entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5595"></a>
<pre class="SCREEN">
    # printer lp2 with continuation
    lp2:\
      :lp=pr@10.0.0.1:client
</pre>
          </div>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">lp2</var> printcap entry
              illustrates the use (and abuse) of the <var class=
              "LITERAL">\</var> continuation. If you think about
              this, we have really defined a printcap entry of the
              form:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN5602"></a>
<pre class="SCREEN">
    lp2: :lp=pr@10.0.0.1:client
</pre>
              </div>
              &#13;<br>
              <br>

              <p>Luckily, <b class="APPLICATION">LPRng</b> ignores
              empty options like <var class="LITERAL">::</var>.
              While it is strongly recommended that <var class=
              "LITERAL">\</var> be avoided it may be necessary for
              compatibility with other system utilities.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">lp=pr@10.0.0.1</var>
              literal is an alternate way to specify a remote queue
              and server. If the <var class=
              "LITERAL">force_localhost</var> default is being
              used, then the <b class="APPLICATION">LPRng</b>
              clients will ignore the <var class=
              "LITERAL">10.0.0.1</var> address and still connect to
              <var class="LITERAL">pr@localhost</var>. There is
              further discussion about this in the next
              section.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">client</var> option
              explicitly labels client only printcap information.
              The <b class="APPLICATION">lpd</b> server will ignore
              any printcap with the <var class=
              "LITERAL">client</var> option. When constructing
              complex printcaps, this option is used to keep ensure
              that you have consistent printcap information.</p>
            </li>
          </ol>
          The following printcap entry shows how to override the
          <var class="LITERAL">force_localhost</var> default, and
          force the <b class="APPLICATION">LPRng</b> clients to
          connect directly to a remote server: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN5622"></a>
<pre class="SCREEN">
    lp3:rp=pr:rm=hp.private
      :force_localhost@
</pre>
          </div>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">rp=</var> (remote
              printer) remote print queue name to used when sending
              commands to the <b class="APPLICATION">lpd</b> print
              server.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">force_localhost@</var>
              literal is an example of a <span class="emphasis"><i
              class="EMPHASIS">flag</i></span> option. The <var
              class="LITERAL">@</var> sets the literal value to 0
              (false). We set <var class=
              "LITERAL">force_localhost</var> to false, which now
              allows the <b class="APPLICATION">LPRng</b> clients
              to connect directly to the specified remote printer.
              In this example, the <tt class=
              "FILENAME">hp.private</tt> could be a HP LaserJet
              Printer with a JetDirect interface, which supports
              the RFC1179 protocol.</p>
            </li>

            <li>
              <p>One disadvantages of sending a job directly to a
              printer using the above method is that <b class=
              "APPLICATION">lpr</b> program will not terminate or
              exit until all of the files have been transferred to
              the printer, and this may take a long time as the
              printer processes the files as they are received.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Now let's look at the last printcap entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5641"></a>
<pre class="SCREEN">
    # Simplest possible printcap entry - defaults for everything
    lp4
</pre>
          </div>
          <br>
          <br>

          <p>The last example is the simplest possible printcap
          entry. This will cause <b class="APPLICATION">LPRng</b>
          clients to use the default values for everything. The
          printer will be <var class="LITERAL">lp4</var>, i.e. -
          the name of the printcap, and the server will be <var
          class="LITERAL">localhost</var> if <var class=
          "LITERAL">force_localhost</var> is set, or the value of
          the <var class="LITERAL">default_remote_host</var>
          configuration option if it is not.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CM">12.3. Simple Server
          Printcap Example</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">cm=</var><span class=
              "emphasis"><i class="EMPHASIS">comment for
              status</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">filter=</var><span class=
              "emphasis"><i class="EMPHASIS">job
              filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lf=</var><span class=
              "emphasis"><i class="EMPHASIS">log
              file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">af=</var><span class=
              "emphasis"><i class="EMPHASIS">accounting
              file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lp=</var><span class=
              "emphasis"><i class="EMPHASIS">output
              device</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">mx=</var><span class=
              "emphasis"><i class="EMPHASIS">maximum job
              size</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sd=</var><span class=
              "emphasis"><i class="EMPHASIS">spool directory
              file</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The previous section discussed printcap entries for
          use by the client programs. Now we will discuss printcap
          entries for use by the <b class="APPLICATION">lpd</b>
          server. In simple configurations or when we have the <var
          class="LITERAL">force_localhost</var> option enabled we
          can use the same printcap for both <b class=
          "APPLICATION">LPRng</b> clients and the <b class=
          "APPLICATION">lpd</b> server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5687"></a>
<pre class="SCREEN">
    # Local ASCII printer
    lp1|printer
      :server
      :cm=Dumb printer
      :lp=/dev/lp1
      :sd=/var/spool/lpd/lp1
      :lf=log:af=acct
      :filter=/usr/local/libexec/filters/ifhp
      :mx=0
</pre>
          </div>
          <br>
          <br>

          <ol type="1">
            <li>
              <p>The printcap entry name is <var class=
              "LITERAL">lp1</var>. This information will be
              displayed when requesting status information using
              the <b class="APPLICATION">lpq</b> program.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">printer</var> alias. This
              allows a single spool queue to have multiple
              names.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:server</var> option
              specifies this printcap entry is only used by <b
              class="APPLICATION">lpd</b> server.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:cm</var> field supplies
              a information field for <b class=
              "APPLICATION">lpq</b> (printer status) output.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:lp</var> value specifies
              the destination file, device or remote spool queue to
              which data is sent. In this example it is the device
              <tt class="FILENAME">/dev/lp1</tt>. By default, IO
              devices are opened for <span class="emphasis"><i
              class="EMPHASIS">write-only</i></span> operation.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:sd=/path</var> specifies
              the <span class="emphasis"><i class="EMPHASIS">spool
              directory</i></span> where print job files are stored
              until they are printed.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:lf</var> and <var class=
              "LITERAL">:af</var> options specify the names of the
              log and accounting files, respectively. These have
              the default values <var class="LITERAL">log</var> and
              <var class="LITERAL">acct</var> respectively. If not
              an absolute path, the file is relative to the spool
              queue directory. If these files don't exist, they
              will not be created, and no logging or accounting
              will be done. You will need to create them manually
              (e.g., by using <var class="LITERAL">touch</var>) or
              by using the <span class="emphasis"><i class=
              "EMPHASIS"><a href="#CHECKPC">checkpc</a></i></span>
              program. If you do not want a log or accounting file,
              then use <var class="LITERAL">:lf=</var>, i.e. - no
              value.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">:filter=/path</var>
              option specifies a filter program to be used to
              process job files. Filters and print formats are
              discussed in <a href="#FILTERS">Filters</a>.</p>
            </li>

            <li>
              <p><var class="LITERAL">mx</var> indicates the
              maximum file size for a print job. Specifying 0 means
              that there is no limit.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5732">12.4. Using :oh To
          Select Printcap Information</a></h2>

          <p>When administering a large number of printers over a
          large area, it is sometimes desirable to have a <span
          class="emphasis"><i class="EMPHASIS">default</i></span>
          printer for each host. This default printer may be
          different for each host, and can be selected by using the
          <var class="LITERAL">oh</var> entry. The <var class=
          "LITERAL">oh</var> value is a list of the following
          entries</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5738"></a>
<pre class="SCREEN">
    [!] IP/n     - address + mask length    10.0.0.0/8
    [!] IP/IP    - address + mask           10.0.0.0/255.0.0.0
    [!] vvv      - glob for hostname        pc*.org.com
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">LPRng</b> software will
          determine the hostnames and IP addresses assigned to the
          host and then check to see if there is a match in the
          listed hostnames or IP addresses. The optional test
          inversion (<var class="LITERAL">!</var>) causes the sense
          of the match to be inverted. The list of addresses or
          entries are tested in sequence until a match is found. If
          no match is found the printcap entry will not be used.
          For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5743"></a>
<pre class="SCREEN">
    lp:oh=*.admin.org.com,10.0.0.5,10.2.0.0/16:lp=pr1@server1
    lp:oh=*.eng.org.com:lp=hp@server2
    color:oh=*.eng.org.com:lp=color@server3
    color:oh=!*.eng.org.com:lp=color@server4
</pre>
          </div>
          <br>
          <br>

          <p>In the above example, if our host name is <tt class=
          "FILENAME">booster.admin.org.com</tt>, then we would use
          <var class="LITERAL">lp=pr1@server1</var>, as the <tt
          class="FILENAME">*.admin.org.com</tt> glob pattern would
          match our host name.</p>

          <p>if our host name is <tt class=
          "FILENAME">booster.dev.org.com</tt> and our IP address is
          10.2.0.1, then we would use <var class=
          "LITERAL">lp=pr1@server1</var>, as the <tt class=
          "FILENAME">10.2.0.0/16</tt> ip address would be in the
          specified address range.</p>

          <p>Finally we have an example of the use of the match
          inversion operator (<var class="LITERAL">!</var>). All
          hosts whose name matches <tt class=
          "FILENAME">*.eng.org.com</tt> will use <var class=
          "LITERAL">color@server3</var> and the others will use
          <var class="LITERAL">color@server4</var>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5758">12.5. Using the
          Wildcard Printcap Entry</a></h2>

          <p>The wildcard printcap name <var class=
          "LITERAL">*</var> is used to select a default or printcap
          entry when a match is not found in the printcap
          database.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5762"></a>
<pre class="SCREEN">
    # %P and %Q set to printer name
    *:lp=%P@server
    
    # %P set to 'printer', %Q set to printer name
    printer|*:lp=%P@server
</pre>
          </div>
          <br>
          <br>

          <p>When searching for printcap information, the <b class=
          "APPLICATION">LPRng</b> software will first search for an
          exact match for a printcap entry against the printcap
          names and aliases. If non is found, it then searches for
          a wildcard entry and uses the first one found with a
          wildcard name or alias.</p>

          <p>If the wildcard <var class="LITERAL">*</var> is the
          printcap name, then the printer name (<var class=
          "LITERAL">%P</var> value) and queue (<var class=
          "LITERAL">%Q</var> value) are set to the name being
          searched for. If the wildcard is an alias, then then
          printer name is set to the printcap main entry name and
          the queue to the name being searched for.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5770">12.6. Enterprise
          Strength Printcap Example</a></h2>

          <p>Most system administrators want to have a single
          printcap file that can be distributed or referenced from
          all the hosts under their administrative control. The
          following show how several large institutions have
          organized their printcap information. It uses the
          following principles:</p>

          <ul>
            <li>
              <p>Many times it is necessary to partition groups of
              users into areas that have particular printing
              setups, but use the same queue name for different
              printers. This is done by using the <var class=
              "LITERAL">:oh</var> (on this host) option to select
              the printcap to be used.</p>
            </li>

            <li>
              <p>Provide as little information as possible to the
              systems that do not have print spoolers. This is
              because they will simply forward their requests to a
              print spooler and it is not necessary to have the
              information for a printer. As we will see in an
              example below, this can be very simple to do.</p>
            </li>

            <li>
              <p>Provide a default printer so that when the user
              does not have a printer explicitly selected then he
              will get well behaved results.</p>
            </li>

            <li>
              <p>For each family of printers, develop a standard
              method of interfacing to them. This means that the
              filter, options, and other things should be
              identical.</p>
            </li>

            <li>
              <p>For each server, provide a uniform set of
              standards for the spool queues for a printer. If the
              spool queue is simply used to store and forward jobs,
              then provide a standard default operation for this
              queue. If the spool queue directly feeds a printer,
              use the default options for the printer, and then
              refine them with printer specific information.</p>
            </li>
          </ul>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5785"></a>
<pre class="SCREEN">
    # client setups; note brutality of this method that
    #  assigns servers to clients based on their names
    #  you could do this for IP addresses as well
    # lp1 is default printer for Engineering
    #   Default client information
    .client=force_localhost@
    #
    lp1:oh=*.eng.com:lp=%P@server1.eng.com:tc=.client
    *:oh=*.eng.com:lp=%P@server1.eng.com:tc=.client
    color:oh-*.admin.com:lp=%P@server2.admin.com:tc=.client
    *:oh=*.admin.com:lp=%P@server2.admin.com:tc=.client
    lowres:lp=%P@general.services.com:tc=.client
    *:lp=%P@general.services.com:tc=.client
    
    # Standard Printer Configurations
    # this is for the HP4simx, we use a standard filter setup
    .cf_hp4simx
     :ifhp=model=hp4simx
     :filter=/usr/local/libexec/filters/ifhp
    .cf_hplj5000
     :ifhp=model=hp5000
     :filter=/usr/local/libexec/filters/ifhp
    # now we define the printers that use them
    .pr_eng1:cm=Engineering's Printer 1
     :tc=.cf_hplj5000:lp=10.0.0.2%9100
    .pr_eng2:cm=Engineering's Printer 2
     :tc=.cf_hplj5000:lp=10.0.0.23%9100
    
    # now we define the server entries
    # We set up server entries and then forward
    #  to a single server that sends the the printer
    
    .server
     :sd=/var/spool/lpd/%P
     :mx=0
    pr1:oh=!10.0.0.5:lp=%P@10.0.0.5:server:tc=.server
    pr1:oh=10.0.0.5:tc=.server
     :tc=.pr_eng1
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5787">12.7. Remote Printer
          Using RFC1179</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lp=</var><span class=
              "emphasis"><i class=
              "EMPHASIS">destination</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rm=</var><span class=
              "emphasis"><i class="EMPHASIS">remote host
              (machine)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rp=</var><span class=
              "emphasis"><i class="EMPHASIS">remote printer
              (machine)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>You can have the <b class="APPLICATION">lpd</b> server
          forward jobs to another server or print which supports
          the RFC1179 protocol by using the following printcap:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5805"></a>
<pre class="SCREEN">
    # Simplest
    remote|Remote Printer
       :lp=raw@server
    # historical
    remote:
      rp=raw:rm=server
    # Sometimes you have to connect to a non-standard port
    special:lp=lp@server%2000
</pre>
          </div>

          <ol type="1">
            <li>
              <p>If the <var class="LITERAL">lp</var> printer entry
              is present, it will override the <var class=
              "LITERAL">rm</var> and <var class="LITERAL">rp</var>
              printer entries.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">lp=pr@host</var> format
              specifies that the output device is actually a remote
              spool queue, and jobs should be transferred using
              RFC1179 protocol.</p>
            </li>

            <li>
              <p>By default, <b class="APPLICATION">LPRng</b> will
              attempt to <span class="emphasis"><i class=
              "EMPHASIS">sanitize</i></span> all jobs that it
              originates or forwards. This sanitization will result
              in an RFC1179 compliant <var class="LITERAL">control
              file</var>, and will not modify any of the job
              information.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5821">12.8. Remote Printer
          Using Socket API</a></h2>

          <p>If the spool queue destination is a remote printer
          supporting the Socket API, then you can have <b class=
          "APPLICATION">LPRng</b> open a connection directly to the
          printer. These include the older Apple printers with
          TCP/IP support and the HP JetDirect supported
          printers.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5825"></a>
<pre class="SCREEN">
    # Simplest
    remote
       :lp=10.24.2.3%9100
</pre>
          </div>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">lp=server%port</var> or
              <var class="LITERAL">lp=IPaddr%port</var> format
              specifies that <b class="APPLICATION">lpd</b> should
              open a TCP/IP connection to the remote host and
              simply transfer verbatum the files to be printed.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">sh</var> and <var class=
              "LITERAL">sf</var> will prevent <b class=
              "APPLICATION">lpd</b> from trying to generate banner
              pages or put form feeds between jobs.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>While this is the simplest printcap, it is also the
          most dangerous as there is nothing to prevent a malformed
          job from being sent to the printer. The next printcap
          example is much more robust:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5839"></a>
<pre class="SCREEN">
    # Simplest
    remote
       :lp=10.24.2.3%9100
       :of=/usr/local/libexec/filters/ifhp
       :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>

          <ol type="1">
            <li>
              <p>This version will use the <b class=
              "APPLICATION">ifhp</b> filter to precondition the
              printer and to process jobs. See <a href="#IFHP"><b
              class="APPLICATION">ifhp</b> Filter</a> for details.
              The <b class="APPLICATION">ifhp</b> filter will
              perform the appropriate printer resets, translate job
              information, and ensure correct printer operation in
              the presence of errors. It will also produce
              voluminous error messages and status information.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN5848">12.9. Parallel
          Printer</a></h2>

          <p>The parallel printer printcap is very simple.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5851"></a>
<pre class="SCREEN">
    # parallel printer
    lp:
       :lp=/dev/lpr
</pre>
          </div>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">lp=/dev/lpr</var>
              specifies that <b class="APPLICATION">lpd</b> should
              open the device for APPEND and simply transfer job
              files to it.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">sh</var> and <var class=
              "LITERAL">sf</var> will prevent <b class=
              "APPLICATION">lpd</b> from trying to generate banner
              pages or put form feeds between jobs.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>If you discover that UNIX print jobs result in a <span
          class="emphasis"><i class="EMPHASIS">staircase</i></span>
          appearance, then you need to force your printer to do
          <acronym class="ACRONYM">LF</acronym> (linefeed) to <tt
          class="FILENAME">CR/LF</tt> (carriage return/line feed)
          translation, or do the translation yourself.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5867"></a>
<pre class="SCREEN">
    # Simple parallel printer
    lp:
       :lp=/dev/lpr
       :filter=/usr/local/bin/lpf
</pre>
          </div>
          <br>
          <br>

          <p>By using the <var class="LITERAL">if=...lpf</var>
          filter, the job will be passed through the <b class=
          "APPLICATION">lpf</b> filter, which will do the <acronym
          class="ACRONYM">LF</acronym> to <tt class=
          "FILENAME">CR/LF</tt> translation.</p>

          <p>If you have a more complex printer that handles
          PostScript, PCL, and PJL, then you will need to use the
          more powerful <b class="APPLICATION">ifhp</b> filter:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5876"></a>
<pre class="SCREEN">
    # Simple parallel printer
    lp:
       :lp=/dev/lpr
       :ifhp=model=hp4,status@
       :of=/usr/local/libexec/filters/ifhp
       :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>

          <p>See <a href="#IFHP"><b class="APPLICATION">ifhp</b>
          Filter</a> for details. This entry will specify that the
          printer is an HP4, and that no status information is
          available. This is usually the case with a parallel
          port.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SERIAL">12.10. Serial
          Printer</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">br=</var><span class=
              "emphasis"><i class="EMPHASIS">serial port bit
              rate</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rw</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">device opened
              RW</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">stty=</var><span class=
              "emphasis"><i class="EMPHASIS">stty options for
              serial port configuration</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The following is a typical printcap for a serial
          printer:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5898"></a>
<pre class="SCREEN">
    # Local Serial ASCII printer
    lp2
      :lp=/dev/ttya
      :rw
      :cm=Serial printer
      :sd=/var/spool/lpd/lp2
      :stty=9600 -echo -crmod -raw -oddp -evenp pass8 cbreak ixon
      :filter=/usr/local/sbin/lpf
      :mx=0
</pre>
          </div>
          <br>
          <br>

          <p>Let's examine the new options:</p>

          <ol type="1">
            <li>
              <p>A serial port is usually <span class="emphasis"><i
              class="EMPHASIS">bidirectional</i></span>, and
              printers will report errors back to the host
              computer. The <var class="LITERAL">rw</var> flag will
              cause the printer port to be opened <var class=
              "LITERAL">read-write</var>, and the <b class=
              "APPLICATION">lpd</b> server will report status
              information.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">stty</var> option
              specifies the <tt class="COMMAND">stty(1)</tt> flags
              and line speed needed to configure the serial line
              (See <a href="#SECSERIAL">Serial Printers</a> for
              details).</p>
            </li>

            <li>
              <p>The legacy <var class="LITERAL">br</var> (bit
              rate) option can be used to specify the line speed as
              well.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPDBOUNCE">12.11. Bounce
          Queue</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpd_bounce</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">produces a
              single file for forwarding</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bq_format=</var><span class=
              "emphasis"><i class="EMPHASIS">format of filtered
              files</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>When the destination of a spool queue is another spool
          queue the job is simply forwarded without any
          modifications. However, sometimes it is essential that
          the job be modified before forwarding, as when the remote
          spool queue is actually a printer, and jobs need to be
          converted to the format acceptable by the remote printer
          or banner pages added.</p>

          <p>The <var class="LITERAL">lpd_bounce</var> flag marks a
          spool queue as a bounce queue. <var class=
          "LITERAL">Lpd</var> will perform all of the usually job
          processing steps, such as banner generation, filtering
          files, etc, but saves the output to a file. This file is
          then sent to the destination print queue for further
          processing.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5933"></a>
<pre class="SCREEN">
    # Simple example of a bounce queue
    bounce:lp=bounce@bouncehost
    bounce:server
        :lp=lp@remote
        :lpd_bounce
        :sd=/var/spool/lpd/%P
        :filter=/usr/local/bin/lpf
        # uncomment ab if you want banner
        #:ab
</pre>
          </div>
          <br>
          <br>

          <p>Some comments:</p>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">lpd_bounce</var> option
              marks the job as a bounce queue, and the <b class=
              "APPLICATION">lpd</b> server will process the job
              through the appropriate filter programs.</p>
            </li>

            <li>
              <p>The printcap has filter specifications for
              different job formats. These are the programs that
              will be used by <b class="APPLICATION">LPRng</b> to
              process the job.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">bq_format</var> specifies
              the job format for the output file sent to the remote
              spool queue. If not specified, it defaults to <var
              class="LITERAL">l</var> (literal or binary).</p>
            </li>

            <li>
              <p>The <var class="LITERAL">ab</var> (always print a
              banner) flag will force a banner to be added to the
              job. The banner generation is done as discussed in <a
              href="#BANNERPRINTING">Banner Printing</a>.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="TRANSLATEFORMAT">12.12. Job
          Format Translation</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">translate_format=</var><span
              class="emphasis"><i class="EMPHASIS">change outgoing
              job file formats</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">translate_incoming_format=</var><span
              class="emphasis"><i class="EMPHASIS">change incoming
              job file formats</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A rarely encountered problem is when a job is printed
          with one format but for compatibility needs to be
          processed with another. The simple <var class=
          "LITERAL">translate_format=vlxf</var> option will rename
          format <var class="LITERAL">x</var> files to <var class=
          "LITERAL">f</var> format.</p>

          <p>This can be used to resolve problems with PC based
          software, which spools jobs using the <var class=
          "LITERAL">v</var> format. Unfortunately, many RCF1179
          print spoolers do not understand the <var class=
          "LITERAL">v</var> format and mishandle the job. A simple
          forwarding queue with the following entries will rename
          <var class="LITERAL">v</var> format to <var class=
          "LITERAL">l</var> (binary) format.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5974"></a>
<pre class="SCREEN">
    lp
      :sd=/var/spool/lpd/%P
      :translate_format=vl
      :lp=lp@printerserver
</pre>
          </div>
          <br>
          <br>

          <p>The <var class=
          "LITERAL">translate_incoming_format</var> will do the
          same thing, but this time on incoming jobs.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="DESTINATIONS">12.13. Dynamic
          Routing</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">destinations=</var><span
              class="emphasis"><i class="EMPHASIS">destinations for
              jobs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">router=</var><span class=
              "emphasis"><i class="EMPHASIS">router
              program</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> has the ability to
          route a job to one or more destinations in a dynamic
          manner. This is not the same as <span class="emphasis"><i
          class="EMPHASIS">load balancing</i></span>, as the
          destinations are hard coded and not able to be changed.
          This is accomplished by having a <var class=
          "LITERAL">router</var> filter generate a set of
          destinations. Here is a sample printcap entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN5994"></a>
<pre class="SCREEN">
    t2|Test Printer 2
        :sd=/var/spool/LPD/t2
        :lf=log
        :destinations=t1@server1,t1@server2,t1@localhost
        :router=/usr/local/LPD/router
</pre>
          </div>
          <br>
          <br>

          <p>When a job arrives at the <b class=
          "APPLICATION">lpd</b> server, the 'router' filter is
          invoked with the standard filter options which include
          the user, host, and other information obtained from the
          control file. <acronym class="ACRONYM">STDIN</acronym> is
          connected to a temporary copy of the control file, and
          the CONTROL environment variable is set to the value of
          the actual control file itself.</p>

          <p>The routing filter exit status is used as follows:</p>

          <ul>
            <li>
              <p>0 (JSUCC) - normal processing</p>
            </li>

            <li>
              <p>37 (JHOLD) - job is held</p>
            </li>

            <li>
              <p>any other value - job is deleted from queue</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The router filter writes to <acronym class=
          "ACRONYM">STDOUT</acronym> a file specifying the
          destinations for the job. The destinations entries in
          this file file have the following format. Entry order is
          not important, but each destination must end with the
          'end' tag.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6009"></a>
<pre class="SCREEN">
    dest (destination queue)
    copies (number of copies to be made)
    priority (priority letter)
    X(controlfile modifications)
    end
</pre>
          </div>
          <br>
          <br>

          <p>Example of router output:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6012"></a>
<pre class="SCREEN">
    dest t1@localhost
    copies 2
    CA
    priority B
    end
    dest t2@localhost
    CZ
    priority Z
    end
</pre>
          </div>
          <br>
          <br>

          <p>In this example, two copies of the job will be sent to
          the t1 and t2 spool queue servers. The Class (C letter
          value) and job priority information will be rewritten
          with the indicated values.</p>

          <p>If routing information is specified by the router
          filter the job will be sent to the default
          destination.</p>

          <p><b class="APPLICATION">lpq</b> will display job
          information in a slightly different format for multiple
          destination jobs. For example:</p>

          <p class="LITERALLAYOUT">
          Printer:&nbsp;t2@h4&nbsp;'Test&nbsp;Printer&nbsp;2'&nbsp;(routed/bounce&nbsp;queue&nbsp;to&nbsp;'t1@h2.private')<br>

          &nbsp;&nbsp;Queue:&nbsp;1&nbsp;printable&nbsp;jobs&nbsp;in&nbsp;queue<br>

          &nbsp;Rank&nbsp;&nbsp;Owner/ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class&nbsp;Job&nbsp;Files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;Time<br>

          active&nbsp;&nbsp;papowell@h4+707&nbsp;A&nbsp;707&nbsp;&nbsp;/tmp/hi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;10:04:49<br>

          &nbsp;-&nbsp;actv&nbsp;papowell@h4+707.1&nbsp;A&nbsp;707&nbsp;-&gt;t1@localhost&nbsp;&lt;cpy&nbsp;1/2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;10:04:49<br>

          &nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;papowell@lprng2+707.2&nbsp;A&nbsp;707&nbsp;-&gt;t2@localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;10:04:49</p>
          <br>
          <br>

          <p>The routing information is displayed below the main
          job information. Each destination will have its transfer
          status displayed as it is transferred. By convention, the
          job identifier of the routed jobs will have a suffix of
          the form .N added; copies will have CN added as well. For
          example, papowell@lprng2+707.1C2 will be the job sent to
          the first destination, copy two.</p>

          <p>Routed jobs can be held, removed, etc., just as normal
          jobs. In addition, the individual destination jobs can be
          manipulated as well. The LPC functionality has been
          extended to recognize destination jobids as well as the
          main job id for control and/or selection operations.</p>

          <p>The optional <var class="LITERAL">destinations</var>
          entry specifies the possible set of destinations that the
          job can be sent to, and is for informational purposes
          only. In order for <b class="APPLICATION">lpq</b> and <b
          class="APPLICATION">lprm</b> to find the job once it has
          been sent to <b class="APPLICATION">lpd</b>, <b class=
          "APPLICATION">lpq</b> and <b class="APPLICATION">lprm</b>
          uses the list of printers in the <var class=
          "LITERAL">destinations</var>, and iterates over list
          looking for the job that you are interested in.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LOADBALANCE">12.14. Printer
          Load Balancing</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">ss=</var><span class=
              "emphasis"><i class="EMPHASIS">queue served by
              printer</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sv=</var><span class=
              "emphasis"><i class="EMPHASIS">printers where jobs
              are sent (servers)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>In a large site, you could have several equivalent
          printers, which will be used by many people. The reason
          for this is, of course, to increase the printer output by
          enabling several jobs to be printed at once. A load
          balance print queue is one that feeds jobs to other
          queues and has a <var class="LITERAL">sv=q1,q2,...</var>
          printcap entry that specifies the destination or server
          queues. These must be print queue entries and have spool
          directories on the server.</p>

          <p>The service queues have a <var class=
          "LITERAL">ss=</var><span class="emphasis"><i class=
          "EMPHASIS">mainqueue</i></span> printcap entry This
          informs the <b class="APPLICATION">lpd</b> server that
          the queue operates under the control of the <span class=
          "emphasis"><i class="EMPHASIS">mainqueue</i></span> print
          queue, and is fed jobs from it.</p>

          <p>During normal operation, when the <b class=
          "APPLICATION">lpd</b> server has a job to print in the
          <span class="emphasis"><i class=
          "EMPHASIS">mainqueue</i></span>, it will check to see if
          there is an idle <span class="emphasis"><i class=
          "EMPHASIS">service</i></span> queue. If there is, it will
          transfer the job to the service queue spooling directory
          and start the service queue printing activities.</p>

          <p>Even though the queues are not meant for direct use,
          people can print directly to individual queues. This
          allows a specific load sharing printer to be used. If you
          wanted to <span class="emphasis"><i class=
          "EMPHASIS">hide</i></span> the load sharing printers,
          i.e. - not allow direct spooling to them, then you would
          simply remove the non-server entries from the
          printcap.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTCAPPATH">12.15. Locations
          of Printcap Files</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">printcap_path=</var><span
              class="emphasis"><i class="EMPHASIS">printcap file
              locations</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpd_printcap_path=</var><span
              class="emphasis"><i class="EMPHASIS">lpd server
              printcap information</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">printcap_path</var> and <var
          class="LITERAL">lpd_printcap_path</var> configuration
          options (see <a href="#CONFIGFILE">lpd.conf(5)</a> )
          specify a set of paths for the printcap information. If
          the <var class="LITERAL">lpd_printcap_path</var> is
          nonblank then the <b class="APPLICATION">lpd</b> server
          uses it, otherwise it uses the <var class=
          "LITERAL">printcap_path</var> information. Client
          programs use only <var class=
          "LITERAL">printcap_path</var>. The path names can be
          separated with whitespace, commas, semicolons, or colons.
          The default values are:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6074"></a>
<pre class="SCREEN">
    printcap_path      ${sysconfdir}/printcap
    lpd_printcap_path  (blank or empty)
</pre>
          </div>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN6076">12.15.1. Separate
            Server and Client Printcap Files</a></h3>

            <p>Since only the <b class="APPLICATION">lpd</b> server
            uses the printcap file specified by the <var class=
            "LITERAL">lpd_printcap_path</var>, you can place server
            specific information there. If this file is used it
            must also contain any required information in the <var
            class="LITERAL">printcap_path</var> file.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="ALLPC">12.15.2. <var class=
            "LITERAL">all</var> Printcap Entry</a></h3>

            <p>The <var class="LITERAL">all</var> printcap name and
            <var class="LITERAL">all</var> option is reserved to
            provide a list of printers available for use by the
            spooling software. This is a desperation, last ditch,
            back to the wall option for administrators with systems
            that do not have ways to provide a list of printcap
            entries. The 'all' printcap entry has the form:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6088"></a>
<pre class="SCREEN">
    all:all=pr1,pr2,...
</pre>
            </div>
            <br>
            <br>

            <p>The value of the <var class="LITERAL">all</var>
            option should be a list of printcap names whose values
            will then be extracted.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECOH">12.16. Single Printcap
          File for Large Installation</a></h2>

          <p>One of the major problems faced by administrators of
          large sites is how to distribute printcap information.
          They would like to have a single printcap file either
          distributed by a file server (NFS) or by some other
          method such as <var class="LITERAL">rdist</var>. By using
          the <var class="LITERAL">server</var> and <var class=
          "LITERAL">oh</var> tags, information for the specific
          sites can be separated out. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6098"></a>
<pre class="SCREEN">
    # printcap
    pr1:lp=pr1@serverhost1:oh=*.eng.site.com,130.191.12.0/24
    pr2:lp=pr1@serverhost1:oh=*.eng.site.com,130.191.12.0/24
    pr1:lp=pr2@serverhost2:oh=*.admin.site.com
    pr2:lp=pr2@serverhost2:oh=*.admin.site.com
    pr1:server:oh=serverhost1.eng.com:lp=/dev/lp:tc=.common
    pr2:server:oh=serverhost2.admin.com:lp=/dev/lp:tc=.common
    .common:sd=/usr/local/lpd/%P
</pre>
          </div>
          <br>
          <br>

          <p>The above example has some interesting effects. The
          <var class="LITERAL">pattern</var> is used as a <span
          class="emphasis"><i class="EMPHASIS">glob</i></span>
          pattern and is applied to the fully qualified domain name
          (FQDN) of the host reading the printcap file. For
          example, <tt class="FILENAME">*.eng.site.com</tt> would
          match host <tt class="FILENAME">h1.eng.site.com</tt> but
          would not match <tt class=
          "FILENAME">h1.admin.site.com</tt>. Thus, the effects of
          the first couple of entries would be to specify that the
          <var class="LITERAL">pr1</var> and <var class=
          "LITERAL">pr2</var> printers on the <var class=
          "LITERAL">eng</var> hosts would be <var class=
          "LITERAL">pr1@serverhost1</var>, and on the <var class=
          "LITERAL">admin</var> hosts would be <var class=
          "LITERAL">pr2@serverhost2</var>,</p>

          <p>Also, the lpd daemons on <var class=
          "LITERAL">serverhost1</var> and <var class=
          "LITERAL">serverhost2</var> would extract the additional
          information for <var class="LITERAL">pr1</var> and <var
          class="LITERAL">pr2</var> respectively, overriding the
          common <var class="LITERAL">lp</var> entries.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6118">12.17. Management
          Strategies for Large Installations</a></h2>

          <p>One very effective way to organize print spooling is
          to have a small number of print servers running a <b
          class="APPLICATION">lpd</b> daemon, and to have all the
          other systems send their jobs directly to them. By using
          the above methods of specifying the printer and server
          host you eliminate the need for more complex management
          strategies.</p>

          <p>However, you still need to inform users of the names
          and existence of these printers, and how to contact them.
          One method is to use a common <tt class=
          "FILENAME">printcap</tt> file which is periodically
          updated and transfered to all sites. Another method is to
          distribute the information using the NIS or some other
          database. <b class="APPLICATION">LPRng</b> has provided a
          very flexible method of obtaining and distributing
          database information: see <a href="#SECNIS">Using
          Programs To Get Printcap Information</a> for details.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SECNIS">12.18. Using Programs
          To Get Printcap Information</a></h2>

          <p>In the <tt class="FILENAME">lpd.conf</tt> file you can
          specify:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6130"></a>
<pre class="SCREEN">
    printcap_path=|program
</pre>
          </div>
          This will cause the <b class="APPLICATION">LPRng</b>
          software to execute the specified program, which should
          then provide the printcap information. The program is
          invoked with the standard filter options, and has the
          name of the printcap entry provided on <acronym class=
          "ACRONYM">STDIN</acronym>. The filter should supply the
          printcap information on <var class="LITERAL">stdout</var>
          and exit with a 0 (success) error code. By convention,
          the printcap name 'all' requests a printcap entry that
          lists all printers.<br>
          <br>

          <p>This technique has been used to interface to the Sun
          Microsystem NIS and NIS+ databases with great success. By
          having the invoked program a simple shell script or front
          end to the <var class="LITERAL">nismatch</var> or <var
          class="LITERAL">ypmatch</var> programs, the complexity of
          incorporating vendor specific code is avoided.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN6138">12.18.1. How to use
            NIS and <b class="APPLICATION">LPRng</b></a></h3>

            <p>This note is based on material sent to the <a href=
            "#MAILLIST">lprng@lprng.com</a> mailing list by Paul
            Haldane <code class="EMAIL">&lt;<a href=
            "mailto:paul@ucs.ed.ac.uk">paul@ucs.ed.ac.uk</a>&gt;</code>.</p>

            <p>We generally don't use NIS for printcap files (we've
            moved to hesiod) but I can show you what we've done in
            the past.</p>

            <p>The input to NIS is a normal printcap file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6146"></a>
<pre class="SCREEN">
    # Classical printcap entry
    lp23a|lp23|lp|main printhost printer - KB, EUCS front Door:\
            :lp=lp23a@printhost:\
            :sd=/var/spool/lpr/lp23a:
    
    #lprng printcap entry
    lplabel|lpl|TEST - Labels printer:
            :lp=:rm=printhost:rp=lplabel:
            :sd=/var/spool/lpr/lplabel:
            :rg=lpadm:mx=1:
</pre>
            </div>
            <br>
            <br>

            <p>To build the NIS printcap.byname map we add the
            following to the NIS makefile (along the other bits and
            pieces that the makefile needs to know about a new
            map).</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6149"></a>
<pre class="SCREEN">
    PRINTCAP=${sysconfdir}/printcap
    # warning : [  ] is actually [&lt;space&gt;&lt;tab&gt;] in the script
    printcap.time: $(PRINTCAP) Makefile
      if [ -f $(PRINTCAP) ]; then \
        sed &lt; $(PRINTCAP) \
          -e 's/[   ][  ]*$$//' -e '/\\$$/s/\\$$/ /' \
        | awk '$$1 ~ /^#/{next;} $$1 ~ /^[:|]/ {printf "%s", $$0; next;} \
            {printf "\n%s", $$0 }' \
        | sed -e 's/[   ]*:[  ]*:/:/g' -e 's/[  ]*|[  ]*/|/g' \
          -e '/^[   ]*$$/d' &gt; .printcap.$$$$; \
        cat .printcap.$$$$; \
        if [ $$? = 0 -a -s .printcap.$$$$ ]; then \
          awk &lt;.printcap.$$$$ '{ FS=":"; OFS="\t"; } { \
              n = split($$1, names, "|"); \
              for (i=1; i&lt;=n; i++) \
                  if (length(names[i]) &gt; 0 \
                  &amp;&amp; names[i] !~ /[ \t]/) \
                      print names[i], $$0; \
          }' | $(MAKEDBM) - $(YPDBDIR)/$(DOM)/printcap.byname; \
          awk &lt;.printcap.$$$$ '{ FS=":"; OFS="\t"; } { \
              n = split($$1, names, "|"); \
              if (n &amp;&amp; length(names[1]) &gt; 0 &amp;&amp; names[1] !~ /[ \t]/) \
                  print names[1], $$0; \
          }' | $(MAKEDBM) - $(YPDBDIR)/$(DOM)/printcap.bykey; \
          rm -f .printcap.$$$$; \
          touch printcap.time; echo "updated printcap"; \
        fi \
      fi
      @if [ ! $(NOPUSH) -a -f $(PRINTCAP) ]; then \
          $(YPPUSH) printcap.byname; \
          $(YPPUSH) printcap.bykey; \
          touch printcap.time; echo "pushed printcap"; \
      fi
</pre>
            </div>
            <br>
            <br>

            <p>To specify that you want YP database rather than
            file access, use the following entry in your <tt class=
            "FILENAME">/etc/lpd.conf</tt> file:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6153"></a>
<pre class="SCREEN">
    printcap_path |/usr/local/libexec/pcfilter
</pre>
            </div>
            <br>
            <br>

            <p>Put the following shell script in
            /usr/local/libexec/pcfilter</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6156"></a>
<pre class="SCREEN">
    #!/bin/sh
    #/usr/local/libexec/filters/pcfilter
    read key
    # specify the full pathname to the ypmatch program
    # the location depends on the version of Solaris or your
    # system install
    /full/pathname/to/ypmatch "$key" printcap.byname
</pre>
            </div>
            <br>
            <br>

            <p>You can test this by using:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6159"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {314} #</samp> <kbd class=
"USERINPUT">lpc client pr</kbd>
    pr
     :lp=pr@server
    <samp class="PROMPT">h4: {315} #</samp> <kbd class=
"USERINPUT">lpc server pr</kbd>
    pr
     :lp=pr@server
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN6165">12.18.2. How to use
            NIS and <b class="APPLICATION">LPRng</b> - Sven
            Rudolph</a></h3>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6169"></a>
<pre class="SCREEN">
     Date: Wed, 11 Sep 1996 00:11:02 +0200
    From: Sven Rudolph &lt;sr1@os.inf.tu-dresden.de&gt;
    To: lprng@lprng.com
    Subject: Using :oh=server: with NIS
</pre>
            </div>
            <br>
            <br>

            <p>When I use a cluster-wide printcap, I want the
            entries for each printer to appear, e.g.:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN6172"></a>
<pre class="SCREEN">
    ---------- start of printcap snippet
    lp1
     :lp=lp1@server
    lp2
     :lp=lp2@server
    lp1
     :server:oh=servername
     :sd=/var/spool/lpd/lp1
     :lp=/dev/lp1
     :mx=0
    ---------- end of printcap snippet
</pre>
            </div>
            <br>
            <br>

            <p>When I create a NIS map out of this the printer name
            is used as a key and must be unique. The NIS makedbm
            will drop all but the last entry for each printer. This
            makes the printer on the clients unavailable. I solved
            this by a hack where the second entry is called
            lp1.server and the NIS client script has to request the
            right entry.</p>

            <ol type="1">
              <li>
                <p>Assumptions</p>

                <p>Perl is available at the YP server in <tt class=
                "COMMAND">/usr/bin/perl</tt>. A Bourne Shell is
                available at all clients in <tt class=
                "COMMAND">/bin/sh</tt> The printcap that is to be
                exported is in <tt class=
                "FILENAME">/etc/printcap</tt>. The printcap is
                written in the new format. In the examples the
                printer is called lp1.</p>
              </li>

              <li>
                <p>Add the following to your YP <tt class=
                "FILENAME">Makefile</tt> (<tt class=
                "FILENAME">/var/yp/Makefile</tt>) on the YP server
                (these lines are for Debian GNU/Linux, other
                systems might require other modifications):</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6186"></a>
<pre class="SCREEN">
    ---------- start of /var/yp/Makefile snippet
    PRINTCAP  = /etc/printcap
    printcap: $(PRINTCAP)
        @echo "Updating $@..."
        $(CAT) $(PRINTCAP) | \
            /usr/lib/yp/normalize_printcap | $(DBLOAD) -i $(PRINTCAP) \
            -o $(YPMAPDIR)/$@ - $@
        @if [ ! $(NOPUSH) ]; then $(YPPUSH) -d $(DOMAIN) $@; fi
        @if [ ! $(NOPUSH) ]; then echo "Pushed $@ map." ; fi
    ---------- end of /var/yp/Makefile snippet
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Install the programs <b class=
                "APPLICATION">match_printcap</b> and <b class=
                "APPLICATION">normalize_printcap</b> in the <tt
                class="FILENAME">/usr/lib/yp</tt> directory; <b
                class="APPLICATION">normalize_printcap</b> is only
                required on the YP server. The <b class=
                "APPLICATION">normalize_printcap</b> processes only
                the <b class="APPLICATION">LPRng</b> printcap
                format.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6196"></a>
<pre class="SCREEN">
    ---------- start of /usr/lib/yp/normalize_printcap
    #! /usr/bin/perl
    $debug = 0;
    $line = "";
    $new = "";
    while (&lt;&gt;) {
        chomp;
        next if ( /^\s*\#.*/ );
        s/^\s*$//;
        next if ( $_ eq '' );
        print "new: " . $_ . "\n" if $debug;;
        if (/^\s/) { # continuation line
            $line = $line.$_;
            print "continued: $line\n" if $debug;
            next;
        } else {
            $line =~ s/\s+\:/:/g;
            $line =~ s/\:\s+/:/g;
            $line =~ s/\:\s*\:/:/g;
            print "line: $line\n" if $debug;
            push(@lines, $line) if $line;
            $line = $_;
        }
    }
    $line =~ s/\s+\:/:/g;
    $line =~ s/\:\s+/:/g;
    $line =~ s/\:\s*\:/:/g;
    push(@lines,$line) if $line;
    @lines = sort(@lines);
    foreach $line (@lines) {
        ($printers) = split(/\:/,$line);
        @printers = split(/\|/,$printers);
        foreach $printer (@printers) {
          $num{$printer}++;
          push(@allprinters,$printer);
          print "allprinters: @allprinters\n" if $debug;
          print $printer."_".$num{$printer}."\t$line\n";
        }
    }
    @pr = keys %num;
    print "printers @pr\n" if $debug;
    if ($#allprinters &gt;=0) {
        print "all_1\tall:all=".join(",",@pr)."\n";
    }
    ---------- end of /usr/lib/yp/normalize_printcap
</pre>
                </div>
                &#13;<br>
                <br>

                <p>The result of processing the sample printcap
                file is:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6199"></a>
<pre class="SCREEN">
    lp1_1 lp1:lp=lp1@server
    lp1_2 lp1:server:oh=servername:sd=/var/spool/lpd/lp1:lp=/dev/lp1:mx=0
    lp2_1 lp2:lp=lp2@server
    all_1 all:all=lp1,lp2
</pre>
                </div>
                <br>
                <br>

                <p>Observe that each of the real printer entries
                has a key consisting of the printer name with a
                numerical suffix. This leads to the following
                method of extracting the printcap information using
                <var class="LITERAL">ypmatch</var>:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6203"></a>
<pre class="SCREEN">
    ---------- start of /usr/lib/yp/match_printcap
    #!/bin/sh
    read p
    n=1
    # specify the full pathname to ypmatch - this depends on your
    # OS version and installation
    while /full/pathname/to/ypmatch "${p}_${n}" printcap 2&gt;/dev/null; do
        n=`expr $n + 1`
    done
    ---------- end of /usr/lib/yp/match_printcap
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Now test the YP arrangement:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6207"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {316} #</samp>  cd /var/yp; make
        # this should create the printcap map
    <samp class="PROMPT">h4: {317} #</samp>  ypcat printcap
        # should provide the whole normalized printcap
    <samp class=
"PROMPT">h4: {318} #</samp>  echo lp1 |/usr/lib/yp/match_printcap
        # yields lp1 printcap
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Modify the <var class=
                "LITERAL">printcap_path</var> entry in the <tt
                class="FILENAME">lpd.conf</tt> file:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6216"></a>
<pre class="SCREEN">
    printcap_path=|/usr/lib/yp/match_printcap
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Test the use of the printcap path entry:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN6220"></a>
<pre class="SCREEN">
    <samp class=
"PROMPT">h4: {319} #</samp>  lpc client lp1 # shows the printcap for lp1
    <samp class=
"PROMPT">h4: {320} #</samp>  lpc server lp1 # shows the printcap for lp1
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Restart the lpd server and check to see that it
                accesses the right printcap information. Use the
                same <b class="APPLICATION">lpq</b> command, and
                then try <tt class="COMMAND">lpc printcap
                lp1</tt>.</p>
              </li>
            </ol>
            <br>
            <br>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6228">12.19. Lexmark
          Printers</a></h2>

          <p>Some Lexmark printers do not send <span class=
          "emphasis"><i class="EMPHASIS">end of job</i></span>
          status back unless configured to do so. Here is what is
          needed to force this. (This capability has been
          incorporated into the <b class="APPLICATION">ifhp</b>
          filter.)</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6233"></a>
<pre class="SCREEN">
    From: Matt White &lt;whitem@bofh.usask.ca&gt;
    To: lprng@lprng.com
    Date: Wed, 21 Jan 1998 18:25:50 -0600 (CST)
    Subject: Re: [LPRng] ifhp with Lexmark Optra N printer
    
    On Wed, 21 Jan 1998, Simon Greaves wrote:
    
    &gt; Apologies in advance if this is way off mark, but we've been
    &gt; evaluating a commercial print charging package (Geomica) which
    &gt; works by talking to the printer in what I think is a similar way
    &gt; to the ifhp filters. Lexmarks are currently a big headache because
    &gt; they seem to fail to return the message that they have finished
    &gt; printing which screws things up somewhat. In our case, it is believed
    &gt; to be a problem with the Lexmark firmware which they are looking
    &gt; into.
    
    There is a fix for that...it is originally from the Lexmark 4039
    series, but it still works on the Optra S 1650 machines that we
    have (and should work on the rest of the optra line).  Just send
    this little chunk of postscript to the printer once:
    
    -----------snip----------
    %! Postscript to set the 4039 printer into synchronous mode
    serverdict begin 0 exitserver
    statusdict begin true setenginesync end
    -----------snip----------
    
    Basically, it causes the printer to wait until it is finished
    printing before actually reporting that it is done.  I've got 3
    Optra S printers running with ifhp right now with no extra options
    (just defaults).
    
    -----------------------------------------------------------
    - Matt White                  whitem@arts.usask.ca
    - Network Technical Support   http://arts.usask.ca/~whitem
    - College of Arts &amp; Science  University of Saskatchewan
    -----------------------------------------------------------
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="P450">12.20. Tektronix Phaser
          Printers</a></h2>

          <p>The <b class="APPLICATION">ifhp</b> filter supports
          the <a href="#APPSOCKET">AppSocket</a> protocol used by
          Tektronix. You will need a printcap similar to the
          following:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6240"></a>
<pre class="SCREEN">
    phaser:
     :sd=/var/spool/lpd/%P
     # need a dummy device for output
     :lp=/dev/null
     # You need to specify the IP address of the printer's network interface
     #  In this example it is 10.0.0.1 - replace with the correct value
     # The filter will actually open the connection.
     :filter=/usr/local/libexec/filters/ifhp
     :ifhp=dev=10.0.0.1%9100,model=tek
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6242">12.21. Duplex
          Printing</a></h2>

          <p>Duplex printing is when you print on both sides of a
          page. Some printers which do duplex printing require that
          you send them special commands to force this mode. This
          is usually done by the FILTERS. The <b class=
          "APPLICATION">ifhp</b> filter makes a stab at sending the
          PJL or PostScript commands to the printer. Many people
          have reported problems doing duplex printing, so here is
          a check list.</p>

          <ol type="1">
            <li>
              <p>Make sure you have enough memory for the worst
              case print job. Usually the printer has to rasterize
              both pages before it can produce an impression. It
              may require much more memory than you expect.</p>
            </li>

            <li>
              <p>Check your printer manual to discover the EXACT
              form of the <var class="LITERAL">enter duplex
              mode</var> command and make sure that either the
              command is part of the job (PJL language at the start
              of the job, postscript header, etc), or that the
              filter generates the correct form.</p>

              <p>Note there is a PostScript Printer Description
              file (PPD) for most printers that support PostScript,
              and they even have the PJL and PostScript code for
              this in the PPD file.</p>
            </li>

            <li>
              <p>It has been observed that even with what would
              apparently be sufficient memory, that many duplex
              jobs print 'oddly', that they are not aligned on the
              same side in the same way, etc etc. This may not be
              the fault of the software, but of the support for
              duplex operation.</p>
            </li>

            <li>
              <p>Read the <b class="APPLICATION">ifhp</b>
              documentation, and create a configuration section in
              the <tt class="FILENAME">ifhp.conf</tt> file for your
              printer.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>I know this is painful, but until there is a uniform
          way to get the correct commands extracted from either PPD
          or some other database then this appears to be the only
          way to do it. <a name="AEN6260"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p><span class="emphasis"><i class="EMPHASIS">Patrick
            Powell</i></span></p>
          </blockquote>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6263">12.22. Solaris,
          Newsprint and FrameMaker</a></h2>

          <p>The following is a guide to using <b class=
          "APPLICATION">LPRng</b> and Sun Microsystems Newsprint by
          Christopher Hylands, Ptolemy Project Manager of the
          University of California.</p>

          <p>The Sun Newsprint printer is actually an OEM version
          of the Tektronix PhaserII; Sun Microsystems appears to
          have dropped support for Newsprint, and the recommended
          migration path is to buy a PostScript printer. If you
          want more information on using the Newsprint system,
          notes are available via <tt class=
          "FILENAME">http://ptolemy.eecs.berkeley.edu/~cxh/lprng.html</tt>.</p>

          <p>Looking through the mailing list logs, it looks like
          everyone was having a hard time getting lprng to work
          with Sun's brain-dead newsprinters. I tried using
          GhostScript, but the fonts were, IMHO, ugly, so I spent a
          little time getting the newsprint fonts to work.</p>

          <p>The key thing was to grab the file <tt class=
          "FILENAME">/usr/newsprint/lpd/if</tt> from a SunOS4.1.3
          newsprint installation. If you cannot get this code, then
          the installation will be extremely difficult.</p>

          <p>To install lprng on a Solaris2.x machine, you need to
          first stop the existing print services and install the
          startup scripts for <b class="APPLICATION">LPRng</b>.
          Note that if there is a local printer, you may have to
          also fix the permissions of the device. Typical commands
          are:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6274"></a>
<pre class="SCREEN">
    chown daemon /devices/sbus@1,f8000000/SUNW,lpvi@1,300000:lpvi0
</pre>
          </div>
          <br>
          <br>

          <p>We use the following simple <var class=
          "LITERAL">:if</var> script.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6278"></a>
<pre class="SCREEN">
    #/bin/sh
    # extremely simple filter script
    /bin/cat
</pre>
          </div>
          <br>
          <br>

          <p>The Sparcprinters use licensed fonts from NeWSprint.
          To use the licensed fonts, you must have the lprng spool
          directory for the sparcprinter in the same location as
          spool directory of the brain dead Solaris lp system. If
          your printer is named xsp524, then this directory would
          be <tt class="COMMAND">/etc/lp/printers/xsp524</tt>.</p>

          <p>The printcap entry looks like:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6283"></a>
<pre class="SCREEN">
    sp524|524:
        :mx=0
        :lp=:rm=doppler:rp=xsp524:
        :sd=/var/spool/lpd/sp524d:
        :lf=/var/spool/lpd/sp524d/log:
    xsp524|Sun SPARCprinter NeWSprint printer:
        :mx=0:rs:
        :lp=/dev/lpvi0:
        :sd=/etc/lp/printers/xsp524:
        :lf=/etc/lp/printers/xsp524/log:
        :af=/var/spool/lpd/xsp524/acct:
        :filter=/usr/local/libexec/newsprint/if:
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class=
          "FILENAME">/usr/local/libexec/newsprint/if</tt> was
          copied from <tt class=
          "FILENAME">/usr/newsprint/lpd/if</tt> in a SunOS4.x
          installation of the newsprint software. Unfortunately,
          the newsprint engine is so brain dead that it needs many
          environment variables set, so it is fairly difficult to
          come up with a clean script to start the engine. I made
          the following changes to the file.</p>

          <ol type="1">
            <li>
              <p>First, set the path in the script. You may also
              need to change defaults to suit your preferences:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN6291"></a>
<pre class="SCREEN">
    PATH=/usr/ucb:/usr/bin:/etc:/usr/etc:\
      /opt/NeWSprint/bin:/opt/NeWSprint/np/bin:
    PATH=$PATH:$NPHOME/pl.$ARCH/bin:$NPHOME/np/bin; export PATH
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>You will also need a <tt class=
              "FILENAME">/etc/lp/printers/printername/.params</tt>
              file. If you are using the same spooler directory as
              the directory that the Solaris lp system uses, then
              the .param file should appear there. If you are using
              a different spooler directory, then you will need to
              copy the .param file from elsewhere and edit it
              accordingly.</p>
            </li>

            <li>
              <p>If you are going to move a license to a new
              printer, you should probably save the .param file in
              the old printer spooler directory. Run
              /opt/NeWSprint/bin/fp_install and remove the license
              from the old printer and assign it to the new
              printer. You could run
              /opt/NeWSprint/bin/rm_np_printer and remove the
              printer, but that will get rid of the .param file</p>
            </li>

            <li>
              <p>FrameMaker under Solaris2.x uses the lp command.
              The fix is to edit $FMHOME/fminit/FMlpr and comment
              out the lp line and add an lpr line</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN6300"></a>
<pre class="SCREEN">
    sunxm.s5.sparc)
        lpr -P"$PRINTER" "$FILE"
        #lp -c -d"$PRINTER" "$FILE"
</pre>
              </div>
              <br>
              <br>
            </li>
          </ol>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6302"></a>
<pre class="SCREEN">
    Christopher Hylands, Ptolemy Project Manager  University of California
    cxh@eecs.berkeley.edu                 US Mail: 558 Cory Hall #1770
    ph: (510)643-9841 fax:(510)642-2739       Berkeley, CA 94720-1770
    home: (510)526-4010 (if busy -4068)       (Office: 493 Cory)
</pre>
          </div>
          <br>
          <br>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="SPOOLQUEUE"></a>Chapter 13. Spool Queues and
        Files</h1>

        <p>When files are accepted by the <b class=
        "APPLICATION">lpd</b> server for printing, they are stored
        in a spool queue directory, together with other files
        controlling the print operation. This section describes
        these files and how the <b class="APPLICATION">LPRng</b>
        software uses them.</p>

        <p>For descriptive purposes, we will use the following
        printcap entry as a guide:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN6311"></a>
<pre class="SCREEN">
    pr|alias
      :sd=/var/lpd/pr_public
      :cd=/var/lpd/pr
</pre>
        </div>
        <br>
        <br>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6313">13.1. Spool
          Queue</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">sd=</var><span class=
              "emphasis"><i class="EMPHASIS">Spool queue directory
              name</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="OPTION">:sd</var> option in the
          printcap entry specifies the spool queue directory. If
          there is no <var class="OPTION">:sd</var> entry or value,
          then the printer can only be used by the clients such as
          <b class="APPLICATION">lpq</b> to locate the destination
          for a print job. All information, files, etc., for a
          print queue is stored in the spool directory.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="QUEUELOCKFILE">13.2. Queue
          Lock File</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">spool_lock_file</var><span
              class="emphasis"><i class="EMPHASIS">spool queue lock
              file - default %P</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>When the <b class="APPLICATION">lpd</b> server starts
          printing, it will fork individual worker processes to
          service each queue. To prevent multiple processes from
          working on the same queue, a printer lock file specified
          by the <var class="LITERAL">queue_lock_file</var> option
          (default <var class="LITERAL">%P</var> - the %P is
          expanded to the print queue name) is used. In our
          example, the lock file would be: <tt class=
          "FILENAME">/var/lpd/pr/pr</tt>.</p>

          <p>The process ID of the currently active printer is
          stored in the lock file. By reading the lock file and
          testing to see if the process is still active, programs
          such as <b class="APPLICATION">lpq</b> can determine
          queue activity.</p>

          <p>Similarly, the worker process may need to create other
          processes to assist it. These in turn will create lock or
          temporary files in the spool directory as well.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="QUEUECONTROLFILE">13.3. Spool
          Control File</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">spool_control_file</var><span
              class="emphasis"><i class="EMPHASIS">spool queue
              control file - default control.%P</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The spool control file is used to control the
          operations of the spooler, and is in the spool or control
          directory. The file name specified by the <var class=
          "LITERAL">queue_control_file</var> option (default <var
          class="LITERAL">control.%P</var> - the %P is expanded to
          the print queue name); in our example, the control file
          would be: <tt class=
          "FILENAME">/var/lpd/pr/control.pr</tt>.</p>

          <p>The <b class="APPLICATION">lpc</b> program sends spool
          control requests to the <b class="APPLICATION">lpd</b>
          daemon, which updates the control file and then signals
          the appropriate spool server processes that an update has
          been performed. The control file contents have the
          form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6356"></a>
<pre class="SCREEN">
    key value
</pre>
          </div>
          <br>
          <br>

          <p>The following keys and their values are currently
          supported.</p>

          <div class="INFORMALTABLE">
            <a name="AEN6359"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Key</th>

                  <th>Value</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td><var class=
                  "LITERAL">printing_disabled</var></td>

                  <td>0 or 1</td>

                  <td>disable printing of jobs in queue</td>
                </tr>

                <tr>
                  <td><var class=
                  "LITERAL">spooling_disabled</var></td>

                  <td>0 or 1</td>

                  <td>disable placing jobs in queue</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">holdall</var></td>

                  <td>0 or 1</td>

                  <td>hold jobs until released</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">redirect</var></td>

                  <td><var class="LITERAL">printer</var></td>

                  <td>transfer jobs to indicated printer</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">class</var></td>

                  <td><var class="LITERAL">glob
                  expression</var></td>

                  <td>print only jobs whose class matches glob
                  expression</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">server_order</var></td>

                  <td><var class="LITERAL">printer name
                  list</var></td>

                  <td>preferred order of printer use</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">debug</var></td>

                  <td><var class="LITERAL">debugging
                  options</var></td>

                  <td>debugging and tracing</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>The <var class="LITERAL">printing_disabled</var> and
          <var class="LITERAL">spooling_disabled</var> are managed
          using the <tt class="COMMAND">lpc start</tt>, <tt class=
          "COMMAND">lpc stop</tt>, <tt class="COMMAND">lpc
          enable</tt> and <tt class="COMMAND">lpc disable</tt>
          commands. Similarly, <var class="LITERAL">holdall</var>
          is enabled and disabled by <var class=
          "LITERAL">holdall</var> and <var class=
          "LITERAL">noholdall</var> commands respectively. When
          holdall is enabled, jobs placed in the print queue will
          be held until they are explicitly released for printing
          by an <tt class="COMMAND">lpc release</tt> command.</p>

          <p>The <var class="LITERAL">redirect</var> entry is used
          to redirect or transfer jobs which are spooled to this
          queue to another queue, and is managed by the redirect
          command. The <tt class="COMMAND">lpc redirect off</tt>
          removes the redirect entry from the control file.</p>

          <p>The <var class="LITERAL">class</var> entry is similar
          in operation to the <var class="LITERAL">holdall</var>,
          but allows jobs whose class identification matches the
          glob expression to be printed. This can be useful when
          you have special forms or paper required for a print job,
          and want to run only these jobs when the paper is in the
          printer.</p>

          <p>The <var class="LITERAL">server_order</var> entry is
          created and updated for a multiple printer queue. It
          records the order in which printers should next be used
          for normal print operations. This allows <span class=
          "emphasis"><i class="EMPHASIS">round robin</i></span> use
          of printers, rather than having all jobs printed to the
          first printer in the list of printers.</p>

          <p>The <var class="LITERAL">debug</var> entry is set by
          the <tt class="COMMAND">lpc debug</tt> command, and is
          used to enable or disable debugging and tracing
          information for a spool queue. This facility is for
          diagnostic purposes only.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LOGFILES">13.4. Log and Status
          Files</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">create_files</var><span
              class="emphasis"><i class="EMPHASIS">create log,
              accounting and status files</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lf=</var><span class=
              "emphasis"><i class="EMPHASIS">log file name
              (default: log)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">max_log_file_size#</var><span
              class="emphasis"><i class="EMPHASIS">maximum log file
              size (Kbytes)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">min_log_file_size#</var><span
              class="emphasis"><i class="EMPHASIS">minimum log file
              size (Kbytes)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">max_status_line#</var><span
              class="emphasis"><i class="EMPHASIS">maximum status
              line length (characters)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">max_status_size#</var><span
              class="emphasis"><i class="EMPHASIS">maximum status
              file size (Kbytes)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">min_status_size#</var><span
              class="emphasis"><i class="EMPHASIS">minimum status
              file size (Kbytes)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ps=</var><span class=
              "emphasis"><i class="EMPHASIS">filter status file
              name (default: status)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">queue_status_file=</var><span
              class="emphasis"><i class="EMPHASIS">queue status
              file (default: status.%P)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">short_status_date=</var><span
              class="emphasis"><i class="EMPHASIS">display short
              (hh:mm) timestamp (default: true)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>During operation, the <b class="APPLICATION">lpd</b>
          server records the current printing operations in the
          spool queue status file specified by the <var class=
          "LITERAL">spool_status_file</var> option (default <var
          class="LITERAL">status.%P</var> - the %P is expanded to
          the print queue name); for our example, this would be <tt
          class="FILENAME">/var/lpd/pr/status.pr</tt>. In order to
          prevent this file from growing too large, the server will
          periodically truncate the file. You can force creation of
          these files by setting the <var class=
          "LITERAL">create_files</var> option. The <var class=
          "LITERAL">max_status_size</var> configuration or printcap
          option sets the maximum size (in Kbytes) of the status
          file; if the file exceeds this, only the last <var class=
          "LITERAL">min_status_size</var> bytes or 25% of the
          maximum size (default if not specified) will be
          preserved.</p>

          <p>Similarly, the server logs its operations in the log
          file specified by the <var class="LITERAL">lf</var> (log
          file) option (default is <var class=
          "LITERAL">lf=log</var>). The <var class=
          "LITERAL">max_log_file_size</var> value (default 0)
          specifies the maximum length of the log file in Kbytes.
          If this value is non-zero, then the log file is truncated
          to <var class="LITERAL">min_log_file_size</var> bytes or
          25% of the maximum file size. Again, the last portion of
          the log file is preserved. If the <var class=
          "LITERAL">max_log_file_size</var> value is 0, then the
          log file grows without limit.</p>

          <p>Some filters require an additional filter status file
          that they use for recording additional filter status or
          other operational information. The <var class=
          "LITERAL">ps</var> names this file, and it is passed to a
          print filter using the <var class="LITERAL">$s</var>
          option (see <a href="#FILTEROPTIONS">Filter Command Line
          Options and Environment Variables</a> ).</p>

          <p>The <acronym class="ACRONYM">STDERR</acronym> output
          for filters is put into the printer status file. This
          allows the filter to produce informative messages that
          can be displayed as part of the user status. In addition,
          a separate status file specified by the <var class=
          "LITERAL">ps</var> (Printer Status) can be used as well.
          This file is <span class="emphasis"><i class=
          "EMPHASIS">not</i></span> truncated by the <b class=
          "APPLICATION">LPRng</b> system.</p>

          <p>When reporting status information, the length of line
          returned can be a problem. The <var class=
          "LITERAL">max_status_line#79</var> option restricts the
          status line to a maximum of 79 characters.</p>

          <p>The <var class="LITERAL">short_status_date</var>
          (default is true) option causes short (hour:minute)
          timestamps to be displayed on status queries.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBFILES">13.5. Job
          Files</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">longnumber</var><span class=
              "emphasis"><i class="EMPHASIS">long job
              number</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">default_priority=</var><span
              class="emphasis"><i class="EMPHASIS">default job
              priority</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">nline_after_file</var><span
              class="emphasis"><i class="EMPHASIS">N line after
              data file</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A print job consists of a control file and one or more
          data files. <a href="#RFC1179">RFC1179</a> specifies the
          general format of these files and how they are to be
          transfered between servers. <b class=
          "APPLICATION">LPRng</b> has extended the contents of the
          control files and the transfer protocol to provide a more
          powerful set of features, but has extensive provisions
          for backwards compatibility with non-<b class=
          "APPLICATION">LPRng</b> software. A sample control file
          is shown below:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6520"></a>
<pre class="SCREEN">
    Hh4.private
    J/tmp/file1 /tmp/file2
    CA
    Lpapowell
    Ppapowell
    fdfA002230h4.private
    N/tmp/file1
    UdfA002230h4.private
    fdfB002230h4.private
    N/tmp/file2
    UdfB002230h4.private
</pre>
          </div>
          <br>
          <br>

          <p>The first part of the control file contains general
          information generated by the <b class=
          "APPLICATION">lpr</b> or other spooling program. The
          information lines start with an uppercase letter or
          digit. Some other spooling systems also start information
          lines with various punctuation marks such as underscores
          (_) or periods (.).</p>

          <p>Following this are a set of entries about each of the
          various files to be printed. These lines start with a
          lower case letter, followed by the print file name. The
          lower case letter is the <span class="emphasis"><i class=
          "EMPHASIS">format</i></span> to be used to process the
          file. See <a href="#PRINTINGJOB">print file formats</a>
          for more information about its use.</p>

          <div class="TABLE">
            <a name="CFLINE"></a>

            <p><b>Table 13-1. Control File Lines</b></p>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Key</th>

                  <th>Meaning</th>

                  <th>Generated By</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>Key</td>

                  <td>Meaning</td>

                  <td>Generated By</td>
                </tr>

                <tr>
                  <td>A</td>

                  <td>identifier *</td>

                  <td><b class="APPLICATION">LPRng</b>
                  internal</td>
                </tr>

                <tr>
                  <td>C</td>

                  <td>class</td>

                  <td>lpr -C class</td>
                </tr>

                <tr>
                  <td>D</td>

                  <td>date</td>

                  <td>lpr</td>
                </tr>

                <tr>
                  <td>H</td>

                  <td>originating host</td>

                  <td>lpr</td>
                </tr>

                <tr>
                  <td>I</td>

                  <td>indent</td>

                  <td>lpr -i indent</td>
                </tr>

                <tr>
                  <td>J</td>

                  <td>jobname</td>

                  <td>lpr -J jobname (default: list of files)</td>
                </tr>

                <tr>
                  <td>L</td>

                  <td>bnrname</td>

                  <td>lpr -U username</td>
                </tr>

                <tr>
                  <td>N</td>

                  <td>filename</td>

                  <td>(see text)</td>
                </tr>

                <tr>
                  <td>M</td>

                  <td>mailname</td>

                  <td>lpr -m mailname</td>
                </tr>

                <tr>
                  <td>P</td>

                  <td>logname</td>

                  <td>lpr</td>
                </tr>

                <tr>
                  <td>Q</td>

                  <td>queuename</td>

                  <td>lpr -Q</td>
                </tr>

                <tr>
                  <td>R</td>

                  <td>accntname</td>

                  <td>lpr -R accntname</td>
                </tr>

                <tr>
                  <td>S</td>

                  <td>slinkdata *</td>

                  <td>lpr</td>
                </tr>

                <tr>
                  <td>T</td>

                  <td>prtitle</td>

                  <td>lpr -T prtitle</td>
                </tr>

                <tr>
                  <td>U</td>

                  <td>unlnkfile</td>

                  <td>(see text)</td>
                </tr>

                <tr>
                  <td>W</td>

                  <td>width</td>

                  <td>lpr -w width</td>
                </tr>

                <tr>
                  <td>Z</td>

                  <td>zopts *</td>

                  <td>lpr -Z zopts</td>
                </tr>

                <tr>
                  <td>1</td>

                  <td>font1</td>

                  <td>lpr -1 font1</td>
                </tr>

                <tr>
                  <td>2</td>

                  <td>font2</td>

                  <td>lpr -2 font2</td>
                </tr>

                <tr>
                  <td>3</td>

                  <td>font3</td>

                  <td>lpr -3 font3</td>
                </tr>

                <tr>
                  <td>4</td>

                  <td>font4</td>

                  <td>lpr -4 font4</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>The entries marked with * are used only by <b class=
          "APPLICATION">LPRng</b>. <var class="LITERAL">N</var> and
          <var class="LITERAL">U</var> lines are associated with a
          print file. The <var class="LITERAL">N</var> line is the
          original name of the print file. By default, <b class=
          "APPLICATION">LPRng</b> places this line <span class=
          "emphasis"><i class="EMPHASIS">before</i></span> the
          corresponding data file. You can use the <var class=
          "LITERAL">nline_after_file</var> option to have <b class=
          "APPLICATION">LPRng</b> place the N line after the data
          file line. The <var class="LITERAL">U</var> line
          originally was used to indicate that the named file was
          to be unlinked after printing. This information is now
          ignored by <b class="APPLICATION">LPRng</b>. These lines
          are always grouped with a print file entry.</p>

          <p>The names of control and data files follow a very
          strict pattern. Control files have the format <var class=
          "LITERAL">cfX</var><var class=
          "REPLACEABLE">number</var><span class="emphasis"><i
          class="EMPHASIS">host</i></span>, where X is an upper
          case letter, <span class="emphasis"><i class=
          "EMPHASIS">number</i></span> is (usually) a 3 digit
          number, and <span class="emphasis"><i class=
          "EMPHASIS">host</i></span> is the host name. <a href=
          "#RFC1179">RFC1179</a> restricted the total length of the
          control file name to 32 characters; <b class=
          "APPLICATION">LPRng</b> has a much looser limit.</p>

          <p>Data file names must follow the same pattern as the
          control file name, and have the format <var class=
          "LITERAL">dfX</var><var class=
          "REPLACEABLE">number</var><span class="emphasis"><i
          class="EMPHASIS">host</i></span>. The X can be in the
          range A-Za-z, allowing at most 52 data files for a job.
          The <span class="emphasis"><i class=
          "EMPHASIS">number</i></span> and <span class=
          "emphasis"><i class="EMPHASIS">host</i></span> must be
          identical to the corresponding control file.</p>

          <p>By convention, <b class="APPLICATION">LPRng</b> uses
          the X of the control file name to set a priority for the
          job. A job with control file name <var class=
          "LITERAL">cfA...</var> will have <span class=
          "emphasis"><i class="EMPHASIS">lower</i></span> format
          than a job with format <var class="LITERAL">cfB...</var>,
          and so forth. The <b class="APPLICATION">lpr</b> program
          uses the first letter of the class name or an explicit
          priority value to set the letter value. If none of these
          are specified, then the <var class=
          "LITERAL">default_priority</var> value from the
          configuration or printcap entry is used.</p>

          <p>The job number is usually a 3 digit value. However, in
          systems where a large number of jobs are spooled and need
          to be kept for printing at scheduled times, this can lead
          to problems. The <var class="LITERAL">longnumber</var>
          option will use 6 digit job numbers. This must be used
          with care when operating with non-<b class=
          "APPLICATION">LPRng</b> software.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6660">13.6. Job Hold
          File</a></h2>

          <p>Associated with each control file is a hold file that
          has additional information controlling the printing
          operations. The entries in this file have the form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6663"></a>
<pre class="SCREEN">
    key [value]
</pre>
          </div>
          <br>
          <br>

          <p>The following is an example of a hold file:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6666"></a>
<pre class="SCREEN">
    server 0
    subserver 0
    attempt 3
    error cannot open printer
    hold 0
    priority 0
    remove 0
    routed 0
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">server</var> and <var class=
          "LITERAL">subserver</var> entry records the process ID of
          the server process and the subserver process that is
          printing the job. The <var class="LITERAL">attempt</var>
          field records the total number of attempts to print the
          job. The <var class="LITERAL">error</var> field records
          any error that would prevent the job from being printed.
          This information is reported by the <b class=
          "APPLICATION">lpq</b> program.</p>

          <p>The <var class="LITERAL">hold</var> field is non-zero
          when the <tt class="COMMAND">lpc hold</tt> command is
          used to explicitly prevent the job from being printed;
          <tt class="COMMAND">lpc release</tt> will clear the field
          and allow the job to be printed.</p>

          <p>The <var class="LITERAL">priority</var> field is
          modified by the <tt class="COMMAND">lpc topq</tt> command
          and is used to provide an overriding priority to printing
          the file.</p>

          <p>The <var class="LITERAL">remove</var> field is
          non-zero when the file has been printed and should be
          removed.</p>

          <p>The <var class="LITERAL">routed</var> field is used to
          indicate that there is routing information present in the
          hold file, and that special handling is needed. The
          routing information is provided by a <a href=
          "#DESTINATIONS">routing filter</a>. The information is
          recorded by information in the hold file. The following
          is an example of routing information. Normally this
          information is stored in a URL escaped format, with one
          line per destination, but for clarity this has been
          broken out into plain text form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6687"></a>
<pre class="SCREEN">
    active 0
    attempt 0
    done 0
    hold 0
    priority 0
    remove 0
    routed 880892602
    route 1
      dest t1
      ident papowell@h4+705.1
      error
      copies 1
      copy_done 0
      status 0
      active 0
      attempt 0
      done 0
      hold 0
      sequence 0
      priority B
      CB
      end
    route 2
      dest t1
      ident papowell@h4+705.2
      error
      copies 0
      copy_done 0
      status 0
      active 0
      attempt 0
      done 0
      hold 0
      sequence 1
      end
</pre>
          </div>
          <br>
          <br>

          <p>Routing information lines start with <var class=
          "LITERAL">route</var> followed by individual routing
          entry information. The <var class="LITERAL">route</var>
          <var class="LITERAL">dest</var>, <var class=
          "LITERAL">copies</var>, <var class=
          "LITERAL">priority</var>, and <var class=
          "LITERAL">Xnnnn</var> entries are derived from the output
          of the router program; other fields are used during the
          printing process. The <var class=
          "LITERAL">copy_done</var> records the numbers of copies
          done, while the <var class="LITERAL">done</var> records
          that the entry has been completed. The <var class=
          "LITERAL">status</var> is the process ID of the server
          process doing the printing.</p>

          <p>The output from route filter that generated the above
          file was:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6700"></a>
<pre class="SCREEN">
    dest t1
    copies 1
    priority B
    CB
    end
    dest t1
    end
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AH">13.7. Job State</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">ah</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Automatically hold
              jobs</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A job can be in the following state:</p>

          <ol type="1">
            <li>
              <p>Initial. This is the state during job submission.
              Jobs in the initial state do not have any status
              displayed for them.</p>
            </li>

            <li>
              <p>Held. Once a job is submitted, it can either be
              printed or <span class="emphasis"><i class=
              "EMPHASIS">held</i></span>. The <var class=
              "LITERAL">ah</var> printcap option specifies that all
              jobs are automatically held on submission. The <tt
              class="COMMAND">lpc release</tt> and <tt class=
              "COMMAND">lpc redo</tt> command will cause these jobs
              to be printed and the <b class="APPLICATION">lprm</b>
              command can remove these jobs.</p>
            </li>

            <li>
              <p>Active. The job is being processed for printing or
              transfer to another queue.</p>
            </li>

            <li>
              <p>Pending. Jobs which can be printed but are not
              active. This can be due to the printer being busy or
              the job <span class="emphasis"><i class=
              "EMPHASIS">class</i></span> not being printed.</p>
            </li>

            <li>
              <p>Error. Jobs which have encountered an error during
              printing. The <tt class="COMMAND">lpc release</tt>
              and <tt class="COMMAND">lpc redo</tt> command will
              cause these jobs to be printed and the <b class=
              "APPLICATION">lprm</b> command can remove these
              jobs.</p>
            </li>

            <li>
              <p>Done. Jobs which have completed printing, but
              which are not yet removed from the print queue. See
              the <span class="emphasis"><i class="EMPHASIS"><a
              href="#NORMALTERM">save_when_done</a></i></span> flag
              for more information. The <b class=
              "APPLICATION">lprm</b> command can remove these
              jobs.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Normally the job sequences is initial, pending,
          active, and done. However, a job may be put in the error
          state by problems processing the job or by actions of the
          <b class="APPLICATION">lpc</b> command.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="USEIDENTIFIER">13.8. Job
          Identifier</a></h2>

          <p>For each job in a spool queue, the <b class=
          "APPLICATION">LPRng</b> software creates a unique
          identifier. This identifier is recorded in the control
          file <var class="LITERAL">A</var> line. It can be used by
          the various client programs for identifying jobs, and is
          displayed by the <b class="APPLICATION">lpq</b> program
          as status information.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="CONFIGFILE"></a>Chapter 14. Configuration
        File, Defaults and Overrides</h1>

        <p>Options used:</p>

        <ul>
          <li>
            <p><var class="LITERAL">allow_getenv</var> FLAG <span
            class="emphasis"><i class="EMPHASIS">use GETENV
            environment variable</i></span></p>
          </li>
        </ul>
        <br>
        <br>

        <p>The <b class="APPLICATION">LPRng</b> options are
        obtained as follows:</p>

        <ul>
          <li>
            <p>The compile time defaults. These are in the <tt
            class="FILENAME">LPRng/src/common/vars.c</tt> file.</p>
          </li>

          <li>
            <p>If the <b class="APPLICATION">LPRng</b> software has
            been compiled with the regression testing <acronym
            class="ACRONYM">GETENV</acronym> option enabled, the
            configuration information in the file specified by the
            <var class="LITERAL">LPD_CONF</var> environment
            variable will be used. This can only be used if you are
            not setuid ROOT or as ROOT as it opens severe security
            loopholes.</p>
          </li>

          <li>
            <p>The file specified by the <var class=
            "LITERAL">config_file</var> compile time option,
            usually <tt class="FILENAME">/etc/lpd.conf</tt> or <tt
            class="FILENAME">/usr/local/etc/lpd.conf</tt>, and
            referred to a the <tt class="FILENAME">lpd.conf</tt>
            file. If the <var class="LITERAL">config_file</var>
            option value has the form <tt class=
            "FILENAME">|/pathname</tt>, then <tt class=
            "FILENAME">/pathname</tt> must be an executable program
            and will be run with the standard set of filter
            options. It must write configuration option values to
            its <acronym class="ACRONYM">STDOUT</acronym> and exit
            with a 0 status.</p>
          </li>

          <li>
            <p>In order to protect system security, the <tt class=
            "FILENAME">lpd.conf</tt> (and the <tt class=
            "FILENAME">printcap</tt>) file should be read only.</p>
          </li>

          <li>
            <p>If the <var class=
            "LITERAL">require_configfiles</var> option is set in
            the compile time options, then the preceeding step must
            be successful, i.e. - there must be a configuration
            file or the program must execute and exit with a 0
            status.</p>
          </li>

          <li>
            <p>If a printer or spooling operation is done, then the
            values in the <tt class="FILENAME">printcap</tt> entry
            for the spooler are used to override the default and
            <tt class="FILENAME">ifhp.conf</tt> file values.</p>
          </li>
        </ul>
        <br>
        <br>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6784">14.1. Configuration
          File Format</a></h2>

          <p>The configuration file format is similar to a the
          fields of a printcap entry with the difference that the
          leading colon is optional and there can only be one
          option per line:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6787"></a>
<pre class="SCREEN">
    # comment
    # set option value to 1 or ON
    ab
    :ab
    # set option value to 0 or OFF
    ab@
    :ab
    # set option value to string
    str=name
</pre>
          </div>
          <br>
          <br>

          <p>During system installation the <b class=
          "APPLICATION">LPRng</b> software processes the default
          values in the <tt class=
          "FILENAME">LPRng/src/common/vars.c</tt> file and
          generates a sample <tt class="FILENAME">lpd.conf</tt>
          file that has the format:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6793"></a>
<pre class="SCREEN">
    # Purpose: always print banner, ignore lpr -h option
    #   default ab@ (FLAG off)
    # Purpose: query accounting server when connected
    #   default achk@ (FLAG off)
    # Purpose: accounting at end (see also af, la, ar, as)
    #   default ae=jobend $H $n $P $k $b $t  (STRING)
    # Purpose: name of accounting file (see also la, ar)
    #   default af=acct  (STRING)
    
    # change:
    # --- we change the af value to none, i.e. - no accounting
    # --- file by default
    af=
</pre>
          </div>
          <br>
          <br>

          <p>You can change option values by editing the file as
          shown above then then to force the <b class=
          "APPLICATION">lpd</b> server to use the new options, use
          the <tt class="COMMAND">lpc reread</tt> command.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN6798">14.2. Legacy
          Compatibility</a></h2>

          <p>The following arguments have been provided for
          compatibility with legacy systems.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="JOBSTEPS"></a>Chapter 15. Job Processing</h1>

        <p>Much of the flexibility of the <b class=
        "APPLICATION">LPRng</b> software is obtained from the
        ability to control the details of each step of job
        processing. The following section details each step in the
        processing of a job, and explains the printcap options used
        to control each operation.</p>

        <p>Assume the <var class="LITERAL">pr</var> printcap entry
        has the form:</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN6807"></a>
<pre class="SCREEN">
    pr
        :lp=/dev/lp  OR  :lp=rp@rm
        :sd=/var/spool/lpd/pr
        :lf=log
        :filter=/usr/local/bin/lpf
</pre>
        </div>
        <br>
        <br>

        <p>Assume that we have used the following command to print
        a set of files.</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN6810"></a>
<pre class="SCREEN">
    lpr -Ppr file1 file2
</pre>
        </div>
        <br>
        <br>

        <p>This will create a control file in the <tt class=
        "FILENAME">/var/spool/lpd/pr</tt> directory with the
        following contents (this is an example - in practice there
        may be minor differences between the example and an actual
        control file):</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN6814"></a>
<pre class="SCREEN">
    Hh4.private
    J/tmp/file1 /tmp/file2
    CA
    Lpapowell
    Ppapowell
    fdfA002230h4.private
    N/tmp/file1
    UdfA002230h4.private
    fdfB002230h4.private
    N/tmp/file2
    UdfB002230h4.private
</pre>
        </div>
        <br>
        <br>

        <p>We will refer to this example throughout the following
        sections.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CONFIGSETUP">15.1.
          Configuration and Setup Options</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">ipv6</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">use IPV6 Network
              facilities</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">default_tmp_dir=</var><span
              class="emphasis"><i class="EMPHASIS">temporary
              directory</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lockfile=</var><span class=
              "emphasis"><i class="EMPHASIS">lpd server lock
              file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">report_server_as=</var><span
              class="emphasis"><i class="EMPHASIS">server name for
              status reports</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">spool_dir_perms=</var><span
              class="emphasis"><i class="EMPHASIS">spool directory
              permissions</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">spool_file_perms=</var><span
              class="emphasis"><i class="EMPHASIS">spool file
              permissions</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">ipv6</var> specifies that the
          IPV6 protocol, rather than IPV4 will be used.</p>

          <p>The <var class="LITERAL">lockfile</var> specifies the
          location of the lock file used by the <b class=
          "APPLICATION">lpd</b> server. This file has the port
          number in the <var class="LITERAL">lpd_port</var> value
          appended to form a unique lock file name.</p>

          <p>The <var class="LITERAL">spool_dir_perms</var> and
          <var class="LITERAL">spool_file_perms</var> (default 0700
          and 0600 respectively) values are the (numeric)
          permissions for the spool directory and spool files.</p>

          <p>The <var class="LITERAL">report_server_as</var> option
          allows an administrator to masquerade a server with
          another name. This could be useful if various load
          sharing activities are being carried out, or if there are
          problems reconfiguring DNS to cause the correct server
          name to be reported.</p>

          <p>The <var class="LITERAL">default_tmp_dir</var> option
          specifies a temporary directory to be used to hold files
          or information temporarily if there is no spool directory
          available.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SUBMITTING">15.2. Submitting
          Jobs and Service Requests</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpd_port=</var><span class=
              "emphasis"><i class="EMPHASIS">Listening Port for <b
              class="APPLICATION">lpd</b></i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">unix_socket_path=</var><span
              class="emphasis"><i class="EMPHASIS">Unix socket for
              <b class="APPLICATION">lpd</b>
              connections</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>After the <b class="APPLICATION">lpd</b> server has
          done its initialization, it will attempt to bind to the
          <b class="APPLICATION">lpd</b> listening port specified
          by the <var class="LITERAL">lpd_port</var> value. This
          value has the format <var class=
          "LITERAL">[ipaddr%]port</var>. If the <var class=
          "LITERAL">ipaddr</var> is specified then the lpd server
          binds to the interface with the specified address
          otherwise it binds to all interfaces. The port value can
          be a number or name the name of a service; The port
          corresponding to the service name is used. The <var
          class="LITERAL">printer</var> services port is 515. If
          the port binding operation is successful and the server
          has not been request to run in <span class="emphasis"><i
          class="EMPHASIS">foreground</i></span> mode by the <var
          class="LITERAL">-F</var> command line option, then a
          child process is forked and the parent process will exit.
          The child process then takes steps to disconnect itself
          from the control terminal of the process that started
          it.</p>

          <p>The <var class="LITERAL">unix_socket_path</var> option
          specifies the pathname of a <span class="emphasis"><i
          class="EMPHASIS">fifo</i></span> socket that local
          processes can use instead of the TCP/IP port.</p>

          <p>The main <b class="APPLICATION">lpd</b> process will
          then start a <span class="emphasis"><i class=
          "EMPHASIS">queue checking</i></span> process that will
          check all of the spool queues used by the server for
          queues that have pending jobs. This process sends a
          message to the main <b class="APPLICATION">lpd</b>
          process requesting that it start a service process for
          this queue.</p>

          <p>The <b class="APPLICATION">lpd</b> process will then
          sit in a loop waiting for one of the following
          events:</p>

          <ol type="1">
            <li>
              <p>An incoming connection request. If the maximum
              number of children has not been exceeded, then a new
              process will be forked to handle this connection.</p>
            </li>

            <li>
              <p>A child process exiting. The server will check to
              see if there is a pending request to start a server
              for a queue that could not be accommodated due to too
              many processes running.</p>
            </li>

            <li>
              <p>A request to start a service process for a queue.
              If the number of active processes is less than the
              maximum allowed a service process will be started,
              otherwise the request will be placed on a list for
              service when the number of processes active
              decreases.</p>
            </li>

            <li>
              <p>A timeout alarm for the queue rescanning
              operation. This is discussed in the next section in
              detail.</p>
            </li>
          </ol>

          <p>When connection is accepted by the <b class=
          "APPLICATION">lpd</b> spooler, the following steps are
          taken to processes the job.</p>

          <ol type="1">
            <li>
              <p>First, a timeout is established for the transfer
              of the information from client to the <b class=
              "APPLICATION">lpd</b> server. This is done to prevent
              a denial of service attack by processes that do not
              close connections in a timely manner.</p>
            </li>

            <li>
              <p>A single line is read into an internal buffer.
              This line must be terminated with a <var class=
              "LITERAL">NEWLINE</var> character.</p>
            </li>

            <li>
              <p>The input line is parsed and the actions required
              are determined.</p>
            </li>

            <li>
              <p>If the activity requires access to the spool queue
              information, then the current directory of the
              process is changed to the spool directory. This
              allows all file accesses to then be relative to this
              directory.</p>
            </li>

            <li>
              <p>If the processing requires starting a spool queue
              server process, a message is sent to the main <b
              class="APPLICATION">lpd</b> server process to start a
              spool queue server process. By having all the
              processes serving spool queues children of the main
              server process it is possible to monitor and limit
              the total number of active processes. This is
              important on systems with a very large number of
              queues.</p>
            </li>

            <li>
              <p>After the processing of the original request has
              been completed, the process with then check to see if
              the Spool Queue for the printer should be
              processed.</p>
            </li>
          </ol>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="RECEPTION">15.3. Job
          Reception</a></h2>

          <ul>
            <li>
              <p><var class="LITERAL">longnumber</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Long job number
              (6 digits)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">fifo</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">enforce FIFO order for
              reception</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpd_listen_port=</var><span
              class="emphasis"><i class="EMPHASIS"><b class=
              "APPLICATION">lpd</b> will listen on this
              port</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">incoming_control_filter=</var><span class=
              "emphasis"><i class="EMPHASIS">filter to modify
              incoming job control file</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">translate_incoming_format=</var><span
              class="emphasis"><i class="EMPHASIS">change data file
              formats</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">accounting_fixupname=</var><span class=
              "emphasis"><i class="EMPHASIS">change accounting name
              infomration</i></span></p>
            </li>
          </ul>

          <p>When a print job is received, the <b class=
          "APPLICATION">lpd</b> server will assign a job number to
          the new job. Historically these have been in the range of
          0 to 999, but the <var class="LITERAL">longnumber</var>
          option allows numbers from 0 to 999,999 to be assigned.
          The server then checks to see that all of the data files
          for a job have been transferred correctly.</p>

          <p>The <var class="LITERAL">fifo</var> flag forces all
          jobs receieved from a particular host to be processed in
          First In, First Out (fifo) order. No new jobs will be
          processed until the incoming job has been released into
          the spool queue.</p>

          <p>If an incoming control file filter is specified, then
          the incoming job's control file will be passed through
          the <var class="LITERAL">incoming_control_filter</var>
          filter if it is specified. This allows the modification
          of the control file.</p>

          <p>The majority of control file modifications are simple
          job file format changes. The <var class=
          "LITERAL">translate_incoming_format</var> option provides
          a simple way to do this. See the <span class=
          "emphasis"><i class="EMPHASIS"><a href=
          "#TRANSLATEFORMAT">translate_format</a></i></span> for
          details.</p>

          <p>The <var class="LITERAL">accounting_namefixup</var>
          option was introduced to allow a simple mapping of host
          and user names to names to be used for accounting
          purposes. By convention, the <var class="LITERAL">R</var>
          field in the job control file specifies the name to be
          used for accounting purposes.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN6959"></a>
<pre class="SCREEN">
    accounting_namefixup=list[,list]*
       where list is:   host(,host*)[=user(,user*)]
</pre>
          </div>
          The incoming job is checked to see if the originating
          host is in the list of hosts; the first matching one
          found is used.<br>
          <br>

          <p>Each host list has the format: host,host... where host
          has the same format used for the <var class=
          "LITERAL">oh</var> and other host name matching options.
          You can use '!host' to invert matching. For example: <var
          class="LITERAL">host1,127.*,!somehost</var>.</p>

          <p>When a host match is found, the name to be used for
          the user is determined from the user list; if none is
          specified then no changes are made. Each entry in the
          user list has the format <var class=
          "LITERAL">${option}</var> or <var class=
          "LITERAL">name</var>; the <var class=
          "LITERAL">${option}</var> values are extracted from the
          control file (capital letters) or printcap/configuration
          information (lower case letters/names). The first
          non-empty value list value used. For example, the <var
          class="LITERAL">${R},${L},${accounting_name},anon</var>
          will select the control file 'R' option value, then the
          'L' option value, then the printcap/config option
          'accounting_name' value, and then finally the 'anon'
          value.</p>

          <p>The control file is then passed through the <var
          class="LITERAL">router</var> routing filter. This allows
          the incoming job to be redirected to one or more print
          queues. For details about all of the capabilities of the
          routing filter, see <a href="#DESTINATIONS">Dynamic
          Routing</a>.</p>

          <p>Finally, the <b class="APPLICATION">lpd</b> server is
          requested to start a spooling process that will print the
          newly arrived job.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SPOOLQ">15.4. Spool Queue
          Processing</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpd_force_poll=</var><span
              class="emphasis"><i class="EMPHASIS">Force <b class=
              "APPLICATION">lpd</b> to periodically poll print
              queues</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpd_poll_time=</var><span
              class="emphasis"><i class="EMPHASIS">Time between
              polls</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">max_servers_active=</var><span class=
              "emphasis"><i class="EMPHASIS">Maximum number of
              active servers</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>When the <b class="APPLICATION">lpd</b> server starts,
          it will fork a set of subserver processes, each which
          will handle an individual queue.</p>

          <p>If a system has a large number of queues, then this
          forking operation may result in the <b class=
          "APPLICATION">lpd</b> server exhausting the process
          resources. To control this, the <var class=
          "LITERAL">max_servers_active</var> value restricts the
          number of active children to the specified value. If this
          value is 0, then 50% of the maximum system processes
          value will be used.</p>

          <p>Due to the limits on the number of processes, there
          may be times when a job is placed in a queue, but the <b
          class="APPLICATION">lpd</b> server is unable to start
          handling the job. When all of the children of the main <b
          class="APPLICATION">lpd</b> server have exited, the
          server starts a timer. After <var class=
          "LITERAL">lpd_poll_time</var> seconds, it will scan the
          queues, looking for jobs to process, and starts a process
          to service them. If it does not find any jobs it remains
          idle.</p>

          <p>The <var class="LITERAL">lpd_force_poll</var> flag
          causes the server to periodically poll the queues. This
          is useful when there is a high possibility that jobs
          could fail to be printed due to high loads on the
          server.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="OPENDEVICE">15.5. Opening the
          Output Device</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">achk</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Accounting check at
              start</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">af=</var><span class=
              "emphasis"><i class="EMPHASIS">Accounting
              File</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ar</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Remote printer
              accounting enabled</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">as=</var><span class=
              "emphasis"><i class="EMPHASIS">Accounting at
              start</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">connect_grace=</var><span
              class="emphasis"><i class="EMPHASIS">Time between
              jobs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">connect_interval=</var><span
              class="emphasis"><i class="EMPHASIS">Connection
              interval</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">connect_timeout=</var><span
              class="emphasis"><i class="EMPHASIS">Connection
              timeout</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">control_filter=</var><span
              class="emphasis"><i class="EMPHASIS">Control file
              filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ff=</var><span class=
              "emphasis"><i class="EMPHASIS">form
              feed</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">fo</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">form feed on
              open</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">la</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Local printer
              accounting enabled</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ld=</var><span class=
              "emphasis"><i class="EMPHASIS">leader on open
              (initialization string)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lk</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Lock IO
              device</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lp=</var><span class=
              "emphasis"><i class="EMPHASIS">IO device
              pathname</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">nb</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Nonblocking device
              open</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">network_connect_grace=</var><span class=
              "emphasis"><i class="EMPHASIS">Interval in secs
              between jobs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">of=</var><span class=
              "emphasis"><i class="EMPHASIS">of
              filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">retry_econnrefused</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Retry if
              open failed</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">retry_nolink</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Retry if open
              failed</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rm=</var><span class=
              "emphasis"><i class="EMPHASIS">the remote machine to
              send the job to</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rp=</var><span class=
              "emphasis"><i class="EMPHASIS">the remote print queue
              to send the job to</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">rw</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">device opened RW
              flag</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">server_tmp_dir=</var><span
              class="emphasis"><i class="EMPHASIS">temporary
              directory</i></span></p>
            </li>
          </ul>
          Sequence of Operations: 

          <ol type="1">
            <li>
              <p>During the server operations, it will try to
              create temporary files in the print queue spool
              directory. If this is not desirable, it will create
              them in the <var class="LITERAL">server_tmp_dir</var>
              directory.</p>
            </li>

            <li>
              <p>If the accounting file specified by <var class=
              "LITERAL">af</var> exists, it is opened (af_fd) and
              the af_fd is passed as file descriptor 3 to all
              filters. If the <var class="LITERAL">af</var> value
              has the form <var class="LITERAL">af=|/program</var>
              then the program is started and the program <acronym
              class="ACRONYM">STDIN</acronym> is used as af_fd. If
              the <var class="LITERAL">af</var> value has the form
              <var class="LITERAL">af=host%port</var>, then a
              TCP/IP connection to the corresponding port on the
              remote host is made and the port used as af_fd. In
              the latter two cases, the filter <acronym class=
              "ACRONYM">STDIN</acronym> (file descriptor 0) is
              actually opened read/write, and is used when
              information is needed from the accounting filter or
              remote server. See <a href=
              "#ACCOUNTINGSERVER">Accounting Printcap Options</a>
              for more information on the <b class=
              "APPLICATION">LPRng</b> accounting support.</p>
            </li>

            <li>
              <p><a name="ACCOUNTSTART"></a> If <var class=
              "LITERAL">la</var> (local accounting) is true and we
              are printing a job or <var class="LITERAL">ar</var>
              (remote accounting) is true and we are transferring a
              job, the <var class="LITERAL">as</var> value is
              examined. If it is a filter (program) specification,
              then the program is started with its <acronym class=
              "ACRONYM">STDIN</acronym> attached to <tt class=
              "FILENAME">/dev/null</tt>, <acronym class=
              "ACRONYM">STDOUT</acronym> will be read by the print
              spooler, <acronym class="ACRONYM">STDERR</acronym>
              output will be written to the error log. The lpd
              program will wait until the accounting filter program
              terminates, and examine the error code for action, as
              for the other filters (see <a href=
              "#ERRORCODES">errorcodes</a> below). If the exit
              status is 0, (JSUCC) then the printing process will
              continue, if JHOLD the job will be held, if JREMOVE
              the job will be removed, if JFAIL the job processing
              will terminate with a JFAIL indication, otherwise the
              job processing will terminate with a JABORT
              indication.</p>
            </li>

            <li>
              <p>If the accounting filter exited with a JSUCC (no
              error code) and the <var class="LITERAL">achk</var>
              (accounting check) flag is set, the line read from
              the accounting filter <acronym class=
              "ACRONYM">STDOUT</acronym> will be examined. This
              line should be <var class="LITERAL">accept</var>,
              <var class="LITERAL">hold</var>, <var class=
              "LITERAL">fail</var>, <var class=
              "LITERAL">remove</var>, otherwise the job processing
              terminates with a JABORT indication. An <var class=
              "LITERAL">accept</var> will allow the job to be
              printed, <var class="LITERAL">hold</var> will hold
              the job, <var class="LITERAL">fail</var> will cause
              the job to fail, <var class="LITERAL">remove</var>
              will cause the job to be removed.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">connect_grace</var>
              value is non-zero and the server is opening a device
              or <var class="LITERAL">network_connect_grace</var>
              is non-zero and a network connection is being made,
              the server will pause the specified time. This is to
              accommodate devices which need a recovery time
              between jobs.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">lp</var> option is
              checked to determine the type of IO device.</p>

              <div class="INFORMALTABLE">
                <a name="AEN7143"></a>

                <table border="1" frame="border" rules="all" class=
                "CALSTABLE">
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Format</th>

                      <th>Meaning</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td><tt class="FILENAME">/pathname</tt></td>

                      <td>Absolute pathname of IO device</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">pr@host</var></td>

                      <td>transfer to <var class="LITERAL">pr</var>
                      on remote <var class=
                      "LITERAL">host</var></td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">host%port</var></td>

                      <td>open a TCP/IP connection to port on host.
                      host can be name or IP address</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">|filter</var></td>

                      <td>run the filter program; it <acronym
                      class="ACRONYM">STDIN</acronym> will be used
                      as device</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>The IO device specified by <var class=
              "LITERAL">lp</var> is opened write-only or read-write
              if the <var class="LITERAL">rw</var> flag is true,
              and the resulting file descriptor is io_fd. If the
              <var class="LITERAL">nb</var> flag is set, a
              non-blocking open will be done as well. If the <var
              class="LITERAL">lk</var> (lock device) flag is true,
              the device will be locked against use by other <b
              class="APPLICATION">lpd</b> servers.</p>
            </li>

            <li>
              <p>If a <var class="LITERAL">host%port</var>
              combination, a TCP/IP connection will be opened to
              the remote port and the connection will be used as
              io_fd.</p>
            </li>

            <li>
              <p>If a filter program is specified, the filter
              program will be run and the <acronym class=
              "ACRONYM">STDIN</acronym> of the filter will be used
              as the device file descriptor.</p>
            </li>

            <li>
              <p>If a <var class="LITERAL">rp@rm</var> combination,
              or none of the above combinations are true and the
              <var class="LITERAL">rm</var> and <var class=
              "LITERAL">rp</var> values are non-zero, then the job
              will be transferred to a remote printer. The type of
              operation will be a job transfer, rather than
              printing operation.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">connect_timeout</var>
              value is non-zero, a timeout is setup for the device
              or socket open. If the device or connection open does
              not succeed within the timeout, then the open
              operation fails.</p>
            </li>

            <li>
              <p>If a connection is to a network address (i.e. -
              <code class="FUNCTION">connect()</code> system call)
              and the connection attempt fails with an <acronym
              class="ACRONYM">ECONNREFUSED</acronym> error, if the
              <var class="LITERAL">retry_econnrefused</var> flag is
              set then the connection attempt is retried, but this
              time using an alternative port number. See <a href=
              "#RFC1179REF">RFC1179</a> for details. This is
              repeated until all of the possible originating port
              numbers are exhausted.</p>
            </li>

            <li>
              <p>If the open or connect operation fails, and the
              <var class="LITERAL">retry_nolink</var> flag is set,
              then the server will pause for a minimum of <var
              class="LITERAL">connect_grace</var> plus a multiple
              of <var class="LITERAL">connect_interval</var>
              seconds based on the number of attempts before
              retrying the open operation. Note that the interval
              may increase as the number of attempts increases.</p>
            </li>

            <li>
              <p>If printing a job and the <var class=
              "LITERAL">:of</var> filter is specified, it is
              created with its <acronym class=
              "ACRONYM">STDOUT</acronym> (fd 1) attached to the
              io_fd. Its stdin (of_fd) will be used in the steps
              listed below. If there is no <var class=
              "LITERAL">:of</var> filter, then the of_fd value will
              be the io_fd descriptor.</p>
            </li>

            <li>
              <p>If transferring a job and the <var class=
              "LITERAL">control_filter</var> option is specified,
              then the program specified by the <var class=
              "LITERAL">control_filter</var> value will be run. It
              will have its <acronym class=
              "ACRONYM">STDIN</acronym> set to the control file,
              and its <acronym class="ACRONYM">STDOUT</acronym>
              output will be used as the new value of the control
              file to transfer to the remote host. See <a href=
              "#FILTEROPTIONS">Filter Command Line Options and
              Environment Variables</a> for details of options
              passed to the control filter, and <a href=
              "#ERRORCODES">errorcodes</a> for the exit codes of
              the filter.</p>
            </li>

            <li>
              <p>If the operation is a job transfer, the operation
              proceeds as outlined in <a href=
              "#RFC1179REF">RFC1179</a>, and then the <a href=
              "#NORMALTERM">Normal Termination</a> operations are
              carried out.</p>
            </li>

            <li>
              <p>If the operation is a print operation and the <var
              class="LITERAL">ld</var> (leader on open) value is
              provided, the string is translated (escapes removed)
              and written to the of_fd file descriptor.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">fo</var> (form feed on
              open) flag is true, then the <var class=
              "LITERAL">ff</var> (form feed) string is translated
              (escapes removed) and written to the of_fd file
              descriptor.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="BANNERPRINTING">15.6. Printing
          Banners</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">ab</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Always print banner
              (default FALSE)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">be=</var><span class=
              "emphasis"><i class="EMPHASIS">End banner generator
              program</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bl=</var><span class=
              "emphasis"><i class="EMPHASIS">Short banner line
              format</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bp=</var><span class=
              "emphasis"><i class="EMPHASIS">Banner generator
              program</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bs=</var><span class=
              "emphasis"><i class="EMPHASIS">Start banner
              generator</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">generate_banner</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Generate
              banner for forwarded jobs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">hl</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Banner (header)
              Last</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">of=</var><span class=
              "emphasis"><i class="EMPHASIS">Banner and File
              Separator Filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sb</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Short banner (default
              FALSE)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sh</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Suppress header
              (banners) (default FALSE)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>Banner printing is one of the more complicated
          configuration options of <b class=
          "APPLICATION">LPRng</b>. This is due mainly to historical
          evolution of the software, as well as a lack of a well
          defined standard for filter responsibilities. In the
          original BSD print spoolers, the philosophy was that
          banner printing should be delegated to the filters, as
          they were the most aware of the capabilities of the
          printers. This required an <span class="emphasis"><i
          class="EMPHASIS">out of band</i></span> method to convey
          banner printing information to the filter, and resulted
          in a complicated interface. The original interface
          was:</p>

          <ol type="1">
            <li>
              <p>The filter doing banner printing was invoked as a
              special <var class="LITERAL">:of</var> filter, or
              passed a special flag.</p>
            </li>

            <li>
              <p>The print spooling software would send a special
              <span class="emphasis"><i class="EMPHASIS">single
              line</i></span> of information telling it what the
              banner information should be. Note that this line was
              never documented except for the source code, and was
              inconsistent from version to version. Also, there was
              no indication of what to do with additional lines, if
              any.</p>
            </li>

            <li>
              <p>The filter would generate the banner, discard the
              line, and then pass other lines to the output
              device.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Adding to the confusion, the original print spoolers
          had a <var class="LITERAL">:sh</var> (suppress header or
          banner) flag, which was supposed to suppress banner
          printing. It did this by having the print spooler not
          generate the magic banner information line.</p>

          <p>A more sophisticated banner printing system would
          allow the print spooler software to generate the banner,
          and would then have the <var class="LITERAL">:of</var>
          filter act as a pass through. Thus, we need configure the
          <var class="LITERAL">:of</var> filter NOT to use the
          first line as banner printing information, and to pass
          through all information to the device.</p>

          <p>Complicating this whole mess is the <var class=
          "LITERAL">ld</var> (leader option) and <var class=
          "LITERAL">tr</var> (trailer option) which is a string
          sent to the output device (<var class="LITERAL">:of</var>
          filter) when the device (filter) is initialized or
          terminated. This can sometimes be interpreted as the
          banner line, leading to unexpected results.</p>

          <p>Sequence of Operations:</p>

          <ol type="1">
            <li>
              <p>If the <var class="LITERAL">sh</var> (suppress
              header) flag is true, no banner is printed, and the
              actions in this section are skipped. No <span class=
              "emphasis"><i class="EMPHASIS">banner information
              line</i></span> is generated for the <var class=
              "LITERAL">:of</var> filter, and no banner printing
              program is invoked. If there is an <var class=
              "LITERAL">:of</var> filter and it is expecting such a
              line and you have <var class="LITERAL">ld</var> or
              <var class="LITERAL">tr</var> information then you
              may get unexpected results (actually, catastrophic
              failure is a better term, but I digress).</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">hl</var> (header last)
              flag is true the banner is printed at the end of the
              job and the actions in this section are done at the
              end of the job.</p>
            </li>

            <li>
              <p>If the user does not want banner pages she can use
              the <tt class="COMMAND">lpr -h</tt> option. This will
              cause the <b class="APPLICATION">lpr</b> program to
              delete the <var class="LITERAL">L</var> (banner name)
              line in the control file. If there is no <var class=
              "LITERAL">L</var> line in the control file and <var
              class="LITERAL">ab</var> (always print a banner) is
              false (the default), then no banner is printed and
              the other actions in this section are skipped. If
              <var class="LITERAL">ab</var> is true and the <var
              class="LITERAL">L</var> line is missing then the <var
              class="LITERAL">N</var> (user login name) is used; if
              it is missing as well, then ANONYMOUS is used for the
              user name.</p>
            </li>

            <li>
              <p>If a banner printing program is specified by <var
              class="LITERAL">bp</var>, <var class=
              "LITERAL">bs</var>, or <var class="LITERAL">be</var>
              options, then <b class="APPLICATION">LPRng</b> will
              invoke the program to generate a banner and then send
              the generated banner to the printer via the <var
              class="LITERAL">:of</var> filter. The banner printing
              program will be invoked using the standard filter
              command line flags (see <a href=
              "#FILTEROPTIONS">Filter Command Line Options and
              Environment Variables</a> for details), with is
              <acronym class="ACRONYM">STDIN</acronym> attached to
              /dev/null and <acronym class=
              "ACRONYM">STDOUT</acronym> attached to a file to hold
              the output banner.</p>
            </li>

            <li>
              <p>If no banner printing program is specified and the
              <var class="LITERAL">sb</var> (short banner) option
              is TRUE (default is true), then the <var class=
              "LITERAL">bl=...</var> (banner line) option value is
              expanded and sent to the <var class=
              "LITERAL">of_fd</var> (<var class="LITERAL">:of</var>
              filter or device. The default <var class=
              "LITERAL">bl</var> value is: <var class=
              "LITERAL">bl=$-'C:$-'n Job: $-'J Date: $-'t</var>.
              Using our example, this will get translated to:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN7331"></a>
<pre class="SCREEN">
    papowell:A Job: file1 file2 Date: Thu Nov 27 23:02:04 PST 1997
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If no banner printing program is specified and we
              have <var class="LITERAL">sb@</var> (no short banner)
              then we skip banner generation, i.e. - we do <span
              class="emphasis"><i class="EMPHASIS">not</i></span>
              send a banner generation line to the output (<var
              class="LITERAL">:of</var> filter).</p>
            </li>

            <li>
              <p>If the queue is a normal forwarding queue, then
              the <var class="LITERAL">generate_banner</var> option
              will invoke the <var class="LITERAL">bp</var>, <var
              class="LITERAL">bs</var> or <var class=
              "LITERAL">be</var> program as appropriate to create a
              banner page file which is then made the first
              (default) or last (<var class="LITERAL">hl</var> flag
              or <var class="LITERAL">be=...</var> present) file in
              a job. This option has no effect in other types of
              queues. See the <span class="emphasis"><i class=
              "EMPHASIS"><a href=
              "#TRANSLATEFORMAT">translate_format</a></i></span>
              option as well.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTINGJOB">15.7. Printing
          Job Files</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">Xf=</var><span class=
              "emphasis"><i class="EMPHASIS">Format
              Filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sf</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Suppress Form Feed
              Separators</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">if=</var><span class=
              "emphasis"><i class="EMPHASIS">Default F Format
              Filter</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">pr=</var><span class=
              "emphasis"><i class="EMPHASIS">pr formatting
              program</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">send_job_rw_timeout=</var><span class=
              "emphasis"><i class="EMPHASIS">print job read/write
              timeout</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">send_query_rw_timeout=</var><span class=
              "emphasis"><i class="EMPHASIS">status query operation
              read/write timeout</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sf</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Suppress form feed
              between job files</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>Sequence of Operations: for each job in listed in the
          control file, the following operations are done in
          turn.</p>

          <ol type="1">
            <li>
              <p>If there is an <var class="LITERAL">:of</var>
              filter present, the suspend string <var class=
              "LITERAL">\031\001</var> is written to of_fd and the
              no further action is taken until the of filter is
              suspended.</p>
            </li>

            <li>
              <p>The control file line for the job is examined, and
              the first letter of the data file specification is
              used as the format.</p>
            </li>

            <li>
              <p>If the format is <var class="LITERAL">p</var>, the
              job is first processed by the program specified by
              the <var class="LITERAL">pr</var> program, and the
              program output used as the print file.</p>
            </li>

            <li>
              <p>If the format is <var class="LITERAL">f</var>,
              <var class="LITERAL">l</var>, or <var class=
              "LITERAL">p</var> then the <var class=
              "LITERAL">:if</var> filter is used, otherwise the
              keyword <var class="LITERAL">Xf</var> is used. Note
              that certain formats such as <var class="LITERAL">p,
              a, l</var>, may not be used as formats.</p>
            </li>

            <li>
              <p>The filter program is started with an appropriate
              set of command line options (see <a href=
              "#FILTEROPTIONS">Filter Command Line Options and
              Environment Variables</a> ), and with its <acronym
              class="ACRONYM">STDOUT</acronym> attached to the
              printing device (io_fd), <acronym class=
              "ACRONYM">STDERR</acronym> to a pipe which results in
              the output being written to the status file. If
              debugging is enabled, then the <acronym class=
              "ACRONYM">STDERR</acronym> output is also written to
              the error log file (lf).</p>
            </li>

            <li>
              <p>When doing a read/write operation to a device or
              remote system, a timeout can be specified. When doing
              a print or job transfer operation, the <var class=
              "LITERAL">send_job_rw_timeout</var> value is used.
              When doing a status or query operation, the <var
              class="LITERAL">send_query_rw_timeout</var> value is
              used. If a write or write operation does not complete
              within the specified timeout seconds, then we have an
              error condition and job processing or the query
              operation is terminated with JFAIL status. If the
              timeout value is 0, then no timeout is done.</p>
            </li>

            <li>
              <p><a name="ERRORCODES"></a> <b class=
              "APPLICATION">lpd</b> will then wait for the filter
              to exit. The following exit codes are used by <b
              class="APPLICATION">lpd</b>:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN7415"></a>
<pre class="SCREEN">
    Key      Value   Meaning
    JSUCC    0       Successful
    JFAIL    1, 32   Failed - retry later
    JABORT   2, 33   Abort - terminate queue processing
    JREMOVE  3, 34   Failed - remove job
    (Unused) 4, 35
    (Unused) 5, 36
    JHOLD    6, 37   Hold this job - reprint later
    JNOSPOOL 7, 38   No spooling to this queue
    JNOPRINT 8, 39   No printing from this queue
    JSIGNAL  9,  40   Killed by unrecognized signal
    JFAILNORETRY 10, 41 Failed, no retry
    Other            Abort - terminate queue processing
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If the filter exit status was JSUCC (0), or no
              error indicated, then processing will continue
              otherwise the job termination takes (see <a href=
              "#ABNORMALTERM">Abnormal Termination</a> ).</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">:of</var> filter is
              present, then it is reactivated with a <tt class=
              "COMMAND">kill -CONT</tt> signal.</p>
            </li>

            <li>
              <p>The the <var class="LITERAL">sf</var> (suppress FF
              print file separators ) is turned off a form feed is
              sent between each file of a job.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN7427">15.8. Printing Banner
          At End of Job</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">hl</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Header (Banner)
              Last</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The actions taken in this step are identical to those
          for the <a href="#BANNERPRINTING">Printing Banner</a>,
          with the exception that the <var class="LITERAL">be</var>
          (end banner program) is used to select the banner
          generation program rather than the <var class=
          "LITERAL">bs</var> (start banner program).</p>

          <p>If we have <var class="LITERAL">hl</var> true, then we
          print a banner at the end of the job, rather than
          start.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="NORMALTERM">15.9. Normal
          Termination</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">fq</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Form Feed on
              Close</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">la</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Local Printer
              Accounting</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">tr=</var><span class=
              "emphasis"><i class="EMPHASIS">Trailer on
              Close</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ae=</var><span class=
              "emphasis"><i class="EMPHASIS">Accounting at
              end</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">save_when_done</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Save when
              done</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">save_on_error</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Do not
              delete on error</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">done_jobs=N</var><span class=
              "emphasis"><i class="EMPHASIS">Save status of last N
              jobs</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">wait_for_eof</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Wait for EOF
              before closing device</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">socket_linger</var><span
              class="emphasis"><i class="EMPHASIS">socket linger
              timeout</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">half_close</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">use shutdown()
              and not close()</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>Sequence of Operations:</p>

          <ol type="1">
            <li>
              <p>If we are printing and the <var class=
              "LITERAL">fq</var> flag is set and the <var class=
              "LITERAL">sf</var> (suppress interfile FF) flag is
              set, then the <var class="LITERAL">ff</var> (form
              feed) string will be interpreted and sent to the
              of_fd.</p>
            </li>

            <li>
              <p>If we are printing, the <var class=
              "LITERAL">tr</var> (trailer) string will be
              interpreted and sent to the of_fd.</p>
            </li>

            <li>
              <p>If printing and the <var class="LITERAL">la</var>
              (local printer accounting) flag is set or
              transferring a job and the <var class=
              "LITERAL">ar</var> (remote accounting) flag is set,
              the <var class="LITERAL">ae</var> is examined and
              accounting is done as described for the <span class=
              "emphasis"><i class="EMPHASIS"><a href=
              "#ACCOUNTSTART">as</a> field.</i></span></p>
            </li>

            <li>
              <p>If the <var class="LITERAL">:of</var> filter is
              present, its <acronym class="ACRONYM">STDIN</acronym>
              is closed, and the <b class="APPLICATION">lpd</b>
              server waits for it to exit. The exit status is used
              as described above.</p>
            </li>

            <li>
              <p>If the device is a socket or network connection,
              the socket linger time is set to <var class=
              "LITERAL">socket_linger</var> value if nonzero.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">half_shut</var> flag
              is set, then a <var class=
              "LITERAL">shutdown(fd,WR_DONE)</var> will be done on
              the connection. This tells the TCP/IP stack that all
              data transmission has been completed. Errors or other
              information can still be read from the connection. If
              the <var class="LITERAL">half_shut</var> flag is
              clear, then a <var class="LITERAL">close(fd)</var>
              will be done and no errors or other information will
              be read.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">wait_for_eof</var>
              option is true (default) then a read is done on the
              connection until an EOF is found. The device (io_fd)
              is then closed.</p>
            </li>

            <li>
              <p>The job is marked as completed in the spool
              queue.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">save_when_done</var>
              flag is clear and the <var class=
              "LITERAL">done_jobs</var> and <var class=
              "LITERAL">done_jobs_max_age</var> values are zero
              (0), the job is removed.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">done_jobs</var> or
              <var class="LITERAL">done_jobs_max_age</var> values
              are nonzero, the spool queue is periodically checked
              and for an excess number of jobs or jobs with old
              status. This action is suppressed if either the <var
              class="LITERAL">save_when_done</var> or <var class=
              "LITERAL">save_on_error</var> flag is set.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="ABNORMALTERM">15.10. Abnormal
          Termination</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">mail_from=</var><span class=
              "emphasis"><i class="EMPHASIS">Mail from user
              name</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">mail_operator_on_error=</var><span class=
              "emphasis"><i class="EMPHASIS">Mail to operator on
              error</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">send_try=</var><span class=
              "emphasis"><i class="EMPHASIS">Maximum printing or
              transfer attempts</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">save_on_error</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Do not
              delete on error</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">done_jobs=N</var><span class=
              "emphasis"><i class="EMPHASIS">Save status of last N
              jobs</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">done_jobs_max_age=N</var><span class=
              "emphasis"><i class="EMPHASIS">Remove status when
              older than N seconds</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">send_failure_action=</var><span class=
              "emphasis"><i class="EMPHASIS">Action on
              Failure</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">sendmail=</var><span class=
              "emphasis"><i class="EMPHASIS">sendmail path name and
              options</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">stop_on_abort</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Stop
              processing queue on filter abort</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>If the job processing terminates abnormally, the
          following sequence of events occurs:</p>

          <ol type="1">
            <li>
              <p>The job is marked as having an error during
              processing.</p>
            </li>

            <li>
              <p>The <b class="APPLICATION">lpd</b> server will
              attempt to kill all filters and other associated
              processes by sending a SIGINT and SIGCONT (<tt class=
              "COMMAND">kill -INT</tt> and <tt class="COMMAND">kill
              -CONT</tt>) to them.</p>
            </li>

            <li>
              <p>If there is a <var class=
              "LITERAL">mail_operator_on_error</var> value, the
              specified operator will be mailed an error
              indication. The <var class="LITERAL">sendmail</var>
              option specifies the pathname of the <span class=
              "emphasis"><i class="EMPHASIS">sendmail</i></span>
              program and the options needed to have it read mail
              addresses from its standard input. For example, <var
              class="LITERAL">sendmail=/usr/sbin/sendmail -oi
              -t</var> is a commonly used set of options.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">mail_from</var> value
              specifies the user name used for mail origination. If
              not specified, the default is to use the print spool
              queue or printer name.</p>
            </li>

            <li>
              <p>If there is a <var class=
              "LITERAL">send_failure_action</var> specified, then
              it is decoded and the corresponding action taken. If
              the value is <var class="LITERAL">remove</var>, <var
              class="LITERAL">hold</var>, <var class=
              "LITERAL">abort</var>, or <var class=
              "LITERAL">retry</var>, then the job is removed, held,
              aborted, or retried. If the value is <tt class=
              "FILENAME">|/program</tt>, the program is executed
              and the number of attempts are written to the filter
              <acronym class="ACRONYM">STDIN</acronym>. The exit
              status of the filter will be used to determine the
              consequent actions. That is, JSUCC (0) will be
              success, and the standard success action will be
              taken; JFAIL will cause retry, JREMOVE will cause the
              job to be removed, JHOLD will cause the job to be
              held, JABORT or other status will abort
              processing.</p>
            </li>

            <li>
              <p>If the status is ABORT and the <var class=
              "LITERAL">stop_on_abort</var> flag is set, then
              further processing of jobs is terminated. The job is
              not removed from the queue.</p>
            </li>

            <li>
              <p>If the error status indicates removal, the <var
              class="LITERAL">save_on_error</var> flag is clear,
              and the <var class="LITERAL">done_jobs</var> and <var
              class="LITERAL">done_jobs_max_age</var> values are
              zero (0), then the job is removed from the spool
              queue.</p>
            </li>

            <li>
              <p>If the error status indicates that no further
              operations should be performed on the queue, then the
              <b class="APPLICATION">lpd</b> server will stop
              processing jobs.</p>
            </li>

            <li>
              <p>If the error code indicated that the job should be
              retried, and the <var class="LITERAL">send_try</var>
              value is 0 or the number of attempts is less than the
              <var class="LITERAL">send_try</var> value, then the
              job is retried. Between each attempt to transfer a
              job to a remote site. This pause will double after
              each attempt, reaching a maximum of <var class=
              "LITERAL">max_connect_interval</var> seconds. If <var
              class="LITERAL">max_connect_interval</var> is 0,
              there is no limit on the interval value.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="BK">15.11. Forwarding
          Jobs</a></h2>

          <p>Options:</p>

          <ul>
            <li>
              <p><var class="LITERAL">bk</var><span class=
              "emphasis"><i class="EMPHASIS">Berkeley compatible
              control file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bq_format=</var><span class=
              "emphasis"><i class="EMPHASIS">format of filtered
              output</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpd_bounce</var><span class=
              "emphasis"><i class="EMPHASIS">filter job and
              transfer output</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">control_filter=</var><span
              class="emphasis"><i class="EMPHASIS">Control file
              filter</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">control_file_line_order=</var><span class=
              "emphasis"><i class="EMPHASIS">Control file line
              order</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">nline_after_file</var><span
              class="emphasis"><i class="EMPHASIS">N line after
              data file</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">send_data_first</var><span
              class="emphasis"><i class="EMPHASIS">send data files
              first</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>If a spool queue is doing store and forward
          operations, then rather than printing a job the control
          files and data files are sent to the remote printer. In
          order to do this, the following items must be
          arranged.</p>

          <ul>
            <li>
              <p>If necessary, the job must be processed by filters
              on the local host.</p>
            </li>

            <li>
              <p>The control file must be prepared and updated
              according to the requirements of the remote site.</p>
            </li>

            <li>
              <p>A connection must be established to the remote
              site.</p>
            </li>

            <li>
              <p>The data files and control files must be
              transferred to the remote site.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>One of the more serious problems is when a print
          spooler (LPR) program does not generate print jobs in a
          manner compatible with a remote system. While <b class=
          "APPLICATION">LPRng</b> performs checks for improper
          implementations of RFC1179, it will try to accept a job
          even under the most severe abuse of the protocol.
          However, other spoolers are not so forgiving. Some
          spoolers require that the contents of the control file be
          in <span class="emphasis"><i class=
          "EMPHASIS">exactly</i></span> the order that the original
          1988 BSD <b class="APPLICATION">lpr</b> software
          generated them. While some entries can be missing, all
          the entries present in the file must be in an explicit
          order.</p>

          <p>The <var class="LITERAL">bk</var> (Berkeley <b class=
          "APPLICATION">lpd</b> compatible control file) option
          causes <b class="APPLICATION">lpr</b> and <b class=
          "APPLICATION">lpd</b> to reformat the control file,
          removing objectionable entries. The control file of a job
          being sent to a remote printer will have its control file
          entries restricted to letters in (and the same order) as
          HPJCLIMWT1234. You can use the <var class=
          "LITERAL">control_file_line_order</var> option to specify
          an even more restricted set, and use the <var class=
          "LITERAL">nline_after_file</var> option to have the file
          information line (<var class="LITERAL">N</var> value)
          come after the data file entry.</p>

          <p>However, there are some very odd commercial
          implementations that require <span class="emphasis"><i
          class="EMPHASIS">more</i></span> information than is
          present. To assist with this, the <var class=
          "LITERAL">control_filter</var> option can be used. This
          specifies a program that will process the control file
          before it is sent to a remote destination. The <var
          class="LITERAL">control_filter</var> program is run with
          the standard set of filter options. <acronym class=
          "ACRONYM">STDIN</acronym> is attached to the control file
          and the <acronym class="ACRONYM">STDOUT</acronym> will be
          used as the control file value sent to the remote
          host.</p>

          <p>The exit code of the <var class=
          "LITERAL">control_filter</var> is used to determine
          whether to proceed in processing. See <a href=
          "#ERRORCODES">Errorcodes</a> for details.</p>

          <p>Sequence of Operations:</p>

          <ol type="1">
            <li>
              <p>A copy of the control file information is made and
              the copy will be modified during processing, rather
              than the original.</p>
            </li>

            <li>
              <p>If the <var class="LITERAL">lpd_bounce</var>
              option is specified then a temporary file is created
              and the job is printed using the procedures for
              printing to a device, but to the file. This includes
              all of the filter operations, banners, and so forth.
              The working copy of the control file is set to have
              the temporary file as the data file to be sent to the
              remote destination, and the data file format is set
              to the <var class="LITERAL">bq_format</var>
              value.</p>
            </li>

            <li>
              <p>The control file is rewritten according to the
              requirements of the routing information, if any. For
              each destination in the routing information and each
              copy, a new job identifier value will be
              generated.</p>
            </li>

            <li>
              <p>The control file is rewritten according to the
              <var class="LITERAL">bk</var> and <var class=
              "LITERAL">control_file_line_order</var> options. If a
              control filter is specified, the control filter
              program is run and the output of the program is used
              as the new control file.</p>
            </li>

            <li>
              <p>A connection is made to the remote host, and the
              data and control files are transferred to the remote
              host using the RFC1179 protocol. If the <var class=
              "LITERAL">send_data_first</var> option is specified
              the data files are sent first.</p>
            </li>

            <li>
              <p>If the job was sent successfully, the job status
              is updated in the same manner as for a printed
              job.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="DEBUGGING">15.12.
          Debugging</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">debugging=</var><span class=
              "emphasis"><i class="EMPHASIS">debugging
              options</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">full_time</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">full or extended
              time format</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">ms_time_resolution</var> FLAG
              <span class="emphasis"><i class=
              "EMPHASIS">millisecond time resolution</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">syslog_device=</var><span
              class="emphasis"><i class="EMPHASIS">syslog
              alternative device</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">use_info_cache</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">cache
              printcap and other information</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <b class="APPLICATION">LPRng</b> software has a
          very powerful debugging capability. Since most printing
          problems occur on remote systems where it is impossible
          to run debuggers, and since most systems do not do core
          dumps of SETUID ROOT programs, the <b class=
          "APPLICATION">LPRng</b> software provides a very verbose
          set of log file trace messages.</p>

          <p>First, serious errors or other information are logged
          using the <code class="FUNCTION">syslog()</code>
          facilities. If these are not present on a system, then
          the messages are logged to the device specified by <var
          class="LITERAL">syslog_device</var>.</p>

          <p>For client programs, the debugging options are
          specified on the command line and output is directed to
          <acronym class="ACRONYM">STDERR</acronym>. For the <b
          class="APPLICATION">lpd</b> server, debugging commands
          can be specified on the command line OR as the <var
          class="LITERAL">db=options</var> printcap value. Output
          is directed to the log file (<var class=
          "LITERAL">lf</var> option value, default log).</p>

          <p>A typical debug entry has the format <var class=
          "LITERAL">2,network+1,database</var>. This sets the
          general debugging level to 2, network debugging to 1 and
          the database debugging level to the default. The
          following debugging options and levels are supported.</p>

          <ul>
            <li>
              <p>nnn - general purpose debugging level</p>
            </li>

            <li>
              <p>network - network debugging</p>
            </li>

            <li>
              <p>database - database debugging</p>
            </li>

            <li>
              <p>receive - job or command reception debugging</p>
            </li>

            <li>
              <p>print - detailed job printing debugging</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">full_time</var> flag forces
          the logging and other information which has timestamps to
          have a full (year, month, day, etc.) timestamp. The <var
          class="LITERAL">ms_time_resolution</var> flag forces
          millisecond time resolution in the time stamp.</p>

          <p>The <var class="LITERAL">use_info_cache</var> (default
          ON) causes <b class="APPLICATION">lpd</b> to cache
          printcap and configuration information. This is desirable
          except when trying to change values in printcap files and
          test the results. By using <var class=
          "LITERAL">use_info_cache@</var> in the configuration
          information, you can get immediate responses. Also, see
          <a href="#LPCREREAD">lpc reread</a> for another
          method.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="FILTERS"></a>Chapter 16. Filters</h1>

        <p>This section gives an overview of how <b class=
        "APPLICATION">LPRng</b> uses filter programs, and gives a
        detailed discussion of how the printcap options and filters
        interact.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN7758">16.1. Filter
          Functions</a></h2>

          <p>Print filters are one of the most powerful tools in
          BSD-style printer systems.</p>

          <p>In general UNIX terms, a <span class="emphasis"><i
          class="EMPHASIS">filter</i></span> is a program that
          takes its input file(s), does something with it, and
          sends the result to its standard output. Most UNIX
          utilities are designed as filters. (But since you are a
          system manager, you should already know that :))</p>

          <p>In the context of a BSD-style print spooler (and also
          <b class="APPLICATION">LPRng</b>), the term <span class=
          "emphasis"><i class="EMPHASIS">filter</i></span> refers
          to a program that processes file while it is being
          transferred to a printer.</p>

          <p>The filter is executed with <acronym class=
          "ACRONYM">STDIN</acronym> reading from the file to be
          printed <acronym class="ACRONYM">STDOUT</acronym> to the
          printer device or a temporary file. <acronym class=
          "ACRONYM">STDERR</acronym> (file handle 2) is redirected
          to the status file, and file handle3 to an accounting
          file or program.</p>

          <p>A filter can be as simple as a <acronym class=
          "ACRONYM">LF</acronym> to <tt class="FILENAME">CR/LF</tt>
          translator, or it can incorporate a complete accounting
          system, automatic file type translations, or even
          redirect the job to another printing system.</p>

          <p>The <b class="APPLICATION">lpf</b> filter supplied as
          part of the <b class="APPLICATION">LPRng</b> distribution
          is a a very simple CR to CR/LF conversion filter. The <b
          class="APPLICATION">ifhp</b> filter provides support for
          more complex PostScript, PCL, and text printers.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="EXITCODES">16.2. Filter Exit
          Codes</a></h2>

          <p>When a filter exits, the exit code value is used by
          the parent process to determine what actions to take.
          Since filters are used in several places in the printing
          process, not just to do format conversion, there is a
          large number of recognized exit values.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN7780"></a>
<pre class="SCREEN">
    Key      Value   Meaning
    JSUCC    0       Successful
    JFAIL    1, 32   Failed - retry later
    JABORT   2, 33   Abort - terminate queue processing
    JREMOVE  3, 34   Failed - remove job
    (Unused) 4, 35   (Unused)
    (Unused) 5, 36   (Unused)
    JHOLD    6, 37   Hold this job - reprint later
    JNOSPOOL 7, 38   No spooling to this queue
    JNOPRINT 8, 39   No printing from this queue
    JSIGNAL  9,  40   Killed by unrecognized signal
    JFAILNORETRY 10, 41 Failed, no retry
    Other            Abort - terminate queue processing
</pre>
          </div>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JSUCC">16.2.1.
            JSUCC</a></h3>

            <p>A zero or <acronym class="ACRONYM">JSUCC</acronym>
            exit value always indicates success; a non-zero exit
            value indicates failure or a problem condition and
            requires special handling by the parent process.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JFAIL">16.2.2.
            JFAIL</a></h3>

            <p>When printing or performing some action that can be
            repeated, such as connecting to a remote printer, a 1
            or <acronym class="ACRONYM">JFAIL</acronym> status
            indicates a transient failure condition. Depending on
            various configuration options, the printing or other
            operation can be retried.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JABORT">16.2.3.
            JABORT</a></h3>

            <p>The 2 or <acronym class="ACRONYM">JABORT</acronym>
            is a more serious error, and indicates that there is no
            expectation that the operation would succeed if
            retried. It may also indicate that no other similar
            operation should be performed. Jobs whose print filters
            exit with <acronym class="ACRONYM">JABORT</acronym> are
            usually unprintable, and by default are removed from
            the print queue.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JREMOVE">16.2.4.
            JREMOVE</a></h3>

            <p>The <acronym class="ACRONYM">JREMOVE</acronym>
            status indicates that the job should be removed from
            the print queue. This is a refinement of the <acronym
            class="ACRONYM">JFAIL</acronym> and <acronym class=
            "ACRONYM">JABORT</acronym> status. The job is usually
            unconditionally removed from the print queue, even if
            it is normally kept in the queue for reprinting. This
            status is usually returned by filters which are
            responsible for permission checking and is returned
            when the user has no permission to print.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JHOLD">16.2.5.
            JHOLD</a></h3>

            <p>The <acronym class="ACRONYM">JREMOVE</acronym>
            status indicates that the job should be held and
            reprinted at a later time. This status is returned by
            various filters during the processing of a job, and
            usually indicates that the resources needed for a job
            are not available. Held jobs need to be explicitly
            released by the administrator.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JNOSPOOL">16.2.6. JNOSPOOL
            and JNOPRINT</a></h3>

            <p>The <acronym class="ACRONYM">JNOSPOOL</acronym> and
            <acronym class="ACRONYM">JNOPRINT</acronym> are used as
            part of the management of load balancing queues and the
            <span class="emphasis"><i class="EMPHASIS">check
            idle</i></span> filter. <b class=
            "APPLICATION">LPRng</b> has the ability to run a
            program to check to see if a spool queue is available
            for printing on a dynamic basis. If the filter that
            does this checking exits with <acronym class=
            "ACRONYM">JNOSPOOL</acronym> or <acronym class=
            "ACRONYM">JNOPRINT</acronym> then jobs should not be
            sent to the spool queue.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JSIGNAL">16.2.7.
            JSIGNAL</a></h3>

            <p>This status is usually returned when the exiting
            process is terminated by a signal or abort, and does
            not exit using the <var class="LITERAL">exit</var>
            facility. It is usually handled like a <acronym class=
            "ACRONYM">JABORT</acronym> exit status, and is the
            indication of a severe and possibly non-restartable
            system failure.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JNORETRY">16.2.8.
            JFAILNORETRY</a></h3>

            <p>This code is used under an extremely odd set of
            circumstances and was used to support a sophisticated
            print retry system.</p>

            <p>Normally when a print filter or other filter returns
            this code, it is treated as <acronym class=
            "ACRONYM">JFAIL</acronym>. The job is marked as having
            an error condition and is not <var class=
            "LITERAL">immediately</var> retried. Other jobs can
            then be tried for printing in the queue. It is not
            removed from the print queue, but marked as <var class=
            "LITERAL">unprintable</var>.</p>

            <p>When a <span class="emphasis"><i class=
            "EMPHASIS">round-robin retry</i></span> print
            scheduling algorithm is used, if there are no other
            jobs available for printing then the jobs that failed
            with <acronym class="ACRONYM">JFAILNORETRY</acronym>
            are retried. Thus, jobs that are submitted go to the
            head of the queue for printing, and jobs that are
            pending for repeat are printed after them. This
            algorithm is deprecated, and that the details of this
            algorithm are undocumented.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="JOTHER">16.2.9. Other
            Values</a></h3>

            <p>If a filter exits with other than the indicated
            value, or a value inappropriate for its purpose, then
            the result is treated like <acronym class=
            "ACRONYM">JABORT</acronym>.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PRINTJOBFORMATS">16.3. Print
          Job Formats</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">:if</var>, <var class=
              "LITERAL">cf</var>, <var class="LITERAL">df</var>,
              <var class="LITERAL">gf</var>, <var class=
              "LITERAL">nf</var>, <var class="LITERAL">:of</var>,
              <var class="LITERAL">rf</var>, <var class=
              "LITERAL">tf</var>, <var class="LITERAL">vf</var>,
              <var class="LITERAL">X</var><var class=
              "LITERAL">f</var>, <span class="emphasis"><i class=
              "EMPHASIS">Filter programs</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> has inherited a set
          of so-called `<span class="emphasis"><i class=
          "EMPHASIS">print formats</i></span>' from its BSD
          ancestor. The format was used to specify the type of file
          that was being printed. The <b class=
          "APPLICATION">lpd</b> server used the print format to
          select the filter for processing the file. The de<span
          class="emphasis"><i class="EMPHASIS">f</i></span>ault
          format is <var class="LITERAL">f</var>.</p>

          <p>The user can specify the format (i.e., the file type)
          by giving the appropriate option to <b class=
          "APPLICATION">lpr</b>:</p>

          <ul>
            <li>
              <p><var class="LITERAL">-b</var> or <var class=
              "LITERAL">-l</var>: Binary (literal) file. No
              processing should be done. The <var class=
              "LITERAL">l</var> format is recorded as the file
              format.</p>
            </li>

            <li>
              <p><var class="LITERAL">-c</var>: cifplot(1)
              output.</p>
            </li>

            <li>
              <p><var class="LITERAL">-d</var>: TeX DVI file.</p>
            </li>

            <li>
              <p><var class="LITERAL">-g</var>: Output from the
              plot(3X) routines.</p>
            </li>

            <li>
              <p><var class="LITERAL">-n</var> or <var class=
              "LITERAL">-t</var>: (di)troff output.</p>
            </li>

            <li>
              <p><var class="LITERAL">-p</var>: Text file that
              should be pre-processed by the <var class=
              "LITERAL">pr</var> command, and then by the standard
              text filter.</p>
            </li>

            <li>
              <p><var class="LITERAL">-v</var>: Benson Varian
              raster image.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>Alternatively, one can also use <var class=
          "LITERAL">-Fx</var>, where <var class="LITERAL">x</var>
          is the format specifier. (E.g., <var class=
          "LITERAL">-Fc</var> instead of <var class=
          "LITERAL">-c</var>.) This last form also allows you to
          use other (non-standard) format specifiers.</p>

          <p>The filter for format <var class="LITERAL">X</var> is
          the value for the <var class="LITERAL">Xf</var> printcap
          option, with some minor exceptions. The following <var
          class="LITERAL">Xf</var> options have a pre-defined
          meaning.</p>

          <ul>
            <li>
              <p><var class="LITERAL">:if</var> The <var class=
              "LITERAL">f</var> format filter, i.e. - for the
              default <var class="LITERAL">f</var> format. All
              print jobs are passed through this one, unless
              another format is selected.</p>
            </li>

            <li>
              <p><a name="CF"></a> <var class="LITERAL">cf</var>
              Cifplot data filter (for <var class=
              "LITERAL">-c</var> format).</p>
            </li>

            <li>
              <p><a name="DF"></a> <var class="LITERAL">df</var>
              Filter for DVI files (<var class=
              "LITERAL">-d</var>).</p>
            </li>

            <li>
              <p><a name="GF"></a> <var class="LITERAL">gf</var>
              Graph data filter (<var class=
              "LITERAL">-g</var>).</p>
            </li>

            <li>
              <p><a name="NF"></a> <var class="LITERAL">nf</var>
              Ditroff data filter (<var class=
              "LITERAL">-n</var>).</p>
            </li>

            <li>
              <p><var class="LITERAL">:of</var> This filter is used
              for processing the (optional) banner at the start
              and/or end of the print job, and also for the
              interjob separators. See <a href="#OFDETAILS">OF
              Filter</a> for details.</p>
            </li>

            <li>
              <p><a name="RF"></a> <var class="LITERAL">rf</var>
              Filter for Fortran style files (<var class=
              "LITERAL">-r</var>).</p>
            </li>

            <li>
              <p><a name="TF"></a> <var class="LITERAL">tf</var>
              Troff filter (<var class="LITERAL">-t</var>).</p>
            </li>

            <li>
              <p><a name="VF"></a> <var class="LITERAL">vf</var>
              (Versatek) raster image filter (<var class=
              "LITERAL">-v</var>).</p>
            </li>
          </ul>
          &#13;<br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="OFDETAILS">16.4. OF
          Filter</a></h2>

          <p>The <var class="LITERAL">:of</var> filter is used to
          process banners and job separators. The <var class=
          "LITERAL">:of</var> filter is responsible for performing
          appropriate processing of this information and sending to
          the printer for action.</p>

          <p>While the various file filters are invoked on a once
          per print file basis, the <var class="LITERAL">:of</var>
          filter is invoked on a once per print job basis.</p>

          <p>This filter is the first one to be started, and should
          perform whatever specialized device initialization is
          needed. It should also do whatever accounting procedure
          is desired for start of job accounting.</p>

          <p>The <var class="LITERAL">:of</var> filter will be
          given any banner printing or job separation information
          for a job. As part of its operation, it can detect a
          specific string, corresponding to a banner print request,
          and generate a banner. (See the <a href="#JOBSTEPS">Job
          Processing Steps and Printcap Options</a> for
          details.)</p>

          <p>During operation, the <b class="APPLICATION">lpd</b>
          server will send the special <span class="emphasis"><i
          class="EMPHASIS">stop</i></span> sequence of <var class=
          "LITERAL">\031\001</var> to the <var class=
          "LITERAL">:of</var> filter. The filter must then suspend
          itself using a <tt class="COMMAND">kill -STOP</tt>
          operation. The <b class="APPLICATION">lpd</b> server will
          detect that the <var class="LITERAL">:of</var> filter has
          suspended itself and then will perform other printing
          operations.</p>

          <p>After the other printing operations have been
          completed, the <var class="LITERAL">:of</var> will then
          be sent a <tt class="COMMAND">kill -CONT</tt> signal.</p>

          <p>This sequence will continue until all information has
          been printed, and then the <var class="LITERAL">:of</var>
          filter's <acronym class="ACRONYM">STDIN</acronym> will be
          closed. The filter will then perform whatever cleanup
          operations are needed, update accounting or other
          information, and exit.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PR">16.5. <b class=
          "APPLICATION">lpr</b> -p format</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">pr=</var><span class=
              "emphasis"><i class="EMPHASIS">pr program for p
              format</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">-p</var> format is requires
          filtering the the input files by the <var class=
          "LITERAL">pr</var> utility and then passing the result
          through the <var class="LITERAL">:if</var> filter.</p>

          <p>This is widely regarded as a kludge and may not be
          supported on your print spooler.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN7980">16.6. <b class=
          "APPLICATION">lpr</b> binary (-l) format</a></h2>

          <p>The binary (or literal) format is <var class=
          "LITERAL">-l</var>. The <var class="LITERAL">:if</var>
          filter is used to process the file, and is invoked with
          the <var class="LITERAL">-c</var> (<var class=
          "LITERAL">c</var>ancel processing?) flag.</p>

          <p>The filter will not modify the file when sending it to
          the printer, but may apply various setups to the
          printer.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="CHAININGFILTERS">16.7.
          Chaining Filters</a></h2>

          <p>If a filter command has a pipe (<var class=
          "LITERAL">|</var>) or IO redirection indicator (<var
          class="LITERAL">&lt;</var> or <var class=
          "LITERAL">&gt;</var>) in it, or starts with an open
          parenthesis (<var class="LITERAL">(</var>), the filter is
          run by passing the entire command to the shell specified
          by the <var class="LITERAL">shell</var> configuration
          option. This allows a wide variety of options and
          operations to be carried out. The <var class=
          "LITERAL">$*</var> value should be used to have the
          filter options passed to the correct entry in the filter
          chain.</p>

          <p>For example,</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN7999"></a>
<pre class="SCREEN">
    lp:
      :filter=( echo "starting `date`" &gt;/var/log/status; /usr/local/ifhp $* )
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="FILTEROPTIONS">16.8. Filter
          Command Line Options and Environment Variables</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">bk_filter_options=</var><span
              class="emphasis"><i class="EMPHASIS">Backwards
              Compatible Filter options</i></span></p>
            </li>

            <li>
              <p><var class=
              "LITERAL">bk_of_filter_options=</var><span class=
              "emphasis"><i class="EMPHASIS">Backwards Compatible
              OF Filter options</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">bkf</var> FLAG <span class=
              "emphasis"><i class="EMPHASIS">Backwards Compatible
              Filters</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">filter_ld_path=</var><span
              class="emphasis"><i class="EMPHASIS">Filter
              LD_LIBRARY_PATH environment</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">filter_options=</var><span
              class="emphasis"><i class="EMPHASIS">Filter
              options</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">filter_path=</var><span
              class="emphasis"><i class="EMPHASIS">Filter PATH
              environment</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">of_filter_options=</var><span
              class="emphasis"><i class="EMPHASIS">OF Filter
              options</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">pass_env=</var><span class=
              "emphasis"><i class="EMPHASIS">Environment variables
              to copy to Filter environment</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">pl=</var><span class=
              "emphasis"><i class="EMPHASIS">line count for
              page</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">pw=</var><span class=
              "emphasis"><i class="EMPHASIS">column count for
              page</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">px=</var><span class=
              "emphasis"><i class="EMPHASIS">pixel width for
              page</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">py=</var><span class=
              "emphasis"><i class="EMPHASIS">pixel length for
              page</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A filter (or program) specification in the <b class=
          "APPLICATION">LPRng</b> printcap database has the
          form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8055"></a>
<pre class="SCREEN">
    :option=| [flags] /path [argument | "argument" | 'argument' ]*
    :option=[flags]   /path [argument | "argument" | 'argument' ]*
</pre>
          </div>
          <br>
          <br>

          <p>The first case is used where the option value can be a
          string or filter, and the second where a program is
          always expected. The following procedure is used to run a
          filter program. Arguments in single or double quotes are
          passed as a single value, as for a shell.</p>

          <p>The sequence of operations to run a filter is as
          follows:</p>

          <ol type="1">
            <li>
              <p>The program must be specified with an absolute
              path name.</p>
            </li>

            <li>
              <p>By default, the program is run as the user if
              invoked from a client program such as <b class=
              "APPLICATION">lpr</b>, <b class=
              "APPLICATION">lpc</b>, etc. If invoked from <b class=
              "APPLICATION">lpd</b>, it is run as the user ID
              specified by the <var class="LITERAL">:user</var>
              (default <var class="LITERAL">daemon</var>)
              configuration entry.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">filter_path</var>
              (default <var class=
              "LITERAL">/bin:/usr/bin:/usr/local/bin</var>, and
              <var class="LITERAL">filter_ld_path</var> (default
              <var class=
              "LITERAL">/lib:/usr/lib:/usr/local/lib</var>,
              configuration options specifies the value of the <var
              class="LITERAL">PATH</var> and <var class=
              "LITERAL">LD_LIBRARY_PATH</var> environment
              variables.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">filter_path</var>
              (default <var class=
              "LITERAL">/bin:/usr/bin:/usr/local/bin</var>, and
              <var class="LITERAL">filter_ld_path</var> (default
              <var class=
              "LITERAL">/lib:/usr/lib:/usr/local/lib</var>,
              configuration option specifies the value of the <var
              class="LITERAL">PATH</var> and <var class=
              "LITERAL">LD_LIBRARY_PATH</var> environment
              variables. The other enviroment variables are
              described in <a href="#FILTERENV"><b class=
              "APPLICATION">LPRng</b> ftp mirror sites Filter
              Environment Variables</a></p>
            </li>

            <li>
              <p><acronym class="ACRONYM">ROOT</acronym> Flag. If
              the ROOT flag is specified the filter is executed
              with Userid and Effective Userid ROOT (User ID 0). By
              default it is executed with the <var class=
              "LITERAL">user</var> and <var class=
              "LITERAL">group</var> configuration option user and
              group ids. Running a filter as ROOT is extremely
              dangerous, and should only be used for programs that
              require root permissions to open files or make
              network connections from privileged ports.</p>
            </li>

            <li>
              <p><var class="LITERAL">$-</var> or <var class=
              "LITERAL">-$</var> Flag. This flag suppresses
              appending options to the filter command line. If the
              <span class="emphasis"><i class=
              "EMPHASIS">$-</i></span> or <var class=
              "LITERAL">-$</var> flag is not present, the <var
              class="LITERAL">:filter_options</var> or <var class=
              "LITERAL">:of_filter_options</var> for the <var
              class="OPTION">:of</var> filter values are appended
              to the filter command line. If the <var class=
              "LITERAL">:bkf</var> (Berkeley <b class=
              "APPLICATION">lpd</b> filter compatible flag) is <var
              class="LITERAL">TRUE</var> then the <var class=
              "LITERAL">:bk_filter_options</var> and <var class=
              "LITERAL">:bk_of_filter_options</var> values are used
              instead of the <var class=
              "LITERAL">:filter_options</var> and <var class=
              "LITERAL">:of_filter_options</var> values.</p>

              <div class="TABLE">
                <a name="PRINTFILTERCOMMAND"></a>

                <p><b>Table 16-1. Print Filter Command Line
                Options</b></p>

                <table border="1" class="CALSTABLE">
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Option</th>

                      <th>DefaultValue</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td>Option</td>

                      <td>DefaultValue</td>
                    </tr>

                    <tr>
                      <td><var class=
                      "LITERAL">filter_options</var></td>

                      <td>$C $F $H $J $L $P $Q $R $Z $a $c $d $e $f
                      $h $i $j $k $l $n $p$r $s $w $x $y $-a</td>
                    </tr>

                    <tr>
                      <td><var class=
                      "LITERAL">of_filter_options</var></td>

                      <td>(same as <var class=
                      "LITERAL">filter_options</var>)</td>
                    </tr>

                    <tr>
                      <td><var class=
                      "LITERAL">bk_filter_options</var></td>

                      <td>$P $w $l $x $y $F $c $L $i $J $C $0n $0h
                      $-a</td>
                    </tr>

                    <tr>
                      <td><var class=
                      "LITERAL">bk_of_filter_options</var></td>

                      <td>$w $l $x $y</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </li>

            <li>
              <p>By default, for programs that are not being
              invoked as print job file filters, the <var class=
              "LITERAL">filter_options</var> arguments are added.
              For print job filters, if the <var class=
              "LITERAL">:bkf</var> flag is set, then the <var
              class="LITERAL">bk_filter_options</var> and <var
              class="LITERAL">bk_of_filter_options</var> entries
              are used. The default <var class="LITERAL">bk</var>
              filter options are the same as originally used with
              the BSD <b class="APPLICATION">lpr</b> filters. For
              the <var class="LITERAL">:of</var> filter, either the
              <var class="LITERAL">of_filter_options</var> or <var
              class="LITERAL">bk_of_filter_options</var> arguments
              will be added.</p>
            </li>

            <li>
              <p>The program arguments will then be scanned and
              interpreted. Arguments of the form <var class=
              "LITERAL">$</var><var class="LITERAL">letter</var>
              will be translated into values from the print job
              control file and/or printcap entry. The letters have
              the following meaning:</p>

              <div class="TABLE">
                <a name="FILTEROPTIONFLAGS"></a>

                <p><b>Table 16-2. Filter Command Line Options and
                Values</b></p>

                <table border="1" class="CALSTABLE">
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Option</th>

                      <th>Purpose or Value</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td><var class="LITERAL">a</var> </td>

                      <td>printcap <var class="LITERAL">af</var>
                      (accounting file name)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">b</var> </td>

                      <td>job size (in K bytes)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">c</var> </td>

                      <td>binary file (<var class="LITERAL">l</var>
                      format for print file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">d</var> </td>

                      <td>printcap <var class="LITERAL">cd</var> or
                      <var class="LITERAL">sd</var> entry</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">e</var> </td>

                      <td>print job data file name (currently being
                      processed)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">f</var> </td>

                      <td>print job original name when spooled for
                      printing (N info from control file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">h</var> </td>

                      <td>print job originating host (H info from
                      control file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">i</var> </td>

                      <td>indent request (I info from control
                      file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">j</var> </td>

                      <td>job number in spool queue</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">k</var> </td>

                      <td>print job control file name</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">l</var> </td>

                      <td>printcap <var class="LITERAL">pl</var>
                      (page length)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">m</var> </td>

                      <td>printcap <var class=
                      "LITERAL">co</var></td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">n</var> </td>

                      <td>user name (L info from control file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">p</var> </td>

                      <td>remote printer (when processing for
                      bounce queue)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">r</var> </td>

                      <td>remote host (when processing for bounce
                      queue)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">s</var> </td>

                      <td>printcap <var class="LITERAL">sf</var>
                      (status file)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">t</var> </td>

                      <td>time in common UNIX format</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">w</var> </td>

                      <td>printcap <var class="LITERAL">pw</var>
                      (page width)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">x</var> </td>

                      <td>printcap <var class="LITERAL">px</var>
                      (page x dimension)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">y</var> </td>

                      <td>printcap <var class="LITERAL">py</var>
                      (page y dimension)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">F</var> </td>

                      <td>print file format</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">P</var> </td>

                      <td>printer name</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">S</var> </td>

                      <td>printcap <var class="LITERAL">cm</var>
                      (comment field)</td>
                    </tr>

                    <tr>
                      <td>Capital letter</td>

                      <td>Corresponding line from control file</td>
                    </tr>

                    <tr>
                      <td>{key}</td>

                      <td>printcap value for <var class=
                      "LITERAL">key</var></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If there is no value for the specified argument,
              then the argument is removed from the list. If there
              is a value, the actual form of the substitution is
              controlled by additional flags as follows.</p>

              <div class="TABLE">
                <a name="AEN8271"></a>

                <p><b>Table 16-3. Filter Command Line Option
                Format</b></p>

                <table border="1" frame="border" rules="all" class=
                "CALSTABLE">
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Form</th>

                      <th>TranslatedValue</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td><var class="LITERAL">$x</var> </td>

                      <td><var class="LITERAL">'-x</var><var class=
                      "REPLACEABLE">value</var><var class=
                      "LITERAL">'</var></td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">$-x</var> </td>

                      <td><var class="LITERAL">'</var><var class=
                      "REPLACEABLE">value</var><var class=
                      "LITERAL">'</var></td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">$0x</var> </td>

                      <td><var class="LITERAL">-x '</var><var
                      class="REPLACEABLE">value</var><var class=
                      "LITERAL">'</var></td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">$'x</var> </td>

                      <td><var class="LITERAL">-x</var> <var class=
                      "REPLACEABLE">value</var></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <br>
              <br>

              <p>Each entry in quotes is treated as a single value,
              as in /bin/sh. The <var class="LITERAL">$'x</var>
              does not quote the value. Combinations of the various
              flags are allowed. For example, <var class=
              "LITERAL">$-x</var> would simply substitute the value
              for <var class="LITERAL">x</var>, and then pass the
              whitespace separated components as individual
              arguments. This last form is useful for adding in
              additional flags on the command line.</p>
            </li>

            <li>
              <p>The command line is parsed, metacharacters are
              ruthlessly stripped from all arguments and pathnames
              and replaced by <var class="LITERAL">_</var>
              (underscores), and an argument list suitable for the
              <var class="LITERAL">execve</var> system call is
              formed.</p>
            </li>

            <li>
              <p>A sanitized environment is set up for the program
              execution, with the following environment
              variables.</p>

              <div class="TABLE">
                <a name="FILTERENV"></a>

                <p><b>Table 16-4. Filter Environment
                Variables</b></p>

                <table border="1" frame="border" rules="all" class=
                "CALSTABLE">
                  <col>
                  <col>

                  <thead>
                    <tr>
                      <th>Variable Name</th>

                      <th>Meaning</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td><var class="LITERAL">CONTROL</var> </td>

                      <td>control file name</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">DATAFILES</var>
                      </td>

                      <td>list of data file names</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">HOME</var> </td>

                      <td>Home directory (client only)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">IFS</var> </td>

                      <td><var class="LITERAL">" \t"</var></td>
                    </tr>

                    <tr>
                      <td><var class=
                      "LITERAL">LD_LIBRARY_PATH</var> </td>

                      <td><var class=
                      "LITERAL">:filter_ld_path</var> configuration
                      information</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">LOGDIR</var> </td>

                      <td>Home directory (client only)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">LOGNAME</var> </td>

                      <td><var class="LITERAL">L</var> control file
                      line</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">PATH</var> </td>

                      <td><var class="LITERAL">filter_path</var>
                      configuration information</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">PRINTCAP_ENTRY</var>
                      </td>

                      <td>printcap information</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">SHELL</var> </td>

                      <td><var class="OPTION">:sh</var>
                      configuration information (default <tt class=
                      "FILENAME">/bin/sh</tt>)</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">SPOOL_DIR</var>
                      </td>

                      <td><var class="LITERAL">:sd</var> printcap
                      information</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">TZ</var> </td>

                      <td>Time zone</td>
                    </tr>

                    <tr>
                      <td><var class="LITERAL">USER</var> </td>

                      <td>User name (client only)</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If the filter is to be run by a client program
              such as <b class="APPLICATION">lpr</b>, then the
              environment variables specified by the <var class=
              "LITERAL">pass_env</var> configuration or printcap
              option will be extracted from the environment, have
              any metacharacters removed, and then placed in the
              environment variable list. Commonly, the <acronym
              class="ACRONYM">PGPPASS</acronym>, <acronym class=
              "ACRONYM">PGPPASSFD</acronym>, and <acronym class=
              "ACRONYM">PGPPATH</acronym> are specified.</p>
            </li>

            <li>
              <p>The program is started, with <acronym class=
              "ACRONYM">STDIN</acronym>, <acronym class=
              "ACRONYM">STDOUT</acronym>, and <acronym class=
              "ACRONYM">STDERR</acronym> attached to the
              appropriate files or file descriptors. If none is
              specified, then they are attached to <tt class=
              "FILENAME">/dev/null</tt>.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8397">16.9. <b class=
          "APPLICATION">LPRng</b> Supported Filters</a></h2>

          <p>There already exists a large library of ready-to-use
          filters. Some of them have <b class=
          "APPLICATION">LPRng</b>-specific versions, which can be
          found at the <a href="#SECFTP"><b class=
          "APPLICATION">LPRng</b> ftp mirror sites</a>.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8404">16.9.1. Filter
            Support Conventions</a></h3>

            <p>By convention, most filters are either totally
            standalone (very rare) or require a set of support
            files or configuration files. There are two types of
            configuration files: per print queue configuration
            information and global configuration information.</p>

            <p>Since a print filter executes with the spool queue
            directory as the current directory, most filters put
            per print queue configuration information in a file in
            the spool directory. Some <span class="emphasis"><i
            class="EMPHASIS">vintage</i></span> filters insist on
            having these files <span class="emphasis"><i class=
            "EMPHASIS">hidden</i></span> with names such as <span
            class="emphasis"><i class="EMPHASIS"><tt class=
            "FILENAME">.setup</tt></i></span>. This can make it
            difficult for administrators to determine where the
            configuration files are.</p>

            <p>Global configuration files are usually placed in
            commonly accessible directories such as <span class=
            "emphasis"><i class="EMPHASIS"><tt class=
            "FILENAME">/usr/local/libexec/filters</tt></i></span>
            and its subdirectories. This allows the <b class=
            "APPLICATION">LPRng</b> administrator to set the
            privileges on these directories such that only the <b
            class="APPLICATION">lpd</b> process can access
            them.</p>

            <p>When a filter is invoked, it is passed a large
            number of options, many of which are totally ignored in
            filter operation. However, for many purposes it is
            necessary to provide options to the filters to tailor
            their operation to the particular spool queue
            needs.</p>

            <p>An alternative to using information in a file is to
            place options in the printcap entry and have the filter
            extract them from the <var class=
            "ENVAR">PRINTCAP_ENTRY</var> environment variable
            value. This is much easier to implement, but is
            specific to <b class="APPLICATION">LPRng</b>.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPF">16.10. lpf</a></h2>

          <p>Source code: <a href="#SECFTP"><b class=
          "APPLICATION">LPRng</b> Distribution</a></p>

          <p>This filter is distributed as part of the <b class=
          "APPLICATION">LPRng</b> source code, and has a very
          limited functionality. By default, it only translates
          <var class="LITERAL">\n</var> to <var class=
          "LITERAL">\r\n</var> sequences, and detects the OF Filter
          Stop sequence when invoked as an OF filter.</p>

          <ul>
            <li>
              <p>Options: <var class="LITERAL">-Tcrlf</var> -
              suppress <var class="LITERAL">\n</var> to <var class=
              "LITERAL">\r\n</var> translation</p>
            </li>
          </ul>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="IFHP">16.11. <b class=
          "APPLICATION">ifhp</b> Filter</a></h2>

          <p>Source code: <a href="#SECFTP"><b class=
          "APPLICATION">LPRng</b> Distribution,
          ifhp-&lt;em&gt;version&lt;/em&gt;.tgz</a></p>

          <p>The <b class="APPLICATION">ifhp</b> filter supports a
          wide variety of <span class="emphasis"><i class=
          "EMPHASIS">smart</i></span> printers, or to be more
          specific, printers which support PostScript, PCL or PJL
          languages. For details on using the <b class=
          "APPLICATION">ifhp</b> filter see the <b class=
          "APPLICATION">ifhp</b> filter documentation for details.
          The following is a quick set of examples of printcap
          entries:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8447"></a>
<pre class="SCREEN">
    # network connection to jet direct box,
    #   no banners, HP compatible
    lp
      :lp=ipaddr%9100
      :filter=/usr/local/libexec/filters/ifhp
    #
    # banner added,  model information added
    #
    lp
      :lp=ipaddr%9100
      :ifhp=model=hp4
      :bp=/usr/local/libexec/filters/pclbanner
      :of=/usr/local/libexec/filters/ifhp
      :filter=/usr/local/libexec/filters/ifhp
    #
    # for a parallel port printer or when you want VERY fast
    #  throughput, no pagecounts, error messages, etc.  The
    #
    lp
      :lp=/dev/lp0
      :ifhp=model=hp4,status@
      :filter=/usr/local/libexec/filters/ifhp
</pre>
          </div>
          <br>
          <br>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="PERMSREF"></a>Chapter 17. Permissions and
        Authentication</h1>

        <p>The contents of the <tt class=
        "FILENAME">/etc/lpd.perms</tt> file are used to control
        access to the <b class="APPLICATION">lpd</b> server
        facilities. The model used for permission granting is
        similar to packet filters. An incoming request is tested
        against a list of rules, and the first match found
        determines the action to be taken. The action is either
        <acronym class="ACRONYM">ACCEPT</acronym> or the request is
        granted, or <acronym class="ACRONYM">REJECT</acronym> and
        the request is denied. You can also establish a default
        action.</p>

        <p>The following is a sample <tt class=
        "FILENAME">lpd.perms</tt> file.</p>

        <div class="INFORMALEXAMPLE">
          <a name="AEN8459"></a>
<pre class="SCREEN">
    # allow root on server to control jobs
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    REJECT SERVICE=C
    #
    # allow same user on originating host to remove a job
    ACCEPT SERVICE=M SAMEHOST SAMEUSER
    # allow root on server to remove a job
    ACCEPT SERVICE=M SERVER REMOTEUSER=root
    REJECT SERVICE=M
    # all other operations allowed
    DEFAULT ACCEPT
</pre>
        </div>
        <br>
        <br>

        <p>Each line of the permissions file is a rule. A rule will
        ACCEPT or REJECT a request if all of the patterns specified
        in the rule match. If there is a match failure, the next
        rule in sequence will be applied. If all of the rules are
        exhausted, then the last specified default authorization
        will be used.</p>

        <p>The sense of a pattern match can be inverted using the
        NOT keyword. For example, the rules with <var class=
        "LITERAL">ACCEPT NOT REMOTEUSER=john,bill</var> succeeds
        only if the REMOTEUSER value is defined and is not <var
        class="LITERAL">john</var> or <var class=
        "LITERAL">bill</var>.</p>

        <p>Each entry in a rule is a keyword which has is assigned
        a value or list of values followed by an optional set of
        patterns that are matched against these values. The
        following table is a summary of the available keywords.</p>

        <div class="TABLE">
          <a name="PERMSKEYWORDS"></a>

          <p><b>Table 17-1. Permission Keywords and Purpose</b></p>

          <table border="1" frame="border" rules="all" class=
          "CALSTABLE">
            <col>
            <col>

            <thead>
              <tr>
                <th>Keyword</th>

                <th>Match</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td><acronym class="ACRONYM">DEFAULT</acronym></td>

                <td>default result</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">SERVICE</acronym></td>

                <td>Checking lpC, lpR, lprM, lpQ, and Printing</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">USER</acronym></td>

                <td>P (logname) field name in print job control
                file.</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">REMOTEUSER</acronym></td>

                <td>user name in request from remote host.</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">HOST</acronym></td>

                <td>DNS and IP address information for the H (host)
                field name in print job control file</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">REMOTEHOST</acronym></td>

                <td>DNS and IP address information for the
                connection from the remote host making the
                request</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">IP</acronym></td>

                <td>Alias for HOST</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">REMOTEIP</acronym></td>

                <td>Alias for REMOTEHOST</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">REMOTEPORT</acronym></td>

                <td>Originating TCP/IP port for the connection from
                the remote host making the request</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">PORT</acronym></td>

                <td>Alias for PORT</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">UNIXSOCKET</acronym></td>

                <td>Connection is on a UNIX socket, i.e. from
                localhost</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">SAMEUSER</acronym></td>

                <td>USER and REMOTEUSER matches</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">SERVER</acronym></td>

                <td>request originates on lpd server</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">FORWARD</acronym></td>

                <td>destination of job is not host</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">REMOTEGROUP</acronym></td>

                <td>REMOTEUSER is in the specified group or
                netgroup in the <b class="APPLICATION">lpd</b>
                server group database.</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">GROUP</acronym></td>

                <td>USER is in the specified group or netgroup in
                the <b class="APPLICATION">lpd</b> server group
                database.</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">LPC</acronym></td>

                <td>LPC command in the LPC request.</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">CONTROLLINE</acronym></td>

                <td>match a line in control file</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">AUTH</acronym></td>

                <td>authentication type</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">AUTHUSER</acronym></td>

                <td>authenticated user</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">AUTHSAMEUSER</acronym></td>

                <td>same authenticated user</td>
              </tr>

              <tr>
                <td><acronym class=
                "ACRONYM">AUTHFROM</acronym></td>

                <td>authenticated forwarder</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">AUTHJOB</acronym></td>

                <td>authenticated job in queue</td>
              </tr>

              <tr>
                <td><acronym class="ACRONYM">AUTHCA</acronym></td>

                <td>SSL signing certificates for job</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="DEFAULTPERMISSION">17.1.
          Permission Checking Algorithm</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class=
              "LITERAL">default_permission=</var><span class=
              "emphasis"><i class="EMPHASIS">Default Permission
              (accept)</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> server uses the
          following algorithm to do permission checks.</p>

          <ol type="1">
            <li>
              <p>The configuration information initially
              establishes a default permission using the <var
              class="LITERAL">default_permission</var>
              configuration value. This is used if an explicit
              permission is not determined by the other steps in
              this algorithm.</p>
            </li>

            <li>
              <p>Each line of the permissions file is a lists of
              tests (patterns) and a permission value that is used
              if all of the tests (patterns) on the line are
              successful. A DEFAULT line sets the default result if
              all lines fail.</p>
            </li>

            <li>
              <p>Each line is executed in sequence until a match is
              found. The first matching line terminates the
              permission checking and the corresponding permission
              value is used.</p>
            </li>

            <li>
              <p>Each keyword has a value (or set of values) that
              are matched against a set of patterns. If the keyword
              does not have a value (or the <span class=
              "emphasis"><i class="EMPHASIS">null</i></span> value)
              then the match will fail. Initially, all the keywords
              have a <var class="LITERAL">null</var> value.</p>
            </li>

            <li>
              <p>When a connection is received by the <b class=
              "APPLICATION">lpd</b> server, REMOTEHOST and
              REMOTEPORT are set to the the IP addresses and
              hostnames, and the TCP/IP port of the host
              originating the IP address respectively. REMOTEIP and
              IFHP are aliases for REMOTEPORT and PORT is an alias
              for REMOTEPORT and are provided for backwards
              compatibility with older versions of <b class=
              "APPLICATION">LPRng</b>. If the connection was on a
              UNIX socket, then the UNIXSOCKET flag is set. For
              example, a request originating from <var class=
              "LITERAL">10.0.0.2</var>, port 1011 would set
              REMOTEIP to 10.0.0.2 and PORT to 1011.</p>
            </li>

            <li>
              <p>The REMOTEHOST value is set to the result of doing
              a reverse DNS lookup on the REMOTEIP address. This
              value is the list of names <span class="emphasis"><i
              class="EMPHASIS">and</i></span> ip addresses in
              standard IP notation (nnn.nnn.nnn.nnn) that are
              returned by the lookup. If the DNS lookup fails then
              the REMOTEHOST value is set to the REMOTEIP value.
              For example, lookup of 10.0.0.2 would result in the
              names <tt class="FILENAME">h2.private</tt> and <tt
              class="FILENAME">patrick.private</tt>, and the only
              IP address assigned to it was <var class=
              "LITERAL">10.0.0.2</var>. The REMOTEHOST value would
              then be the list <var class=
              "LITERAL">h2.private,patrick.private,10.0.0.2</var>.</p>
            </li>

            <li>
              <p>The SERVICE value is set to <var class=
              "LITERAL">X</var> and then the permissions database
              is scanned for a matching entry. The result is the
              permission value of the first matching line or the
              default permission. If the result is REJECT then the
              connection is closed.</p>
            </li>

            <li>
              <p>Next, a single line is read from the connection.
              This line contains the request type, the print queue
              name, and depending on the request type an optional
              user name and options. The SERVICE value is set to
              <var class="LITERAL">R,</var> <var class=
              "LITERAL">Q,</var> <var class="LITERAL">M,</var> and
              <var class="LITERAL">C,</var> for a <var class=
              "LITERAL">lpR</var>, <var class="LITERAL">lpQ</var>,
              <var class="LITERAL">lprM</var>, and <b class=
              "APPLICATION">lpc</b> request respectively and
              PRINTER to the print queue name.</p>
            </li>

            <li>
              <p>If the request is for an <b class=
              "APPLICATION">lpc</b> operation, the LPC value is set
              to the name of the operation. For example, and <tt
              class="COMMAND">lpc lpd</tt> operation</p>
            </li>

            <li>
              <p>If the request contains a user name then
              REMOTEUSER is assigned the user name.</p>
            </li>

            <li>
              <p>If the request originates from the <b class=
              "APPLICATION">lpd</b> server as determined by the
              connection arriving from the <var class=
              "LITERAL">localhost</var> address or an address
              assigned to one of the network interfaces for this
              host then the SERVER value is set to true (or
              matches).</p>
            </li>

            <li>
              <p>If the request is for an authenticated transfer,
              (see <a href="#AUTHREF">Authentication and
              Encryption</a> ), then the authentication procedures
              are carried out. After they have been performed, the
              AUTH value is set to true, AUTHTYPE is set to the
              name of the authentication method, AUTHUSER to the
              authenticated identifier of the originator of the
              request, and AUTHFROM to the authenticated identifier
              of the originator of the connection.</p>
            </li>

            <li>
              <p>Other matching keywords such as REMOTEGROUP use
              values set at this time. These are discussed in the
              next section.</p>
            </li>

            <li>
              <p>The permission database is rescanned, this time to
              see if there is permission to operate on the
              specified spool queue. The permission database is
              first checked to see if the requesting user has
              control (SERVICE=C) permission. If they do, then they
              can perform any operation on the spool queue. The
              scan is then repeated for the actual request.</p>
            </li>

            <li>
              <p>If there is no permission to perform the operation
              then an error code and messages is returned on the
              requesting connection.</p>
            </li>

            <li>
              <p>If the operation is for a spool queue or server,
              no other permissions checking is done. This includes
              the <b class="APPLICATION">lpq</b> command, and most
              of the <b class="APPLICATION">lpc</b> commands
              control queue operations.</p>
            </li>

            <li>
              <p>If the operation is for for individual jobs in a
              spool queue, then the queue is scanned and job
              information is extracted for each job in the queue.
              The USER value is set to the job control file <var
              class="LITERAL">P</var> line. The value of the <var
              class="LITERAL">H</var> line in the control file is
              used to perform a DNS lookup, and the HOST value is
              set to the results of this lookup. IP is an alias for
              HOST, and is retained for backwards
              compatibility.</p>
            </li>

            <li>
              <p>The SAMEUSER value is set to true (or match) if
              the REMOTEUSER value is identical to the USER value.
              Similarly, SAMEHOST is set to true if the REMOTEHOST
              value matches the HOST value. See the following
              sections for other keywords such as GROUP.</p>
            </li>

            <li>
              <p>The permission checking is done for each
              individual job in a spool queue, and if it succeeds
              the action is carried out on the job.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>These checks are applied on the arrival of a job from
          an external connection. Unfortunately, there are a set of
          print spooler implementations that do not handle job
          rejection due to lack of permissions. These printers will
          continually and repeatedly attempt to send a job for
          which there is no printing permission until the job is
          removed by administrative action. To accommodate these
          printers, we must accept jobs for printing and then
          dispose of them. This is done by using the SERVICE=P
          (printing) checks. These checks are performed <span
          class="emphasis"><i class="EMPHASIS">after</i></span> the
          job has been accepted.</p>

          <ol type="1">
            <li>
              <p>When a print spool is active and is printing or
              forwarding jobs, before it processes a job it will
              read the job control file and set the <acronym class=
              "ACRONYM">USER</acronym> and <acronym class=
              "ACRONYM">HOST</acronym> values as discussed in the
              previous sections. It will also set the <acronym
              class="ACRONYM">AUTH</acronym>, <acronym class=
              "ACRONYM">AUTHUSER</acronym>, and <acronym class=
              "ACRONYM">AUTHJOB</acronym> values as well, if the
              job was spooled by using an authenticated method.</p>
            </li>

            <li>
              <p>The permissions database will be scanned and the
              resulting permission determined. Note that the values
              of the REMOTE keys are undefined, and tests using
              them will have unpredictable effects.</p>
            </li>

            <li>
              <p>If the job does not have permission to be printed,
              it will normally be removed from the spool queue.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>While this model is very simple it can handle a wide
          range of situations. However, it is really based on the
          simple <span class="emphasis"><i class=
          "EMPHASIS">trust</i></span> that users will not <span
          class="emphasis"><i class=
          "EMPHASIS">impersonate</i></span> other users or hosts.
          If this is not the case, then more elaborate procedures
          based on encryption and authentication are called
          for.</p>

          <p>There is a problem with permissions checking for <b
          class="APPLICATION">lpq</b> (SERVICE=Q) requests. Since
          the user name is not passed as part of the request, it is
          impossible to use the REMOTEUSER clause to restrict <b
          class="APPLICATION">lpq</b> operations.</p>

          <p>The <var class="LITERAL">SERVICE=R</var> and <var
          class="LITERAL">SERVICE=P</var> facilities are provided
          to handle problems with print spoolers that do not
          recognize a <span class="emphasis"><i class=
          "EMPHASIS">lack of permission</i></span> error code, and
          will indefinitely retry sending a job to the <b class=
          "APPLICATION">lpd</b> server. If this is the case, then
          the <var class="LITERAL">SERVICE=R</var> clause can be
          used to accept jobs, and then the <var class=
          "LITERAL">SERVICE=P</var> clause will cause the <b class=
          "APPLICATION">lpd</b> server to remove of the job when it
          is scheduled for printing.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8680">17.2. Rule Matching
          Procedures</a></h2>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8683"></a>
<pre class="SCREEN">
    [not] key                                 assigned value
    [not] key=pattern                         substring match
    [not] key=pattern1,pattern2,pattern3,...  glob and exact
    [not] key=IP1/mask1,IP2/mask2,...         IP address
</pre>
          </div>
          <br>
          <br>

          <p>Each of the indicated values is matched against a list
          of patterns. The following types of matches are used:</p>

          <ol type="1">
            <li>
              <p>assigned value. The keyword has an assigned value
              which is true (match) or false (no match). Examples
              are SAMEHOST and SERVER.</p>
            </li>

            <li>
              <p>substring match. The indicated entry is present as
              a substring in the pattern.</p>
            </li>

            <li>
              <p>GLOB matches. The pattern is interpreted as a GLOB
              style pattern, where * matches 0 or more characters,
              and ? matches a single character, and <var class=
              "LITERAL">[L-H]</var> specifies a range of characters
              from <var class="LITERAL">L</var> to <var class=
              "LITERAL">H</var>, in ASCII order.</p>
            </li>

            <li>
              <p>IP address match. The address must be specified in
              the standard <tt class="FILENAME">nn.nn.nn.nn</tt>
              format. The mask must be either an integer number
              corresponding to the number of significant bits, or
              in the standard <tt class="FILENAME">nn.nn.nn.nn</tt>
              format. Addresses are compared by doing</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN8700"></a>
<pre class="SCREEN">
    ( IPaddr XOR IP ) AND mask
</pre>
              </div>
              &#13;<br>
              <br>

              <p>If the result is 0, then a match results. Note
              that there may be one or more addresses being checked
              for; this can occur when a host may have multiple IP
              addresses assigned to it.</p>
            </li>

            <li>
              <p>integer range match. The pattern has the form <var
              class="LITERAL">low-high</var>, where low and high
              are integer numbers. The match succeeds if the value
              is in the specified range.</p>
            </li>

            <li>
              <p>Same IP Address Match. This compares two lists of
              IP addresses; a match is found when there is one or
              more common addresses.</p>
            </li>
          </ol>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8708">17.2.1.
            DEFAULT</a></h3>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8711"></a>
<pre class="SCREEN">
    DEFAULT ACCEPT
    DEFAULT REJECT
</pre>
            </div>
            <br>
            <br>

            <p>The DEFAULT rule specifies the default if no rule
            matches. Normally, there is one DEFAULT entry in a
            permissions file.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8714"></a>
<pre class="SCREEN">
    Example:
    
    DEFAULT ACCEPT
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8716">17.2.2.
            SERVICE</a></h3>

            <p>Match type: substring</p>

            <p>The SERVICE key is based on the type of request.</p>

            <div class="INFORMALTABLE">
              <a name="AEN8720"></a>

              <table border="1" frame="border" rules="all" class=
              "CALSTABLE">
                <col>
                <col>

                <thead>
                  <tr>
                    <th>Key</th>

                    <th>Request</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td>Key</td>

                    <td>Request</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">C</var></td>

                    <td>LPC Control Request</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">M</var></td>

                    <td><b class="APPLICATION">lprm</b> Removal
                    Request</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">P</var></td>

                    <td>Printing</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">Q</var></td>

                    <td><b class="APPLICATION">lpq</b> Status
                    Request</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">R</var></td>

                    <td><b class="APPLICATION">lpr</b> Job
                    Transfer</td>
                  </tr>

                  <tr>
                    <td><var class="LITERAL">X</var></td>

                    <td>Connection Request</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <br>
            <br>

            <p>Each of the above codes corresponds either directly
            to the user command, or a set of subcommands.</p>

            <p>If you have an LPC request, you can add an <var
            class="LITERAL">LPC=xxx</var> clause to refine the
            permissions checking to allow or disallow <b class=
            "APPLICATION">lpc</b> commands such as <tt class=
            "COMMAND">lpc status, printcap, active,</tt> .</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8762"></a>
<pre class="SCREEN">
    Example:
    
    # control only from root on server
    ACCEPT SERVICE=C SERVER USER=root
    REJECT SERVICE=C
    # accept all others
    ACCEPT SERVICE=*
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8764">17.2.3.
            USER</a></h3>

            <p>Match type: GLOB</p>

            <p>The USER information is taken from the <var class=
            "LITERAL">P</var> (person or logname) information in
            the print job control file.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8769"></a>
<pre class="SCREEN">
    Example:
    
    # we allow jobs to be spooled
    ACCEPT SERVICE=R
    # now we do the checking at print time
    ACCEPT SERVICE=P USER=root
    REJECT SERVICE=P
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8771">17.2.4.
            REMOTEUSER</a></h3>

            <p>Match type: GLOB</p>

            <p>The REMOTEUSER information is taken from the user
            information sent with a service request.</p>

            <p>Note that one of the flaws of <a href=
            "#RFC1179">RFC1179</a> is that an <b class=
            "APPLICATION">lpq</b> (print status) request does not
            provide a REMOTEUSER name.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8778"></a>
<pre class="SCREEN">
    Example:
    
    ACCEPT SERVICE=C REMOTEUSER=root,papowell,admin SERVER
    ACCEPT SERVICE=C LPC=status,lpd REMOTEUSER=admin
    REJECT SERVICE=C
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8780">17.2.5.
            HOST</a></h3>

            <p>Match type: GLOB</p>

            <p>The <var class="LITERAL">H</var> (host) information
            in the print job control file is used to do a DNS
            lookup, and the resulting list of names and addresses
            is used for matching purposes.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8785"></a>
<pre class="SCREEN">
    Example:
    
    # we allow jobs to be spooled
    ACCEPT SERVICE=R
    # now we do the checking at print time
    # allow from our private subnet
    ACCEPT SERVICE=P HOST=10.0.0.0/8,*.othernet.com
    REJECT SERVICE=P
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8787">17.2.6.
            REMOTEHOST</a></h3>

            <p>Match type: GLOB</p>

            <p>The REMOTEHOST information is obtained by doing a
            reverse IP name lookup on the remote host IP address
            and the resulting list of names and addresses is used
            for matching purposes. If there is no FQDN available,
            then the IP address in text form will be used.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8791"></a>
<pre class="SCREEN">
    Example:
    
    # allow from our private subnet
    ACCEPT SERVICE=R REMOTEHOST=10.0.0.0/8,*.othernet.com
    REJECT SERVICE=R
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8793">17.2.7.
            REMOTEPORT</a></h3>

            <p>Match type: integer range</p>

            <p>The REMOTEPORT value is the originating port of the
            TCP/IP connection. The match succeeds if it is in the
            specified range.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8797"></a>
<pre class="SCREEN">
    Example:
    
    # require connections to originate from privileged port
    ACCEPT SERVICE=X REMOTEPORT=1-1023
    REJECT SERVICE=X
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8799">17.2.8.
            PORT</a></h3>

            <p>Alias for REMOTEPORT.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8802">17.2.9. IP</a></h3>

            <p>Alias for HOST.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8805">17.2.10.
            REMOTEIP</a></h3>

            <p>Alias for REMOTEHOST.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8808">17.2.11.
            LPC</a></h3>

            <p>Match type: GLOB</p>

            <p>The requested <b class="APPLICATION">lpc</b>
            command. This allows the following permissions line to
            be used:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8813"></a>
<pre class="SCREEN">
    Example:
    
    #allow remoteuser admin on server to use LPC topq and hold
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    ACCEPT LPC=topq,hold SERVER REMOTEUSER=papowell
    REJECT SERVICE=C
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8815">17.2.12.
            SAMEUSER</a></h3>

            <p>Match type: exact string match</p>

            <p>Both the REMOTEUSER and USER information must be
            present and identical.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8819"></a>
<pre class="SCREEN">
    Example:
    
    # LPC users can do anything
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    REJECT SERVICE=C
    # allow users who sent jobs from the same host to remove them
    ACCEPT SERVICE=M SAMEUSER SAMEHOST
    REJECT SERVICE=M
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8821">17.2.13.
            SAMEHOST</a></h3>

            <p>Match type: Same IP Address</p>

            <p>The REMOTEHOST and HOST address lists are checked;
            if there is a common value the match succeeds.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8825"></a>
<pre class="SCREEN">
    Example:
    
    # allow root on the same host as user
    # to remove files
    ACCEPT SERVICE=M SAMEHOST REMOTEUSER=root
    REJECT SERVICE=M
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8827">17.2.14.
            SERVER</a></h3>

            <p>Match type: Matching IP Address</p>

            <p>One of the REMOTEHOST addresses must be the same as
            one of the addresses of the <b class=
            "APPLICATION">lpd</b> server host, or must be one of
            the addresses found by looking up the <var class=
            "LITERAL">localhost</var> name using <code class=
            "FUNCTION">gethostbyname()</code>.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8834"></a>
<pre class="SCREEN">
    Example:
    
    # allow root on the server full LPC permissions
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    REJECT SERVICE=C
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8836">17.2.15.
            FORWARD</a></h3>

            <p>Match type: Address Match</p>

            <p>The list of REMOTEHOST and HOST addresses must not
            have a common entry. This is usually the case when a
            remote <b class="APPLICATION">lpd</b> server is
            forwarding jobs to the <b class="APPLICATION">lpd</b>
            server.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8842"></a>
<pre class="SCREEN">
    Example:
    
    # do not accept forwarded jobs or requests
    REJECT SERVICE=* FORWARD
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8844">17.2.16.
            GROUP</a></h3>

            <p>Match type: modified GLOB</p>

            <p>The USER must be present in one of the groups in <tt
            class="FILENAME">/etc/group</tt> or whatever
            permissions mechanism is used to determine group
            ownership which matches the GLOB pattern. If the
            pattern has the form <var class="LITERAL">@name</var>,
            then a check to see if the user is in the named
            netgroup is done.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8850"></a>
<pre class="SCREEN">
    Example:
    
    ACCEPT SERVICE=P GROUP=admin,@netgroup
    REJECT SERVICE=P
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8852">17.2.17.
            REMOTEGROUP</a></h3>

            <p>The same rules as for GROUP, but using the
            REMOTEUSER value.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8855"></a>
<pre class="SCREEN">
    Example:
    
    ACCEPT SERVICE=R REMOTEGROUP=admin,@netgroup
    REJECT SERVICE=R
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8857">17.2.18.
            CONTROLLINE</a></h3>

            <p>Match type: GLOB</p>

            <p>A <acronym class="ACRONYM">CONTROLLINE</acronym>
            pattern has the form</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8862"></a>
<pre class="SCREEN">
    X=pattern1,pattern2,...
</pre>
            </div>
            <br>
            <br>

            <p>X is a single upper case letter. The corresponding
            line must be present in a control file, and the pattern
            is applied to the line contents.</p>

            <p>This pattern can be used to select only files with
            specific control file information for printing.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8866">17.2.19.
            AUTH</a></h3>

            <p>Match type: value</p>

            <p>If the current transfer or the transfer used to send
            a job was authenticated, then AUTH is true or
            matches.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8870"></a>
<pre class="SCREEN">
    Example:
    
    # reject all non-authenticated transfers
    REJECT NOT AUTH
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8872">17.2.20.
            AUTHTYPE</a></h3>

            <p>Match type: glob</p>

            <p>If the current transfer or the transfer used to send
            a job was authenticated, then AUTHTYPE is set to the
            name of the authentication method.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8876"></a>
<pre class="SCREEN">
    Example:
    
    # require kerberos, pgp, or md5 authentication
    REJECT NOT AUTHTYPE=kerberos*,pgp,md5
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8878">17.2.21.
            AUTHUSER</a></h3>

            <p>Match type: GLOB</p>

            <p>The AUTHUSER rule will check to see if the
            authenticated user identification matches the
            pattern.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN8882"></a>
<pre class="SCREEN">
    Example:
    
    ACCEPT SERVICE=C AUTHTYPE=kerberos* AUTHUSER=admin@ASTART.COM
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN8884">17.2.22.
            IFIP</a></h3>

            <p>Match type: IPmatch, but for IPV6 as well as
            IPV4</p>

            <p>There is a subtle problem with names and IP
            addresses which are obtained for 'multi-homed hosts',
            i.e. - those with multiple ethernet interfaces, and for
            IPV6 (IP Version 6), in which a host can have multiple
            addresses, and for the normal host which can have both
            a short name and a fully qualified domain name.</p>

            <p>The IFIP (interface IP) field can be used to check
            the IP address of the interface that accepted the
            network connection, as reported by the information
            returned by the accept() system call. Note that this
            information may be IPV4 or IPV6 information, depending
            on the origination of the system. This information is
            used by gethostbyaddr() to obtain the originating host
            fully qualified domain name (FQDN) and set of IP
            addresses. Note that this FQDN will be for the
            originating interface, and may not be the canonical
            host name. Some systems which use the Domain Name
            Server (DNS) system may add the canonical system name
            as an alias.</p>

            <p>This entry is deprecated and may not be supported in
            future releases.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="PERMSPATH">17.3. Permission
          File Location</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">perms_path=</var><span class=
              "emphasis"><i class="EMPHASIS">path</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The <var class="LITERAL">perms_path=</var>
          configuration variable specifies the location of the
          default permissions file. The default value is:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8900"></a>
<pre class="SCREEN">
    perms_path=${sysconfdir}/lpd.perms
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="FILENAME">lpd.perms</tt> file can be
          obtained by running a program, in a similar manner to the
          <tt class="FILENAME">printcap</tt> file. See <a href=
          "#FILTERS">Filters</a> for details on how the program
          would be invoked. For example, assume the configuration
          information specified:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8906"></a>
<pre class="SCREEN">
    perms_path=|/usr/local/libexec/get_perms
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> server will write
          either a blank line for connection (<var class=
          "LITERAL">SERVICE=X</var>) and global <b class=
          "APPLICATION">lpc</b> permissions (<var class=
          "LITERAL">SERVICE=C</var> and <var class=
          "LITERAL">LPC=reread,lpd,default</var>) or the name of
          the spool queue to the <var class=
          "LITERAL">get_perms</var> <acronym class=
          "ACRONYM">STDIN</acronym>, and expects to read permission
          information from its <acronym class=
          "ACRONYM">STDOUT</acronym>. If the filter method is used,
          it should always return the complete set of connection
          (<var class="LITERAL">X</var>) and control (<var class=
          "LITERAL">C</var> service values.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8919">17.4. Example
          Permission File</a></h2>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8922"></a>
<pre class="SCREEN">
    # allow root on server to control jobs
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    ACCEPT SERVICE=C LPC=lpd
    REJECT SERVICE=C
    #
    # allow same user on originating host to remove a job
    ACCEPT SERVICE=M SAMEHOST SAMEUSER
    # allow root on server to remove a job
    ACCEPT SERVICE=M SERVER REMOTEUSER=root
    REJECT SERVICE=M
    # all other operations allowed
    DEFAULT ACCEPT
</pre>
          </div>
          <br>
          <br>

          <p>In the above sample, we first specify that lp<var
          class="LITERAL">C</var> commands from user <var class=
          "LITERAL">root</var> on the lpd server will be accepted.
          This is traditionally the way that most lpc commands
          operate. We also allow anybody to use the <tt class=
          "COMMAND">lpc lpd</tt> command. We reject any other <b
          class="APPLICATION">lpc</b> requests.</p>

          <p>We accept lpr<var class="LITERAL">M</var> requests
          from the host and user that submitted the job, as well as
          from root on the server, and reject any others.</p>

          <p>Finally, all other types of commands (lpq, lpr) are
          allowed by default.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8932">17.5. Complex
          Permission Checking</a></h2>

          <p>One of the more useful types of permission checking is
          to restrict access to your printers from users outside
          your networks. The IP pattern can specify a list of IP
          addresses and netmasks to apply to them.</p>

          <p>For example <var class="LITERAL">IP=10.3.4.0/24</var>
          would match all hosts with the IP addresses <var class=
          "LITERAL">IP=10.3.4.0</var> to <var class=
          "LITERAL">IP=10.3.4.255</var>.</p>

          <p>Similarly, the HOST pattern can specify a set of
          hostnames or patterns to match against based on the GLOB
          notation.</p>

          <p>For example <var class=
          "LITERAL">REMOTEHOST=*.private</var> would match all
          hosts with a DNS entry which ended with <tt class=
          "FILENAME">private</tt>.</p>

          <p>The NOT keyword reverses the match sense. For example
          <var class="LITERAL">REJECT NOT
          REMOTEHOST=*.private,*.murphy.com</var> would reject all
          requests from hosts which did not have a DNS entry ending
          in <tt class="FILENAME">private</tt> or <tt class=
          "FILENAME">murphy.com</tt>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8947">17.6. More
          Examples</a></h2>

          <p>The following is a more complex lpd.perms file.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8950"></a>
<pre class="SCREEN">
    # All operations allowed except those specifically forbidden
    DEFAULT ACCEPT
    #Reject connections which do not originate from hosts with an
    # address on 130.191.0.0 or from localhost,
    # or name is not assigned to Engineering pc's
    REJECT SERVICE=X NOT IFIP=130.191.0.0/16,127.0.0.1/32
    REJECT SERVICE=X NOT REMOTEHOST=engpc*
    #Do not allow anybody but root or papowell on
    #astart1.private or the server to use control
    #facilities.
    ACCEPT SERVICE=C SERVER REMOTEUSER=root
    ACCEPT SERVICE=C REMOTEHOST=astart1.private REMOTEUSER=papowell
    #Allow root on talker.private to control printer hpjet
    ACCEPT SERVICE=C HOST=talker.private PRINTER=hpjet REMOTEUSER=root
    #Reject all others
    REJECT SERVICE=C
    #Do not allow forwarded jobs or requests
    REJECT SERVICE=R,C,M FORWARD
    # allow same user on originating host to remove a job
    ACCEPT SERVICE=M SAMEHOST SAMEUSER
    # allow root on server to remove a job
    ACCEPT SERVICE=M SERVER REMOTEUSER=root
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AUTHREF">17.7.
          Authentication</a></h2>

          <p>One of the major problems in a print spooler system is
          providing privacy and authentication services for users.
          One method is to construct a specific set of protocols
          which will be used for providing the privacy or
          authentication; another is to provide a simple interface
          to a set of tools that will do the authentication and/or
          encryption.</p>

          <p><b class="APPLICATION">LPRng</b> provides native
          support for the MIT Kerberos 4 extensions and Kerberos 5
          authentication.</p>

          <p><b class="APPLICATION">LPRng</b> uses the OpenSSL
          libraries to support SSL authentication and encrypted
          data transfers.</p>

          <p><b class="APPLICATION">LPRng</b> has native support
          for the PGP (Pretty Good Privacy) program and can sign
          and optionally encrypt command and responses between
          servers and clients. Due to legal restrictions, an
          external PGP program must be used for this purpose.</p>

          <p>A simple MD5 hash based authentication scheme is also
          provided as an example to illustrate how new or different
          authentication methods can be adddd.</p>

          <p>Finally, <b class="APPLICATION">LPRng</b> provide a
          general purpose interface allowing users to insert their
          own authentication methods, either at the program level
          or at the code level.</p>

          <p>A careful study of the authentication problem shows
          that it should be done during reception of commands
          and/or jobs from a remote user and/or spooler. At this
          time the following must be done:</p>

          <ol type="1">
            <li>
              <p>The received command must be checked for
              consistency, and the remote user and host must be
              determined.</p>
            </li>

            <li>
              <p>The remote user and host must be
              authenticated.</p>
            </li>

            <li>
              <p>The command and/or spooling operation must be
              carried out.</p>
            </li>

            <li>
              <p>The results must be returned to the remote
              system.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8974">17.8. User
          Identification</a></h2>

          <p>When a user logs into a system, they are assigned a
          user name and a corresponding UserID. This user name is
          used by the <b class="APPLICATION">LPRng</b> software
          when transferring jobs to identify the user.</p>

          <p>When we look into the problem of authentication, we
          will possibly have a more global user identification to
          deal with, the authentication identifier (AuthID). One
          way to deal with this problem is to give <b class=
          "APPLICATION">LPRng</b> intimate knowledge of the UserID
          and AuthID relationship. While this is possible it is
          difficult to deal with in a simple and extensible manner.
          An alternate solution is to provide a mapping service,
          where the authentication procedure provides a map between
          the UserID and AuthID.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN8980">17.9. RFC1179
          Protocol Extensions</a></h2>

          <p>The RFC1179 protocol specifies that a <b class=
          "APPLICATION">lpd</b> server command sent on a connection
          has the form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8984"></a>
<pre class="SCREEN">
    \nnn[additional fields]\n
</pre>
          </div>
          <br>
          <br>

          <p><var class="LITERAL">\nnn</var> is a one octet (byte)
          value with the following meaning:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8989"></a>
<pre class="SCREEN">
    REQ_START   1    start printer
    REQ_RECV    2    transfer a printer job
    REQ_DSHORT  3    print short form of queue status
    REQ_DLONG   4    print long form of queue status
    REQ_REMOVE  5    remove jobs
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">LPRng</b> system extends
          the protocol with the following additional types:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN8993"></a>
<pre class="SCREEN">
    REQ_CONTROL 6    do control operation
    REQ_BLOCK   7    transfer a block format print job
    REQ_SECURE  8    do operation with authentication
</pre>
          </div>
          <br>
          <br>

          <p>The REQ_CONTROL allows a remote user to send LPC
          commands to the server. The REQ_BLOCK provides an
          alternate method to transfer a job. Rather than
          transferring the control and data files individually,
          this format transfers one file. The REQ_AUTH provides a
          mechanism for providing an authentication mechanism and
          is described in this document.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AUTH">17.10. Authentication
          Operations</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">auth=</var><span class=
              "emphasis"><i class="EMPHASIS">client to server
              authentication type</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">auth_forward=</var><span
              class="emphasis"><i class="EMPHASIS">server to server
              authentication type</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">XX_id=</var><span class=
              "emphasis"><i class="EMPHASIS">server
              identification</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">XX_forward_id=</var><span
              class="emphasis"><i class="EMPHASIS">Server
              identification</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A <b class="APPLICATION">LPRng</b> client <b class=
          "APPLICATION">lpr</b>, <b class="APPLICATION">lpq</b>, <b
          class="APPLICATION">lprm</b>, or <b class=
          "APPLICATION">lpc</b> to <b class="APPLICATION">lpd</b>
          server authenticated transfer proceeds as follows. If an
          authenticated transfer is specified by the <var class=
          "LITERAL">auth=protocol</var> entry in the printcap or
          configuration information, the client sends a request for
          an authenticated transfer to the server.</p>

          <p>Part of the authentication request is the
          authentication type. If authentication type <acronym
          class="ACRONYM">XX</acronym> is requested the server will
          examine the information in the printcap and configuration
          entries for an <var class="LITERAL">XX_id</var> value. If
          this value is present then the server supports
          authentication of this type. Further permission checks
          are carried out and finally the server will accept or
          reject the authentication request. If the request is
          accepted the server returns a positive acknowledgment
          (single 0 byte) to the requester, otherwise it returns a
          nonzero value and an error message.</p>

          <p>If the request is accepted then an authentication
          specific protocol exchange is carried out between client
          and server. The commands and/or data files are encrypted
          and/or signed and transferred to the server. The protocol
          specific software on the server will then decrypt and/or
          check signatures, perform the requested actions, and in
          turn generate a status information. The status
          information is encrypted and/or signed by the server and
          sent to the client, where the client decrypts and/or
          checked for correct signature.</p>

          <p>A <b class="APPLICATION">lpd</b> server to <b class=
          "APPLICATION">lpd</b> server authenticated transfer
          proceeds as follows. If an authenticated transfer is
          specified by the <var class=
          "LITERAL">auth_forward=protocol</var> entry in the
          printcap or configuration information, the originating
          server sends a request for an authenticated transfer to
          the destination server. The originating server plays the
          part of the client and performs the same set of
          actions.</p>

          <p>The following printcap or user level information needs
          to be provided for an authenticated exchange.</p>

          <ol type="1">
            <li>
              <p>The <var class="LITERAL">auth</var> option
              specifies the authentication type to be used for
              client to server transfers. For example, <var class=
              "LITERAL">auth=kerberos</var> or <var class=
              "LITERAL">auth=kerberos5</var> or would specify
              Kerberos 5 authentication, <var class=
              "LITERAL">auth=kerberos4</var> would specify Kerberos
              4 authentication, <var class="LITERAL">auth=pgp</var>
              would specify PGP authentication, <var class=
              "LITERAL">auth=md5</var> would specify MD5
              authentication, etc. The special form <var class=
              "LITERAL">auth@</var> specifies no
              authentication.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">auth_forward</var> option
              specifies the authentication type to be used for
              server to server transfers. For example, <var class=
              "LITERAL">auth_forward=kerberos5</var> would specify
              Kerberos 5 authentication, etc. The special form <var
              class="LITERAL">auth@</var> specifies no
              authentication.</p>
            </li>

            <li>
              <p>The authenticated transfer request sent to a
              server has one of the following forms, depending on
              the originator:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN9050"></a>
<pre class="SCREEN">
    \008printer C user_id authtype \n  - for commands (lpq, lpc, etc.)
    \008printer C user_id authtype size\n - for print jobs (lpr)
    \008printer F server_id authtype \n - forwarded commands (lpq, lpc, etc.)
    \008printer F server_id authtype size\n - forwarded print jobs (lpr)
</pre>
              </div>
              &#13;<br>
              <br>

              <p>The single character with the <var class=
              "LITERAL">\008</var> value signals that this is an
              authentication request the <var class=
              "LITERAL">printer</var> is the name of a print queue,
              and the <var class="LITERAL">C</var> (client) or <var
              class="LITERAL">F</var> indicates that the request is
              from a client program or is a forwarded request from
              a server. The <var class="LITERAL">user_id</var> or
              <var class="LITERAL">server_id</var> field is an
              identifier supplied by the originator and is
              discussed below. If the <var class=
              "LITERAL">size</var> value is present then the
              request is for a job transfer and this value
              represents the job size. It is used to determine if
              there is sufficient space in the spool queue for the
              job.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">user_id</var> or <var
              class="LITERAL">server_id</var> fields in the
              authentication request are obtained as follows. If
              the request originates from a client, then the <var
              class="LITERAL">user_id</var> is the user name of the
              originator obtained from password information. If the
              request originates from a server, then the <var
              class="LITERAL">server_id</var> is the printcap or
              configuration <var class=
              "LITERAL">xx_id=server_id</var> value, where <var
              class="LITERAL">xx</var> is the value of the <var
              class="LITERAL">auth_forward=xx</var> entry.</p>
            </li>

            <li>
              <p>When the authenticated transfer request is
              received, the destination will either return a single
              zero byte, or a non-zero byte value followed by
              additional refusal information. A refusal terminates
              the protocol exchange.</p>
            </li>

            <li>
              <p>Further exchanges are then determined by the
              authentication protocol specific requirements.</p>
            </li>

            <li>
              <p>Once the initial exchanges have been completed a
              user file and/or command will be transferred to the
              destination server.</p>
            </li>

            <li>
              <p>An authentication protocol specific <acronym
              class="ACRONYM">AUTHFROM</acronym> and <acronym
              class="ACRONYM">AUTHUSER</acronym> strings will be
              supplied to the lpd server for purposes of permission
              checking.</p>
            </li>

            <li>
              <p>The lpd server then carries out the requested
              operation, and will write error and status
              information into a file.</p>
            </li>

            <li>
              <p>After the requested activity has finished,
              protocol specific module transfer the status
              information in the file to the requesting system and
              terminate the protocol exchange.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9083">17.11. Permission
          Checking</a></h2>

          <p>When an authenticated transfer has been performed, the
          following permission information will be provided.</p>

          <ul>
            <li>
              <p>AUTH This value is <var class="LITERAL">true</var>
              or <var class="LITERAL">match</var> if an
              authenticated request was received.</p>
            </li>

            <li>
              <p>AUTHTYPE=authtype This has the value of the <var
              class="LITERAL">authtype</var> field in the
              authentication request.</p>
            </li>

            <li>
              <p>AUTHUSER=userinfo This is the <acronym class=
              "ACRONYM">AUTHUSER</acronym> information provided by
              the authentication protocol, and is usually the
              originating user's identification.</p>
            </li>

            <li>
              <p>AUTHFROM=frominfo This is the <acronym class=
              "ACRONYM">AUTHUSER</acronym> information provided by
              the authentication protocol, and is usually the
              originating system (user or lpd server)
              identification.</p>
            </li>

            <li>
              <p>AUTHSAMEUSER This item has effect only when
              checking jobs in a spool queue. The <acronym class=
              "ACRONYM">AUTHUSER</acronym> information from the
              request is compared to the <acronym class=
              "ACRONYM">AUTHUSER</acronym> information from the
              request that created a job. If they are identical,
              the match succeeds.</p>
            </li>

            <li>
              <p>AUTHJOB This item has effect only when checking
              jobs in a spool queue. If the job was transfered
              using an authentication protocol the match
              succeeds.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>For example, to reject non-authenticated operations,
          the following line could be put in the permissions
          file.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9107"></a>
<pre class="SCREEN">
    REJECT NOT AUTH
</pre>
          </div>
          <br>
          <br>

          <p>If a remote server has id information FFEDBEEFDEAF,
          then the following will accept only forwarded jobs from
          this server.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9110"></a>
<pre class="SCREEN">
    ACCEPT AUTH AUTHFROM=FFEDBEEFDEAF
    REJECT AUTH
    REJECT NOT AUTH
</pre>
          </div>
          <br>
          <br>

          <p>To allow only authenticated users to remove jobs you
          can use:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9113"></a>
<pre class="SCREEN">
    ACCEPT AUTH SERVICE=R,M,L,P AUTHSAMEUSER
    REJECT AUTH
    REJECT NOT AUTH
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9115">17.12. PGP
          Authentication Support</a></h2>

          <p>PGP is a well known encryption and authentication
          program. For more details see the web site <a href=
          "http://www.pgp.net" target="_top">http://www.pgp.net</a>
          or the ftp site <a href="ftp://ftp.pgp.net" target=
          "_top">ftp://ftp.pgp.net</a>.</p>

          <p><b class="APPLICATION">LPRng</b> has greatly
          simplified the use of PGP for authentication by building
          in support as follows.</p>

          <ul>
            <li>
              <p>The <var class="LITERAL">user</var> and <var
              class="LITERAL">group</var> configuration entry
              (defaults <var class="LITERAL">daemon</var> and <var
              class="LITERAL">daemon</var> respectively) specify
              the user and group id used by the <b class=
              "APPLICATION">lpd</b> server for file and program
              execution. PGP uses the current user id of the PGP
              process to determine the locations of various
              configuration files and information. In this
              discussion we will assume that <b class=
              "APPLICATION">lpd</b> runs as uid <var class=
              "LITERAL">daemon</var>.</p>
            </li>

            <li>
              <p>By default, the PGP program expects the public and
              secret key rings to be in the <tt class=
              "FILENAME">$HOME/.pgp/</tt> directory to be readable
              only by the user. In order to set up PGP
              authentication, make sure that the <var class=
              "LITERAL">daemon</var> account has a home directory.
              Then use the <var class="LITERAL">su daemon</var>
              command to change effective UID to daemon and run the
              <tt class="COMMAND">pgp -kg</tt> (generate key)
              command as daemon. The <var class=
              "LITERAL">daemon</var> user should not have a
              password.</p>
            </li>

            <li>
              <p>Each PGP key has an associated identifier. It is
              recommended that the <b class="APPLICATION">lpd</b>
              key be <var class="LITERAL">lpr@hostname</var>, where
              hostname is the fully qualified domain name of the
              server. A public and a private key file will be
              created.</p>
            </li>

            <li>
              <p>Next, place the passphrase for the <var class=
              "LITERAL">daemon</var> user in <tt class=
              "FILENAME">~daemon/.pgp/serverkey</tt>, and make sure
              it has owner <var class="LITERAL">daemon</var> and
              <var class="LITERAL">600</var> permissions
              (read/write only by <var class=
              "LITERAL">daemon</var>). This is extremely important.
              If other users can read this file then security will
              be severely compromised.</p>
            </li>

            <li>
              <p>Next, distribute the <var class=
              "LITERAL">lpr@hostname</var> public key to all users
              of the <b class="APPLICATION">LPRng</b> server. This
              is usually done by placing the public key in a well
              known file location or making it available to users
              by some form of Public Key Distribution system (PKD).
              The key can be extracted and put into a text file
              using the following commands:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN9154"></a>
<pre class="SCREEN">
    pgp -kxa userid destfile keyfile
    
    Example:
    &gt; pgp -kxa lpr@astart /tmp/lprkey ~daemon/.pgp/pubring.pgp
    Key for user ID: lpr@astart
    512-bit key, key ID BB261B89, created 1999/01/01
    
    Transport armor file: /tmp/lprkey.asc
    Key extracted to file '/tmp/lprkey.asc'.
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>To allow a user to send files to the server, their
              public key must be put into the <var class=
              "LITERAL">daemon</var> public key ring. This can be
              done using:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN9159"></a>
<pre class="SCREEN">
    pgp -ka /tmp/lprkey.asc
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>Finally, the administrator will need to add users
              public keys to the <var class="LITERAL">daemon</var>
              users public key ring. This can most easily be done
              by copying all the keys (in ASCII text form) to a
              single file (<tt class=
              "FILENAME">/tmp/keyfile</tt>)and using:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN9165"></a>
<pre class="SCREEN">
    su daemon
    pgp -ka /tmp/keyfile ~daemon/.pgp/pubring.pgp
</pre>
              </div>
              <br>
              <br>
            </li>

            <li>
              <p>If the <b class="APPLICATION">lpd</b> server is
              using PGP to forward jobs or requests, the
              destination server's public key must be put in the
              originating servers public keyring. For example:</p>

              <div class="INFORMALEXAMPLE">
                <a name="AEN9170"></a>
<pre class="SCREEN">
    su daemon
    pgp -ka /tmp/lpd.keyfile ~daemon/.pgp/pubring.pgp
</pre>
              </div>
              <br>
              <br>
            </li>
          </ul>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="PGPPATH">17.12.1. Printcap
            Configuration</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">pgp_path=</var><span class=
                "emphasis"><i class="EMPHASIS">path to PGP
                program</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">pgp_id=</var><span class=
                "emphasis"><i class="EMPHASIS">destination server
                key used by clients</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">pgp_forward_id=</var><span
                class="emphasis"><i class="EMPHASIS">destination
                server used by server</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">pgp_server_key=</var><span
                class="emphasis"><i class="EMPHASIS">path to server
                passphrase file</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Example printcap entry:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9193"></a>
<pre class="SCREEN">
    pr:
        :lp=pr@wayoff
        :auth=pgp
        :pgp_id=lpr@wayoff.com
        :pgp_path=/usr/local/bin/pgp
    pr:server
        :lp=pr@faroff
        :auth_forward=pgp
        :pgp_id=lpr@wayoff.com
        :pgp_path=/usr/bin/pgp
        :pgp_forward_id=lpr@faroff.com
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">pgp_path</var> value is the
            path to the PGP program. The program must be executable
            by all users.</p>

            <p>The <var class="LITERAL">pgp_id</var> value is the
            id used by PGP to look extract keys from key rings.
            When doing a client to server transfer this will be
            supplied as the id to be used for the destination, and
            the user's public keyring will be checked for a key
            corresponding to this id. When a request arrives at the
            server, the server will use this value as the id of a
            key in its private key ring. Finally, when a server is
            forwarding a request to a remote server, it will use
            this value as the id of the key in its private key ring
            to be used to sign or encode the destination
            information.</p>

            <p>The <var class="LITERAL">pgp_forward_id</var> value
            is used by the <b class="APPLICATION">lpd</b> server as
            the id to use to find a key for the destination.</p>

            <p>The <var class="LITERAL">pgp_server_key</var> is the
            path to the file containing the server passphrase. This
            file will be read by <b class="APPLICATION">lpd</b> to
            get the passphrase to unlock the server's keyring.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9205">17.12.2. User Files
            and Environment Variables</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">PGPPASSFILE=</var><span
                class="emphasis"><i class="EMPHASIS">File to read
                PGP passphrase from</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">PGPPASSFD=</var><span
                class="emphasis"><i class="EMPHASIS">File
                descriptor to read PGP passphrase
                from</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">PGPPASS=</var><span class=
                "emphasis"><i class="EMPHASIS">PGP
                passphrase</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>One problem with using PGP is the need to have users
            input their passphrases. The following methods can be
            used.</p>

            <ul>
              <li>
                <p>Put the passphrase in a file, say <tt class=
                "FILENAME">$(HOME)/.pgp/.hidden</tt>, and set the
                <acronym class="ACRONYM">PGPPASSFILE</acronym>
                environment variable to the file name. This file
                will be opened and read by PGP to get the
                passphrase. This file should be owned by the user
                and have <var class="LITERAL">0600</var> or
                read/write only by user permissions.</p>
              </li>

              <li>
                <p>A more subtle solution is to use the <acronym
                class="ACRONYM">PGPPASSFD</acronym> environment
                variable facility. This causes PGP to read the
                passphrase from a file descriptor. If the user puts
                his passphrase in a file, say <tt class=
                "FILENAME">$(HOME)/.pgp/.hidden</tt>, then the
                following shell script can be used:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9232"></a>
<pre class="SCREEN">
    #!/bin/sh
    #  /usr/local/bin/pgplpr script - passphrase in $(HOME)/.pgp/.hidden
    #
    PGPASSFD=3 3&lt;$(HOME)/.pgp/.hidden lpr "$@"
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>The least desirable method is to put the
                passphrase in the <acronym class=
                "ACRONYM">PGPPASS</acronym> environment variable.
                Since the <var class="LITERAL">ps</var> command can
                be used to list the environment variables of
                processes, this is highly undesirable and should
                not be used under any circumstances.</p>
              </li>
            </ul>
            <br>
            <br>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="KERBEROS">17.13. Using
          Kerberos 5 for Authentication</a></h2>

          <p><b class="APPLICATION">LPRng</b> Kerberos 5
          authentication is based on the Kerberos5-1.2.5 release as
          of 3 June 2002. The distribution was obtained from MIT
          from the <span class="emphasis"><i class="EMPHASIS"><a
          href="http://web.mit.edu/kerberos/www/" target=
          "_top">http://web.mit.edu/kerberos/www/</a></i></span>
          Website.</p>

          <p>The following sections briefly describes how to set up
          and test the Kerberos software and then how to configure
          <b class="APPLICATION">LPRng</b> to use Kerberos.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9246">17.13.1. <b class=
            "APPLICATION">LPRng</b> Configuration</a></h3>

            <p>The following <var class="LITERAL">configure</var>
            options are used to enable Kerberos support:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9251"></a>
<pre class="SCREEN">
    --enable-kerberos         enable Kerberos V support
    --enable-mit_kerberos4    enable MIT Kerberos 4 support
    --disable-kerberos_checks disable Kerberos sanity checks
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">--enable-kerberos</var>
            option will cause <var class="LITERAL">configure</var>
            to search for the include files such as <tt class=
            "FILENAME">krb5.h</tt> and the <var class=
            "LITERAL">krb5</var> support libraries. libraries. If
            it finds these, then Kerberos authentication will be
            included. The <var class=
            "LITERAL">--enable-mit_kerberos</var> enable searching
            for the Kerberos 4 include files and support libraries.
            If these are found then MIT Kerberos 4 compatibility
            will be enabled. The <var class=
            "LITERAL">--disable-kerberos_checks</var> will disable
            checking for libraries and simply enable the various
            options.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9260">17.13.2. Kerberos
            Installation Procedure</a></h3>

            <ol type="1">
              <li>
                <p>Get the Kerberos 5 distribution.</p>
              </li>

              <li>
                <p>Compile and install the distribution.</p>
              </li>

              <li>
                <p>Create the <tt class=
                "FILENAME">/etc/krb5.conf</tt> and <tt class=
                "FILENAME">/usr/local/var/krb5kdc/kdc.conf</tt>,
                files using templates from the files in the
                Kerberos distribution's <tt class=
                "FILENAME">src/config-files</tt> directory. See the
                Kerberos Installation Guide and the Kerberos System
                Administrators Guide for details.</p>
              </li>

              <li>
                <p>Start up the KDC and KADMIN servers - you might
                want to put the following in your <tt class=
                "FILENAME">rc.local</tt> or equivalent system
                startup files:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9276"></a>
<pre class="SCREEN">
    if [ -f /etc/krb5.conf -a -f /usr/local/var/krb5kdc/kdc.conf  ]; then
        echo -n ' krb5kdc ';    /usr/local/sbin/krb5kdc;
        echo -n ' kadmind ';    /usr/local/sbin/kadmind;
    fi
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Use kadmin (or kadmin.local) to create
                principals for your users.</p>
              </li>

              <li>
                <p>Use kadmin (or kadmin.local) to create
                principals for the <b class="APPLICATION">lpd</b>
                servers. The recommended method is to use <tt
                class="FILENAME">lpr/hostname@REALM</tt> as a
                template for the principal name, i.e. - <var class=
                "LITERAL">lpr/astart1.private@ASTART.COM</var> for
                an example. You should use fully qualified domain
                names for the principals. Do not assign the
                principal a password.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9285"></a>
<pre class="SCREEN">
    Example:
    
    #&gt; kadmin   OR #&gt; kadmin.local 
    kadmin: addprinc -randkey lpr/wayoff.private@ASTART.COM
    quit
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Extract the keytab for each server:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9289"></a>
<pre class="SCREEN">
    Example:
    #&gt; kadmin   OR #&gt; kadmin.local 
    ktadd -k /etc/lpr.wayoff.private  lpr/wayoff.private@ASTART.COM
    quit
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>The <var class=
                "LITERAL">/etc/lpr.wayoff.private</var> file
                contains the keytab information which is the
                equivalent of a password for a server program. You
                should create these files and then copy the
                appropriate <var class="LITERAL">keytab</var> file
                to <tt class="FILENAME">/etc/lpd.keytab</tt> file
                on each server. See the warnings about of keytab
                files in the Kerberos Installation and Kerberos
                Administration manuals. You should copy the file
                using an encrypted connection, set the permissions
                to read only by the owner (<var class=
                "LITERAL">400</var>), and set the owner to <var
                class="LITERAL">daemon</var> or the user that <b
                class="APPLICATION">lpd</b> will run as.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9299"></a>
<pre class="SCREEN">
    #&gt; chmod 400 lpr.wayoff.com
    #&gt; scp lpr.wayoff.com root@wayoff.com:/etc/lpd.keytab
    #&gt; ssh -l root wayoff.com
    # wayoff &gt; chmod 400 /etc/lpd.keytab  
    # wayoff &gt; chown daemon /etc/lpd.keytab  
    # wayoff &gt; ls -l /etc/lpd.keytab  
    -rw-------  1 daemon  wheel  128 Jan 16 11:06 /etc/lpd.keytab
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>If you want to have MIT Kerberos4 printing
                compatibility then you will need to set up Kerberos
                4 <var class="LITERAL">servertabs</var> instead of
                Kerberos 5 keytabs. Assuming that you have put the
                Kerberos 5 keytab in <tt class=
                "FILENAME">/etc/lpd.keytab</tt>, then you extract
                the Kerberos 4 srvtab version of the Kerberos 5
                keytab using the following commands. You must put
                the key in the <tt class=
                "FILENAME">/etc/srvtab</tt> file in order to be
                compatible with the Kerberos 4 support.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9306"></a>
<pre class="SCREEN">
    <samp class="PROMPT">h4: {321} #</samp> <kbd class=
"USERINPUT">ktuil</kbd>
    <kbd class="USERINPUT">rkt /etc/lpd.keytab</kbd>
    <kbd class="USERINPUT">wst /etc/srvtab</kbd>
</pre>
                </div>
                <br>
                <br>
              </li>
            </ol>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9312">17.13.3. <b class=
            "APPLICATION">LPRng</b> Configuration</a></h3>

            <p>The <b class="APPLICATION">LPRng</b> software needs
            to be configured so that it can find the Kerberos
            libraries and include files. By default, the include
            files are installed in <tt class=
            "FILENAME">/usr/local/include</tt> and the libraries in
            <tt class="FILENAME">/usr/local/lib</tt>. Use the
            following steps to configure <b class=
            "APPLICATION">LPRng</b> so that it uses these
            directories during configuration and installation:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9320"></a>
<pre class="SCREEN">
    cd .../LPRng
    rm -f config.cache
    CPPFLAGS="-I/usr/local/include -I/usr/include/kerberosIV" \
      LDFLAGS="-L/usr/local/lib -L/usr/lib/kerberosIV" \
      ./configure
    make clean all
    su
    make install
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9322">17.13.4. Printcap
            Entries</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">auth=kerberos5</var><span
                class="emphasis"><i class="EMPHASIS">use Kerberos5
                authentication</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">kerberos_id=</var><span
                class="emphasis"><i class="EMPHASIS">server
                prinicpal name (for client use)</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">kerberos_server_principal=</var><span
                class="emphasis"><i class="EMPHASIS">alias for
                kerberos_id</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">kerberos_forward_id=</var><span class=
                "emphasis"><i class="EMPHASIS">destination server
                used by server</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">kerberos_forward_principal=</var><span
                class="emphasis"><i class="EMPHASIS">alias for
                kerberos_forward_id</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">kerberos_keytab=</var><span
                class="emphasis"><i class="EMPHASIS">location of
                the lpd server keytab file</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">kerberos_service=</var><span class=
                "emphasis"><i class="EMPHASIS">service to be
                used</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">kerberos_life=</var><span
                class="emphasis"><i class="EMPHASIS">lpd server
                ticket lifetime</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">kerberos_renew=</var><span
                class="emphasis"><i class="EMPHASIS">lpd server
                ticket renew</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Example printcap entry:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9363"></a>
<pre class="SCREEN">
    pr:client
        :lp=pr@wayoff
        :auth=kerberos5
        :kerberos_id=lpr/wayoff.private@ASTART.COM
    pr:server
        :lp=pr@faroff.private
        :auth_forward=kerberos5
        :kerberos_id=lpr/wayoff.private@ASTART.COM
        :kerberos_forward_id=lpr/faroff.private@ASTART.COM
        :kerberos_keytab=/etc/lpd.keytab
    
    OR If you want to use Kerberos 4 authentication to the server
    pr:client
        :lp=pr@wayoff
        :auth=kerberos4
        :kerberos_id=lpr/wayoff.private@ASTART.COM
    # support both Kerberos 4 and 5 on server
    pr:server
        :lp=pr@faroff.private
        :auth_forward=kerberos5
        :kerberos_id=lpr/wayoff.private@ASTART.COM
        :kerberos_forward_id=lpr/faroff.private@ASTART.COM
        :kerberos_keytab=/etc/lpd.keytab
</pre>
            </div>
            <br>
            <br>

            <p>The printcap configuration for Kerberos
            authentication is very simple.</p>

            <p>The <var class="LITERAL">kerberos_id</var> is the
            principal name of the lpd server that clients will
            connect to. For backwards compatibility, <var class=
            "LITERAL">kerberos_server_principal</var> can also be
            used. This values is used to obtain a ticket for the <b
            class="APPLICATION">lpd</b> server, and is the only
            entry required for client to server authentication.</p>

            <p>The other entries are used by the <b class=
            "APPLICATION">lpd</b> server. <var class=
            "LITERAL">kerberos_keytab</var> entry is the location
            of the keytab file to be used by the server. This
            contains the passphrase used by the server to
            authenticate itself and get a ticket from the ticket
            server.</p>

            <p>The <var class="LITERAL">kerberos_id</var> value is
            also used by the server during the authentication
            process to make sure that the correct principal name
            was used by the request originator. This check has
            saved many hours of pain in trying to determine why
            authentication is failing.</p>

            <p>The <var class="LITERAL">kerberos_life</var> and
            <var class="LITERAL">kerberos_renew</var> set the
            lifetime and renewability of the lpd server Kerberos
            tickets. These values should not be modified unless you
            are familiar with the Kerberos system. There are
            extensive notes in the <b class="APPLICATION">LPRng</b>
            source code concerning these values. The <var class=
            "LITERAL">kerberos_service</var> value supplies the
            name of the service to be used when generating a
            ticket. It is stronly recommended that the <var class=
            "LITERAL">kerberos_id</var> entry be used instead.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9381">17.13.5. User
            Environment Variables and Files</a></h3>

            <p>In order to use kerberos authentication, the user
            will need to obtain a ticket from the Kerberos ticket
            server. This is done using <var class=
            "LITERAL">kinit</var>.</p>

            <p>No other actions are required by the user.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9386">17.14. Using Kerberos
          4 for Authentication</a></h2>

          <p><b class="APPLICATION">LPRng</b> has built-in support
          for the Project Athena extensions to the RFC1179
          protocol. These provide an extremely simple
          authentication protocol using an initial credential
          exchange. After the initial exchange the usual RFC1179
          protocol is used.</p>

          <p>During configuration, if the <tt class=
          "FILENAME">krb.h</tt> (Kerberos 4) include file is found,
          then this is enabled by default.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9392">17.14.1. Printcap
            Entries</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">auth=kerberos4</var><span
                class="emphasis"><i class="EMPHASIS">use Kerberos4
                authentication</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">kerberos_id=</var><span
                class="emphasis"><i class="EMPHASIS">destination
                server key used by clients</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">kerberos_server_principal=</var><span
                class="emphasis"><i class="EMPHASIS">alias for
                kerberos_id</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Example printcap entry:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9409"></a>
<pre class="SCREEN">
    pr:
        :lp=pr@wayoff
        :auth=kerberos4
        :kerberos_id=lpr/wayoff.private@ASTART.COM
</pre>
            </div>
            <br>
            <br>

            <p>The configuration information for Kerberos4 and
            Kerberos5 is identical and differ only in the
            authentication type. Note that only client to server
            authentication is supported.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9412">17.15. Using SSL for
          Authentication</a></h2>

          <p><b class="APPLICATION">LPRng</b> has built-in support
          for using SSL as an authentication method. The
          implementation is based on OpenSSL 0.9.6c and the
          associated libraries as of of 3 June 2002. The
          distribution was obtained from the OpenSSL group from the
          <span class="emphasis"><i class="EMPHASIS"><a href=
          "http://www.openssl.org" target=
          "_top">http://www.openssl.org</a></i></span> Website.</p>

          <p>SSL authentication is based a private key/secret key
          technology, where the various keys are placed in files
          (or data structures) called <span class="emphasis"><i
          class="EMPHASIS">certificates</i></span> or <var class=
          "LITERAL">certs</var>, and the certificates are <span
          class="emphasis"><i class="EMPHASIS">signed</i></span> by
          calculating a checksum over the certificate, encypting
          the checksum and other information using the private key
          of a <span class="emphasis"><i class=
          "EMPHASIS">signing</i></span> certificate. The top level
          or <span class="emphasis"><i class=
          "EMPHASIS">root</i></span> certificate is signed by its
          own key; lower level signing certificates can be created
          which are signed by the top level or root certificate,
          and in turn can sign other signing certificates. User
          certificates can be created and signed by a signing
          certificate which can be used in the SSL protocol for
          authentication purposes. The following objects are needed
          to use SSL encryption.</p>

          <ol type="1">
            <li>
              <p>A top level or root certificates and a set of
              signing certificates. By convention, these are stored
              in the <tt class="FILENAME">/etc/lpd/ssl.ca</tt>
              directory; the root certificate is usually the <tt
              class="FILENAME">ca.crt</tt> file.</p>
            </li>

            <li>
              <p>Each server has a certificate and private key file
              which are used to identify the server and sign the
              SSL messages. The private key file is usually stored
              in an encrypted form and a password is required
              unlock the file. By convention, the server files are
              stored in the <tt class=
              "FILENAME">/etc/lpd/ssl.server</tt> directory; the
              <tt class="FILENAME">server.crt</tt> file contains
              the server certificate and (encrypted) private key;
              the <tt class="FILENAME">server.pwd</tt> file
              contains the password to decrypt the private key.</p>
            </li>

            <li>
              <p>Each user has a certificate and private key file
              which are used to identify the user and sign the SSL
              messages. The private key file is usually stored in
              an encrypted form and a password is required unlock
              the file. By convention, the user files are stored in
              the <tt class="FILENAME">${HOME}/.lpr</tt> directory;
              the <tt class="FILENAME">client.crt</tt> file
              contains the client certificate and (encrypted)
              private key; the <tt class="FILENAME">client.pwd</tt>
              file contains the password to decrypt the private
              key.</p>
            </li>

            <li>
              <p>A utility to create and manage the SSL certificate
              files.</p>
            </li>
          </ol>
          &#13;<br>
          <br>

          <p>The locations of the SSL files can be specified by
          various options to <b class="APPLICATION">configure</b>
          facility and by values in the the <var class=
          "LITERAL">lpd.conf</var> file.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9445">17.15.1.
            Certificate Management</a></h3>

            <p>The <b class="APPLICATION">lprng_cert</b> utility is
            used to set up the various directories and files
            required for SSL authentication. This code was derived
            from similar facilities developed for the <var class=
            "LITERAL">mod_ssl</var> extensions to the <b class=
            "APPLICATION">Apache</b> web server. This interactive
            utility is very verbose and has extensive comments and
            assistance.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9451"></a>
<pre class="SCREEN">
    h110: {111} % lprng_certs
    lprng_certs -- LPRng SSL Certificate Management
    Copyright (c) 2002 Patrick Powell
    Based on CCA by Ralf S. Engelschall
    (Copyright (c) 1998-2001 Ralf S. Engelschall, All Rights Reserved.)
    
    usage: lprng_certs option
      init              - make directory structure
      newca             - make new root CA and default values for certs
      defaults          - set new default values for certs
      gen               - generate user, server, or signing cert
      verify [cert]     - verify cert file
      index [dir]       - make certificate index files in directory dir
      encrypt keyfile   - set or change password on private key file
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">lprng_certs init</var>
            option will create the necessary directories for the <b
            class="APPLICATION">LPRng</b> software on a system. The
            <var class="LITERAL">lprng_certs newca</var> option
            will create the root level certificate and set up a set
            of defaults for the creation of other certificates. The
            <var class="LITERAL">lprng_certs defaults</var> option
            allows viewing and editting of the various default
            values. The <var class="LITERAL">lprng_certs gen</var>
            option is used to create and sign new certificate
            files. The OpenSSL software assumes that the file names
            of the signing certificate files have a special format;
            the <var class="LITERAL">lprng_certs index</var>
            creates links of the required format to the certificate
            files. Finally, the <var class="LITERAL">lprng_certs
            verify</var> and the <var class="LITERAL">lprng_certs
            encrypt</var> facilities can be used to verify that the
            certificate files have the proper format and to change
            the private key password respectively.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9462">17.15.2. Creating
            Root Certificate</a></h3>

            <p>The <var class="LITERAL">lprng_certs newca</var>
            option is used to create a new root signing certificate
            and to establish defaults.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9466"></a>
<pre class="SCREEN">
    h110: {112} #&gt; lprng_certs newca
    lprng_certs -- LPRng SSL Certificate Management
    Copyright (c) 2002 Patrick Powell
    Based on CCA by Ralf S. Engelschall
    (Copyright (c) 1998-2001 Ralf S. Engelschall, All Rights Reserved.)
    
    INITIALIZATION - SET DEFAULTS
    ...  
    ______________________________________________________________________
    
    STEP 1: Generating RSA private key for CA (1024 bit)
    ______________________________________________________________________
    
    STEP 2: Generating X.509 certificate signing request for CA
    ______________________________________________________________________
    
    STEP 3: Generating X.509 certificate for CA signed by itself
    ______________________________________________________________________
    
    RESULT:
    /etc/lpd/ssl.ca/ca.crt:
    /C=US/ST=California/L=San Diego/O=Astart/OU=Certificate Authority/\
     CN=Astart CA/Email=id@astart.com
    error 18 at 0 depth lookup:self signed certificate
    OK
    ______________________________________________________________________
    
    STEP 4. Encrypting RSA private key with a pass phrase for security
    The contents of the certificate key file (the generated private
    key) should be echo kept secret, especially so if it is used to
    sign Certificates or for User authentication.  SSL experts strongly
    recommend you to encrypt the key file with a Triple-DES cipher and
    a Pass Phrase.  When using LPRng, you provide the password via a
    file specified by the LPR_SSL_PASSWORD environent variable, or in
    the ${HOME}/.lpr/client.pwd file.  The LPD server uses the
    ssl_server_password_file option to specify the location of a file
    containing the password.  See the LPRng Reference Manual for details, or the
    printcap(5) man page.
    
    key file is /etc/lpd/ssl.ca/ca.key
    Encrypt the private key now? [Y/n]: y
    Fine, you're using an encrypted private key to sign CERTS.
</pre>
            </div>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9468">17.15.3. Creating
            Client and Server Certificates</a></h3>

            <p>The <var class="LITERAL">lprng_certs gen</var>
            option allows the creation of client and server
            identification certificates. By convention, these are
            created in a default directory and the system
            administrator then copies them to the appropriate
            client or server directory.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9472"></a>
<pre class="SCREEN">
    h110: {112} #&gt; lprng_certs gen
    lprng_certs -- LPRng SSL Certificate Management
    Copyright (c) 2002 Patrick Powell
    Based on CCA by Ralf S. Engelschall
    (Copyright (c) 1998-2001 Ralf S. Engelschall, All Rights Reserved.)
    
    CERTIFICATE GENERATION
    What type of certificate? User/Server/Signing Authority/Help? [u/s/a/H]
    Create in '/etc/lpd/ssl.certs' [return for yes, or specify directory]
    CERT name 'user-10'? [return for yes, or specify name] papowell
    CERT name 'papowell'? [return for yes, or specify name] 
    Creating papowell in /etc/lpd/ssl.certs
    Sign with Certificate '/etc/lpd/ssl.ca/ca.crt' \
       [return for yes, ? for list, or specify cert file] ?
    Possible CERTS in directory '/etc/lpd/ssl.ca' are:
    /etc/lpd/ssl.ca/ca.crt
    /etc/lpd/ssl.ca/signer1.crt
    /etc/lpd/ssl.ca/tsign.crt
    Sign with Certificate '/etc/lpd/ssl.ca/ca.crt'  \
      [return for yes, ? for list, or specify cert file] signer1
    Match Found /etc/lpd/ssl.ca/signer1.crt
    Sign with Certificate '/etc/lpd/ssl.ca/signer1.crt'  \
      [return for yes, ? for list, or specify cert file]
    Private key in /etc/lpd/ssl.ca/signer1.crt
    
    Generating user Certificate [papowell] 
    
    STEP 1: Generating RSA private key for user (1024 bit)
    
    STEP 2: Generating X.509 certificate signing request for user
    ....
    
    STEP 3: Generating X.509 certificate signed by /etc/lpd/ssl.ca/signer1.crt
    ...
    
    RESULT:
    /etc/lpd/ssl.certs/papowell.crt: OK
    
    STEP 4. Enrypting RSA private key /etc/lpd/ssl.certs/papowell.key
      with a pass phrase for security
    
    Encrypt the private key now? [Y/n]: Fine, you're using an encrypted
      private key to sign CERTS.
    
    STEP 5: Combine CERT and KEY file
    Generate single CERT and KEY file? [Y/n] 
    
    Use the following commands to examine the CERT and KEY files:
       openssl x509 -text -in /etc/lpd/ssl.certs/papowell.crt
       openssl rsa -text -in /etc/lpd/ssl.certs/papowell.crt
</pre>
            </div>
            <br>
            <br>

            <p>After the certificate file has been created, then it
            should be copied to the appropriate location: <tt
            class="FILENAME">/etc/lpd/ssl.server/server.crt</tt>
            and the password in <tt class=
            "FILENAME">/etc/lpd/ssl.server/server.pwd</tt>, for a
            server or <tt class=
            "FILENAME">${HOME}/.lpr/client.crt</tt> and the
            password in <tt class=
            "FILENAME">${HOME}/.lpr/client.pwd</tt> for a user.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9479">17.15.4. Creating
            Signing Certificates</a></h3>

            <p>Having only one signing certificate, i.e. - the root
            certificate, may make it difficult to delegate
            authority for the creation of user certificates and/or
            server certificates. The <var class=
            "LITERAL">lprng_certs gen</var> facility can be used to
            create a certificate that can be used to sign other
            certificates.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9483">17.15.5.
            Permissions and Certificate Revocation</a></h3>

            <p>The certificate revocation facility is not
            implemented in <b class="APPLICATION">LPRng</b>, due to
            various technical and management issues. Instead, the
            <var class="LITERAL">AUTHUSER</var> and <var class=
            "LITERAL">AUTHCA</var> and</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9489">17.16. Using MD5 for
          Authentication</a></h2>

          <p><b class="APPLICATION">LPRng</b> has built-in support
          for using MD5 digests as an authentication method. The
          implementation is provided as an example of how to add
          user level authentication into the <b class=
          "APPLICATION">LPRng</b> system.</p>

          <p>The method used to do authentication is very simple.
          Each user has a file containing a set of keys that are
          used to salt an md5 hash. The information being
          transferred has its md5 checksum calculated using this
          salt, and is then transferred to the destination, along
          with the md5 hash result. At the destination the server
          will get the user id, obtain the salt value from a key
          file, and then calculate the md5 hash value. If the two
          are in agreement, authentication is successful.</p>

          <p>The keyfile used for md5 authentication contains an id
          followed by a text string whose binary value is used as a
          hash key:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9496"></a>
<pre class="SCREEN">
    id1=key
    id2=key
    
    Example:
    
    lpr@h2=tadf79asd%^1asdf
    lpr@h1=fdfa%$^&amp;^%$
</pre>
          </div>
          <br>
          <br>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9498">17.16.1. Printcap
            Entries</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">auth=md5</var><span class=
                "emphasis"><i class="EMPHASIS">use MD5
                authentication</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">auth_forward=md5</var><span
                class="emphasis"><i class="EMPHASIS">forward using
                MD5 authentication</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">md5_id=</var><span class=
                "emphasis"><i class="EMPHASIS">id for
                server</i></span></p>
              </li>

              <li>
                <p><var class="LITERAL">md5_forward_id=</var><span
                class="emphasis"><i class="EMPHASIS">id for
                server</i></span></p>
              </li>

              <li>
                <p><var class=
                "LITERAL">md5_server_keyfile=</var><span class=
                "emphasis"><i class="EMPHASIS">server
                keyfile</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>Example printcap entry:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9523"></a>
<pre class="SCREEN">
    pr:
        :lp=pr@wayoff
        :auth=md5
        :md5_id=lpr@wayoff.com
    pr:server
        :auth_forward=md5
        :md5_id=lpr@wayoff.com
        :md5_server_keyfile
        :md5_forward_id=lpr@faroff.com
</pre>
            </div>
            <br>
            <br>

            <p>The <var class="LITERAL">md5_id</var> value is used
            by the client to obtain a hash key that is used to salt
            the md5 calculation for client to server transfers. The
            <var class="LITERAL">md5_forward_id</var> value is used
            by the server to obtain a hash key that is used to salt
            the md5 calculation for server to server transfers.</p>

            <p>The <var class="LITERAL">md5_server_keyfile</var>
            contains the keys of users; the id sent as the
            connection information is used to obtain the key from
            the file.</p>

            <p>To set up md5 authentication, all that is needed is
            the following.</p>

            <ul>
              <li>
                <p>For each user generate a key and place it in the
                server keyfile. This file should have the form:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9534"></a>
<pre class="SCREEN">
    user1@host1=asdfasdfadf
    user2@host2=a8789087asddasdf
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>Assign a key to the server, and set its printcap
                entry to this key.</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9538"></a>
<pre class="SCREEN">
    pr:
        :lp=pr@wayoff
        :auth=md5
        :md5_id=lpr@wayoff.com
</pre>
                </div>
                <br>
                <br>
              </li>

              <li>
                <p>For each user, create a user key file with the
                following format:</p>

                <div class="INFORMALEXAMPLE">
                  <a name="AEN9542"></a>
<pre class="SCREEN">
    lpr@wayoff = user1@host1 asdfasdfadf
</pre>
                </div>
                The first entry corresponds to the <var class=
                "LITERAL">md5_id</var> value in the printcap. The
                second field is the <acronym class=
                "ACRONYM">AUTHUSER</acronym> value supplied to the
                server and which will be used to look up the key in
                the servers key file. Finally, the last field is
                the salt value for the md5 calculation.<br>
                <br>
              </li>
            </ul>
            <br>
            <br>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9546">17.16.2. User
            Environment Variables and Files</a></h3>

            <p>Options used:</p>

            <ul>
              <li>
                <p><var class="LITERAL">MD5KEYFILE=5</var><span
                class="emphasis"><i class="EMPHASIS">location of
                user keyfile</i></span></p>
              </li>
            </ul>
            <br>
            <br>

            <p>The <var class="LITERAL">MD5KEYFILE</var>
            environment variable contains the path to the user
            keytab file.</p>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9556">17.17. Adding
          Authentication Support</a></h2>

          <p>Additional types of authentication support can be
          added very easily to <b class="APPLICATION">LPRng</b> by
          using the following conventions and guidelines.</p>

          <p>First, the authentication method can be connection
          based or transfer based. Connection based authentication
          involves the <b class="APPLICATION">LPRng</b> client or
          server opening a connection to the remote server, having
          the authentication protocol provide authentication
          information, and then having no further interaction with
          the system. This is the easiest to implement and
          understand method. Code needs to be provided to do a
          simple authentication exchange between the two ends of
          the connection, after which no other action needs to be
          taken.</p>

          <p>Transfer based authentication is more complex, but
          allows encrypted transfers of information between the two
          systems. A connection is established between client and
          server (or server and server), and an initial protocol
          exchange is performed. Then the authentication module
          transfers the command or job information to the
          destination, where is it unpacked and/or decrypted. The
          internal <b class="APPLICATION">lpd</b> server facilities
          are then invoked by the authentication module, which also
          provides a destination for any error message or
          information destined for the client. The authentication
          module will encrypt or encode this information and then
          send it to the client program. This type of
          authentication is more complex, but provides a higher
          degree of security and reliability than the simple
          connection based system.</p>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9564">17.17.1. Printcap
            Support</a></h3>

            <p>By convention, printcap entries <var class=
            "LITERAL">auth=XXX</var> and <var class=
            "LITERAL">auth_forward=XXX</var> specifies that
            authentication protocol <acronym class=
            "ACRONYM">XXX</acronym> is to be used for client to
            server and for server to server transfers
            respectively.</p>

            <p>Similarly, the server receiving an authentication
            request must have a <var class=
            "LITERAL">XXX_id=name</var> entry in the printcap or
            configuration information. This allows several
            different authentication protocols to be accepted by a
            server.</p>

            <p>By convention, printcap and configuration entries of
            the form <var class="LITERAL">XXX_key</var> contain
            configuration information for the <acronym class=
            "ACRONYM">XXX</acronym> authentication protocol. As
            part of the authentication support process the <var
            class="LITERAL">XXX_key</var> values are extracted from
            the printcap and configuration files and placed in a
            simple database for the authentication support
            module.</p>

            <p>If you are using a routing filter, then you can also
            place <var class="LITERAL">XXX_key</var> information in
            the routing entry for each file, and this will be used
            for sending the job to the specified destination.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9578">17.17.2. Code
            Support</a></h3>

            <p>The <tt class=
            "FILENAME">LPRng/src/common/sendauth.c</tt> file has
            the following entries at the end.</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9582"></a>
<pre class="SCREEN">
    #define SENDING
    #include "user_auth.stub"
    
    struct security SendSecuritySupported[] = {
      /* name,       config_tag, connect,    send,   receive */
      { "kerberos4", "kerberos", Send_krb4_auth, 0, 0 },
      { "kerberos*", "kerberos", 0,           Krb5_send },
      { "pgp",       "pgp",      0,           Pgp_send },
    #if defined(USER_SEND)
     USER_SEND
    #endif
      {0}
    };
</pre>
            </div>
            This is an example of how to add user level
            authentication support. The <tt class=
            "FILENAME">user_auth.stub</tt> file contains the source
            code for the various modules authentication modules.
            You can replace this file with your own version if
            desired. The following fields are used. 

            <div class="VARIABLELIST">
              <dl>
                <dt>name</dt>

                <dd>
                  <p>The authentication name. The <var class=
                  "LITERAL">auth=XXX</var> printcap or
                  configuration value will cause the <var class=
                  "LITERAL">name</var> fields to be searched using
                  a glob match.</p>
                </dd>

                <dt>config_tag</dt>

                <dd>
                  <p>When a match is found, the <var class=
                  "LITERAL">config_tag</var> value is used to
                  search the printcap and configuration entries for
                  information. If the <var class=
                  "LITERAL">config_tag</var> field has value
                  <acronym class="ACRONYM">XXX</acronym>, then
                  entries with keys <var class=
                  "LITERAL">XXX_key</var> will be extracted for use
                  by the authentication code.</p>
                </dd>

                <dt>connect</dt>

                <dd>
                  <p>Routine to call to support <var class=
                  "LITERAL">connection</var> level authentication.
                  This routine is responsible for connection
                  establishment and protocol handshake. If the
                  value is 0, then the <var class=
                  "LITERAL">send</var> field value will be
                  used.</p>
                </dd>

                <dt>send</dt>

                <dd>
                  <p>Routine to call to support <var class=
                  "LITERAL">transfer</var> level authentication.
                  The <var class="LITERAL">send</var> routine is
                  provided a file and a connection to the remote
                  server, and is responsible for the transferring
                  files.</p>
                </dd>
              </dl>
            </div>
            <br>
            <br>

            <p>The <tt class=
            "FILENAME">LPRng/src/common/lpd_secure.c</tt> file has
            the following information at the end:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9614"></a>
<pre class="SCREEN">
    #define RECEIVE 1
    #include "user_auth.stub"
    
     struct security ReceiveSecuritySupported[] = {
        /* name, config_tag, connect, send, receive */
    #if defined(HAVE_KRB_H) &amp;&amp; defined(MIT_KERBEROS4)
        { "kerberos4", "kerberos",  0, 0, 0 },
    #endif
    #if defined(HAVE_KRB5_H)
        { "kerberos*", "kerberos",   0, 0, Krb5_receive },
    #endif
        { "pgp",       "pgp",   0, 0, Pgp_receive, },
    #if defined(USER_RECEIVE)
    /* this should have the form of the entries above */
     USER_RECEIVE
    #endif
        {0}
    };
</pre>
            </div>
            <br>
            <br>

            <p>This information matches the same information in the
            <tt class="FILENAME">sendauth.c</tt> file. When the
            authentication request arrives at the server, the <var
            class="LITERAL">name</var> field values are searched
            for a match, and then the <var class=
            "LITERAL">config_tag</var> value is used to get extract
            configuration information from the database for the
            protocol.</p>

            <p>The <var class="LITERAL">receive</var> routine is
            then called and is expected to handle the remaining
            steps of the authentication protocol. If the routine
            exits with a 0 value then the lpd server expects <var
            class="LITERAL">connection</var> level authentication
            has been done and proceeds to simply transfer
            information using the standard RFC1179 protocol steps.
            A non-zero return value indicates an error and an error
            is reported to the other end of the connection.</p>

            <p>If the <var class="LITERAL">receive</var> module is
            to perform <var class="LITERAL">transfer</var> level
            authentication, then the module carries out the
            necessary steps to transfer the command and/or job
            information. It then calls the necessary internal <b
            class="APPLICATION">LPRng</b> routine to implement the
            desired services. After finishing the requested work,
            these routines return to the calling authentication
            module, which then will transfer data, close the
            connection to the remote system, and return to the
            calling system. The combination of 0 return value and
            closed connection indicates successful transfer level
            authentication to the server.</p>

            <p>The <tt class="FILENAME">user_auth.stub</tt> file
            contains the following code that sets the <var class=
            "LITERAL">USER_SEND</var> variable:</p>

            <div class="INFORMALEXAMPLE">
              <a name="AEN9630"></a>
<pre class="SCREEN">
    #if defined(SENDING)
    extern int md5_send();
    #  define USER_SEND \
      { "md5", "md5", md5_send, 0, md5_receive },
    #endif
</pre>
            </div>
            <br>
            <br>

            <p>If the <acronym class="ACRONYM">SENDING</acronym>
            value has been defined, this causes the prototype for
            <code class="FUNCTION">md5_send()</code> to be place in
            the file and the <var class="LITERAL">USER_SEND</var>
            value to be defined. This will cause the <var class=
            "LITERAL">md5</var> authentication information to be
            placed in the correct table.</p>
          </div>

          <div class="SECT2">
            <hr>

            <h3 class="SECT2"><a name="AEN9637">17.17.3. Connection
            and Transfer Authentication</a></h3>

            <p>Rather than go into a detailed description of the
            code, the <tt class="FILENAME">user_auth.stub</tt> file
            contains extremely detailed examples as well as several
            working versions of authentication information. It is
            recommended that the user start with one of these and
            then modify it to suit themselves.</p>
          </div>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="ACCOUNTINGREF"></a>Chapter 18. Accounting</h1>

        <p>In Academic institutions, avoiding printing accounting
        has been regarded as a challenge, an ongoing game of fat
        cat and poor starving mouse, between the brutal and corrupt
        Administration and the poor, downtrodden, over-charged
        student. We will disregard the fact that if most students
        put as much effort into their studies as in finding ways to
        avoid accounting procedures then they would be Rhodes
        Scholar material, but I digress...</p>

        <p>There are two approaches to printing accounting: use
        software determine the number of pages that should be
        printed or use a hardware pagecounter facility on the
        printer to accurately determine the number of pages used.
        While the software method works well in a relatively error
        and security compromise free environment and where print
        jobs do not jam, for accurate account a hardware level
        pagecounter or some other method must be used. LPRng
        provides facilities to use either method to determine page
        counts.</p>

        <p>There are also two methods available to store the actual
        accounting information: the simple <span class=
        "emphasis"><i class="EMPHASIS">save to file</i></span>
        method and the more complex <span class="emphasis"><i
        class="EMPHASIS">save to program</i></span> method. LPRng
        provides support for both methods.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="ACCOUNTINGSERVER">18.1.
          Accounting Printcap Options</a></h2>

          <p>The accounting facilities are controlled and enabled
          by the following entries in the printcap file.</p>

          <div class="INFORMALTABLE">
            <a name="AEN9651"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Tag</th>

                  <th>Default Value</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>af</td>

                  <td>NULL</td>

                  <td>accounting file name</td>
                </tr>

                <tr>
                  <td>as</td>

                  <td>"jobstart $H $n $P $k $b $t"</td>

                  <td>accounting info for job start</td>
                </tr>

                <tr>
                  <td>ae</td>

                  <td>"jobend $H $n $P $k $b $t"</td>

                  <td>accounting info for job end</td>
                </tr>

                <tr>
                  <td>achk</td>

                  <td>FALSE</td>

                  <td>&nbsp;</td>
                </tr>

                <tr>
                  <td>la</td>

                  <td>TRUE</td>

                  <td>do accounting for 'local' printer</td>
                </tr>

                <tr>
                  <td>ar</td>

                  <td>FALSE</td>

                  <td>do accounting for 'remote' transfers</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9682">18.2. Accounting
          Information</a></h2>

          <p>The <var class="LITERAL">:as=...</var> and <var class=
          "LITERAL">:ae=...</var> options specify the the start of
          job and end of job accounting information or a set of
          programs to be run to record the start and end of job
          accounting information. The option values are expanded
          using the same methods as for the filter options. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9687"></a>
<pre class="SCREEN">
    :as=jobstart $H $n $P $k $b $t
      jobstart '-Hh4.private' '-nroot' '-Pps' '-kcfA938h4.private' \
        '-b1093' '-tNov  5 19:39:25'
    :ae=jobend $H $n $P $k $b $t
      jobend '-Hh4.private' '-nroot' '-Pps' '-kcfA938h4.private' \
        '-b1093' '-tNov  5 19:39:59'
</pre>
          </div>
          <br>
          <br>

          <p>If the options have the form <var class=
          "LITERAL">:as=|/path ...</var>, then the specified
          program is run to record the information. By convention
          the accounting information is passed as command line
          values to the program. The programs are run in the same
          manner as a print filter. When the <var class=
          "LITERAL">:as</var> or <var class="LITERAL">:ae</var>
          value specifies a program then logging using the <var
          class="LITERAL">:af</var> option values in the next
          section is not performed. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9694"></a>
<pre class="SCREEN">
    :as=|/usr/local/libexec/jobstart $H $n $P $k $b $t
      /usr/local/libexec/jobstart '-Hh4.private' '-nroot' \
      '-Pps' '-kcfA938h4.private' '-b1093' '-tNov  5 19:39:25'
    :ae=jobend $H $n $P $k $b $t
      jobend '-Hh4.private' '-nroot' '-Pps' '-kcfA938h4.private' \
        '-b1093' '-tNov  5 19:39:59'
</pre>
          </div>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9696">18.3. Accounting
          File</a></h2>

          <p>The Accounting File (<var class="LITERAL">:af=</var>)
          option value specifies the destination of accounting
          information. If the format of the <var class=
          "LITERAL">:af</var> option is <var class="LITERAL">:as=|
          ...</var> , then the value is assumed to be a program to
          be run to record start and end of job information. The
          program is run in the same manner as a print filter. The
          values of the <var class="LITERAL">:as</var> and <var
          class="LITERAL">:ae</var> options are written to the
          program's <var class="LITERAL">STDIN</var> and the output
          from the program's <var class="LITERAL">STDOUT</var> is
          used as described below for authorization.</p>

          <p>If the <var class="LITERAL">:af=</var> option has the
          format <var class="LITERAL">host%port</var> then a TCP/IP
          connection is opened to the specified port on the
          indicated host. The values of the <var class=
          "LITERAL">:as</var> and <var class="LITERAL">:ae</var>
          options are written to the remote host. The port that the
          connection originates from will be in the range set by
          the configuration or printcap <span class="emphasis"><i
          class="EMPHASIS"><a href=
          "#LPDPORT">originate_port</a></i></span> option.</p>

          <p>Finally, if the <var class="LITERAL">:af=</var> has
          neither of these formats then it will be treated as a
          pathname to a file. If the file exists or the <var class=
          "LITERAL">create_files</var> option is true, then the
          file will be opened and the values of the <var class=
          "LITERAL">:as</var> and <var class="LITERAL">:ae</var>
          options are written to the file. The accounting file
          should be periodically truncated.&#13;</p>

          <p>&#13;By convention the <var class="LITERAL">:af=</var>
          value is passed to filters as a command line option.
          LPRng will pass the option value only if it is specifies
          a file or network destination. This implies that
          accounting information can be written to the accounting
          file or network destinations by the print spooler, <var
          class="LITERAL">:of</var> filters, or print file filters.
          The filters are responsible for opening the accounting
          file or network connection.</p>

          <p>The following is an example of information written to
          the accounting file:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9722"></a>
<pre class="SCREEN">
    jobstart '-Hh4.private' '-nroot' '-Pps' '-kcfA938h4.private' \
    '-b1093' '-tNov  5 19:39:25'
    start '-p12942' '-kcfA938h4.private' '-nroot' '-hh4.private' '-Pps' \
    '-c0' '-Fo' '-tSun Nov  5 19:39:25 1995'
    filestart '-p12944' '-kcfA938h4.private' '-nroot' '-hh4.private' '-Pps' \
    '-c0' '-Ff' '-tSun Nov  5 19:39:27 1995'
    fileend '-p12944' '-kcfA938h4.private' '-nroot' '-hh4.private' '-Pps' \
    '-b3' '-c0' '-Ff' '-tSun Nov  5 19:39:58 1995'
    end '-p12942' '-kcfA938h4.private' '-nroot' '-hh4.private' '-Pps' \
    '-b2' '-c0' '-Fo' '-tSun Nov  5 19:39:59 1995'
    jobend '-Hh4.private' '-nroot' '-Pps' '-kcfA938h4.private' \
    '-b1093' '-tNov  5 19:39:59'
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">jobstart</var> and <var
          class="LITERAL">jobend</var> lines are written by <b
          class="APPLICATION">lpd</b> and are the expanded <var
          class="LITERAL">:as</var> and <var class=
          "LITERAL">:ae</var> values. The <var class=
          "LITERAL">start</var> and <var class="LITERAL">end</var>
          line are added by the <var class="LITERAL">:of</var>
          filter. This filter usually queries the printer and gets
          printer dependent accounting information such as the
          pagecounter value. The <var class="LITERAL">:of</var>
          filter is then suspended and the job is processed by the
          various format dependent filters. The the <var class=
          "LITERAL">filestart</var> and <var class=
          "LITERAL">fileend</var> lines are produced by the other
          filters.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9736">18.4. Authorization
          and Quotas</a></h2>

          <p>In addition to simply recording accounting information
          the accounting procedures can be used to check print
          quotas or update databases. This is done by using the
          Accounting Check <var class="LITERAL">:achk</var> flag
          and the <var class="LITERAL">:as</var>, <var class=
          "LITERAL">:ae</var>, and <var class="LITERAL">:af</var>
          network connection or program capabilities.</p>

          <p>If the <var class="LITERAL">:achk</var> flag is set
          and the <var class="LITERAL">:as=</var> option specifies
          a program to be run, or the <var class=
          "LITERAL">:af=</var> option specifies a program to be run
          or a network connection then output of the program or
          information read from the network connection is used to
          control the handling of the job. If the <var class=
          "LITERAL">:as=</var> option specifies a program to be run
          then the program is run and the exit code and output is
          saved. If the <var class="LITERAL">:as=</var> option
          specifies a string and the <var class=
          "LITERAL">:af=</var> option specifies a program to be run
          or a remote host to be contacted then the <var class=
          "LITERAL">:as=</var> value is written to the program
          STDIN or remote host. The program STDOUT or network
          connection is read and saved and the program exit code is
          saved.</p>

          <p>If the information was read from a program, then the
          exit code of the program is checked:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9752"></a>
<pre class="SCREEN">
    Exit Code    Action
    JSUCC (0)    process data read
    JFAIL        retry with JFAIL status
    JHOLD        hold job
    JREMOVE      remove job
    JABORT       abort processing jobs
    other        abort processing jobs
</pre>
          </div>
          <br>
          <br>

          <p>If the information was read from a network connection
          or the program exited with JSUCC (0) then the start of
          the first line of the information read is used. If this
          line starts with the following case insensitive words
          then the following actions are taken:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9755"></a>
<pre class="SCREEN">
    Word         Action
    (blank)      process job
    ACCEPT       process job
    FAIL         retry with JFAIL status
    HOLD         hold job
    REMOVE       remove job
    (other)      abort processing jobs
</pre>
          </div>
          <br>
          <br>

          <p>These facilities can be used to implement a wide
          variety of quota mechanisms. The most simple method is to
          create a script or program that can be run as the <var
          class="LITERAL">:as=</var> program. This would connect to
          a database server or check a database to see if user
          quotas had been exceeded. If they had, then it would
          return a <var class="LITERAL">REMOVE</var> or <var class=
          "LITERAL">HOLD</var> status as appropriate.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9761">18.5. Accessing
          Printer Hardware Pagecounters</a></h2>

          <p>The following is from Hewlett-Packard documentation,
          <a href=
          "http://www.hp.com/cposupport/printers/support_doc/bpl02119.html"
           target=
          "_top">http://www.hp.com/cposupport/printers/support_doc/bpl02119.html</a></p>

          <p>All HP LaserJet 4/5/6 family printers have a page
          count feature built into the firmware. However, this
          feature works differently depending on which HP LaserJet
          printer is being used. The following is a description of
          how the page count feature works for each printer within
          the HP LaserJet 4/5/6 printer families.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9766"></a>
<pre class="SCREEN">
    HP LaserJet 4/4M printers
    HP LaserJet 4 Plus/4M Plus printers
    HP LaserJet 4P/4MP printers
    HP LaserJet 4Si/4Si MX printers
    HP LaserJet 4ML printers
    HP LaserJet 5P/5MP printers
    HP LaserJet 6P/6MP printers
</pre>
          </div>
          <br>
          <br>

          <p>All of the above printers use the same method for
          keeping track of the number of copies. There are really
          two different page count values: Primary and Secondary
          values. Every time a page is printed, whether it is an
          internal job (such as a self-test) or a standard print
          job, the Secondary page count increases by one. This
          value is stored in standard RAM. Once the Secondary page
          count value reaches 10, the Primary page count will
          increase by 10. The Primary page count value is stored in
          a type of memory called NVRAM (Non-Volatile RAM). This is
          important, since NVRAM is not cleared when the printer is
          powered off. Standard RAM, on the other hand, is cleared
          when the printer is turned off or reset. Thus, the
          Primary page count only increases in increments of
          10.</p>

          <p>Example</p>

          <p>You have a brand new HP LaserJet 6P printer and you
          print a self-test page. When you look on the test page
          for the Page Count value, you will see that it says 1.
          Next, you decide to print a two page letter and, after
          that, another self-test. The page count value now says 4.
          Internally, the printers Secondary page count (stored in
          RAM) has the value of 4 while the Primary page count
          (stored in NVRAM) still has the value of 0. Now, you turn
          the printer off, then back on, and print another
          self-test. The page count value again says 1 since the
          previous value of 4, stored in RAM, was cleared when the
          printer was powered off. Finally, print a ten page
          document and then turn the printer off. Upon turning the
          printer back on and printing out another self test, you
          see that the page count value is 11. Internally, the
          Secondary page count value is back at 1 while the Primary
          page count value (stored in NVRAM) is 10. Added together,
          you end up with the resulting value seen on the self-test
          page.</p>

          <p>The HP LaserJet 4L/5L/6L printers differ from that of
          the other printers in that they do not have any NVRAM
          available for storing page count values. Thus, no way
          exists for the printer to retain a page count value once
          the printer is powered off. The HP LaserJet 4L/5L/6L
          printers have only a single page count value that
          increases in increments of one until the printer is
          powered off.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9772">18.6. Reliable
          Accounting</a></h2>

          <p>In order to do reliable accounting, the printer must
          be queueried for the current value of the pagecounter at
          the start and end of jobs and this information stored in
          the accounting file. The <b class="APPLICATION">ifhp</b>
          filter can be configured to obtain the pagecounter values
          and to record them at the start and end of each part of a
          print job. We can use the <var class="LITERAL">:of</var>
          filter to read the pagecounter value at the start and end
          of a job, and have the other file files record
          information as well. The <var class="LITERAL">ifhp</var>
          filter will record the pagecounter information with the
          <var class="LITERAL">-p</var> option. We need simply take
          the difference of the starting and ending pagecounter
          values to find the number of pages used by a job.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9779"></a>
<pre class="SCREEN">
    Example:
     lpd generates:  
      jobstart  - from the lpd.conf 'as=' option
      jobend    - from the lpd.conf 'ae=' option
        -H   - host name
        -n   - user name
        -P   - printer
        -k   - control file name
        -b   - byte count of job/file
        -t   - current printing time
    
     ifhp filter generates:
       start/end         - of filter, for entire job
       filestart/fileend - if or other filter, for each file
       (options above are same)
        -A  - identifier information
        -q  - process id of filter
        -p  - current value of page counter, 0 indicates no
              page counter on printer or it is not readable
    
    jobstart '-Hh110.private' '-nroot' '-Plp' \
       '-kcfA129h110.private' '-b48780' '-t2001-10-19-09:36:36.000'
                               ^^^ bytes in file
    
    start '-q26130' '-p105340' '-t2001-10-19-09:36:38.330' \
                     ^^^^^^^  starting page counter value for job
        '-Aroot@h110+129' '-nroot' '-Plp' 
    filestart '-q26132' '-p105340' '-t2001-10-19-09:36:38.350' \
                          ^^^^^^^  starting page counter value for file
        '-Aroot@h110+129' '-nroot' '-Plp' 
    fileend '-b19' '-T435' '-q26132' '-p105359' '-t2001-10-19-09:43:51.504'
                                      ^^^^^^^  ending page countvalue for file
             ^^^ number of pages printed for this file
        '-Aroot@h110+129' '-nroot' '-Plp'
    end '-b19' '-T435' '-q26130' '-p105359' '-t2001-10-19-09:43:51.504'
                                      ^^^^^^^  ending page countvalue for job
         ^^^ number of pages printed for this job
        '-Aroot@h110+129' '-nroot' '-Plp'
    jobend '-Hh110.private' '-nroot' '-Plp' \
        '-kcfA129h110.private' '-b48780' '-t2001-10-19-09:43:51.000'
                               ^^^ bytes in file
</pre>
          </div>
          <br>
          <br>

          <p>If for some reason the job is killed or terminates due
          to error conditions, the <var class="LITERAL">:of</var>
          filter may not get to record the ending value for the
          job. This can lead to accounting files with the following
          entries:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9783"></a>
<pre class="SCREEN">
    start '-p100' '-q20005' '-Fo' '-kcfA100taco' '-uuser' '-hhost' '-R...
    filestart '-p101' '-q20005' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    start '-p110' '-q20005' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
    filestart '-p112' '-q20010' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
    end '-p112' '-q20010' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
</pre>
          </div>
          <br>
          <br>

          <p>The missing <var class="LITERAL">end</var> is a clear
          indication that the user's job has been terminated. We
          simply use the pagecounter value determined at the start
          of the next job to find the numbers of pages used for
          this job.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN9787">18.7. <b class=
          "APPLICATION">LPRng</b> accounting.pl Utility</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> <tt class=
          "FILENAME">accounting.pl</tt> utility provides the basic
          framework for using the <var class="LITERAL">:as=|</var>,
          <var class="LITERAL">:ae=|</var>, and pagecounter
          information written to the accounting file to do reliable
          accounting, and may be found in the <b class=
          "APPLICATION">LPRng</b> distribution <var class=
          "LITERAL">UTILS</var> directory. Usually this is modified
          according to local site needs and installed in the filter
          directory.</p>

          <p>The utility maintains the accounting file by inserting
          a <var class="LITERAL">START</var> record at the start of
          a job and an <var class="LITERAL">END</var> record at the
          end of the job. It is assumed that the last <var class=
          "LITERAL">END</var> record in the file marks the last
          place that accounting was completed.</p>

          <p>The following shows the printcap entry for using the
          <var class="LITERAL">accounting.pl</var> utility. The
          <var class="LITERAL">start</var> and <var class=
          "LITERAL">end</var> options are used to specify that the
          utility is being called at the job start or end.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9805"></a>
<pre class="SCREEN">
    printer
     :af=acct
     :as=|/usr/local/libexec/filters/accounting.pl start
     :ae=|/usr/local/libexec/filters/accounting.pl end
</pre>
          </div>
          <br>
          <br>

          <p>At the start of each job the utilty writes a <var
          class="LITERAL">START</var> record into the accounting
          file. This record can contain information suitable for
          use by local site. The exit code and information written
          to the utility <acronym class="ACRONYM">STDOUT</acronym>
          is used by the <var class="LITERAL">lpd</var> server to
          determine if the job is to be printed. This allows job
          quotas to be implemented in a simple way by having the
          <var class="LITERAL">accounting.pl</var> utility query a
          database with the user quotas and reject the job if the
          user's quota is exceeded.</p>

          <p>At the end of the job, the utilitity will read the
          accounting file and use the recorded information to
          update the accounting information. In order to make this
          reliable, the following steps are taken.</p>

          <ol type="1">
            <li>
              <p>The accounting file is read and scanned for the
              last <var class="LITERAL">END</var> record. If there
              is none, then the next step starts at the beginning
              of the accounting file.</p>
            </li>

            <li>
              <p>The file is scanned for <var class=
              "LITERAL">START</var> lines and <var class=
              "LITERAL">pagecounter</var> information determined at
              the start of a job.</p>
            </li>

            <li>
              <p>If the last line in the accounting file does not
              indicate successful completetion of the job and
              contain pagecounting information, then the accounting
              procedure is abandoned until the next job completes
              successfully.</p>
            </li>

            <li>
              <p>If the last line in the accounting file indicates
              successful completion, then its pagecounter value is
              used as the last page counter value.</p>
            </li>

            <li>
              <p>Job information is updated by finding the start
              and end pagecounter values for each job. It is
              possible that a job will not have a pagecounter value
              recorded at its start; in this case the page usage
              will be 0, as it did not even get initialized.</p>
            </li>

            <li>
              <p>After determining the accounting information, the
              procedure will then update and databases and the
              accounting file. During this update, interrupts
              should be disabled and the amount of time taken to
              update the accounting information and/or file should
              be minimized.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Administrators can use this script as a starting point
          for more advanced accounting. For example, rather than
          just recording the information, at the job start the
          script can query either a local database or a remote
          server to see if the user has permissions to access the
          printer. At the end of the job or when an <acronym class=
          "ACRONYM">END</acronym> line is written to the accounting
          file, the local database or remote accounting server can
          be updated.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="RFC1179REF"></a>Chapter 19. RFC 1179 - Line
        Printer Daemon Protocol</h1>

        <p>RFC1179 can be obtained from the <b class=
        "APPLICATION">LPRng</b> distribution, in the
        LPRng_DOC/rfc1179 directory, or from one of many sites
        which mirror the RFCs.</p>

        <p>This RFC is an <span class="emphasis"><i class=
        "EMPHASIS">informational</i></span> RFC, which means that
        the information in it is meant as a guide to users, and not
        as a fixed standard. In addition, the RFC tried to document
        the behavior of the BSD <b class="APPLICATION">lpd</b>
        print server, and left out many details dealing with error
        recover, error messages, extensions to the protocol,
        etc.</p>

        <p>In this section, I will try to explain what RFC1179
        specifies as a protocol, and many of the problems
        encountered in trying to use it.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPDPORT">19.1. Ports and
          Connections</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpd_port=</var><span class=
              "emphasis"><i class="EMPHASIS">Port for <b class=
              "APPLICATION">lpd</b> connections</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">lpd_listen_port=</var><span
              class="emphasis"><i class="EMPHASIS">Port for <b
              class="APPLICATION">lpd</b> to accept
              connection</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">originate_port=</var><span
              class="emphasis"><i class="EMPHASIS">Ports to
              originate connections on</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">reuse_addr</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Set SO_REUSEADDR
              flag on connection</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">retry_econnrefused</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Retry on
              connect ECONNREFUSED error</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">retry_nolink</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Retry on device
              open or connection ffailure</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">unix_socket_path</var> PATH
              <span class="emphasis"><i class="EMPHASIS">UNIX FIFO
              pathname for local connections</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">socket_linger=</var><span
              class="emphasis"><i class="EMPHASIS">socket linger
              timeout</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>RFC1179 requires that the <b class=
          "APPLICATION">lpd</b> server listen for TCP/IP
          connections on port 515. This port is registered with the
          Internet Naming Authority, and the <tt class=
          "FILENAME">/etc/services</tt> file or TCP/IP services
          database usually has an entry:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN9880"></a>
<pre class="SCREEN">
    printer     515/tcp     spooler     # line printer spooler
</pre>
          </div>
          <br>
          <br>

          <p>RFC1179 explicitly states that all connections to port
          515 must originate from ports 721-731. The reason for
          this restriction is due to the UNIX concept of <span
          class="emphasis"><i class="EMPHASIS">reserved</i></span>
          and <span class="emphasis"><i class=
          "EMPHASIS">privileged</i></span> ports. By convention,
          ports in the range 1-1023 can only <span class=
          "emphasis"><i class="EMPHASIS">bound</i></span> by
          processes whose Effective User ID (EUID) is 0 (root).
          This, ordinary users could not originate a connection
          from the reserved or privileged port range.</p>

          <p>In a UNIX environment, this means that the user
          programs <b class="APPLICATION">lpr</b>, <b class=
          "APPLICATION">lpq</b>, <b class="APPLICATION">lprm</b>,
          and <b class="APPLICATION">lpc</b> would have to be
          SETUID root.</p>

          <p>As experience has shown, for security purposes, the
          fewer programs that need to have privileged status, the
          better. <b class="APPLICATION">LPRng</b> uses the <var
          class="LITERAL">lpd_port=printer</var> configuration
          option to set the port for the connections to a <b class=
          "APPLICATION">lpd</b> server. By default, this is port
          515, but can be set to other values. This port value is
          used to make connections to a remote <b class=
          "APPLICATION">lpd</b> server. The <var class=
          "LITERAL">lpd_listen_port=printer</var> configuration
          option can be used to specify a port for the <b class=
          "APPLICATION">lpd</b> to listen for incoming requests. If
          no <var class="LITERAL">lpd_listen_port</var> value is
          specified the <var class="LITERAL">lpd_port</var> value
          will be used as the <b class="APPLICATION">lpd</b>
          listening port.</p>

          <p>The <var class="LITERAL">unix_socket_path</var> option
          specifies the pathname of a UNIX FIFO or socket that can
          be used for connections the <b class=
          "APPLICATION">lpd</b> server if the client and server are
          on the same host. The use of a local FIFO restricts
          connections from outside hosts. The UNIX FIFO path should
          be to a node in a directory that is writable by by the <b
          class="APPLICATION">lpd</b> server and not other
          non-privileged processes.</p>

          <p>The restriction of originating ports to 721-731 causes
          another set of problems. Part of the TCP/IP protocol is
          concerned with avoiding communications problems resulting
          from the arrival of old or <span class="emphasis"><i
          class="EMPHASIS">stale</i></span> packets. When a
          connection between <var class="LITERAL">sourcehost,
          sourceport</var> and <var class="LITERAL">desthost,
          destport</var> is made, a set of sequence numbers is
          established and used for sending and acknowledgement of
          data. When the connection terminates, the TCP/IP protocol
          restricts the establishment of a new connection between
          <var class="LITERAL">sourcehost, sourceport</var> and
          <var class="LITERAL">desthost, destport</var> for a
          period long enough for all <span class="emphasis"><i
          class="EMPHASIS">stale</i></span> packets to be removed
          from the system. This is approximately 10 minutes
          long.</p>

          <p>In order to simplify assignments of ports, timing out
          connections, and other matters, many TCP/IP packages do
          keep track of explicit connections <span class=
          "emphasis"><i class="EMPHASIS">originating</i></span>
          from a port, but simply prevent the port from being
          reused for either origination or reception of a
          connection. They do, however, keep track of the active
          connections <span class="emphasis"><i class=
          "EMPHASIS">to</i></span> a port, and perform timeouts on
          these. This is usually much simpler to implement, as it
          can be done with a list attached to the port.</p>

          <p>This implementation method creates some problems when
          a large number of connections must be originated from a
          relatively small number of port numbers. Observe what
          happens when host 1 tries to send a large number of jobs
          to a server 2. The following connections are established
          and terminated: <var class="LITERAL">host 1, port
          721</var> and <var class="LITERAL">host 2, port 515</var>
          <var class="LITERAL">host 1, port 722</var> and <var
          class="LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 723</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 724</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 725</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 726</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 727</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 728</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 729</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 730</var> and <var class=
          "LITERAL">host 2, port 515</var> <var class=
          "LITERAL">host 1, port 731</var> and <var class=
          "LITERAL">host 2, port 515</var></p>

          <p>Now according to the RFC1179 rules and the TCP/IP
          protocol, we will have to wait until one of these
          connections terminates before we can make another. On the
          originating system, if the TCP/IP implementation does
          timeouts on the originating port, we will have to wait
          for the timeout to elapse before we can make a new
          connection. Unfortunately, there is no way to find out
          what the status of the port is, so we will have to try
          them each in turn until we get a successful
          connection.</p>

          <p>The <b class="APPLICATION">LPRng</b> code has tried to
          provide several methods to deal with these problems.
          Firstly, the <var class="LITERAL">originate_port=512
          1023</var> option specifies the range of ports used to
          originate connections when the software is running either
          as ROOT or SETUID root. By strict RFC1179 rules, this
          should be <var class="LITERAL">originate_port=721
          731</var>, but it turns out that most BSD <b class=
          "APPLICATION">lpd</b> based implementations only check
          for a <span class="emphasis"><i class=
          "EMPHASIS">reserved</i></span> originating port. By using
          512 ports we get a greatly reduced rate of errors due to
          lack of ports due to pending timeouts.</p>

          <p>However, on some systems which are acting as servers
          for a large number of printers even increasing this port
          range is insufficient, and steps need to be taken use the
          originating port numbers more efficiently. The Berkeley
          TCP/IP implementation <code class=
          "FUNCTION">getsockopt()</code> and <code class=
          "FUNCTION">setsockopt()</code> allows the user to
          manipulate some of the underlying timeouts and options of
          the TCP/IP network. When a TCP/IP connection is
          established, the <code class=
          "FUNCTION">setsockopt()</code> facility can be used to
          set the <var class="LITERAL">SO_REUSEADDR</var> flag on
          the connection. This flag effectively sets the timeout
          value on the ports and connections to 0, allowing
          immediate reuse of the ports. When done on an originating
          end of a connection, this will allow the originating port
          number to be reused immediately.</p>

          <p>It would appear that by setting <var class=
          "LITERAL">SO_REUSEADDR</var> on the originating end that
          we have solved our problems. However, unless the
          destination end of the connection sets its <var class=
          "LITERAL">SO_REUSEADDR</var> flag on the connection, it
          will still do a timeout. Thus when we try to make a
          connection from a port that was active within a short
          period of time to the same host, then it will reject the
          connection until the timeout is over.</p>

          <p>The <var class="LITERAL">reuse_addr</var> flag
          (default off) forces the <b class="APPLICATION">LPRng</b>
          software to set the <var class=
          "LITERAL">SO_REUSEADDR</var> flag on originating
          connections. As indicated, this will allow ports to be
          reused immediately for outgoing connections, rather than
          waiting for a timeout.</p>

          <p>While the <var class="LITERAL">reuse_addr</var> flag
          usually allows us to reuse ports, there is still the
          problem of dealing with connections failing due to the
          remote site rejecting the connection due to a pending
          timeout from a previous connection. A careful study of
          the original BSD TCP/IP network code and of some others
          indicates that when a connection fails due to a pending
          timeout, an ECONNREFUSED error code is returned to a
          <code class="FUNCTION">connect()</code> system call. If
          this happens and we suspect that the remote site is
          rejecting the connection due to a timeout problem, then
          we should retry making the connection but from a new
          port, and continue retrying until all possible ports are
          used.</p>

          <p>The <var class="LITERAL">retry_econnrefused</var>
          (default on) flag is used to specify that we retry
          connections in this manner. When this is set, a <var
          class="LITERAL">connection refused</var> error causes the
          connection to be retried using a new port. This will be
          repeated until all available ports have been tried.</p>

          <p>When printing a job and the <b class=
          "APPLICATION">lpd</b> server connection to a remote site
          or device open fails, the <var class=
          "LITERAL">retry_nolink</var> (default on) will cause the
          attempt to be retried indefinitely. The combination of
          <var class="LITERAL">retry_econnrefused</var> and <var
          class="LITERAL">retry_nolink</var> will provide robust
          connection attempts to remote systems.</p>

          <p>While the above problems cause difficulties when
          making connections, there are also problems when
          terminating connections. After closing a socket, the
          TCP/IP software will try to flush any pending data to the
          destination. Unfortunately, on some systems it will only
          do this while the process is active. This has caused
          problems on systems which terminate a process it has
          received an abnormal (signal caused) termination.</p>

          <p>The <code class="FUNCTION">setsockopt()</code>
          SO_LINGER option allows the user to specify that when a
          socket is closed normally, that the process should block
          until pending data is flushed or for the <var class=
          "LITERAL">socket_linger</var> period. If <var class=
          "LITERAL">socket_linger</var> is 0, then no SO_LINGER
          operation is done.</p>

          <p>In summary, if you experience problems with connection
          failures due to port exhaustion, first try setting the
          <var class="LITERAL">reuse_port</var> flag, and you
          should see a reduction. Check to ensure that the <var
          class="LITERAL">retry_econnrefused</var> and <var class=
          "LITERAL">retry_nolink</var> flags are set, and the error
          code in the log and status files. If the failures
          continue, then the problem is caused by the remote end
          having timeout limitations and there is little you can do
          except to set a very long <var class=
          "LITERAL">connect_retry</var> interval, say <var class=
          "LITERAL">connect_retry=120</var> (2 minutes).</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="REMOTESUPPORT">19.2. Protocol
          Requests and Replies</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">remote_support=</var><span
              class="emphasis"><i class="EMPHASIS">Remote
              operations supported</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>After a connection has been established, a request can
          be sent to the <b class="APPLICATION">lpd</b> server. The
          request consists of a single octet indicating the request
          type, followed by the printer (or print queue) name,
          followed by a set of options for the request, followed by
          a LF (line feed) character.</p>

          <div class="TABLE">
            <a name="RF1179COMMANDS"></a>

            <p><b>Table 19-1. RFC1179 Commands</b></p>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>NNN</th>

                  <th>RFC1179</th>

                  <th>Operation</th>

                  <th>program</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>1</td>

                  <td>yes</td>

                  <td>start print</td>

                  <td><b class="APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td>2</td>

                  <td>yes</td>

                  <td>transfer a printer job</td>

                  <td><b class="APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td>3</td>

                  <td>yes</td>

                  <td>print short form of queue status</td>

                  <td><b class="APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td>4</td>

                  <td>yes</td>

                  <td>print long form of queue status</td>

                  <td><b class="APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td>5</td>

                  <td>yes</td>

                  <td>remove jobs</td>

                  <td><b class="APPLICATION">lprm</b></td>
                </tr>

                <tr>
                  <td>6</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>do control operation</td>

                  <td><b class="APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td>7</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>transfer a block format print job</td>

                  <td><b class="APPLICATION">lpr</b></td>
                </tr>

                <tr>
                  <td>8</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>secure command transfer</td>

                  <td><b class="APPLICATION">lpc</b></td>
                </tr>

                <tr>
                  <td>9</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>verbose status information</td>

                  <td><b class="APPLICATION">lpr</b></td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>After the request has been sent, then a reply will be
          returned. In general the reply has the following
          form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10059"></a>
<pre class="SCREEN">
    \000\n    Success
    \NNN\n    Failure (NNN is error code)
    text\n    Text or status information
</pre>
          </div>
          <br>
          <br>

          <p>As can be seen, this protocol is extremely simple, but
          there are a set of problems due to the loosely written
          language of RFC1179.</p>

          <ol type="1">
            <li>
              <p>Firstly, while RFC1179 sets limits on the lengths
              of commands, it does not strictly set limits on the
              characters set used in the commands. This can result
              in problems when trying to print status information,
              headers on banners, and other details.</p>
            </li>

            <li>
              <p>The original RFC1179 protocol did not provide any
              way to do remote control of queues or <b class=
              "APPLICATION">lpd</b> servers. This has been added to
              the protocol. As a side effect, if you try to use <b
              class="APPLICATION">lpc</b> to control a non-<b
              class="APPLICATION">LPRng</b> printer, it will not
              work.</p>
            </li>

            <li>
              <p>You can specify that a network printer is non-<b
              class="APPLICATION">LPRng</b> by using the <var
              class="LITERAL">remote_support=RQVMC</var> option and
              specify the operations supported by the printer. The
              letters R, Q, M, and C stand for <b class=
              "APPLICATION">lpr</b>, <b class=
              "APPLICATION">lpq</b>, <b class=
              "APPLICATION">lprm</b>, and <b class=
              "APPLICATION">lpc</b> operations respectively, and
              indicate that these are supported. If <var class=
              "LITERAL">remote_support</var> does not allow a
              particular operation, then the <b class=
              "APPLICATION">LPRng</b> software will not send a
              corresponding request to the printer. For example,
              <var class="LITERAL">remote_support=R</var> would
              restrict operations to spooling jobs only, and the <b
              class="APPLICATION">LPRng</b> software would not
              query the printer for status.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="JOBTRANSFER">19.3. Job
          Transfer</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">longnumber</var> FLAG <span
              class="emphasis"><i class="EMPHASIS">Long job number
              (6 digits)</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">send_data_first</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Send data
              files first</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">use_shorthost</var><span
              class="emphasis"><i class="EMPHASIS">Use short
              hostname</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>A job transfer operation starts with a job transfer
          request, followed by several file transfer operations. At
          the end of the file transfers, the connection should be
          closed.</p>

          <p>A file transfer request has the form:</p>

          <div class="INFORMALTABLE">
            <a name="AEN10100"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Command</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>\001\n</td>

                  <td>abort</td>
                </tr>

                <tr>
                  <td>\002nnnn cfname</td>

                  <td>control file transfer</td>
                </tr>

                <tr>
                  <td>\003nnnn dfname</td>

                  <td>data file transfer</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>The abort operation is used to terminate job transfer
          and indicate that the job should not be processed for
          printing. The connection will be closed and the partly
          transferred job will be discarded.</p>

          <p>The control file and data file transfer commands have
          a length (in bytes) of the file and the name of the file
          to be transferred. When the command is received, the
          server will reply with a status line:</p>

          <div class="INFORMALTABLE">
            <a name="AEN10118"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Status</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>\000</td>

                  <td>Accepted, proceed</td>
                </tr>

                <tr>
                  <td>\nnn</td>

                  <td>Rejected with error code</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>The reply is only a single octet. Some defective
          implementations of RFC1179 send a LF after the octet,
          which makes life very difficult. <b class=
          "APPLICATION">LPRng</b> makes an effort to detect these
          non-conforming RFC1179 systems and will accept jobs from
          them. However, it will not send jobs to them.</p>

          <p>If <b class="APPLICATION">LPRng</b> sends a reject
          code, as an extension to RFC1179 it also sends an error
          message. Note that the values for error codes are not
          defined, nor are their causes. <b class=
          "APPLICATION">LPRng</b> uses the following values for
          error codes, which appear to be compatible with many, but
          not all, of the BSD <b class="APPLICATION">lpd</b> based
          systems:</p>

          <div class="INFORMALTABLE">
            <a name="AEN10137"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Code</th>

                  <th>Error</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>\000</td>

                  <td>Accepted, proceed</td>
                </tr>

                <tr>
                  <td>\001</td>

                  <td>Queue not accepting jobs</td>
                </tr>

                <tr>
                  <td>\002</td>

                  <td>Queue temporarily full, retry later</td>
                </tr>

                <tr>
                  <td>\003</td>

                  <td>Bad job format, do not retry</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>When the sender gets the reply indicating success, it
          sends the <var class="LITERAL">nnnn</var> bytes of the
          control or data file, followed by a <var class=
          "LITERAL">\000</var> octet. The receiver will then reply
          as above; a single <var class="LITERAL">\000</var> octet
          indicating success.</p>

          <p>The above procedure is carried out until all data
          files and the control file of a job are transferred.</p>

          <p>RFC1179 is silent on the following issues:</p>

          <ol type="1">
            <li>
              <p>When sending a job, do you send the control file
              first, followed by the data file(s), or the data
              files first?</p>
            </li>

            <li>
              <p>When sending multiple jobs, can you send them on a
              single connection, or do you have to establish a new
              connection for each job?</p>
            </li>
          </ol>
          <br>
          <br>

          <p><b class="APPLICATION">LPRng</b> will <span class=
          "emphasis"><i class="EMPHASIS">accept</i></span> jobs
          whether they are sent control or data files first. By
          default, it sends the control file first, followed by the
          data file. If the destination system requires that the
          data files be sent first, the <var class=
          "LITERAL">send_data_first</var> printcap option can be
          used to force data files to be sent first.</p>

          <p>RFC1179 states that: <a name="AEN10172"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>The name of the control file ... should start with
            ASCII "cfA", followed by a three digit job number,
            followed by the host name which has constructed the
            control file.</p>
          </blockquote>
          <br>
          <br>

          <p>The <span class="emphasis"><i class=
          "EMPHASIS">should</i></span> in this wording indicates
          that this is simply a guideline, and that other formats
          are possible. Some of the major problems with this format
          are as follows:</p>

          <ol type="1">
            <li>
              <p>The restriction to 3 digits means that at most
              1000 jobs can be in a queue. Strangely, some systems
              generate far more than 1000 jobs a day, and need to
              archive them on a regular basis. The <var class=
              "LITERAL">longnumber</var> option will allow <b
              class="APPLICATION">LPRng</b> to use a 6 digit job
              number for files in the print queue.</p>
            </li>

            <li>
              <p>The host name format is not specified. Some
              implementations consider that this is the short host
              name, while others think it is the fully qualified
              domain name (FQDN). <b class="APPLICATION">LPRng</b>,
              by default, will use the FQDN host name. However, the
              <var class="LITERAL">use_shorthost</var> option will
              force it to use short host names in control and data
              files.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">cfA</var> control file
              name was modified to allow the job priority to be
              used as the A letter of the control file. By default,
              this is A (lowest, i.e. <var class=
              "LITERAL">cfA</var>) and but can range to Z (highest,
              i.e. <var class="LITERAL">cfZ</var>). All known
              spoolers except <b class="APPLICATION">LPRng</b> seem
              to ignore the actual value of the letter.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10191">19.4. Data File
          Transfer</a></h2>

          <p>As mentioned before a data file is transferred using
          the command below.</p>

          <div class="INFORMALTABLE">
            <a name="AEN10194"></a>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Command</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>\003nnnn dfname</td>

                  <td>data file transfer</td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>

          <p>From RFC1179: <a name="AEN10205"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>The data file may contain any 8 bit values at all.
            The total number of bytes in the stream may be sent as
            the first operand, otherwise the field should be
            cleared to 0. The name of the data file should start
            with ASCII "dfA". This should be followed by a three
            digit job number. The job number should be followed by
            the host name which has constructed the data file.
            Interpretation of the contents of the data file is
            determined by the contents of the corresponding control
            file.</p>
          </blockquote>
          <br>
          <br>

          <p>There are several surprises in RFC1179.</p>

          <ol type="1">
            <li>
              <p>Apparently a job should only consist of a single
              data file. This is a severe limitation, and in fact
              the BSD <b class="APPLICATION">lpr</b> and other
              print spoolers process jobs with multiple data files.
              By convention, these data files have names of the
              form <var class="LITERAL">dfA</var>, <var class=
              "LITERAL">dfB</var>, ... <var class=
              "LITERAL">dfZ</var>, <var class="LITERAL">dfa</var>,
              <var class="LITERAL">dfz</var>.</p>
            </li>

            <li>
              <p>The RFC does not specify that the control file and
              data file job numbers must be identical. Most
              implementations follow this convention, which
              simplifies life tremendously.</p>
            </li>

            <li>
              <p>The RFC does not specify that the control file and
              data file job host names must be identical. Most
              implementations follow this convention, which
              simplifies life tremendously.</p>
            </li>

            <li>
              <p>A zero length data file does not cause a data
              transfer to take place. <b class=
              "APPLICATION">LPRng</b> modifies this action to be
              slightly different. When a zero length data file
              transfer is indicated, all of the input until the
              connection is closed is used as the contents of the
              data file.</p>

              <p>When <span class="emphasis"><i class=
              "EMPHASIS">piping</i></span> into the <b class=
              "APPLICATION">lpr</b> program, this can be very
              useful as it eliminates the need to create temporary
              files on the local host. Note that some print
              spoolers do not use this interpretation, and this
              option should be used carefully.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10227">19.5. Control File
          Contents</a></h2>

          <p>The control file consists of a set of lines which
          either provide printing information or specify data files
          to be printed. The information lines start with upper
          case letters or digits, while the data files lines start
          with lower case letters. Here is a sample control
          file:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10230"></a>
<pre class="SCREEN">
    Hh4.private
    J(stdin)
    CA
    Lpapowell
    Apapowell@h4+955
    Ppapowell
    fdfA955h4.private
    N(stdin)
    UdfA955h4.private
</pre>
          </div>
          <br>
          <br>

          <p>The following are the letters and their meanings in
          the control file.</p>

          <div class="TABLE">
            <a name="CFLINES"></a>

            <p><b>Table 19-2. Control File Lines and
            Purpose</b></p>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>
              <col>

              <thead>
                <tr>
                  <th>Letter</th>

                  <th>Defined</th>

                  <th>Purpose</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>A</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>Identifier for job</td>
                </tr>

                <tr>
                  <td>C</td>

                  <td>RFC1179</td>

                  <td>Class for banner page</td>
                </tr>

                <tr>
                  <td>H</td>

                  <td>RFC1179</td>

                  <td>Host name</td>
                </tr>

                <tr>
                  <td>I</td>

                  <td>RFC1179</td>

                  <td>Indent Printing</td>
                </tr>

                <tr>
                  <td>J</td>

                  <td>RFC1179</td>

                  <td>Job name for banner page</td>
                </tr>

                <tr>
                  <td>L</td>

                  <td>RFC1179</td>

                  <td>Print banner page</td>
                </tr>

                <tr>
                  <td>M</td>

                  <td>RFC1179</td>

                  <td>Mail When Printed</td>
                </tr>

                <tr>
                  <td>N</td>

                  <td>RFC1179</td>

                  <td>Name of source file</td>
                </tr>

                <tr>
                  <td>P</td>

                  <td>RFC1179</td>

                  <td>User identification</td>
                </tr>

                <tr>
                  <td>Q</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>Queue name</td>
                </tr>

                <tr>
                  <td>R</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>Accounting info</td>
                </tr>

                <tr>
                  <td>S</td>

                  <td>RFC1179</td>

                  <td>Symbolic link data</td>
                </tr>

                <tr>
                  <td>T</td>

                  <td>RFC1179</td>

                  <td>Title for pr</td>
                </tr>

                <tr>
                  <td>U</td>

                  <td>RFC1179</td>

                  <td>Unlink data file</td>
                </tr>

                <tr>
                  <td>W</td>

                  <td>RFC1179</td>

                  <td>Width of output</td>
                </tr>

                <tr>
                  <td>Z</td>

                  <td><b class="APPLICATION">LPRng</b></td>

                  <td>Filter options</td>
                </tr>

                <tr>
                  <td>1</td>

                  <td>RFC1179</td>

                  <td>troff R font</td>
                </tr>

                <tr>
                  <td>2</td>

                  <td>RFC1179</td>

                  <td>troff I font</td>
                </tr>

                <tr>
                  <td>3</td>

                  <td>RFC1179</td>

                  <td>troff B font</td>
                </tr>

                <tr>
                  <td>4</td>

                  <td>RFC1179</td>

                  <td>troff S font</td>
                </tr>

                <tr>
                  <td>c</td>

                  <td>RFC1179</td>

                  <td>Plot CIF file</td>
                </tr>

                <tr>
                  <td>d</td>

                  <td>RFC1179</td>

                  <td>Print DVI file</td>
                </tr>

                <tr>
                  <td>f</td>

                  <td>RFC1179</td>

                  <td>Print formatted file</td>
                </tr>

                <tr>
                  <td>g</td>

                  <td>RFC1179</td>

                  <td>Plot file</td>
                </tr>

                <tr>
                  <td>k</td>

                  <td>RFC1179</td>

                  <td>Reserved for use by Kerberized <b class=
                  "APPLICATION">LPRng</b> clients and servers.</td>
                </tr>

                <tr>
                  <td>l</td>

                  <td>RFC1179</td>

                  <td>Print file leaving control characters</td>
                </tr>

                <tr>
                  <td>n</td>

                  <td>RFC1179</td>

                  <td>Print ditroff output file</td>
                </tr>

                <tr>
                  <td>o</td>

                  <td>RFC1179</td>

                  <td>Print Postscript output file</td>
                </tr>

                <tr>
                  <td>p</td>

                  <td>RFC1179</td>

                  <td>Print file with 'pr' format</td>
                </tr>

                <tr>
                  <td>t</td>

                  <td>RFC1179</td>

                  <td>Print troff output file</td>
                </tr>

                <tr>
                  <td>v</td>

                  <td>RFC1179</td>

                  <td>Print raster file</td>
                </tr>

                <tr>
                  <td>z</td>

                  <td>RFC1179</td>

                  <td>Reserved for future use with the Palladium
                  print system.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>The <var class="LITERAL">A</var> (Identifier) line was
          introduced to record a unique system wide job identifier
          for <b class="APPLICATION">LPRng</b> submitted jobs. This
          is basically formed from the user name, job number, and
          host at the time of submission. For example: <var class=
          "LITERAL">papowell@h4+955</var> is job number 995
          submitted by papowell from host h4.</p>

          <p>The <var class="LITERAL">C</var> (Class) line is set
          by the <tt class="COMMAND">lpr -C class</tt> option, and
          the value can be used to control printing. For example,
          the <tt class="COMMAND">lpc class zone</tt> command would
          restrict job printing to only jobs with class <var class=
          "LITERAL">zone</var>.</p>

          <p>The <var class="LITERAL">H</var> (hostname), <var
          class="LITERAL">P</var> (username), and <var class=
          "LITERAL">J</var> (jobname) fields are used to identify
          the host and user which sent the job, and to provide
          information to be displayed by <b class=
          "APPLICATION">lpq</b> when reporting job status.</p>

          <p>The <var class="LITERAL">L</var> (print banner page)
          field is one that has caused many problems for users.
          RFC1179 indicates that its presence causes the banner
          page to be printed, and its absence suppresses banner
          pages. The <tt class="COMMAND">lpr -h</tt> option
          suppresses putting this line into the control file.
          Usually the <var class="LITERAL">L</var> field is a
          duplicate of the <var class="LITERAL">P</var> field.</p>

          <p>The <var class="LITERAL">M</var> (mail information)
          field supplies a mail address for <b class=
          "APPLICATION">LPRng</b> to send mail to when a job is
          completed. See <a href="#JOBCOMPLETION">Job Completion
          Notification Requested</a> for more details.</p>

          <p>The <var class="LITERAL">N</var> (file name) field is
          usually provided to identify the file name corresponding
          to the data file. This can be used to print names on page
          separators, etc. <b class="APPLICATION">LPRng</b> largely
          ignores this line.</p>

          <p>The <var class="LITERAL">I</var> (indent) and <var
          class="LITERAL">W</var> (width) fields are supposed to
          specify a page indent and width for printing. These
          fields are passed to filters if they are present.</p>

          <p>The <var class="LITERAL">Q</var> (queue name) field is
          an <b class="APPLICATION">LPRng</b> extension, and
          contains the name of the print queue the job was
          originally sent to. See <a href="#QQ">qq printcap
          option</a> for details.</p>

          <p>The <var class="LITERAL">R</var> (accounting info)
          field was added by <b class="APPLICATION">LPRng</b> to
          allow a specified account to be billed for job printing.
          The <tt class="COMMAND">lpr -Rname</tt> option can be
          used to specify the accounting name.</p>

          <p>The <var class="LITERAL">S</var> (symbolic link) and
          <var class="LITERAL">U</var> (unlink after printing)
          lines were used by the original BSD <b class=
          "APPLICATION">lpd</b> print system to control how it
          passed files to the print server. <b class=
          "APPLICATION">LPRng</b> ignores these lines. In fact, it
          will remove <var class="LITERAL">S</var> lines and force
          the <var class="LITERAL">U</var> lines to refer only to
          job data files. This closes a nasty security loophole on
          non-<b class="APPLICATION">LPRng</b> print spoolers.</p>

          <p>The <var class="LITERAL">T</var> (pr job title) is
          used with the <tt class="COMMAND">lpr -p</tt> operation
          to supply a banner to the <var class="LITERAL">pr</var>
          program.</p>

          <p>The <var class="LITERAL">Z</var> (filter options)
          value is specified with <tt class="COMMAND">lpr
          -Zoption</tt> and is passed to the data file filters
          during the printing operation. See <a href=
          "#FILTERS">Filters</a> for details on how the this is
          used during the printing process.</p>

          <p>All of the lower case letters are reserved for format
          specifications for data files. In the control file, these
          are followed by the name of the data file to which they
          correspond. While in principle different data files in
          the control file can have different formats, this has not
          been implemented in any known spooling system. See <a
          href="#FILTERS">Filters</a> for details on how the data
          file formats are used during the printing process.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10430">19.6. <b class=
          "APPLICATION">lpq</b> Requests</a></h2>

          <p>The RFC1179 protocol specifies that <b class=
          "APPLICATION">lpq</b> print status requests can be sent
          to the <b class="APPLICATION">lpd</b> server. The lpq
          requests have the format:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10436"></a>
<pre class="SCREEN">
    \003printer [id]* \n    short
    \004printer [id]* \n    long
    \011printer [id]* \n    <b class=
"APPLICATION">LPRng</b> extension- verbose
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> print server will
          then return queue status and close the data
          connection.</p>

          <p>RFC1179 does not state in any manner what the format
          of the queue status should be. Thus, implementors have
          been free to augment or change the status as they like.
          Even the BSD <b class="APPLICATION">lpq</b> status format
          has been changed from different versions.</p>

          <p>See <a href="#LPQ"><b class="APPLICATION">lpq</b> -
          Status Monitoring Program</a> for information on the
          formats returned.</p>

          <p>The <var class="LITERAL">id</var> values are used to
          select the jobs to be displayed. <b class=
          "APPLICATION">LPRng</b> displays any job whose ID,
          hostname, or user name information from the control file
          <var class="LITERAL">A</var>, <var class=
          "LITERAL">H</var>, or <var class="LITERAL">P</var> fields
          match any of the id values.</p>

          <p>Note that since there is no identification of the
          information requestor, then restriction of information is
          almost impossible.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10453">19.7. <b class=
          "APPLICATION">lprm</b> Requests</a></h2>

          <p>The RFC1179 protocol specifies that <b class=
          "APPLICATION">lprm</b> job removal requests can be sent
          to the <b class="APPLICATION">lpd</b> server. The lpq
          requests have the format:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10459"></a>
<pre class="SCREEN">
    \005printer user [id]* \n
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> print server will
          search the specified print queue and remove any job whose
          ID, hostname, or user name information from the control
          file <var class="LITERAL">A</var>, <var class=
          "LITERAL">H</var>, or <var class="LITERAL">P</var> fields
          match any of the id values and for which the user has
          permission to perform a removal operation. See <a href=
          "#PERMSREF">Permissions and Authentication</a> for
          details.</p>

          <p>Most RFC1179 compatible spoolers use the user
          information in the request as the name of the user which
          spooled the job. However, in a network environment this
          is extremely easy to fabricate, and is at best a weak
          type of authentication.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LPCREREAD">19.8. LPC
          Requests</a></h2>

          <p><b class="APPLICATION">LPRng</b> has extended the
          RFC1179 protocol to allow queue and printer control
          commands to be sent to the <b class="APPLICATION">lpd</b>
          server. The format of these commands are:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10474"></a>
<pre class="SCREEN">
    \006printer user key [options]
</pre>
          </div>
          <br>
          <br>

          <p>The following commands are supported.</p>

          <div class="TABLE">
            <a name="LPCCOMMANDS"></a>

            <p><b>Table 19-3. LPC Commands</b></p>

            <table border="1" frame="border" rules="all" class=
            "CALSTABLE">
              <col>
              <col>

              <thead>
                <tr>
                  <th>Command</th>

                  <th>Operation</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>Command</td>

                  <td>Operation</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">active
                  [printer[@host]]</var></td>

                  <td>check to see if server accepting
                  connections</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">abort (printer[@host] |
                  all)</var> </td>

                  <td>terminate server process printing job</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">disable (printer[@host]
                  | all)</var> </td>

                  <td>disable queueing</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">debug (printer[@host] |
                  all) debugparms</var> </td>

                  <td>set debug level for printer</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">enable (printer[@host] |
                  all)</var> </td>

                  <td>enable queueing</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">hold (printer[@host] |
                  all) (name[@host] | job | all)*</var> </td>

                  <td>hold job</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">holdall (printer[@host]
                  | all)</var> </td>

                  <td>hold all jobs on</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">kill (printer[@host] |
                  all)</var> </td>

                  <td>stop and restart server</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">lpd
                  [printer[@host]]</var> </td>

                  <td>get <b class="APPLICATION">lpd</b> PID for
                  server</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">lpq (printer[@host] |
                  all) (name[@host] | job | all)*</var> </td>

                  <td>invoke <b class="APPLICATION">lpq</b></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">lprm (printer[@host] |
                  all) (name[@host]|host|job| all)*</var> </td>

                  <td>invoke <b class="APPLICATION">lprm</b></td>
                </tr>

                <tr>
                  <td><var class="LITERAL">move printer
                  (user|jobid)* target</var> </td>

                  <td>move jobs to new queue</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">noholdall
                  (printer[@host] | all)</var> </td>

                  <td>hold all jobs off</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">printcap (printer[@host]
                  | all)</var> </td>

                  <td>report printcap values</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">quit</var> </td>

                  <td>exit LPC</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">redirect (printer[@host]
                  | all) (printer@host | off )*</var> </td>

                  <td>redirect jobs</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">release (printer[@host]
                  | all) (name[@host] | job | all)*</var> </td>

                  <td>release job</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">reread
                  [printer[@host]]</var></td>

                  <td><b class="APPLICATION">lpd</b> reread
                  database information</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">start (printer[@host] |
                  all)</var> </td>

                  <td>start printing</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">status (printer[@host] |
                  all)</var> </td>

                  <td>status of printers</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">stop (printer[@host] |
                  all)</var> </td>

                  <td>stop printing</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">topq (printer[@host] |
                  all) (name[@host] | job | all)*</var> </td>

                  <td>reorder job</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">defaultq</var> </td>

                  <td>default queue for <b class=
                  "APPLICATION">lpd</b> server</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">local (printer |
                  all)</var> </td>

                  <td>client printcap and configuration
                  information</td>
                </tr>

                <tr>
                  <td><var class="LITERAL">server (printer |
                  all)</var> </td>

                  <td>server printcap and configuration
                  information</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>Many of these commands support extremely specialized
          operations for print queue management, However, the
          following are the most commonly used and are supported by
          the BSD <b class="APPLICATION">lpd</b> print spooling
          system as well:</p>

          <ul>
            <li>
              <p><var class="LITERAL">start, stop, enable,
              disable</var> Start and stop will start and stop
              printing for a specified queue. Enable and disable
              enable and disable sending and/or accepting jobs for
              the queue.</p>
            </li>

            <li>
              <p><var class="LITERAL">abort, kill</var> Abort will
              cause the process doing the actual job printing to be
              terminated. Kill does an abort, and then restarts the
              printing process. These commands are used to restart
              a queue printing after some disaster.</p>
            </li>

            <li>
              <p><var class="LITERAL">topq</var> Places selected
              jobs at the top of the print queue.</p>
            </li>

            <li>
              <p><var class="LITERAL">status</var> Shows a status
              display of the print spools on the server.</p>
            </li>
          </ul>
          <br>
          <br>

          <p>The following commands are extensions to the basic set
          provided by the BSD <b class="APPLICATION">lpd</b>
          system.</p>

          <ul>
            <li>
              <p><var class="LITERAL">lpq, lprm</var> Invokes the
              lpq or lprm program from lpc. Useful when in the
              interactive mode.</p>
            </li>

            <li>
              <p><var class="LITERAL">hold, holdall, release</var>
              The hold command will cause the selected jobs to be
              held until released. The holdall jobs sets all jobs
              submitted to the queue to be held until released. The
              release command releases jobs for printing. If a job
              has had an error and is in the error state, the
              release command will cause it to be reprinted.</p>
            </li>

            <li>
              <p><var class="LITERAL">move, redirect</var> The move
              command will move selected jobs to the specified
              spool queue. The redirect command sends all jobs
              submitted to the queue to be sent to the specified
              queue.</p>
            </li>

            <li>
              <p><var class="LITERAL">active, lpd, reread</var> The
              active command will connect to the server for the
              printer. This is used to check to see if non-<b
              class="APPLICATION">LPRng</b> print servers are
              active. The lpd command will connect to the server
              and get the process id (PID) of the <b class=
              "APPLICATION">lpd</b> server. The reread command
              causes a SIGHUP signal to be sent to the lpd process,
              causing it to reread the <tt class=
              "FILENAME">lpd.conf</tt>, <tt class=
              "FILENAME">printcap</tt>, and <tt class=
              "FILENAME">lpd.perms</tt> files. This is done when
              configuration information has been modified and the
              administrator wants to have the server use the new
              information.</p>
            </li>

            <li>
              <p><var class="LITERAL">debug</var> This is a
              desperation facility for developers that allows
              dynamic enabling of debug information generation. Not
              normally used in general operation.</p>
            </li>

            <li>
              <p><var class="LITERAL">local, server</var> These
              commands will print out the configuration information
              in the local <tt class="FILENAME">lpd.conf</tt> file,
              as well as the printcap information for the specified
              printers; <var class="LITERAL">client</var> prints
              what the <b class="APPLICATION">LPRng</b> clients
              (<var class="LITERAL">lpr, lpq, ...</var>) would use
              while <var class="LITERAL">server</var> prints what
              the <b class="APPLICATION">LPRng</b> server (<b
              class="APPLICATION">lpd</b>) would use if running on
              this host. This is an extremely useful diagnostic
              tool for administrators. Not normally used in general
              operation.</p>
            </li>
          </ul>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="SENDBLOCKFORMAT">19.9. Block
          Job Transfer</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class="LITERAL">send_block_format</var> FLAG
              <span class="emphasis"><i class="EMPHASIS">Transfer
              job as a block</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>In normal job transfer operations, the sender and
          receiver have a handshake interaction in order to
          transfer a print job. Each file is sent individually. The
          <var class="LITERAL">send_block_format</var> option
          forces a Block Job Transfer operation. This causes the
          sender to transfer a single file containing all the job
          printing information, including control file and data
          files.</p>

          <p>The transfer command line has the form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10652"></a>
<pre class="SCREEN">
    \007printer size\n
</pre>
          </div>
          <br>
          <br>

          <p>The receiver will return any acknowledgement of a
          single 0 octet, and then the size bytes of the job will
          be transferred by the sender. At the end of the transfer
          a single 0 octet is added, and the receiver will indicate
          success by returning a single 0 octet. Any other value
          returned by the receiver indicates an error
          condition.</p>

          <p>The file transferred by the sender is simply the
          command lines that it would have normally sent for job
          transfer, followed by the control or data file
          values.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10656">19.10. Authenticated
          Transfer</a></h2>

          <p>RFC1179 does not provide any authentication or
          encryption mechanism for the transfer of jobs or commands
          to the <b class="APPLICATION">lpd</b> print server. The
          Authenticated Transfer operation was added to allow an
          encrypted or authenticated transfer of print jobs or
          commands.</p>

          <p>Since there are various restrictions on the
          incorporation of authentication facilities into programs,
          <b class="APPLICATION">LPRng</b> supports authentication
          by providing a simple interface to encryption
          programs.</p>

          <p>The idea is that when authentication is required when
          sending a job, <b class="APPLICATION">LPRng</b> will
          generate a block transfer job as described for the <a
          href="#SENDBLOCKFORMAT">Block Job Transfer</a> operation,
          and then invoke a set of programs to encryt and transfer
          the file, and encrypt and transfer the returned
          status.</p>

          <p>Similarly, when sending a command, the command
          information will be placed in a file and the encrypted
          file will be transferred.</p>

          <p>This technique means that the programs and support to
          do encryption are external to <b class=
          "APPLICATION">LPRng</b>, and can use any type of method
          that they choose to implement the secure and/or
          authenticated transfer.</p>

          <p>See <a href="#AUTHREF">Authentication and
          Encryption</a> for details on the authentication
          interface.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="FAQ"></a>Chapter 20. The Most Frequently Asked
        Questions</h1>

        <p>In this section, the Most Frequently Asked Questions
        have been placed, together with their answers. You may
        notice that some questions have the same answer, but the
        symptoms appear differently.</p>

        <p>Some of these answers will reference other material in
        this FAQ, or the <b class="APPLICATION">LPRng</b> man
        pages.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10675">20.1. Why do I get
          malformed from address errors?</a></h2>

          <p>This is the number one question asked by most <b
          class="APPLICATION">LPRng</b> users who try to use <b
          class="APPLICATION">LPRng</b> with network printers or
          other systems supporting <a href="#RFC1179">RFC1179</a>
          printing. For details about <b class=
          "APPLICATION">LPRng</b> and RFC1179, see <a href=
          "#RFC1179REF">RFC1179 and <b class=
          "APPLICATION">LPRng</b></a>.</p>

          <p>The <var class="LITERAL">malformed from address</var>
          error is usually reported when trying to send a print job
          from <b class="APPLICATION">LPRng</b> to other BSD <b
          class="APPLICATION">lpr</b> or RFC1179 <b class=
          "APPLICATION">lpr</b> implementations, or with network
          connected printers that have a built in <b class=
          "APPLICATION">lpd</b> server. This is due to the
          following RFC1179 rule: <a name="AEN10690"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>Servers originate a connection from ports in the
            range 721-731.</p>
          </blockquote>
          <br>
          <br>

          <p>WHY? These are a subset of the 'reserved' ports in
          UNIX, and normal users cannot open connections from them.
          This provides a small amount of security from UNIX users
          on the host 'spoofing' a server.</p>

          <p>IMPLICATION: in order to do use a reserved port, the
          program must have root privileges. This means the LPR, <b
          class="APPLICATION">lpd</b>, <b class=
          "APPLICATION">lpq</b>, etc., programs must be installed
          SUID root. This can open up a can of worms with regard to
          security, but <b class="APPLICATION">LPRng</b> has been
          designed to take as much paranoid care as possible to
          avoid problems.</p>

          <p>WHAT TO DO: When installing <b class=
          "APPLICATION">LPRng</b> you will need to install the
          executables SUID root. In the <tt class=
          "FILENAME">src/Makefile</tt>, you can remove the comment
          from the line</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10700"></a>
<pre class="SCREEN">
    PERMS=SUID_ROOT_PERMS
</pre>
          </div>
          and then do <var class="LITERAL">make install</var>. This
          will install the executables SUID, and owned by root.<br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10703">20.2. It was working
          normally, then I get connection refused errors</a></h2>

          <p>This message usually appears when you have been
          sending a large number of jobs to a network printer or a
          remote system. The reason for this is a combination the
          above port 721-731 restriction and the TCP/IP timeouts.
          For details, see <a href="#RFC1179REF">RFC1179 and <b
          class="APPLICATION">LPRng</b></a>, but here is a quick
          explanation.</p>

          <p>A TCP/IP connection is usually specified as between
          <var class="LITERAL">srchost:srcport,
          desthost:destport</var>, although in practice the order
          of source (src) and destination (dest) is not
          important.</p>

          <p>When a connection is established, each end of the
          connection exchanges the necessary flow control and error
          control information. When a connection is terminated,
          each end of the connection will not accept another
          connection from the same <var class=
          "LITERAL">host:port</var> that was previously active for
          a specified timeout period, usually 10 minutes.</p>

          <p>Some TCP/IP implementations go further: they will not
          allow <acronym class="ACRONYM">ANY</acronym> connection
          to be <span class="emphasis"><i class=
          "EMPHASIS">originated</i></span> (via the <code class=
          "FUNCTION">bind()</code> system call or API) from a port
          that was active, or accepted on a port that was active
          for this timeout period.</p>

          <p>Now let us see what happens when we have a client
          program, which must originate a connection on port
          721-731, connect to the server, which waits for a
          connection on port 515. We first try to make a connection
          from host:port <var class="LITERAL">1.1.1.1:721</var> to
          <var class="LITERAL">1.1.1.2:515</var>. The first time
          that we make the connection (or the first connection) we
          succeed. We can transfer a file, etc., and then close the
          connection. When we try to reconnect from <var class=
          "LITERAL">1.1.1.1:721</var> to <var class=
          "LITERAL">1.1.1.2:515</var> we get an error such as
          "address already in use" or "connection refused".</p>

          <p>Luckily, we can use port 722 to originate a
          connection, and we can connect from <var class=
          "LITERAL">1.1.1.1:722</var> to <var class=
          "LITERAL">1.1.1.2:515</var>. We continue on, until we
          come to port 731, and then we need to wait for our
          timeouts.</p>

          <p>SOLUTION:</p>

          <p>It appears that most RFC1179 implementations do not
          check for the exact port range 721-731, but only that the
          connection originates from a reserved port, i.e. - in the
          range 1-1023. You can extend the range of ports used by
          <b class="APPLICATION">LPRng</b> by changing the</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10727"></a>
<pre class="SCREEN">
    originate_port=721 731
</pre>
          </div>
          value in the defaults (<tt class=
          "FILENAME">LPRng/src/common/defaults.c</tt>) file or in
          the <tt class="FILENAME">lpd.conf</tt> file. I recommend
          the following: 

          <div class="INFORMALEXAMPLE">
            <a name="AEN10731"></a>
<pre class="SCREEN">
    originate_port=512 1022
</pre>
          </div>
          This is, in fact, now the default in <b class=
          "APPLICATION">LPRng</b> software. If you get the infamous
          <var class="LITERAL">malformed from address</var> error
          message from your spooler, then you will have to set
          originate_port=721 731, and live with a delayed
          throughput.<br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10735">20.3. Job is not in
          print queue, but it gets printed!</a></h2>

          <p>In the original BSD <b class="APPLICATION">lpd</b>
          implementation, the <b class="APPLICATION">lpr</b>
          program copied users files to a special spool queue
          directory, and then caused the <b class=
          "APPLICATION">lpd</b> server to peek in the directory and
          print the files.</p>

          <p>This type of operation required spool directory space,
          special SETUID programs, and a slew of headaches in
          system security and management.</p>

          <p>The LPR, <b class="APPLICATION">lpq</b>, and other
          user programs in the <b class="APPLICATION">LPRng</b>
          suite use TCP/IP connections and transfer jobs directly
          to a <b class="APPLICATION">lpd</b> server running on a
          remote host, or even the local host if appropriate. Note
          that this type of operation does not require a <b class=
          "APPLICATION">lpd</b> server to run on each local
          machine. In fact, you can have a single host system
          performing all of your printing. This type of operation
          is very similar to a central mail server versus
          individual systems, each having their own mail server and
          queues.</p>

          <p>However, some users require or want their jobs to be
          spooled on the local host system, and then transferred to
          the remote printer. This is usually the case when some
          type of processing (filtering) is needed in order to
          print the job correctly. There are several methods that
          can be used to force this.</p>

          <p>Method 1: Explicit Printer Address</p>

          <p>You can force a job to be sent directly to the <var
          class="LITERAL">pr</var> serviced by the <b class=
          "APPLICATION">lpd</b> server on <var class=
          "LITERAL">host</var> by using the form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10753"></a>
<pre class="SCREEN">
    lpr -Ppr@host file
</pre>
          </div>
          <br>
          <br>

          <p>You can also set the <acronym class=
          "ACRONYM">PRINTER</acronym> environment variable to a
          similar form, and get the same effect:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10757"></a>
<pre class="SCREEN">
    PRINTER=pr@host; export PRINTER;
    lpr file
</pre>
          </div>
          <br>
          <br>

          <p>Method 2: User and Server Printcap Entries</p>

          <p>If you want to have the benefits of a printcap file,
          i.e. - you can use aliases or abbreviations for the names
          of printers, then here is a couple of hints. First, the
          <b class="APPLICATION">LPRng</b> software scans the <tt
          class="FILENAME">printcap</tt> file for printcap entries,
          combining information for the same printer into a single
          entry. Information found later in the printcap file will
          override earlier information. In addition, you can tag
          entries as either being used for all utilities or just
          for the <b class="APPLICATION">lpd</b> server. Here are a
          couple of examples:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10764"></a>
<pre class="SCREEN">
    # for all utilities
    pr:lp=pr@host
    # just for lpd
    pr:server
      :lp=/dev/lp
    # more information
    pr:check_for_nonprintable@
    # --- final result for LPR
    pr:lp=pr@host:check_for_nonprintable@
    # --- final result for lpd
    pr:lp=/dev/lp:check_for_nonprintable@
</pre>
          </div>
          <br>
          <br>

          <p>As you can see, the <var class="LITERAL">server</var>
          keyword indicates that the printcap entry is only for the
          server. The <b class="APPLICATION">lpr</b> utility will
          send the job to the host, while the <b class=
          "APPLICATION">lpd</b> server will print it on <tt class=
          "FILENAME">/dev/lp</tt>.</p>

          <p>Note that the <var class="LITERAL">lp=...</var>
          information overrides the <var class="LITERAL">:rp:</var>
          (remote printer) and <var class="LITERAL">:rm:</var>
          (remote machine) fields if they are present.</p>

          <p>Method 3: Force sending to server on <var class=
          "LITERAL">localhost</var></p>

          <p>The <var class="LITERAL">force_localhost</var>
          printcap or configuration flag forces non-<b class=
          "APPLICATION">lpd</b> applications to send all requests
          and print jobs to the server running on the local
          host.</p>

          <p>This method is similar to the previous one, but has
          the benefit that it can be configured as a global (i.e. -
          applies to all printers) rather than printer specific.
          You can put this in the <tt class=
          "FILENAME">lpd.conf</tt> file for general application, or
          have a printcap entry of the following form:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10782"></a>
<pre class="SCREEN">
    # for all utilities
    pr:lp=pr@host:force_localhost
</pre>
          </div>
          <br>
          <br>

          <p>The <b class="APPLICATION">lpd</b> server will ignore
          the <var class="LITERAL">force_localhost</var> flag, and
          send jobs to the <var class="LITERAL">pr</var> queue on
          the <var class="LITERAL">host</var> machine. However, the
          LPR, <b class="APPLICATION">lpq</b>, etc., utilities will
          send their requests to the server running on the local
          host.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10790">20.4. Job disappears
          and is never printed, but lpr works</a></h2>

          <p>This is a rather disconcerting problem, and usually
          occurs when sending jobs to either a network printer or a
          nonconforming <a href="#RFC1179">RFC1179</a> print
          spooler. For details about <b class=
          "APPLICATION">LPRng</b> and RFC1179, see <a href=
          "#RFC1179REF">RFC1179 and <b class=
          "APPLICATION">LPRng</b></a>, but here is a quick
          explanation.</p>

          <p>An <b class="APPLICATION">lpd</b> job consists of a
          control file, which contains information about the job,
          and one or more data files. RFC1179 is silent on the
          order that jobs are sent; however some implementations
          REQUIRE that the data files be sent first, followed by
          the control file.</p>

          <p>SOLUTION:</p>

          <p>Set the <var class="LITERAL">send_data_first</var>
          flag in the printcap for the particular printer, or in
          the <tt class="FILENAME">lpd.conf</tt> configuration
          file. This is:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10803"></a>
<pre class="SCREEN">
    :send_data_first:  (printcap)
    send_data_first    (lpd.conf)
</pre>
          </div>
          <br>
          <br>

          <p>Note that some printers/servers INSIST on the control
          file first; You can clear the flag using <var class=
          "LITERAL">send_job_first@</var> if you need to.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10807">20.5. I get messages
          about bad control file format</a></h2>

          <p>RFC1179 describes a set of fields that MAY appear in
          the control file. It is silent if other ones can appear
          as well. Unfortunately, some implementations will reject
          jobs unless they contain ONLY fields from a very small
          set. In addition, RFC1179 is silent about the ORDER the
          fields can appear.</p>

          <p><b class="APPLICATION">LPRng</b> quite happily will
          accept jobs from poor or nonconforming RFC1179 spooler
          programs, and fix them up to be conformant.</p>

          <p>If you are sending jobs to one of a non-conforming
          spooler, you can force <b class="APPLICATION">LPRng</b>
          to send jobs with only the fields described in RFC1179 by
          setting the the <var class="LITERAL">:bk:</var>
          (BacKwards compatible) flag in the printcap for your
          printer.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="RFC1179">20.6. What is RFC
          1179, the Line Printer Daemon Protocol?</a></h2>

          <p>RFC1179 defines a standard method by which print jobs
          can be transferred using the TCP/IP protocol between
          hosts. The standard was developed by simply detailing the
          way that a version of the BSD <b class=
          "APPLICATION">lpd</b> software did its job.</p>

          <p>From the RFC Introduction: <a name="AEN10820"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>RFC 1179 describes a print server protocol widely
            used on the Internet for communicating between line
            printer daemons (both clients and servers). RFC1179 is
            for informational purposes only, and does not specify
            an Internet standard.</p>
          </blockquote>
          <br>
          <br>

          <p>Having said this, the RFC then goes on to describe the
          protocol used by a particular implementation of <b class=
          "APPLICATION">lpd</b>. The problem was that the RFC did
          not provide any way to put extensions to the operations
          into the system, and failed to specify such interesting
          details as the order in which print jobs and their
          components could be transferred.</p>

          <p>Comment by Patrick Powell <var class=
          "LITERAL">&lt;papowell@lprng.com&gt;</var> : <a name=
          "AEN10826"></a></p>

          <blockquote class="BLOCKQUOTE">
            <p>Since 1988, there have been a large number of print
            spooling systems developed which claim RFC1179
            conformance, but which are mutually incompatible.</p>

            <p>Rather than live with the limited capabilities of
            the RFC1179 standard, <b class="APPLICATION">LPRng</b>
            has extended them by adding capabilities to perform
            remote control of print spoolers, encrypted and
            authenticated data transfers, and other operations
            missing from the RFC1179 specification. However, great
            effort was made to be backwards compatible with older
            and other <b class="APPLICATION">lpd</b> based
            systems.</p>

            <p><b class="APPLICATION">LPRng</b> was developed in
            order to be able to both accept and provide
            interactions with these systems. It does so by allowing
            various options to be used to <span class="emphasis"><i
            class="EMPHASIS">tune</i></span> how print jobs would
            be exchanged. Currently, <b class=
            "APPLICATION">LPRng</b> can be configured to send and
            receive print jobs between a vast number of the
            existing spooling systems. It is flexible enough to act
            as a gateway between non-compatible systems, and has
            provisions to transform jobs from one format to another
            in a dynamic manner.</p>
          </blockquote>
          <br>
          <br>

          <p>For a detailed explanation about <b class=
          "APPLICATION">LPRng</b> and RFC1179, see <a href=
          "#RFC1179REF">RFC1179 and <b class=
          "APPLICATION">LPRng</b></a>.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10839">20.7. I want to
          replace lp, lpstat, etc, but my programs need
          them</a></h2>

          <p><b class="APPLICATION">LPRng</b> was designed as a
          replacement the BSD printing system. As such, it
          inherited its command names and options from the latter.
          As you might know, SystemV uses a totally different set
          of commands, incompatible with the BSD ones.</p>

          <p>The good news is that the <b class=
          "APPLICATION">LPRng</b> binaries include an emulation for
          the SystemV commands. (See <a href="#LPSIMULATION">lp
          Simulation</a> for details. Briefly, you create links to
          the appropriate programs, and invoke them by the link
          names. <span class="emphasis"><i class=
          "EMPHASIS">Actually, these links are installed by default
          in recent versions.</i></span></p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10848"></a>
<pre class="SCREEN">
    ln -s lpr lp
    ln -s lpq lpstat
    ln -s lprm cancel
</pre>
          </div>
          <br>
          <br>

          <p>If you make these links, calling <var class=
          "LITERAL">lp</var>, <var class="LITERAL">lpstat</var> and
          <var class="LITERAL">cancel</var> will give you a
          (partial) SVR4 emulation. They have their own man pages,
          which you should read if you need the emulation.</p>

          <p>Since it is a <span class="emphasis"><i class=
          "EMPHASIS">partial</i></span> emulation, you shouldn't
          expect everything to work. In particular, I would guess
          that any script which relies on the output format of one
          of your system binaries will break. Again, see <a href=
          "#LPSIMULATION">lp Simulation</a> for more details or
          additional suggestions.</p>
        </div>
      </div>

      <div class="CHAPTER">
        <hr>

        <h1><a name="REMOTELOGGER"></a>Chapter 21. Remote Logger
        Operation</h1>

        <p>Several sites have wanted a way to provide central
        logging of job status and/or information. In order to do
        this, the following functionality is implemented in <b
        class="APPLICATION">LPRng</b>.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="LOGGER">21.1. Logger Network
          Communication</a></h2>

          <p>Options used:</p>

          <ul>
            <li>
              <p><var class=
              "LITERAL">logger_destination=</var><span class=
              "emphasis"><i class="EMPHASIS">logger information
              destination</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">logger_pathname=</var><span
              class="emphasis"><i class="EMPHASIS">pathname of temp
              file for log information</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">logger_max_size=</var><span
              class="emphasis"><i class="EMPHASIS">max size in K of
              temp file for log information</i></span></p>
            </li>

            <li>
              <p><var class="LITERAL">logger_timeout=</var><span
              class="emphasis"><i class="EMPHASIS">time between
              connection attempts</i></span></p>
            </li>
          </ul>
          <br>
          <br>

          <p>The printcap/configuration variable <var class=
          "LITERAL">logger_destination</var> specifies a
          destination in the standard <var class=
          "LITERAL">host%port</var> notation used by <b class=
          "APPLICATION">LPRng</b>. Host is the destination host,
          and can be a name or IP address. Port is the port on the
          destination host. A TCP/IP connection is made to the
          indicated port.</p>

          <p>Log information is save in a temporary file specified
          by <var class="LITERAL">logger_path</var>, and up to <var
          class="LITERAL">logger_max_size</var> K bytes of data
          will be saved.</p>

          <p>If a connection cannot be made to the <var class=
          "LITERAL">logger_destination</var>, then every <var
          class="LITERAL">logger_timeout</var> seconds a new
          connection attempt will be made. If <var class=
          "LITERAL">logger_timeout</var> is 0, then a connection
          attempt will be made every time new data arrives to be
          logged.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10892">21.2. Logger
          Messages</a></h2>

          <p>Log messages consist of a single line terminated with
          a newline (<var class="LITERAL">\n</var>) character.</p>

          <p>Each log message reports a system event or status
          change of the LPD server. When the connection is first
          established, a complete dump of the status of the LPD
          server is sent. After this, only status update messages
          are sent. The remote monitor can force a status dump by
          simply closing and reopening the connection.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10897">21.3. Message
          Format</a></h2>

          <p>Each message is encoded as a URI escaped string. That
          is, non-alphanumeric characters are encoded as the 3
          character sequence <var class="LITERAL">%xx</var>, where
          <var class="LITERAL">xx</var> is the hexadecimal value of
          the character. The message has the format <var class=
          "LITERAL">key=value</var>, where <var class=
          "LITERAL">key</var> indicates the message type. For
          example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10904"></a>
<pre class="SCREEN">
    dump=host=h4.private%0aprinter=t1%0aprocess=1613%0a
    update_time=1999-03-23-20:32:17.148%0a\
    value=queue=holdall 0%25250aprinting_aborted=0x0%25250a\
    printing_disabled=0x0%25250aspooling_disabled=\
    0x0%25250a%250a%0a
</pre>
          </div>
          <br>
          <br>

          <p>The following keys are used:</p>

          <ol type="1">
            <li>
              <p>dump A status dump of the current contents of a
              print queue.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Each message has a set of headers and a value. For
          example, the decoded dump message from the previous
          section would be:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10911"></a>
<pre class="SCREEN">
    host=h4.private
    printer=t1
    process=1613
    update_time=1999-03-23-20:32:17.148
    value=queue=holdall 0%250aprinting_aborted=0x0%250a\
    printing_disabled=0x0%250aspooling_disabled=0x0%250a%0a
</pre>
          </div>
          <br>
          <br>

          <p>Each line consists of a key and a value. The <var
          class="LITERAL">host</var> key indicates the host name,
          <var class="LITERAL">printer</var> is the print queue,
          <var class="LITERAL">process</var> is the process which
          generated the report or action, <var class=
          "LITERAL">update_time</var> is the time at which the
          report was generated, and <var class=
          "LITERAL">value</var> is the value of the report.</p>

          <p>The decoded <var class="LITERAL">value</var> of the
          above report is:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10921"></a>
<pre class="SCREEN">
    queue='holdall 0%0aprinting_aborted=0x0%0aprinting_disabled=0x0%0a\
    spooling_disabled=0x0%0a
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">queue</var> key provides the
          current value of the queue control file.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10925">21.4. Dump
          Messages</a></h2>

          <p>Dump messages are generated at the start of
          operations, and consist of a list of queue status
          messages.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10928">21.5. LPD
          Messages</a></h2>

          <p>These are used to indicate LPD startup or change in
          operation.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10931"></a>
<pre class="SCREEN">
    Decode: lpd=host=h4.private%0aprocess=1672%0aupdate_time=1999-03-23-20:5
    1:10.507%0avalue=Starting%0a
    host=h4.private
    process=1672
    update_time=1999-03-23-20:51:10.507
    value=Starting
    lpd: 'Starting'
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10933">21.6. Job Status
          Messages - UPDATE</a></h2>

          <p>Update messages are used to report changes in the
          queue contents, such as job arrival.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10936"></a>
<pre class="SCREEN">
    Decode: update=host=h4.private%0aidentifier=papowell@h4+676%0anumber=
     ...
    host=h4.private
    identifier=papowell@h4+676
    number=676
    printer=t1
    process=1677
    update_time=1999-03-23-20:51:17.197
    value=bnrname=papowell%0acf_esc_image=Apapowell@h4+676%250aCA%250aD1999-03-
      ...
</pre>
          </div>
          <br>
          <br>

          <p>This update message reports the arrival of a new job
          at the queue. The <var class="LITERAL">value</var> field
          reports the control file contents:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10940"></a>
<pre class="SCREEN">
    cf_esc_image=Apapowell@h4+676%0aCA%0aD1999-03-23-20:51:17.151%0aHh4.as
       tart.com%0aJ/tmp/hi%0aLpapowell%0aPpapowell%0aQt1%0aN/tmp/hi%0afdfA676h4.as
       tart.com%0aUdfA676h4.private%0a
    class=A
    date=1999-03-23-20:51:17.151
    file_hostname=h4.private
    fromhost=h4.private
    held=0x0
    hf_name=/var/tmp/LPD/t1/hfA676
    hold_class=0x0
    hold_time=0x0
    identifier=papowell@h4+676
    job_time=0x36f86f45
    jobname=/tmp/hi
    logname=papowell
    number=676
    priority=A
    queuename=t1
    size=3
    transfername=cfA676h4.private
    update_time=1999-03-23-20:51:17.187
</pre>
          </div>
          <br>
          <br>

          <p>The <var class="LITERAL">update_time</var> field in
          the section above is the time that the job information
          was last updated. The <var class=
          "LITERAL">cf_esc_image</var> value is the URL escaped
          control file information.</p>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN10945">21.7. Printer Status
          Messages - PRSTATUS</a></h2>

          <p>These messages report printing or other activity
          related to a job.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN10948"></a>
<pre class="SCREEN">
    Decode: prstatus=host=h4.private%0aidentifier=papowell@h4+676%0anumber=
    676%0aprinter=t1%0aprocess=1692%0aupdate_time=1999-03-23-21:02:04.855%0avalue=
    finished 'papowell@h4+676'%252c status 'JSUCC'%0a
    
    host=h4.private
    identifier=papowell@h4+676
    number=676
    printer=t1
    process=1692
    update_time=1999-03-23-21:02:04.855
    value=finished 'papowell@h4+676'%2c status 'JSUCC'
    PRSTATUS: 'finished 'papowell@h4+676', status 'JSUCC''
</pre>
          </div>
          <br>
          <br>
        </div>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="OPTIONINDEX"></a>Appendix A. Index To All The
        Configuration and Printcap Options</h1>

        <div class="TABLE">
          <a name="LPRNGOPTIONS"></a>

          <p><b>Table A-1. LPRng Options</b></p>

          <table border="1" frame="border" rules="all" class=
          "CALSTABLE">
            <col>
            <col>

            <thead>
              <tr>
                <th>Option</th>

                <th>Purpose or Value</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td><a href="#BANNERPRINTING">ab</a></td>

                <td>always print banner, ignore lpr -h option</td>
              </tr>

              <tr>
                <td><a href=
                "#RECEPTION">accounting_namefixup</a></td>

                <td>update accounting name information</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">achk</a></td>

                <td>query accounting server when connected</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">ae</a></td>

                <td>accounting at end (see also af, la, ar,
                as)</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">af</a></td>

                <td>name of accounting file (see also la, ar)</td>
              </tr>

              <tr>
                <td><a href="#AH">ah</a></td>

                <td>automatically hold all jobs</td>
              </tr>

              <tr>
                <td><a href="#CONFIGFILE">allow_getenv</a></td>

                <td>Allow use of LPD_CONF</td>
              </tr>

              <tr>
                <td><a href=
                "#JOBCOMPLETION">allow_user_logging</a></td>

                <td>allow users to request logging info using lpr
                -mhost%port</td>
              </tr>

              <tr>
                <td><a href=
                "#ALLOWUSERSETTING">allow_user_setting</a></td>

                <td>allow privileged user to impersonate other
                users</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">ar</a></td>

                <td>enable remote transfer accounting (if af is
                set)</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">as</a></td>

                <td>accounting at start (see also af, la, ar)</td>
              </tr>

              <tr>
                <td><a href="#AUTH">use_auth</a></td>

                <td>authentication type to use</td>
              </tr>

              <tr>
                <td><a href="#AUTH">auth_forward</a></td>

                <td>authentication type for forwarding</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">be</a></td>

                <td>Banner at End Generation Program</td>
              </tr>

              <tr>
                <td><a href="#BK">bk</a></td>

                <td>Berkeley <b class="APPLICATION">lpd</b> job
                file format</td>
              </tr>

              <tr>
                <td><a href=
                "#FILTEROPTIONS">bk_filter_options</a></td>

                <td>Berkeley <b class="APPLICATION">lpd</b> filter
                options</td>
              </tr>

              <tr>
                <td><a href=
                "#FILTEROPTIONS">bk_of_filter_options</a></td>

                <td>Berkeley <b class="APPLICATION">lpd</b> OF
                filter options</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">bkf</a></td>

                <td>backwards-compatible filters: use simple
                parameters</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">bl</a></td>

                <td>short banner line sent to banner printer</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">bp</a></td>

                <td>Banner Generation Program (see bs, be)</td>
              </tr>

              <tr>
                <td><a href="#LPDBOUNCE">bq_format</a></td>

                <td>Format of bounce queue output</td>
              </tr>

              <tr>
                <td><a href="#SERIAL">br</a></td>

                <td>Serial port bit rate (see ty)</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">bs</a></td>

                <td>Banner at Start Generation Program</td>
              </tr>

              <tr>
                <td><a href=
                "#CHECKFORNONPRINTABLE">check_for_nonprintable</a></td>

                <td><b class="APPLICATION">lpr</b> checks for
                nonprintable file</td>
              </tr>

              <tr>
                <td><a href=
                "#CLASSINSTATUS">class_in_status</a></td>

                <td>Show job class name in <b class=
                "APPLICATION">lpq</b> status information</td>
              </tr>

              <tr>
                <td><a href="#PRINTCAPPARSE">client</a></td>

                <td>Mark printcap entry for client programs
                only</td>
              </tr>

              <tr>
                <td><a href="#CM">cm</a></td>

                <td>comment identifying printer (<b class=
                "APPLICATION">lpq</b>)</td>
              </tr>

              <tr>
                <td><a href="#CONFIGFILE">config_file</a></td>

                <td>configuration file</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">connect_grace</a></td>

                <td>connection control for remote printers</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">connect_interval</a></td>

                <td>connection control for remote printers</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">connect_timeout</a></td>

                <td>connection control for remote printers</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">connect_try</a></td>

                <td>connection control for remote printers</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">create_files</a></td>

                <td>create spool queue files</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">control_filter</a></td>

                <td>control file filter</td>
              </tr>

              <tr>
                <td><a href="#DEBUGGING">db</a></td>

                <td>debug options for queue</td>
              </tr>

              <tr>
                <td><a href=
                "#DEFAULTFORMAT">default_format</a></td>

                <td>default job format</td>
              </tr>

              <tr>
                <td><a href=
                "#DEFAULTPERMISSION">default_permission</a></td>

                <td>default permission for files</td>
              </tr>

              <tr>
                <td><a href="#DEFAULTRMRP">default_printer</a></td>

                <td>default printer</td>
              </tr>

              <tr>
                <td><a href=
                "#CLASSPRIORITY">default_priority</a></td>

                <td>default job priority</td>
              </tr>

              <tr>
                <td><a href=
                "#DEFAULTRMRP">default_remote_host</a></td>

                <td>default remote host</td>
              </tr>

              <tr>
                <td><a href="#CONFIGSETUP">default_tmp_dir</a></td>

                <td>default directory for temp files</td>
              </tr>

              <tr>
                <td><a href="#DESTINATIONS">destinations</a></td>

                <td>printers that a route filter may return and we
                should query</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">done_jobs</a></td>

                <td>save status for last N jobs</td>
              </tr>

              <tr>
                <td><a href=
                "#NORMALTERM">done_jobs_max_age</a></td>

                <td>remove status older than N seconds</td>
              </tr>

              <tr>
                <td><a href="#RECEPTION">fifo</a></td>

                <td>enforce FIFO job ordering</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">ff</a></td>

                <td>string to send for a form feed</td>
              </tr>

              <tr>
                <td><a href=
                "#FILTEROPTIONS">filter_ld_path</a></td>

                <td>filter LD_LIBRARY_PATH value</td>
              </tr>

              <tr>
                <td><a href=
                "#FILTEROPTIONS">filter_options</a></td>

                <td>filter options</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">filter_path</a></td>

                <td>filter PATH environment variable</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">fo</a></td>

                <td>send form feed when device is opened</td>
              </tr>

              <tr>
                <td><a href=
                "#FORCEFQDNHOSTNAME">force_fqdn_hostname</a></td>

                <td>force FQDN hostname value in control file</td>
              </tr>

              <tr>
                <td><a href=
                "#FORCELOCALHOST">force_localhost</a></td>

                <td>force clients to send all requests to
                localhost</td>
              </tr>

              <tr>
                <td><a href="#QQ">force_queuename</a></td>

                <td>force use of this queuename if none
                provided</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">fq</a></td>

                <td>send form feed when device is closed</td>
              </tr>

              <tr>
                <td><a href="#DEBUGGING">full_time</a></td>

                <td>use extended time format</td>
              </tr>

              <tr>
                <td><a href=
                "#BANNERPRINTING">generate_banner</a></td>

                <td>generate banner page for forwarded jobs</td>
              </tr>

              <tr>
                <td><a href="#USERGROUP">group</a></td>

                <td>Effective Group ID (EGID) for SUID ROOT
                programs</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">half_close</a></td>

                <td>Use shutdown(fd,1) when sending job to remote
                printer instead of close(fd)</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">hl</a></td>

                <td>Header (banner) last, at end of job</td>
              </tr>

              <tr>
                <td><a href=
                "#CLASSPRIORITY">ignore_requested_user_priority</a></td>

                <td>Ignore requested user priority</td>
              </tr>

              <tr>
                <td><a href=
                "#RECEPTION">incoming_control_filter</a></td>

                <td>incoming job control filter</td>
              </tr>

              <tr>
                <td><a href="#PRINTJOBFORMATS">if</a></td>

                <td>default (f, l) filter program</td>
              </tr>

              <tr>
                <td><a href="#CONFIGSETUP">ipv6</a></td>

                <td>using IPV6 conventions</td>
              </tr>

              <tr>
                <td><a href="#KERBEROS">kerberos_keytab</a></td>

                <td>kerberos keytab file location</td>
              </tr>

              <tr>
                <td><a href="#KERBEROS">kerberos_life</a></td>

                <td>kerberos key lifetime</td>
              </tr>

              <tr>
                <td><a href="#KERBEROS">kerberos_renew</a></td>

                <td>kerberos key renewal time</td>
              </tr>

              <tr>
                <td><a href=
                "#KERBEROS">kerberos_forward_principal</a></td>

                <td>kerberos remote principle name for
                forwarding</td>
              </tr>

              <tr>
                <td><a href=
                "#KERBEROS">kerberos_server_principal</a></td>

                <td>kerberos remote server principle name</td>
              </tr>

              <tr>
                <td><a href="#KERBEROS">kerberos_service</a></td>

                <td>kerberos default service</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">la</a></td>

                <td>enable local printer accounting (if af is
                set)</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">ld</a></td>

                <td>leader string sent on printer open</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">lf</a></td>

                <td>error log file for spool queue</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">lk</a></td>

                <td>lock the IO device</td>
              </tr>

              <tr>
                <td><a href="#CONFIGSETUP">lockfile</a></td>

                <td>lpd lock file</td>
              </tr>

              <tr>
                <td><a href="#LOGGER">logger_destination</a></td>

                <td>destination for logging information</td>
              </tr>

              <tr>
                <td><a href="#LOGGER">logger_timeout</a></td>

                <td>intervals between connection attempts</td>
              </tr>

              <tr>
                <td><a href="#LOGGER">logger_pathname</a></td>

                <td>temp file for log information</td>
              </tr>

              <tr>
                <td><a href="#LOGGER">logger_max_size</a></td>

                <td>max size in Kbytes of temp file for log
                information</td>
              </tr>

              <tr>
                <td><a href="#JOBTRANSFER">longnumber</a></td>

                <td>use long job number when a job is
                submitted</td>
              </tr>

              <tr>
                <td><a href="#SIMPLE">lp</a></td>

                <td>printer device name or specification</td>
              </tr>

              <tr>
                <td><a href="#LPDBOUNCE">lpd_bounce</a></td>

                <td>force lpd to filter job before forwarding</td>
              </tr>

              <tr>
                <td><a href="#SPOOLQ">lpd_force_poll</a></td>

                <td>force lpd to poll idle printers</td>
              </tr>

              <tr>
                <td><a href="#SPOOLQ">lpd_poll_time</a></td>

                <td>interval between lpd printer polls</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">lpd_port</a></td>

                <td>lpd listening port</td>
              </tr>

              <tr>
                <td><a href=
                "#PRINTCAPPATH">lpd_printcap_path</a></td>

                <td>lpd printcap path</td>
              </tr>

              <tr>
                <td><a href="#LPRBOUNCE">lpr_bounce</a></td>

                <td>lpr does filtering as in bounce queue</td>
              </tr>

              <tr>
                <td><a href="#JOBCOMPLETION">lpr_bsd</a></td>

                <td>lpr does filtering as in bounce queue</td>
              </tr>

              <tr>
                <td><a href="#ABNORMALTERM">mail_from</a></td>

                <td>mail user from user name</td>
              </tr>

              <tr>
                <td><a href=
                "#ABNORMALTERM">mail_operator_on_error</a></td>

                <td>mail to this operator on error</td>
              </tr>

              <tr>
                <td><a href=
                "#ABNORMALTERM">max_connect_interval</a></td>

                <td>maximum time between connection attempts</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">max_log_file_size</a></td>

                <td>maximum size (in K) of spool queue log
                file</td>
              </tr>

              <tr>
                <td><a href="#SPOOLQ">max_servers_active</a></td>

                <td>maximum number of lpd queue servers that can be
                active</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">max_status_line</a></td>

                <td>maximum length of status line</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">max_status_size</a></td>

                <td>maximum size (in K) of status file</td>
              </tr>

              <tr>
                <td><a href="#JOBCOPIES">mc</a></td>

                <td>maximum copies allowed</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">min_log_file_size</a></td>

                <td>minimum size (in K) of spool queue log
                file</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">min_status_size</a></td>

                <td>minimum size to reduce status file to</td>
              </tr>

              <tr>
                <td><a href="#MINFREE">minfree</a></td>

                <td>minimum amount of free space needed</td>
              </tr>

              <tr>
                <td><a href="#CHECKFORNONPRINTABLE">ml</a></td>

                <td>minimum number of printable characters for
                printable check</td>
              </tr>

              <tr>
                <td><a href=
                "#DEBUGGING">ms_time_resolution</a></td>

                <td>millisecond time resolution</td>
              </tr>

              <tr>
                <td><a href="#JOBCOPIES">mx</a></td>

                <td>maximum job size (1Kb blocks, 0 =
                unlimited)</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">nb</a></td>

                <td>use nonblocking device open</td>
              </tr>

              <tr>
                <td><a href=
                "#OPENDEVICE">network_connect_grace</a></td>

                <td>pause between transferring jobs to remote
                printer</td>
              </tr>

              <tr>
                <td><a href="#JOBFILES">nline_after_file</a></td>

                <td>N line after file name</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">of</a></td>

                <td>banner output filter</td>
              </tr>

              <tr>
                <td><a href=
                "#FILTEROPTIONS">of_filter_options</a></td>

                <td>OF filter options</td>
              </tr>

              <tr>
                <td><a href="#PRINTCAPPARSE">oh</a></td>

                <td>Printcap entry valid only on these hosts</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">originate_port</a></td>

                <td>originate connections from these ports</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">pass_env</a></td>

                <td>clients pass these environment variables to
                filters</td>
              </tr>

              <tr>
                <td><a href="#PERMSPATH">perms_path</a></td>

                <td>lpd.perms files</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">pl</a></td>

                <td>page length (in lines)</td>
              </tr>

              <tr>
                <td><a href="#PR">pr</a></td>

                <td>pr program for p format</td>
              </tr>

              <tr>
                <td><a href="#PRINTCAPPATH">printcap_path</a></td>

                <td>printcap file</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">ps</a></td>

                <td>printer status file name</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">pw</a></td>

                <td>page width (in characters)</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">px</a></td>

                <td>page width in pixels (horizontal)</td>
              </tr>

              <tr>
                <td><a href="#FILTEROPTIONS">py</a></td>

                <td>page length in pixels (vertical)</td>
              </tr>

              <tr>
                <td><a href=
                "#QUEUELOCKFILE">queue_lock_file</a></td>

                <td>queue lock file name</td>
              </tr>

              <tr>
                <td><a href=
                "#QUEUECONTROLFILE">queue_control_file</a></td>

                <td>queue control file name</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">queue_status_file</a></td>

                <td>queue status file name</td>
              </tr>

              <tr>
                <td><a href="#QQ">qq</a></td>

                <td>put queue name in control file</td>
              </tr>

              <tr>
                <td><a href=
                "#REMOTESUPPORT">remote_support</a></td>

                <td>operations allowed to remote host</td>
              </tr>

              <tr>
                <td><a href=
                "#CONFIGSETUP">report_server_as</a></td>

                <td>server name for status reports</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">retry_econnrefused</a></td>

                <td>Retry on connect ECONNREFUSED errors</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">retry_nolink</a></td>

                <td>Retry device open or connect failures</td>
              </tr>

              <tr>
                <td><a href=
                "#SHORTSTATUS">return_short_status</a></td>

                <td>return short lpq status when request arrives
                from specified host</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">reuse_addr</a></td>

                <td>set SO_REUSEADDR on outgoing ports</td>
              </tr>

              <tr>
                <td><a href=
                "#REVERSELPQFORMAT">reverse_lpq_format</a></td>

                <td>reverse lpq format when request arrives from
                specified host</td>
              </tr>

              <tr>
                <td><a href="#RG">rg</a></td>

                <td>clients allow only users in this group access
                to printer</td>
              </tr>

              <tr>
                <td><a href="#SIMPLE">rm</a></td>

                <td>remote machine (hostname) (with rp)</td>
              </tr>

              <tr>
                <td><a href="#DESTINATIONS">router</a></td>

                <td>routing filter, returns destinations</td>
              </tr>

              <tr>
                <td><a href="#SIMPLE">rp</a></td>

                <td>remote printer name (with rm)</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">rw</a></td>

                <td>open printer for reading and writing</td>
              </tr>

              <tr>
                <td><a href="#SAFECHARS">safe_chars</a></td>

                <td>additional safe characters in control file
                lines</td>
              </tr>

              <tr>
                <td><a href="#ABNORMALTERM">save_on_error</a></td>

                <td>save job when an error</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">save_when_done</a></td>

                <td>save job when done</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">sb</a></td>

                <td>short banner (one line only)</td>
              </tr>

              <tr>
                <td><a href="#SPOOLQUEUE">sd</a></td>

                <td>spool directory pathname</td>
              </tr>

              <tr>
                <td><a href=
                "#SENDBLOCKFORMAT">send_block_format</a></td>

                <td>send block of data, rather than individual
                files</td>
              </tr>

              <tr>
                <td><a href="#JOBTRANSFER">send_data_first</a></td>

                <td>send data files first in job transfer</td>
              </tr>

              <tr>
                <td><a href=
                "#ABNORMALTERM">send_failure_action</a></td>

                <td>failure action to take after send_try attempts
                failed</td>
              </tr>

              <tr>
                <td><a href=
                "#PRINTINGJOB">send_job_rw_timeout</a></td>

                <td>print job read/write timeout</td>
              </tr>

              <tr>
                <td><a href=
                "#PRINTINGJOB">send_query_rw_timeout</a></td>

                <td>status query operation read/write timeout</td>
              </tr>

              <tr>
                <td><a href="#ABNORMALTERM">send_try</a></td>

                <td>maximum number of times to try sending job</td>
              </tr>

              <tr>
                <td><a href="#ABNORMALTERM">sendmail</a></td>

                <td>sendmail program</td>
              </tr>

              <tr>
                <td><a href="#PRINTCAPPARSE">server</a></td>

                <td>Mark printcap entry for lpd server program
                only</td>
              </tr>

              <tr>
                <td><a href="#OPENDEVICE">server_tmp_dir</a></td>

                <td>server temporary file directory</td>
              </tr>

              <tr>
                <td><a href="#PRINTINGJOB">sf</a></td>

                <td>suppress form feeds separating data files in
                job</td>
              </tr>

              <tr>
                <td><a href="#BANNERPRINTING">sh</a></td>

                <td>suppress header (banner) pages</td>
              </tr>

              <tr>
                <td><a href="#LOGFILES">short_status_date</a></td>

                <td>short (hh:mm) timestamp format for status</td>
              </tr>

              <tr>
                <td><a href=
                "#SHORTSTATUS">short_status_length</a></td>

                <td>short lpq status length in lines</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">socket_linger</a></td>

                <td>set the SO_LINGER socket option</td>
              </tr>

              <tr>
                <td><a href="#CONFIGSETUP">spool_dir_perms</a></td>

                <td>spool directory permissions</td>
              </tr>

              <tr>
                <td><a href=
                "#CONFIGSETUP">spool_file_perms</a></td>

                <td>spool file permissions</td>
              </tr>

              <tr>
                <td><a href="#LOADBALANCE">ss</a></td>

                <td>name of queue that server serves (with sv)</td>
              </tr>

              <tr>
                <td><a href="#STALLEDTIME">stalled_time</a></td>

                <td>time after which to report active job
                stalled</td>
              </tr>

              <tr>
                <td><a href="#ABNORMALTERM">stop_on_abort</a></td>

                <td>stop processing queue on filter abort</td>
              </tr>

              <tr>
                <td><a href="#SERIAL">stty</a></td>

                <td>stty commands to set output line
                characteristics</td>
              </tr>

              <tr>
                <td><a href="#LOADBALANCE">sv</a></td>

                <td>names of servers for queue (with ss)</td>
              </tr>

              <tr>
                <td><a href="#DEBUGGING">syslog_device</a></td>

                <td>name of syslog device</td>
              </tr>

              <tr>
                <td><a href="#PRINTCAPPARSE">tc</a></td>

                <td>Include indicated printcap entries in current
                entry</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">tr</a></td>

                <td>trailer string to send before closing
                printer</td>
              </tr>

              <tr>
                <td><a href=
                "#TRANSLATEFORMAT">translate_format</a></td>

                <td>translate data format in control file</td>
              </tr>

              <tr>
                <td><a href="#LPDPORT">unix_socket_path</a></td>

                <td>FIFO path for local process connections</td>
              </tr>

              <tr>
                <td><a href="#DEBUGGING">use_info_cache</a></td>

                <td>read and cache information</td>
              </tr>

              <tr>
                <td><a href="#JOBTRANSFER">use_shorthost</a></td>

                <td>Use short hostname for lpr control and data
                file names</td>
              </tr>

              <tr>
                <td><a href="#USERGROUP">user</a></td>

                <td>Effective User ID (EUID) for SUID ROOT
                programs</td>
              </tr>

              <tr>
                <td><a href="#NORMALTERM">wait_for_eof</a></td>

                <td>Wait for EOF on connection</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="LICENSE"></a>Appendix B. License</h1>
<pre class="PROGRAMLISTING">
                    *LPRng, IFHP, and LPRngTool LICENSE*
                        GNU GPL and Artistic License
    
                       (Version 5, 28 Aug 2003)
    
                  Copyright Patrick Powell, Astart Technologies
                           &lt;papowell@lprng.com&gt;
    
                          All rights reserved.
    
    You may use "LPRng" or "IFHP" under either the terms of the GNU
    GPL License or the Artistc License. These licenses are included
    below.  The licenses were obtained from the http://www.opensource.org
    web site on 28 Aug 2003.
    
       These Licenses apply to the computer software packages known as
    "LPRng", "IFHP", and associated files.  The "Package" or "Program"
    below refers to the programs, files,  and associated software which
    are distributed as the package.
    
       The "LPRng" Software Package is a copyrighted work whose copyright
    is held by Patrick Powell.
    
       The "IFHP" Software Package is a copyrighted work whose copyright
    is held by Patrick Powell.
    
       The "LPRngTool" Software Package is a copyrighted work whose copyright
    is held by Patrick Powell.
    
       BY MODIFYING OR DISTRIBUTING THE PROGRAM (OR ANY WORK BASED ON THE
    PROGRAM), YOU INDICATE YOUR ACCEPTANCE OF THIS LICENSE TO DO SO, AND ALL
    ITS TERMS AND CONDITIONS FOR COPYING, DISTRIBUTING OR MODIFYING THE
    PROGRAM OR WORKS BASED ON IT. NOTHING OTHER THAN THIS LICENSE GRANTS
    YOU PERMISSION TO MODIFY OR DISTRIBUTE THE PROGRAM OR ITS DERIVATIVE
    WORKS. THESE ACTIONS ARE PROHIBITED BY LAW. IF YOU DO NOT ACCEPT THESE
    TERMS AND CONDITIONS, DO NOT MODIFY OR DISTRIBUTE THE PROGRAM.
    
    -----------------------------------------------------------------------
                      Addendum Fri Jun 21 17:06:33 PDT 2002
    
    If you wish  to distribute the LPRng source code or binaries of any
    of the programs in the LPRng packages under terms of the GNU license,
    then when any package or portion of the LPRng is configured to use
    any facility or utility of the OpenSSL distribution, the additional
    following clause will be applied, as recommended in the OpenSSL
    0.9.6c release FAQ:
    
    "This program is released under the GPL with the additional exemption that
    compiling, linking, and/or using OpenSSL is allowed."
    
    -----------------------------------------------------------------------
    
                GNU GENERAL PUBLIC LICENSE
                   Version 2, June 1991
    
     Copyright (C) 1989, 1991 Free Software Foundation, Inc.
      675 Mass Ave, Cambridge, MA 02139, USA
     Everyone is permitted to copy and distribute verbatim copies
     of this license document, but changing it is not allowed.
    
                    Preamble
    
      The licenses for most software are designed to take away your
    freedom to share and change it.  By contrast, the GNU General Public
    License is intended to guarantee your freedom to share and change free
    software--to make sure the software is free for all its users.  This
    General Public License applies to most of the Free Software
    Foundation's software and to any other program whose authors commit to
    using it.  (Some other Free Software Foundation software is covered by
    the GNU Library General Public License instead.)  You can apply it to
    your programs, too.
    
      When we speak of free software, we are referring to freedom, not
    price.  Our General Public Licenses are designed to make sure that you
    have the freedom to distribute copies of free software (and charge for
    this service if you wish), that you receive source code or can get it
    if you want it, that you can change the software or use pieces of it
    in new free programs; and that you know you can do these things.
    
      To protect your rights, we need to make restrictions that forbid
    anyone to deny you these rights or to ask you to surrender the rights.
    These restrictions translate to certain responsibilities for you if you
    distribute copies of the software, or if you modify it.
    
      For example, if you distribute copies of such a program, whether
    gratis or for a fee, you must give the recipients all the rights that
    you have.  You must make sure that they, too, receive or can get the
    source code.  And you must show them these terms so they know their
    rights.
    
      We protect your rights with two steps: (1) copyright the software, and
    (2) offer you this license which gives you legal permission to copy,
    distribute and/or modify the software.
    
      Also, for each author's protection and ours, we want to make certain
    that everyone understands that there is no warranty for this free
    software.  If the software is modified by someone else and passed on, we
    want its recipients to know that what they have is not the original, so
    that any problems introduced by others will not reflect on the original
    authors' reputations.
    
      Finally, any free program is threatened constantly by software
    patents.  We wish to avoid the danger that redistributors of a free
    program will individually obtain patent licenses, in effect making the
    program proprietary.  To prevent this, we have made it clear that any
    patent must be licensed for everyone's free use or not licensed at all.
    
      The precise terms and conditions for copying, distribution and
    modification follow.
    
                GNU GENERAL PUBLIC LICENSE
       TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
    
      0. This License applies to any program or other work which contains
    a notice placed by the copyright holder saying it may be distributed
    under the terms of this General Public License.  The "Program", below,
    refers to any such program or work, and a "work based on the Program"
    means either the Program or any derivative work under copyright law:
    that is to say, a work containing the Program or a portion of it,
    either verbatim or with modifications and/or translated into another
    language.  (Hereinafter, translation is included without limitation in
    the term "modification".)  Each licensee is addressed as "you".
    
    Activities other than copying, distribution and modification are not
    covered by this License; they are outside its scope.  The act of
    running the Program is not restricted, and the output from the Program
    is covered only if its contents constitute a work based on the
    Program (independent of having been made by running the Program).
    Whether that is true depends on what the Program does.
    
      1. You may copy and distribute verbatim copies of the Program's
    source code as you receive it, in any medium, provided that you
    conspicuously and appropriately publish on each copy an appropriate
    copyright notice and disclaimer of warranty; keep intact all the
    notices that refer to this License and to the absence of any warranty;
    and give any other recipients of the Program a copy of this License
    along with the Program.
    
    You may charge a fee for the physical act of transferring a copy, and
    you may at your option offer warranty protection in exchange for a fee.
    
      2. You may modify your copy or copies of the Program or any portion
    of it, thus forming a work based on the Program, and copy and
    distribute such modifications or work under the terms of Section 1
    above, provided that you also meet all of these conditions:
    
        a) You must cause the modified files to carry prominent notices
        stating that you changed the files and the date of any change.
    
        b) You must cause any work that you distribute or publish, that in
        whole or in part contains or is derived from the Program or any
        part thereof, to be licensed as a whole at no charge to all third
        parties under the terms of this License.
    
        c) If the modified program normally reads commands interactively
        when run, you must cause it, when started running for such
        interactive use in the most ordinary way, to print or display an
        announcement including an appropriate copyright notice and a
        notice that there is no warranty (or else, saying that you provide
        a warranty) and that users may redistribute the program under
        these conditions, and telling the user how to view a copy of this
        License.  (Exception: if the Program itself is interactive but
        does not normally print such an announcement, your work based on
        the Program is not required to print an announcement.)
    
    These requirements apply to the modified work as a whole.  If
    identifiable sections of that work are not derived from the Program,
    and can be reasonably considered independent and separate works in
    themselves, then this License, and its terms, do not apply to those
    sections when you distribute them as separate works.  But when you
    distribute the same sections as part of a whole which is a work based
    on the Program, the distribution of the whole must be on the terms of
    this License, whose permissions for other licensees extend to the
    entire whole, and thus to each and every part regardless of who wrote it.
    
    Thus, it is not the intent of this section to claim rights or contest
    your rights to work written entirely by you; rather, the intent is to
    exercise the right to control the distribution of derivative or
    collective works based on the Program.
    
    In addition, mere aggregation of another work not based on the Program
    with the Program (or with a work based on the Program) on a volume of
    a storage or distribution medium does not bring the other work under
    the scope of this License.
    
      3. You may copy and distribute the Program (or a work based on it,
    under Section 2) in object code or executable form under the terms of
    Sections 1 and 2 above provided that you also do one of the following:
    
        a) Accompany it with the complete corresponding machine-readable
        source code, which must be distributed under the terms of Sections
        1 and 2 above on a medium customarily used for software interchange; or,
    
        b) Accompany it with a written offer, valid for at least three
        years, to give any third party, for a charge no more than your
        cost of physically performing source distribution, a complete
        machine-readable copy of the corresponding source code, to be
        distributed under the terms of Sections 1 and 2 above on a medium
        customarily used for software interchange; or,
    
        c) Accompany it with the information you received as to the offer
        to distribute corresponding source code.  (This alternative is
        allowed only for noncommercial distribution and only if you
        received the program in object code or executable form with such
        an offer, in accord with Subsection b above.)
    
    The source code for a work means the preferred form of the work for
    making modifications to it.  For an executable work, complete source
    code means all the source code for all modules it contains, plus any
    associated interface definition files, plus the scripts used to
    control compilation and installation of the executable.  However, as a
    special exception, the source code distributed need not include
    anything that is normally distributed (in either source or binary
    form) with the major components (compiler, kernel, and so on) of the
    operating system on which the executable runs, unless that component
    itself accompanies the executable.
    
    If distribution of executable or object code is made by offering
    access to copy from a designated place, then offering equivalent
    access to copy the source code from the same place counts as
    distribution of the source code, even though third parties are not
    compelled to copy the source along with the object code.
    
      4. You may not copy, modify, sublicense, or distribute the Program
    except as expressly provided under this License.  Any attempt
    otherwise to copy, modify, sublicense or distribute the Program is
    void, and will automatically terminate your rights under this License.
    However, parties who have received copies, or rights, from you under
    this License will not have their licenses terminated so long as such
    parties remain in full compliance.
    
      5. You are not required to accept this License, since you have not
    signed it.  However, nothing else grants you permission to modify or
    distribute the Program or its derivative works.  These actions are
    prohibited by law if you do not accept this License.  Therefore, by
    modifying or distributing the Program (or any work based on the
    Program), you indicate your acceptance of this License to do so, and
    all its terms and conditions for copying, distributing or modifying
    the Program or works based on it.
    
      6. Each time you redistribute the Program (or any work based on the
    Program), the recipient automatically receives a license from the
    original licensor to copy, distribute or modify the Program subject to
    these terms and conditions.  You may not impose any further
    restrictions on the recipients' exercise of the rights granted herein.
    You are not responsible for enforcing compliance by third parties to
    this License.
    
      7. If, as a consequence of a court judgment or allegation of patent
    infringement or for any other reason (not limited to patent issues),
    conditions are imposed on you (whether by court order, agreement or
    otherwise) that contradict the conditions of this License, they do not
    excuse you from the conditions of this License.  If you cannot
    distribute so as to satisfy simultaneously your obligations under this
    License and any other pertinent obligations, then as a consequence you
    may not distribute the Program at all.  For example, if a patent
    license would not permit royalty-free redistribution of the Program by
    all those who receive copies directly or indirectly through you, then
    the only way you could satisfy both it and this License would be to
    refrain entirely from distribution of the Program.
    
    If any portion of this section is held invalid or unenforceable under
    any particular circumstance, the balance of the section is intended to
    apply and the section as a whole is intended to apply in other
    circumstances.
    
    It is not the purpose of this section to induce you to infringe any
    patents or other property right claims or to contest validity of any
    such claims; this section has the sole purpose of protecting the
    integrity of the free software distribution system, which is
    implemented by public license practices.  Many people have made
    generous contributions to the wide range of software distributed
    through that system in reliance on consistent application of that
    system; it is up to the author/donor to decide if he or she is willing
    to distribute software through any other system and a licensee cannot
    impose that choice.
    
    This section is intended to make thoroughly clear what is believed to
    be a consequence of the rest of this License.
    
      8. If the distribution and/or use of the Program is restricted in
    certain countries either by patents or by copyrighted interfaces, the
    original copyright holder who places the Program under this License
    may add an explicit geographical distribution limitation excluding
    those countries, so that distribution is permitted only in or among
    countries not thus excluded.  In such case, this License incorporates
    the limitation as if written in the body of this License.
    
      9. The Free Software Foundation may publish revised and/or new versions
    of the General Public License from time to time.  Such new versions will
    be similar in spirit to the present version, but may differ in detail to
    address new problems or concerns.
    
    Each version is given a distinguishing version number.  If the Program
    specifies a version number of this License which applies to it and "any
    later version", you have the option of following the terms and conditions
    either of that version or of any later version published by the Free
    Software Foundation.  If the Program does not specify a version number of
    this License, you may choose any version ever published by the Free Software
    Foundation.
    
      10. If you wish to incorporate parts of the Program into other free
    programs whose distribution conditions are different, write to the author
    to ask for permission.  For software which is copyrighted by the Free
    Software Foundation, write to the Free Software Foundation; we sometimes
    make exceptions for this.  Our decision will be guided by the two goals
    of preserving the free status of all derivatives of our free software and
    of promoting the sharing and reuse of software generally.
    
                    NO WARRANTY
    
      11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
    FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
    OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
    PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
    OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
    MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
    TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
    PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
    REPAIR OR CORRECTION.
    
      12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
    WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
    REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
    INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
    OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
    TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
    YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
    PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGES.
    
                 END OF TERMS AND CONDITIONS
    
        Appendix: How to Apply These Terms to Your New Programs
    
      If you develop a new program, and you want it to be of the greatest
    possible use to the public, the best way to achieve this is to make it
    free software which everyone can redistribute and change under these terms.
    
      To do so, attach the following notices to the program.  It is safest
    to attach them to the start of each source file to most effectively
    convey the exclusion of warranty; and each file should have at least
    the "copyright" line and a pointer to where the full notice is found.
    
        &lt;one line to give the program's name and a brief idea of what it does.&gt;
        Copyright (C) 19yy  &lt;name of author&gt;
    
        This program is free software; you can redistribute it and/or modify
        it under the terms of the GNU General Public License as published by
        the Free Software Foundation; either version 2 of the License, or
        (at your option) any later version.
    
        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.
    
        You should have received a copy of the GNU General Public License
        along with this program; if not, write to the Free Software
        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
    
    Also add information on how to contact you by electronic and paper mail.
    
    If the program is interactive, make it output a short notice like this
    when it starts in an interactive mode:
    
        Gnomovision version 69, Copyright (C) 19yy name of author
        Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
        This is free software, and you are welcome to redistribute it
        under certain conditions; type `show c' for details.
    
    The hypothetical commands `show w' and `show c' should show the appropriate
    parts of the General Public License.  Of course, the commands you use may
    be called something other than `show w' and `show c'; they could even be
    mouse-clicks or menu items--whatever suits your program.
    
    You should also get your employer (if you work as a programmer) or your
    school, if any, to sign a "copyright disclaimer" for the program, if
    necessary.  Here is a sample; alter the names:
    
      Yoyodyne, Inc., hereby disclaims all copyright interest in the program
      `Gnomovision' (which makes passes at compilers) written by James Hacker.
    
      &lt;signature of Ty Coon&gt;, 1 April 1989
      Ty Coon, President of Vice
    
    This General Public License does not permit incorporating your program into
    proprietary programs.  If your program is a subroutine library, you may
    consider it more useful to permit linking proprietary applications with the
    library.  If this is what you want to do, use the GNU Library General
    Public License instead of this License.
    
    --------------------------------------------------------------------------------------------
    
    From http://www.opensource.org  - The Artistic License
    Version as of 28 Aug, 2003
    
                            The Artistic License
    
    Preamble
    
    The intent of this document is to state the conditions under which
    a Package may be copied, such that the Copyright Holder maintains
    some semblance of artistic control over the development of the
    package, while giving the users of the package the right to use and
    distribute the Package in a more-or-less customary fashion, plus
    the right to make reasonable modifications.
    
    Definitions:
    
    "Package" refers to the collection of files distributed by the
    Copyright Holder, and derivatives of that collection of files created
    through textual modification.
    
    "Standard Version" refers to such a Package if it has not been
    modified, or has been modified in accordance with the wishes of the
    Copyright Holder.
    
    "Copyright Holder" is whoever is named in the copyright or copyrights
    for the package.
    
    "You" is you, if you're thinking about copying or distributing this
    Package.
    
    "Reasonable copying fee" is whatever you can justify on the basis
    of media cost, duplication charges, time of people involved, and
    so on. (You will not be required to justify it to the Copyright
    Holder, but only to the computing community at large as a market
    that must bear the fee.)
    
    "Freely Available" means that no fee is charged for the item itself,
    though there may be fees involved in handling the item. It also
    means that recipients of the item may redistribute it under the
    same conditions they received it.
    
    1. You may make and give away verbatim copies of the source form
    of the Standard Version of this Package without restriction, provided
    that you duplicate all of the original copyright notices and
    associated disclaimers.
    
    2. You may apply bug fixes, portability fixes and other modifications
    derived from the Public Domain or from the Copyright Holder. A
    Package modified in such a way shall still be considered the Standard
    Version.
    
    3. You may otherwise modify your copy of this Package in any way,
    provided that you insert a prominent notice in each changed file
    stating how and when you changed that file, and provided that you
    do at least ONE of the following:
    
    a) place your modifications in the Public Domain or otherwise make
    them Freely Available, such as by posting said modifications to
    Usenet or an equivalent medium, or placing the modifications on a
    major archive site such as ftp.uu.net, or by allowing the Copyright
    Holder to include your modifications in the Standard Version of the
    Package.
    
    b) use the modified Package only within your corporation or
    organization.
    
    c) rename any non-standard executables so the names do not conflict
    with standard executables, which must also be provided, and provide
    a separate manual page for each non-standard executable that clearly
    documents how it differs from the Standard Version.
    
    d) make other distribution arrangements with the Copyright Holder.
    
    4. You may distribute the programs of this Package in object code
    or executable form, provided that you do at least ONE of the
    following:
    
    a) distribute a Standard Version of the executables and library
    files, together with instructions (in the manual page or equivalent)
    on where to get the Standard Version.
    
    b) accompany the distribution with the machine-readable source of
    the Package with your modifications.
    
    c) accompany any non-standard executables with their corresponding
    Standard Version executables, giving the non-standard executables
    non-standard names, and clearly documenting the differences in
    manual pages (or equivalent), together with instructions on where
    to get the Standard Version.
    
    d) make other distribution arrangements with the Copyright Holder.
    
    5. You may charge a reasonable copying fee for any distribution of
    this Package. You may charge any fee you choose for support of this
    Package. You may not charge a fee for this Package itself. However,
    you may distribute this Package in aggregate with other (possibly
    commercial) programs as part of a larger (possibly commercial)
    software distribution provided that you do not advertise this Package
    as a product of your own.
    
    6. The scripts and library files supplied as input to or produced
    as output from the programs of this Package do not automatically
    fall under the copyright of this Package, but belong to whomever
    generated them, and may be sold commercially, and may be aggregated
    with this Package.
    
    7. C or perl subroutines supplied by you and linked into this Package
    shall not be considered part of this Package.
    
    8. The name of the Copyright Holder may not be used to endorse or
    promote products derived from this software without specific prior
    written permission.
    
    9. THIS PACKAGE IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS OR
    IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
    WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
   
</pre>
        <br>
        <br>
      </div>

      <div class="APPENDIX">
        <hr>

        <h1><a name="TESTING"></a>Appendix C. Testing and
        Diagnostic Facilities</h1>

        <p>The <b class="APPLICATION">LPRng</b> code has the
        ability to run as non-setuid software, and to use the
        non-default TCP/IP ports for communication. This facility
        allows a <span class="emphasis"><i class="EMPHASIS">Test
        Version</i></span> to be run in parallel with the normal <b
        class="APPLICATION">LPRng</b> software.</p>

        <p>To simplify testing and portability issues, a simple
        test version of the spool queues and jobs has been supplied
        with the <b class="APPLICATION">LPRng</b> distribution.
        These queues can be placed in a suitable location (<tt
        class="FILENAME">/tmp</tt> is common) and the <b class=
        "APPLICATION">LPRng</b> software tested.</p>

        <p>The test version of the software will use the <var
        class="LITERAL">LPD_CONF</var> environment variable to
        specify the location of the configuration file. It will
        read this configuration file on startup and use the values
        to override the normal defaults. Since a user could
        maliciously set up their own configuration files with
        values that could compromise system security, it is
        strongly recommended that the test version is not made
        SETUID root. In fact, the <b class="APPLICATION">LPRng</b>
        code will chatter messages when the LPD_CONF ability is
        enabled and it is run as root.</p>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN11656">C.1. Compiling the
          Test Version</a></h2>

          <p>Edit <tt class="FILENAME">src/Makefile</tt>, and
          uncomment the indicated line. Then run <var class=
          "LITERAL">make</var> to regenerate the distribution.</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN11661"></a>
<pre class="SCREEN">
    #### ****** TESTING AND SECURITY LOOPHOLE ******************************
    # Define GETENV to allow the LPD_CONFIG environment
    #  variable to be used as the name of a configuration file.  In non-testing
    #  systems,  this is a security loophole.
    #CF := $(CF) -DGETENV
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN11663">C.2. Setting Up The
          Test Version Spool Queues</a></h2>

          <p>The <b class="APPLICATION">LPRng</b> <acronym class=
          "ACRONYM">TESTSUPPORT</acronym> directory contains a set
          of shell scripts and files that need to be installed in
          the appropriate directory. The following steps are
          used.</p>

          <ol type="1">
            <li>
              <p>First, you need to set up your <acronym class=
              "ACRONYM">HOST</acronym> environment variable to the
              fully qualified domain name of your host and your
              <acronym class="ACRONYM">USER</acronym> environment
              variable to your user name. This is done in order to
              get values to put into the Test Version configuration
              files.</p>
            </li>

            <li>
              <p>In the <acronym class=
              "ACRONYM">TESTSUPPORT</acronym> directory, edit the
              <var class="LITERAL">Makefile</var>, and specify the
              location of the <var class="LITERAL">Test
              Version</var> spool queues. The default location is
              <tt class="FILENAME">/tmp</tt>; since on most systems
              these files are deleted or are available to
              everybody, a more secure location should most likely
              be used. <span class="emphasis"><i class=
              "EMPHASIS">DO NOT USE THE RAW TESTFILE
              DIRECTORY</i></span>. These files need to be copied
              and placed in another directory.</p>
            </li>

            <li>
              <p>The <var class="LITERAL">LPD_CONF</var>
              environment variable should be set to the location of
              the installed <tt class="FILENAME">lpd.conf</tt>
              file.</p>
            </li>

            <li>
              <p>In the <acronym class=
              "ACRONYM">TESTSUPPORT</acronym> directory, run <var
              class="LITERAL">make</var>. This will copy and
              install the necessary files.</p>
            </li>
          </ol>
          <br>
          <br>

          <p>Example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN11689"></a>
<pre class="SCREEN">
      CSH:
        setenv HOST {fully qualified domain name};
        setenv USER `whoami`
        setenv LPD_CONF /tmp/LPD/lpd.conf
        set path=( /tmp/LPD $path )
        unsetenv PRINTER
       Example:
          setenv HOST h4.private
          setenv USER papowell
          setenv LPD_CONF /tmp/LPD/lpd.conf
          set path=( /tmp/LPD $path )
          unsetenv PRINTER
      Bourne Shell:
        HOST={fully qualified domain name}; export HOST;
        USER='whoami'; export USER
        LPD_CONF=/tmp/LPD/lpd.conf.$HOST; export LPD_CONF
        PATH=/tmp/LPD:$PATH; export PATH
        PRINTER=; export PRINTER
       Example:
          HOST=h4.private; export HOST
          USER=papowell; export USER
          LPD_CONF=/tmp/LPD/lpd.conf.$HOST; export LPD_CONF
          PATH=/tmp/LPD:$PATH; export PATH
          PRINTER=; export PRINTER
      cd TESTSUPPORT
      make
</pre>
          </div>
          <br>
          <br>
        </div>

        <div class="SECT1">
          <hr>

          <h2 class="SECT1"><a name="AEN11691">C.3. Running the
          Test Version Software</a></h2>

          <p>Set your current directory to the location of the
          compiled <var class="LITERAL">Test Version</var>
          executables. Execute the various executables using <tt
          class="FILENAME">./cmd</tt>, or set <var class=
          "LITERAL">.</var> <span class="emphasis"><i class=
          "EMPHASIS">as the first entry in the PATH</i></span> . If
          it is not the first entry, then the standard system
          executables will be used.</p>

          <ol type="1">
            <li>
              <p>Run <tt class="FILENAME">./checkpc</tt>. this will
              print out the various values for the spool queues in
              the <var class="LITERAL">Test Version</var> setup. If
              the <var class="LITERAL">t1</var>, <var class=
              "LITERAL">t2</var>,... spool queues are not
              displayed, make sure that the LPD_CONF environment
              variable is set correctly and that you are using the
              <var class="LITERAL">Test Version</var>
              executable.</p>
            </li>

            <li>
              <p>Run <var class="LITERAL">./checkpc -f</var>. This
              will fix up the (deliberately introduced) problems in
              the spool queues.</p>
            </li>

            <li>
              <p>Next, run <var class="LITERAL">./lpd -F</var> in
              one window, and then run <var class="LITERAL">./lpq
              -a</var> in another window. This will check that the
              server is working.</p>
            </li>

            <li>
              <p>You can now amuse yourself by sending jobs,
              setting up permissions checking, and other
              chores.</p>
            </li>

            <li>
              <p>When everything appears to be working correctly,
              you can then remove the <var class="LITERAL">Test
              Version</var> flag from the <tt class=
              "FILENAME">src/Makefile</tt>, recompile, and install
              the <b class="APPLICATION">LPRng</b> software.</p>
            </li>
          </ol>
          <br>
          <br>
        </div>
      </div>

      <div class="INDEX">
        <hr>

        <h1><a name="AEN11720"></a>Index</h1>

        <dl>
          <dt>download, <a href="#MAILLIST">Additional
          Resources</a></dt>

          <dt>FAQ, <a href="#AEN216">Frequently Asked
          Questions</a></dt>

          <dt>Frequently Asked Questions, <a href=
          "#AEN216">Frequently Asked Questions</a></dt>

          <dt>FTP site, <a href="#MAILLIST">Additional
          Resources</a></dt>

          <dt>History, <a href="#SECFEATURES">What is
          LPRng?</a></dt>

          <dt>Mailing List, <a href="#MAILLIST">Additional
          Resources</a></dt>

          <dt>Tutorial notes, <a href="#MAILLIST">Additional
          Resources</a></dt>
        </dl>
      </div>
    </div>
    <hr>
  </body>
</html>

